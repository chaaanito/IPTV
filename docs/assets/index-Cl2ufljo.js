function Rm(t,r){for(var i=0;i<r.length;i++){const o=r[i];if(typeof o!="string"&&!Array.isArray(o)){for(const d in o)if(d!=="default"&&!(d in t)){const p=Object.getOwnPropertyDescriptor(o,d);p&&Object.defineProperty(t,d,p.get?p:{enumerable:!0,get:()=>o[d]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function i(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(d){if(d.ep)return;d.ep=!0;const p=i(d);fetch(d.href,p)}})();const xh=!1;var Ms=Array.isArray,km=Array.prototype.indexOf,Gc=Array.from,yc=Object.defineProperty,da=Object.getOwnPropertyDescriptor,Ah=Object.getOwnPropertyDescriptors,wm=Object.prototype,Im=Array.prototype,jc=Object.getPrototypeOf,Zf=Object.isExtensible;function uo(t){return typeof t=="function"}const rn=()=>{};function Pm(t){return t()}function _o(t){for(var r=0;r<t.length;r++)t[r]()}function Dm(){var t,r,i=new Promise((o,d)=>{t=o,r=d});return{promise:i,resolve:t,reject:r}}const Dn=2,Vc=4,$l=8,Do=16,Ki=32,Na=64,Ch=128,Kn=256,Nl=512,nn=1024,Hn=2048,Hi=4096,ai=8192,Fa=16384,Kc=32768,Mo=65536,ed=1<<17,Mm=1<<18,Hc=1<<19,qc=1<<20,bc=1<<21,Wc=1<<22,Ia=1<<23,Si=Symbol("$state"),Lh=Symbol("legacy props"),Om=Symbol(""),Yc=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Nm(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Oo(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Fm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Bm(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Um(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Gm(t){throw new Error("https://svelte.dev/e/effect_orphan")}function jm(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Vm(t){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function Km(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Hm(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function qm(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Wm(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Xl=1,Ql=2,Rh=4,Ym=8,zm=16,$m=1,Xm=2,Qm=4,Jm=8,Zm=16,e0=1,t0=2,Hr=Symbol(),r0="http://www.w3.org/1999/xhtml",n0="@attach";function i0(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let a0=!1;function kh(t){return t===this.v}function wh(t,r){return t!=t?r==r:t!==r||t!==null&&typeof t=="object"||typeof t=="function"}function Ih(t){return!wh(t,this.v)}let Os=!1,s0=!1;function o0(){Os=!0}let qt=null;function Fl(t){qt=t}function td(t){return zc().get(t)}function l0(t,r){return zc().set(t,r),r}function u0(t){return zc().has(t)}function Ba(t,r=!1,i){qt={p:qt,c:null,e:null,s:t,x:null,l:Os&&!r?{s:null,u:null,$:[]}:null}}function Ua(t){var r=qt,i=r.e;if(i!==null){r.e=null;for(var o of i)Wh(o)}return qt=r.p,{}}function Ns(){return!Os||qt!==null&&qt.l===null}function zc(t){return qt===null&&Oo(),qt.c??=new Map(c0(qt)||void 0)}function c0(t){let r=t.p;for(;r!==null;){const i=r.c;if(i!==null)return i;r=r.p}return null}const f0=new WeakMap;function d0(t){var r=Ut;if(r===null)return Bt.f|=Ia,t;if((r.f&Kc)===0){if((r.f&Ch)===0)throw!r.parent&&t instanceof Error&&Ph(t),t;r.b.error(t)}else $c(t,r)}function $c(t,r){for(;r!==null;){if((r.f&Ch)!==0)try{r.b.error(t);return}catch(i){t=i}r=r.parent}throw t instanceof Error&&Ph(t),t}function Ph(t){const r=f0.get(t);r&&(yc(t,"message",{value:r.message}),yc(t,"stack",{value:r.stack}))}let To=[],Ec=[];function Dh(){var t=To;To=[],_o(t)}function h0(){var t=Ec;Ec=[],_o(t)}function No(t){To.length===0&&queueMicrotask(Dh),To.push(t)}function p0(){To.length>0&&Dh(),Ec.length>0&&h0()}function v0(t){let r=0,i=Is(0),o;return()=>{k0()&&(Q(i),Bo(()=>(r===0&&(o=dn(()=>t(()=>yo(i)))),r+=1,()=>{No(()=>{r-=1,r===0&&(o?.(),o=void 0,yo(i))})})))}}function g0(){for(var t=Ut.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&Nm(),t}function Fo(t){var r=Dn|Hn,i=Bt!==null&&(Bt.f&Dn)!==0?Bt:null;return Ut===null||i!==null&&(i.f&Kn)!==0?r|=Kn:Ut.f|=Hc,{ctx:qt,deps:null,effects:null,equals:kh,f:r,fn:t,reactions:null,rv:0,v:Hr,wv:0,parent:i??Ut,ac:null}}function m0(t,r){let i=Ut;i===null&&Fm();var o=i.b,d=void 0,p=Is(Hr),b=null,_=!Bt;return M0(()=>{try{var x=t()}catch(W){x=Promise.reject(W)}var R=()=>x;d=b?.then(R,R)??Promise.resolve(x),b=d;var P=Wt,O=o.pending;_&&(o.update_pending_count(1),O||P.increment());const F=(W,H=void 0)=>{b=null,O||P.activate(),H?H!==Yc&&(p.f|=Ia,So(p,H)):((p.f&Ia)!==0&&(p.f^=Ia),So(p,W)),_&&(o.update_pending_count(-1),O||P.decrement()),Fh()};if(d.then(F,W=>F(null,W||"unknown")),P)return()=>{queueMicrotask(()=>P.neuter())}}),new Promise(x=>{function R(P){function O(){P===d?x(p):R(d)}P.then(O,O)}R(d)})}function Rt(t){const r=Fo(t);return Jh(r),r}function Xc(t){const r=Fo(t);return r.equals=Ih,r}function Mh(t){var r=t.effects;if(r!==null){t.effects=null;for(var i=0;i<r.length;i+=1)Mn(r[i])}}function y0(t){for(var r=t.parent;r!==null;){if((r.f&Dn)===0)return r;r=r.parent}return null}function Qc(t){var r,i=Ut;pa(y0(t));try{Mh(t),r=rp(t)}finally{pa(i)}return r}function Oh(t){var r=Qc(t);if(t.equals(r)||(t.v=r,t.wv=ep()),!ja)if(ks!==null)ks.set(t,t.v);else{var i=(ua||(t.f&Kn)!==0)&&t.deps!==null?Hi:nn;yn(t,i)}}function Nh(t,r,i){const o=Ns()?Fo:Xc;if(r.length===0){i(t.map(o));return}var d=Wt,p=Ut,b=b0(),_=g0();Promise.all(r.map(x=>m0(x))).then(x=>{d?.activate(),b();try{i([...t.map(o),...x])}catch(R){(p.f&Fa)===0&&$c(R,p)}d?.deactivate(),Fh()}).catch(x=>{_.error(x)})}function b0(){var t=Ut,r=Bt,i=qt;return function(){pa(t),xi(r),Fl(i)}}function Fh(){pa(null),xi(null),Fl(null)}const co=new Set;let Wt=null,Tl=null,ks=null,rd=new Set,Bl=[];function Bh(){const t=Bl.shift();Bl.length>0&&queueMicrotask(Bh),t()}let Ma=[],Jl=null,_c=!1,Sl=!1;class ws{current=new Map;#e=new Map;#t=new Set;#r=0;#u=null;#c=!1;#i=[];#s=[];#a=[];#n=[];#o=[];#f=[];#d=[];skipped_effects=new Set;process(r){Ma=[],Tl=null;var i=null;if(co.size>1){i=new Map,ks=new Map;for(const[p,b]of this.current)i.set(p,{v:p.v,wv:p.wv}),p.v=b;for(const p of co)if(p!==this)for(const[b,_]of p.#e)i.has(b)||(i.set(b,{v:b.v,wv:b.wv}),b.v=_)}for(const p of r)this.#p(p);if(this.#i.length===0&&this.#r===0){this.#h();var o=this.#a,d=this.#n;this.#a=[],this.#n=[],this.#o=[],Tl=Wt,Wt=null,nd(o),nd(d),Wt===null?Wt=this:co.delete(this),this.#u?.resolve()}else this.#l(this.#a),this.#l(this.#n),this.#l(this.#o);if(i){for(const[p,{v:b,wv:_}]of i)p.wv<=_&&(p.v=b);ks=null}for(const p of this.#i)Ls(p);for(const p of this.#s)Ls(p);this.#i=[],this.#s=[]}#p(r){r.f^=nn;for(var i=r.first;i!==null;){var o=i.f,d=(o&(Ki|Na))!==0,p=d&&(o&nn)!==0,b=p||(o&ai)!==0||this.skipped_effects.has(i);if(!b&&i.fn!==null){if(d)i.f^=nn;else if((o&nn)===0)if((o&Vc)!==0)this.#n.push(i);else if((o&Wc)!==0){var _=i.b?.pending?this.#s:this.#i;_.push(i)}else Uo(i)&&((i.f&Do)!==0&&this.#o.push(i),Ls(i));var x=i.first;if(x!==null){i=x;continue}}var R=i.parent;for(i=i.next;i===null&&R!==null;)i=R.next,R=R.parent}}#l(r){for(const i of r)((i.f&Hn)!==0?this.#f:this.#d).push(i),yn(i,nn);r.length=0}capture(r,i){this.#e.has(r)||this.#e.set(r,i),this.current.set(r,r.v)}activate(){Wt=this}deactivate(){Wt=null,Tl=null;for(const r of rd)if(rd.delete(r),r(),Wt!==null)break}neuter(){this.#c=!0}flush(){Ma.length>0?Uh():this.#h(),Wt===this&&(this.#r===0&&co.delete(this),this.deactivate())}#h(){if(!this.#c)for(const r of this.#t)r();this.#t.clear()}increment(){this.#r+=1}decrement(){if(this.#r-=1,this.#r===0){for(const r of this.#f)yn(r,Hn),Oa(r);for(const r of this.#d)yn(r,Hi),Oa(r);this.#a=[],this.#n=[],this.flush()}else this.deactivate()}add_callback(r){this.#t.add(r)}settled(){return(this.#u??=Dm()).promise}static ensure(){if(Wt===null){const r=Wt=new ws;co.add(Wt),Sl||ws.enqueue(()=>{Wt===r&&r.flush()})}return Wt}static enqueue(r){Bl.length===0&&queueMicrotask(Bh),Bl.unshift(r)}}function E0(t){var r=Sl;Sl=!0;try{for(var i;;){if(p0(),Ma.length===0&&(Wt?.flush(),Ma.length===0))return Jl=null,i;Uh()}}finally{Sl=r}}function Uh(){var t=Cs;_c=!0;try{var r=0;for(ld(!0);Ma.length>0;){var i=ws.ensure();if(r++>1e3){var o,d;_0()}i.process(Ma),Pa.clear()}}finally{_c=!1,ld(t),Jl=null}}function _0(){try{jm()}catch(t){$c(t,Jl)}}function nd(t){var r=t.length;if(r!==0){for(var i=0;i<r;){var o=t[i++];if((o.f&(Fa|ai))===0&&Uo(o)){var d=Wt?Wt.current.size:0;if(Ls(o),o.deps===null&&o.first===null&&o.nodes_start===null&&(o.teardown===null&&o.ac===null?$h(o):o.fn=null),Wt!==null&&Wt.current.size>d&&(o.f&qc)!==0)break}}for(;i<r;)Oa(t[i++])}}function Oa(t){for(var r=Jl=t;r.parent!==null;){r=r.parent;var i=r.f;if(_c&&r===Ut&&(i&Do)!==0)return;if((i&(Na|Ki))!==0){if((i&nn)===0)return;r.f^=nn}}Ma.push(r)}const Pa=new Map;function Is(t,r){var i={f:0,v:t,reactions:null,equals:kh,rv:0,wv:0};return i}function Pt(t,r){const i=Is(t);return Jh(i),i}function xl(t,r=!1,i=!0){const o=Is(t);return r||(o.equals=Ih),Os&&i&&qt!==null&&qt.l!==null&&(qt.l.s??=[]).push(o),o}function qe(t,r,i=!1){Bt!==null&&(!ii||(Bt.f&ed)!==0)&&Ns()&&(Bt.f&(Dn|Do|Wc|ed))!==0&&!Gi?.includes(t)&&Wm();let o=i?jn(r):r;return So(t,o)}function So(t,r){if(!t.equals(r)){var i=t.v;ja?Pa.set(t,r):Pa.set(t,i),t.v=r;var o=ws.ensure();o.capture(t,i),(t.f&Dn)!==0&&((t.f&Hn)!==0&&Qc(t),yn(t,(t.f&Kn)===0?nn:Hi)),t.wv=ep(),Gh(t,Hn),Ns()&&Ut!==null&&(Ut.f&nn)!==0&&(Ut.f&(Ki|Na))===0&&(Gn===null?F0([t]):Gn.push(t))}return r}function id(t,r=1){var i=Q(t),o=r===1?i++:i--;return qe(t,i),o}function yo(t){qe(t,t.v+1)}function Gh(t,r){var i=t.reactions;if(i!==null)for(var o=Ns(),d=i.length,p=0;p<d;p++){var b=i[p],_=b.f;if(!(!o&&b===Ut)){var x=(_&Hn)===0;x&&yn(b,r),(_&Dn)!==0?Gh(b,Hi):x&&Oa(b)}}}function jn(t){if(typeof t!="object"||t===null||Si in t)return t;const r=jc(t);if(r!==wm&&r!==Im)return t;var i=new Map,o=Ms(t),d=Pt(0),p=Da,b=_=>{if(Da===p)return _();var x=Bt,R=Da;xi(null),cd(p);var P=_();return xi(x),cd(R),P};return o&&i.set("length",Pt(t.length)),new Proxy(t,{defineProperty(_,x,R){(!("value"in R)||R.configurable===!1||R.enumerable===!1||R.writable===!1)&&Hm();var P=i.get(x);return P===void 0?P=b(()=>{var O=Pt(R.value);return i.set(x,O),O}):qe(P,R.value,!0),!0},deleteProperty(_,x){var R=i.get(x);if(R===void 0){if(x in _){const P=b(()=>Pt(Hr));i.set(x,P),yo(d)}}else qe(R,Hr),yo(d);return!0},get(_,x,R){if(x===Si)return t;var P=i.get(x),O=x in _;if(P===void 0&&(!O||da(_,x)?.writable)&&(P=b(()=>{var W=jn(O?_[x]:Hr),H=Pt(W);return H}),i.set(x,P)),P!==void 0){var F=Q(P);return F===Hr?void 0:F}return Reflect.get(_,x,R)},getOwnPropertyDescriptor(_,x){var R=Reflect.getOwnPropertyDescriptor(_,x);if(R&&"value"in R){var P=i.get(x);P&&(R.value=Q(P))}else if(R===void 0){var O=i.get(x),F=O?.v;if(O!==void 0&&F!==Hr)return{enumerable:!0,configurable:!0,value:F,writable:!0}}return R},has(_,x){if(x===Si)return!0;var R=i.get(x),P=R!==void 0&&R.v!==Hr||Reflect.has(_,x);if(R!==void 0||Ut!==null&&(!P||da(_,x)?.writable)){R===void 0&&(R=b(()=>{var F=P?jn(_[x]):Hr,W=Pt(F);return W}),i.set(x,R));var O=Q(R);if(O===Hr)return!1}return P},set(_,x,R,P){var O=i.get(x),F=x in _;if(o&&x==="length")for(var W=R;W<O.v;W+=1){var H=i.get(W+"");H!==void 0?qe(H,Hr):W in _&&(H=b(()=>Pt(Hr)),i.set(W+"",H))}if(O===void 0)(!F||da(_,x)?.writable)&&(O=b(()=>Pt(void 0)),qe(O,jn(R)),i.set(x,O));else{F=O.v!==Hr;var Z=b(()=>jn(R));qe(O,Z)}var _e=Reflect.getOwnPropertyDescriptor(_,x);if(_e?.set&&_e.set.call(P,R),!F){if(o&&typeof x=="string"){var me=i.get("length"),le=Number(x);Number.isInteger(le)&&le>=me.v&&qe(me,le+1)}yo(d)}return!0},ownKeys(_){Q(d);var x=Reflect.ownKeys(_).filter(O=>{var F=i.get(O);return F===void 0||F.v!==Hr});for(var[R,P]of i)P.v!==Hr&&!(R in _)&&x.push(R);return x},setPrototypeOf(){qm()}})}function ad(t){try{if(t!==null&&typeof t=="object"&&Si in t)return t[Si]}catch{}return t}function T0(t,r){return Object.is(ad(t),ad(r))}var sd,jh,Vh,Kh;function S0(){if(sd===void 0){sd=window,jh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,r=Node.prototype,i=Text.prototype;Vh=da(r,"firstChild").get,Kh=da(r,"nextSibling").get,Zf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Zf(i)&&(i.__t=void 0)}}function Ga(t=""){return document.createTextNode(t)}function Ps(t){return Vh.call(t)}function Zl(t){return Kh.call(t)}function Qt(t,r){return Ps(t)}function yt(t,r){{var i=Ps(t);return i instanceof Comment&&i.data===""?Zl(i):i}}function Or(t,r=1,i=!1){let o=t;for(;r--;)o=Zl(o);return o}function x0(t){t.textContent=""}function Jc(){return!1}function A0(t,r){if(r){const i=document.body;t.autofocus=!0,No(()=>{document.activeElement===i&&t.focus()})}}let od=!1;function C0(){od||(od=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const r of t.target.elements)r.__on_r?.()})},{capture:!0}))}function eu(t){var r=Bt,i=Ut;xi(null),pa(null);try{return t()}finally{xi(r),pa(i)}}function L0(t,r,i,o=i){t.addEventListener(r,()=>eu(i));const d=t.__on_r;d?t.__on_r=()=>{d(),o(!0)}:t.__on_r=()=>o(!0),C0()}function Hh(t){Ut===null&&Bt===null&&Gm(),Bt!==null&&(Bt.f&Kn)!==0&&Ut===null&&Um(),ja&&Bm()}function R0(t,r){var i=r.last;i===null?r.last=r.first=t:(i.next=t,t.prev=i,r.last=t)}function Ai(t,r,i,o=!0){var d=Ut;d!==null&&(d.f&ai)!==0&&(t|=ai);var p={ctx:qt,deps:null,nodes_start:null,nodes_end:null,f:t|Hn,first:null,fn:r,last:null,next:null,parent:d,b:d&&d.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(i)try{Ls(p),p.f|=Kc}catch(x){throw Mn(p),x}else r!==null&&Oa(p);var b=i&&p.deps===null&&p.first===null&&p.nodes_start===null&&p.teardown===null&&(p.f&Hc)===0;if(!b&&o&&(d!==null&&R0(p,d),Bt!==null&&(Bt.f&Dn)!==0&&(t&Na)===0)){var _=Bt;(_.effects??=[]).push(p)}return p}function k0(){return Bt!==null&&!ii}function qh(t){const r=Ai($l,null,!1);return yn(r,nn),r.teardown=t,r}function Vn(t){Hh();var r=Ut.f,i=!Bt&&(r&Ki)!==0&&(r&Kc)===0;if(i){var o=qt;(o.e??=[]).push(t)}else return Wh(t)}function Wh(t){return Ai(Vc|qc,t,!1)}function w0(t){return Hh(),Ai($l|qc,t,!0)}function I0(t){ws.ensure();const r=Ai(Na,t,!0);return(i={})=>new Promise(o=>{i.outro?tu(r,()=>{Mn(r),o(void 0)}):(Mn(r),o(void 0))})}function Zc(t){return Ai(Vc,t,!1)}function P0(t,r){var i=qt,o={effect:null,ran:!1,deps:t};i.l.$.push(o),o.effect=Bo(()=>{t(),!o.ran&&(o.ran=!0,dn(r))})}function D0(){var t=qt;Bo(()=>{for(var r of t.l.$){r.deps();var i=r.effect;(i.f&nn)!==0&&yn(i,Hi),Uo(i)&&Ls(i),r.ran=!1}})}function M0(t){return Ai(Wc|Hc,t,!0)}function Bo(t,r=0){return Ai($l|r,t,!0)}function cn(t,r=[],i=[]){Nh(r,i,o=>{Ai($l,()=>t(...o.map(Q)),!0)})}function Fs(t,r=0){var i=Ai(Do|r,t,!0);return i}function ji(t,r=!0){return Ai(Ki,t,!0,r)}function Yh(t){var r=t.teardown;if(r!==null){const i=ja,o=Bt;ud(!0),xi(null);try{r.call(null)}finally{ud(i),xi(o)}}}function zh(t,r=!1){var i=t.first;for(t.first=t.last=null;i!==null;){const d=i.ac;d!==null&&eu(()=>{d.abort(Yc)});var o=i.next;(i.f&Na)!==0?i.parent=null:Mn(i,r),i=o}}function O0(t){for(var r=t.first;r!==null;){var i=r.next;(r.f&Ki)===0&&Mn(r),r=i}}function Mn(t,r=!0){var i=!1;(r||(t.f&Mm)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(N0(t.nodes_start,t.nodes_end),i=!0),zh(t,r&&!i),Ul(t,0),yn(t,Fa);var o=t.transitions;if(o!==null)for(const p of o)p.stop();Yh(t);var d=t.parent;d!==null&&d.first!==null&&$h(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function N0(t,r){for(;t!==null;){var i=t===r?null:Zl(t);t.remove(),t=i}}function $h(t){var r=t.parent,i=t.prev,o=t.next;i!==null&&(i.next=o),o!==null&&(o.prev=i),r!==null&&(r.first===t&&(r.first=o),r.last===t&&(r.last=i))}function tu(t,r){var i=[];ef(t,i,!0),Xh(i,()=>{Mn(t),r&&r()})}function Xh(t,r){var i=t.length;if(i>0){var o=()=>--i||r();for(var d of t)d.out(o)}else r()}function ef(t,r,i){if((t.f&ai)===0){if(t.f^=ai,t.transitions!==null)for(const b of t.transitions)(b.is_global||i)&&r.push(b);for(var o=t.first;o!==null;){var d=o.next,p=(o.f&Mo)!==0||(o.f&Ki)!==0;ef(o,r,p?i:!1),o=d}}}function tf(t){Qh(t,!0)}function Qh(t,r){if((t.f&ai)!==0){t.f^=ai,(t.f&nn)===0&&(yn(t,Hn),Oa(t));for(var i=t.first;i!==null;){var o=i.next,d=(i.f&Mo)!==0||(i.f&Ki)!==0;Qh(i,d?r:!1),i=o}if(t.transitions!==null)for(const p of t.transitions)(p.is_global||r)&&p.in()}}let Cs=!1;function ld(t){Cs=t}let ja=!1;function ud(t){ja=t}let Bt=null,ii=!1;function xi(t){Bt=t}let Ut=null;function pa(t){Ut=t}let Gi=null;function Jh(t){Bt!==null&&(Gi===null?Gi=[t]:Gi.push(t))}let mn=null,Pn=0,Gn=null;function F0(t){Gn=t}let Zh=1,xo=0,Da=xo;function cd(t){Da=t}let ua=!1;function ep(){return++Zh}function Uo(t){var r=t.f;if((r&Hn)!==0)return!0;if((r&Hi)!==0){var i=t.deps,o=(r&Kn)!==0;if(i!==null){var d,p,b=(r&Nl)!==0,_=o&&Ut!==null&&!ua,x=i.length;if((b||_)&&(Ut===null||(Ut.f&Fa)===0)){var R=t,P=R.parent;for(d=0;d<x;d++)p=i[d],(b||!p?.reactions?.includes(R))&&(p.reactions??=[]).push(R);b&&(R.f^=Nl),_&&P!==null&&(P.f&Kn)===0&&(R.f^=Kn)}for(d=0;d<x;d++)if(p=i[d],Uo(p)&&Oh(p),p.wv>t.wv)return!0}(!o||Ut!==null&&!ua)&&yn(t,nn)}return!1}function tp(t,r,i=!0){var o=t.reactions;if(o!==null&&!Gi?.includes(t))for(var d=0;d<o.length;d++){var p=o[d];(p.f&Dn)!==0?tp(p,r,!1):r===p&&(i?yn(p,Hn):(p.f&nn)!==0&&yn(p,Hi),Oa(p))}}function rp(t){var r=mn,i=Pn,o=Gn,d=Bt,p=ua,b=Gi,_=qt,x=ii,R=Da,P=t.f;mn=null,Pn=0,Gn=null,ua=(P&Kn)!==0&&(ii||!Cs||Bt===null),Bt=(P&(Ki|Na))===0?t:null,Gi=null,Fl(t.ctx),ii=!1,Da=++xo,t.ac!==null&&(eu(()=>{t.ac.abort(Yc)}),t.ac=null);try{t.f|=bc;var O=t.fn,F=O(),W=t.deps;if(mn!==null){var H;if(Ul(t,Pn),W!==null&&Pn>0)for(W.length=Pn+mn.length,H=0;H<mn.length;H++)W[Pn+H]=mn[H];else t.deps=W=mn;if(!ua||(P&Dn)!==0&&t.reactions!==null)for(H=Pn;H<W.length;H++)(W[H].reactions??=[]).push(t)}else W!==null&&Pn<W.length&&(Ul(t,Pn),W.length=Pn);if(Ns()&&Gn!==null&&!ii&&W!==null&&(t.f&(Dn|Hi|Hn))===0)for(H=0;H<Gn.length;H++)tp(Gn[H],t);return d!==null&&d!==t&&(xo++,Gn!==null&&(o===null?o=Gn:o.push(...Gn))),(t.f&Ia)!==0&&(t.f^=Ia),F}catch(Z){return d0(Z)}finally{t.f^=bc,mn=r,Pn=i,Gn=o,Bt=d,ua=p,Gi=b,Fl(_),ii=x,Da=R}}function B0(t,r){let i=r.reactions;if(i!==null){var o=km.call(i,t);if(o!==-1){var d=i.length-1;d===0?i=r.reactions=null:(i[o]=i[d],i.pop())}}i===null&&(r.f&Dn)!==0&&(mn===null||!mn.includes(r))&&(yn(r,Hi),(r.f&(Kn|Nl))===0&&(r.f^=Nl),Mh(r),Ul(r,0))}function Ul(t,r){var i=t.deps;if(i!==null)for(var o=r;o<i.length;o++)B0(t,i[o])}function Ls(t){var r=t.f;if((r&Fa)===0){yn(t,nn);var i=Ut,o=Cs;Ut=t,Cs=!0;try{(r&Do)!==0?O0(t):zh(t),Yh(t);var d=rp(t);t.teardown=typeof d=="function"?d:null,t.wv=Zh;var p;xh&&s0&&(t.f&Hn)!==0&&t.deps}finally{Cs=o,Ut=i}}}async function U0(){await Promise.resolve(),E0()}function Q(t){var r=t.f,i=(r&Dn)!==0;if(Bt!==null&&!ii){var o=Ut!==null&&(Ut.f&Fa)!==0;if(!o&&!Gi?.includes(t)){var d=Bt.deps;if((Bt.f&bc)!==0)t.rv<xo&&(t.rv=xo,mn===null&&d!==null&&d[Pn]===t?Pn++:mn===null?mn=[t]:(!ua||!mn.includes(t))&&mn.push(t));else{(Bt.deps??=[]).push(t);var p=t.reactions;p===null?t.reactions=[Bt]:p.includes(Bt)||p.push(Bt)}}}else if(i&&t.deps===null&&t.effects===null){var b=t,_=b.parent;_!==null&&(_.f&Kn)===0&&(b.f^=Kn)}if(ja){if(Pa.has(t))return Pa.get(t);if(i){b=t;var x=b.v;return((b.f&nn)===0&&b.reactions!==null||np(b))&&(x=Qc(b)),Pa.set(b,x),x}}else if(i){if(b=t,ks?.has(b))return ks.get(b);Uo(b)&&Oh(b)}if((t.f&Ia)!==0)throw t.v;return t.v}function np(t){if(t.v===Hr)return!0;if(t.deps===null)return!1;for(const r of t.deps)if(Pa.has(r)||(r.f&Dn)!==0&&np(r))return!0;return!1}function dn(t){var r=ii;try{return ii=!0,t()}finally{ii=r}}const G0=-7169;function yn(t,r){t.f=t.f&G0|r}function ip(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Si in t)Tc(t);else if(!Array.isArray(t))for(let r in t){const i=t[r];typeof i=="object"&&i&&Si in i&&Tc(i)}}}function Tc(t,r=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!r.has(t)){r.add(t),t instanceof Date&&t.getTime();for(let o in t)try{Tc(t[o],r)}catch{}const i=jc(t);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){const o=Ah(i);for(let d in o){const p=o[d].get;if(p)try{p.call(t)}catch{}}}}}function j0(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const V0=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function K0(t){return V0.includes(t)}const H0={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function q0(t){return t=t.toLowerCase(),H0[t]??t}const W0=["touchstart","touchmove"];function Y0(t){return W0.includes(t)}const ap=new Set,Sc=new Set;function rf(t,r,i,o={}){function d(p){if(o.capture||go.call(r,p),!p.cancelBubble)return eu(()=>i?.call(this,p))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?No(()=>{r.addEventListener(t,d,o)}):r.addEventListener(t,d,o),d}function Gl(t,r,i,o={}){var d=rf(r,t,i,o);return()=>{t.removeEventListener(r,d,o)}}function sp(t,r,i,o,d){var p={capture:o,passive:d},b=rf(t,r,i,p);(r===document.body||r===window||r===document||r instanceof HTMLMediaElement)&&qh(()=>{r.removeEventListener(t,b,p)})}function ru(t){for(var r=0;r<t.length;r++)ap.add(t[r]);for(var i of Sc)i(t)}let fd=null;function go(t){var r=this,i=r.ownerDocument,o=t.type,d=t.composedPath?.()||[],p=d[0]||t.target;fd=t;var b=0,_=fd===t&&t.__root;if(_){var x=d.indexOf(_);if(x!==-1&&(r===document||r===window)){t.__root=r;return}var R=d.indexOf(r);if(R===-1)return;x<=R&&(b=x)}if(p=d[b]||t.target,p!==r){yc(t,"currentTarget",{configurable:!0,get(){return p||i}});var P=Bt,O=Ut;xi(null),pa(null);try{for(var F,W=[];p!==null;){var H=p.assignedSlot||p.parentNode||p.host||null;try{var Z=p["__"+o];if(Z!=null&&(!p.disabled||t.target===p))if(Ms(Z)){var[_e,...me]=Z;_e.apply(p,[t,...me])}else Z.call(p,t)}catch(le){F?W.push(le):F=le}if(t.cancelBubble||H===r||H===null)break;p=H}if(F){for(let le of W)queueMicrotask(()=>{throw le});throw F}}finally{t.__root=r,delete t.currentTarget,xi(P),pa(O)}}}function op(t){var r=document.createElement("template");return r.innerHTML=t.replaceAll("<!>","<!---->"),r.content}function Ao(t,r){var i=Ut;i.nodes_start===null&&(i.nodes_start=t,i.nodes_end=r)}function Yr(t,r){var i=(r&e0)!==0,o=(r&t0)!==0,d,p=!t.startsWith("<!>");return()=>{d===void 0&&(d=op(p?t:"<!>"+t),i||(d=Ps(d)));var b=o||jh?document.importNode(d,!0):d.cloneNode(!0);if(i){var _=Ps(b),x=b.lastChild;Ao(_,x)}else Ao(b,b);return b}}function z0(t,r,i="svg"){var o=!t.startsWith("<!>"),d=`<${i}>${o?t:"<!>"+t}</${i}>`,p;return()=>{if(!p){var b=op(d),_=Ps(b);p=Ps(_)}var x=p.cloneNode(!0);return Ao(x,x),x}}function Go(t,r){return z0(t,r,"svg")}function dd(t=""){{var r=Ga(t+"");return Ao(r,r),r}}function St(){var t=document.createDocumentFragment(),r=document.createComment(""),i=Ga();return t.append(r,i),Ao(r,i),t}function et(t,r){t!==null&&t.before(r)}function ka(t,r){var i=r==null?"":typeof r=="object"?r+"":r;i!==(t.__t??=t.nodeValue)&&(t.__t=i,t.nodeValue=i+"")}function $0(t,r){return X0(t,r)}const Ts=new Map;function X0(t,{target:r,anchor:i,props:o={},events:d,context:p,intro:b=!0}){S0();var _=new Set,x=O=>{for(var F=0;F<O.length;F++){var W=O[F];if(!_.has(W)){_.add(W);var H=Y0(W);r.addEventListener(W,go,{passive:H});var Z=Ts.get(W);Z===void 0?(document.addEventListener(W,go,{passive:H}),Ts.set(W,1)):Ts.set(W,Z+1)}}};x(Gc(ap)),Sc.add(x);var R=void 0,P=I0(()=>{var O=i??r.appendChild(Ga());return ji(()=>{if(p){Ba({});var F=qt;F.c=p}d&&(o.$$events=d),R=t(O,o)||{},p&&Ua()}),()=>{for(var F of _){r.removeEventListener(F,go);var W=Ts.get(F);--W===0?(document.removeEventListener(F,go),Ts.delete(F)):Ts.set(F,W)}Sc.delete(x),O!==i&&O.parentNode?.removeChild(O)}});return Q0.set(R,P),R}let Q0=new WeakMap;function Ot(t,r,i=!1){var o=t,d=null,p=null,b=Hr,_=i?Mo:0,x=!1;const R=(W,H=!0)=>{x=!0,F(H,W)};var P=null;function O(){P!==null&&(P.lastChild.remove(),o.before(P),P=null);var W=b?d:p,H=b?p:d;W&&tf(W),H&&tu(H,()=>{b?p=null:d=null})}const F=(W,H)=>{if(b!==(b=W)){var Z=Jc(),_e=o;if(Z&&(P=document.createDocumentFragment(),P.append(_e=Ga())),b?d??=H&&ji(()=>H(_e)):p??=H&&ji(()=>H(_e)),Z){var me=Wt,le=b?d:p,ce=b?p:d;le&&me.skipped_effects.delete(le),ce&&me.skipped_effects.add(ce),me.add_callback(O)}else O()}};Fs(()=>{x=!1,r(R),x||F(null,null)},_)}function J0(t,r){return r}function Z0(t,r,i){for(var o=t.items,d=[],p=r.length,b=0;b<p;b++)ef(r[b].e,d,!0);var _=p>0&&d.length===0&&i!==null;if(_){var x=i.parentNode;x0(x),x.append(i),o.clear(),yi(t,r[0].prev,r[p-1].next)}Xh(d,()=>{for(var R=0;R<p;R++){var P=r[R];_||(o.delete(P.k),yi(t,P.prev,P.next)),Mn(P.e,!_)}})}function jl(t,r,i,o,d,p=null){var b=t,_={flags:r,items:new Map,first:null},x=(r&Rh)!==0;if(x){var R=t;b=R.appendChild(Ga())}var P=null,O=!1,F=new Map,W=Xc(()=>{var me=i();return Ms(me)?me:me==null?[]:Gc(me)}),H,Z;function _e(){ey(Z,H,_,F,b,d,r,o,i),p!==null&&(H.length===0?P?tf(P):P=ji(()=>p(b)):P!==null&&tu(P,()=>{P=null}))}Fs(()=>{Z??=Ut,H=Q(W);var me=H.length;if(!(O&&me===0)){O=me===0;var le,ce,Ee,Se;if(Jc()){var z=new Set,ne=Wt;for(ce=0;ce<me;ce+=1){Ee=H[ce],Se=o(Ee,ce);var ke=_.items.get(Se)??F.get(Se);ke?(r&(Xl|Ql))!==0&&lp(ke,Ee,ce,r):(le=up(null,_,null,null,Ee,Se,ce,d,r,i,!0),F.set(Se,le)),z.add(Se)}for(const[Ce,Be]of _.items)z.has(Ce)||ne.skipped_effects.add(Be.e);ne.add_callback(_e)}else _e();Q(W)}})}function ey(t,r,i,o,d,p,b,_,x){var R=(b&Ym)!==0,P=(b&(Xl|Ql))!==0,O=r.length,F=i.items,W=i.first,H=W,Z,_e=null,me,le=[],ce=[],Ee,Se,z,ne;if(R)for(ne=0;ne<O;ne+=1)Ee=r[ne],Se=_(Ee,ne),z=F.get(Se),z!==void 0&&(z.a?.measure(),(me??=new Set).add(z));for(ne=0;ne<O;ne+=1){if(Ee=r[ne],Se=_(Ee,ne),z=F.get(Se),z===void 0){var ke=o.get(Se);if(ke!==void 0){o.delete(Se),F.set(Se,ke);var Ce=_e?_e.next:H;yi(i,_e,ke),yi(i,ke,Ce),Mu(ke,Ce,d),_e=ke}else{var Be=H?H.e.nodes_start:d;_e=up(Be,i,_e,_e===null?i.first:_e.next,Ee,Se,ne,p,b,x)}F.set(Se,_e),le=[],ce=[],H=_e.next;continue}if(P&&lp(z,Ee,ne,b),(z.e.f&ai)!==0&&(tf(z.e),R&&(z.a?.unfix(),(me??=new Set).delete(z))),z!==H){if(Z!==void 0&&Z.has(z)){if(le.length<ce.length){var ze=ce[0],Ye;_e=ze.prev;var He=le[0],xe=le[le.length-1];for(Ye=0;Ye<le.length;Ye+=1)Mu(le[Ye],ze,d);for(Ye=0;Ye<ce.length;Ye+=1)Z.delete(ce[Ye]);yi(i,He.prev,xe.next),yi(i,_e,He),yi(i,xe,ze),H=ze,_e=xe,ne-=1,le=[],ce=[]}else Z.delete(z),Mu(z,H,d),yi(i,z.prev,z.next),yi(i,z,_e===null?i.first:_e.next),yi(i,_e,z),_e=z;continue}for(le=[],ce=[];H!==null&&H.k!==Se;)(H.e.f&ai)===0&&(Z??=new Set).add(H),ce.push(H),H=H.next;if(H===null)continue;z=H}le.push(z),_e=z,H=z.next}if(H!==null||Z!==void 0){for(var er=Z===void 0?[]:Gc(Z);H!==null;)(H.e.f&ai)===0&&er.push(H),H=H.next;var Tr=er.length;if(Tr>0){var ft=(b&Rh)!==0&&O===0?d:null;if(R){for(ne=0;ne<Tr;ne+=1)er[ne].a?.measure();for(ne=0;ne<Tr;ne+=1)er[ne].a?.fix()}Z0(i,er,ft)}}R&&No(()=>{if(me!==void 0)for(z of me)z.a?.apply()}),t.first=i.first&&i.first.e,t.last=_e&&_e.e;for(var be of o.values())Mn(be.e);o.clear()}function lp(t,r,i,o){(o&Xl)!==0&&So(t.v,r),(o&Ql)!==0?So(t.i,i):t.i=i}function up(t,r,i,o,d,p,b,_,x,R,P){var O=(x&Xl)!==0,F=(x&zm)===0,W=O?F?xl(d,!1,!1):Is(d):d,H=(x&Ql)===0?b:Is(b),Z={i:H,v:W,k:p,a:null,e:null,prev:i,next:o};try{if(t===null){var _e=document.createDocumentFragment();_e.append(t=Ga())}return Z.e=ji(()=>_(t,W,H,R),a0),Z.e.prev=i&&i.e,Z.e.next=o&&o.e,i===null?P||(r.first=Z):(i.next=Z,i.e.next=Z.e),o!==null&&(o.prev=Z,o.e.prev=Z.e),Z}finally{}}function Mu(t,r,i){for(var o=t.next?t.next.e.nodes_start:i,d=r?r.e.nodes_start:i,p=t.e.nodes_start;p!==null&&p!==o;){var b=Zl(p);d.before(p),p=b}}function yi(t,r,i){r===null?t.first=i:(r.next=i,r.e.next=i&&i.e),i!==null&&(i.prev=r,i.e.prev=r&&r.e)}function ni(t,r,...i){var o=t,d=rn,p;Fs(()=>{d!==(d=r())&&(p&&(Mn(p),p=null),p=ji(()=>d(o,...i)))},Mo)}function Fi(t,r,i){var o=t,d,p,b=null,_=null;function x(){p&&(tu(p),p=null),b&&(b.lastChild.remove(),o.before(b),b=null),p=_,_=null}Fs(()=>{if(d!==(d=r())){var R=Jc();if(d){var P=o;R&&(b=document.createDocumentFragment(),b.append(P=Ga()),p&&Wt.skipped_effects.add(p)),_=ji(()=>i(P,d))}R?Wt.add_callback(x):x()}},Mo)}function ty(t,r){var i=void 0,o;Fs(()=>{i!==(i=r())&&(o&&(Mn(o),o=null),i&&(o=ji(()=>{Zc(()=>i(t))})))})}function cp(t){var r,i,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var d=t.length;for(r=0;r<d;r++)t[r]&&(i=cp(t[r]))&&(o&&(o+=" "),o+=i)}else for(i in t)t[i]&&(o&&(o+=" "),o+=i);return o}function ry(){for(var t,r,i=0,o="",d=arguments.length;i<d;i++)(t=arguments[i])&&(r=cp(t))&&(o&&(o+=" "),o+=r);return o}function bi(t){return typeof t=="object"?ry(t):t??""}const hd=[...` 	
\r\f \v\uFEFF`];function ny(t,r,i){var o=t==null?"":""+t;if(r&&(o=o?o+" "+r:r),i){for(var d in i)if(i[d])o=o?o+" "+d:d;else if(o.length)for(var p=d.length,b=0;(b=o.indexOf(d,b))>=0;){var _=b+p;(b===0||hd.includes(o[b-1]))&&(_===o.length||hd.includes(o[_]))?o=(b===0?"":o.substring(0,b))+o.substring(_+1):b=_}}return o===""?null:o}function pd(t,r=!1){var i=r?" !important;":";",o="";for(var d in t){var p=t[d];p!=null&&p!==""&&(o+=" "+d+": "+p+i)}return o}function Ou(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function iy(t,r){if(r){var i="",o,d;if(Array.isArray(r)?(o=r[0],d=r[1]):o=r,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var p=!1,b=0,_=!1,x=[];o&&x.push(...Object.keys(o).map(Ou)),d&&x.push(...Object.keys(d).map(Ou));var R=0,P=-1;const Z=t.length;for(var O=0;O<Z;O++){var F=t[O];if(_?F==="/"&&t[O-1]==="*"&&(_=!1):p?p===F&&(p=!1):F==="/"&&t[O+1]==="*"?_=!0:F==='"'||F==="'"?p=F:F==="("?b++:F===")"&&b--,!_&&p===!1&&b===0){if(F===":"&&P===-1)P=O;else if(F===";"||O===Z-1){if(P!==-1){var W=Ou(t.substring(R,P).trim());if(!x.includes(W)){F!==";"&&O++;var H=t.substring(R,O).trim();i+=" "+H+";"}}R=O+1,P=-1}}}}return o&&(i+=pd(o)),d&&(i+=pd(d,!0)),i=i.trim(),i===""?null:i}return t==null?null:String(t)}function Ei(t,r,i,o,d,p){var b=t.__className;if(b!==i||b===void 0){var _=ny(i,o,p);_==null?t.removeAttribute("class"):r?t.className=_:t.setAttribute("class",_),t.__className=i}else if(p&&d!==p)for(var x in p){var R=!!p[x];(d==null||R!==!!d[x])&&t.classList.toggle(x,R)}return p}function Nu(t,r={},i,o){for(var d in i){var p=i[d];r[d]!==p&&(i[d]==null?t.style.removeProperty(d):t.style.setProperty(d,p,o))}}function Al(t,r,i,o){var d=t.__style;if(d!==r){var p=iy(r,o);p==null?t.removeAttribute("style"):t.style.cssText=p,t.__style=r}else o&&(Array.isArray(o)?(Nu(t,i?.[0],o[0]),Nu(t,i?.[1],o[1],"important")):Nu(t,i,o));return o}function xc(t,r,i=!1){if(t.multiple){if(r==null)return;if(!Ms(r))return i0();for(var o of t.options)o.selected=r.includes(vd(o));return}for(o of t.options){var d=vd(o);if(T0(d,r)){o.selected=!0;return}}(!i||r!==void 0)&&(t.selectedIndex=-1)}function ay(t){var r=new MutationObserver(()=>{xc(t,t.__value)});r.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qh(()=>{r.disconnect()})}function vd(t){return"__value"in t?t.__value:t.value}const yl=Symbol("class"),As=Symbol("style"),fp=Symbol("is custom element"),dp=Symbol("is html");function sy(t,r){r?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function Xt(t,r,i,o){var d=hp(t);d[r]!==(d[r]=i)&&(r==="loading"&&(t[Om]=i),i==null?t.removeAttribute(r):typeof i!="string"&&pp(t).includes(r)?t[r]=i:t.setAttribute(r,i))}function oy(t,r,i,o,d=!1){var p=hp(t),b=p[fp],_=!p[dp],x=r||{},R=t.tagName==="OPTION";for(var P in r)P in i||(i[P]=null);i.class?i.class=bi(i.class):i.class=null,i[As]&&(i.style??=null);var O=pp(t);for(const ce in i){let Ee=i[ce];if(R&&ce==="value"&&Ee==null){t.value=t.__value="",x[ce]=Ee;continue}if(ce==="class"){var F=t.namespaceURI==="http://www.w3.org/1999/xhtml";Ei(t,F,Ee,o,r?.[yl],i[yl]),x[ce]=Ee,x[yl]=i[yl];continue}if(ce==="style"){Al(t,Ee,r?.[As],i[As]),x[ce]=Ee,x[As]=i[As];continue}var W=x[ce];if(!(Ee===W&&!(Ee===void 0&&t.hasAttribute(ce)))){x[ce]=Ee;var H=ce[0]+ce[1];if(H!=="$$")if(H==="on"){const Se={},z="$$"+ce;let ne=ce.slice(2);var Z=K0(ne);if(j0(ne)&&(ne=ne.slice(0,-7),Se.capture=!0),!Z&&W){if(Ee!=null)continue;t.removeEventListener(ne,x[z],Se),x[z]=null}if(Ee!=null)if(Z)t[`__${ne}`]=Ee,ru([ne]);else{let ke=function(Ce){x[ce].call(this,Ce)};var le=ke;x[z]=rf(ne,t,ke,Se)}else Z&&(t[`__${ne}`]=void 0)}else if(ce==="style")Xt(t,ce,Ee);else if(ce==="autofocus")A0(t,!!Ee);else if(!b&&(ce==="__value"||ce==="value"&&Ee!=null))t.value=t.__value=Ee;else if(ce==="selected"&&R)sy(t,Ee);else{var _e=ce;_||(_e=q0(_e));var me=_e==="defaultValue"||_e==="defaultChecked";if(Ee==null&&!b&&!me)if(p[ce]=null,_e==="value"||_e==="checked"){let Se=t;const z=r===void 0;if(_e==="value"){let ne=Se.defaultValue;Se.removeAttribute(_e),Se.defaultValue=ne,Se.value=Se.__value=z?ne:null}else{let ne=Se.defaultChecked;Se.removeAttribute(_e),Se.defaultChecked=ne,Se.checked=z?ne:!1}}else t.removeAttribute(ce);else me||O.includes(_e)&&(b||typeof Ee!="string")?(t[_e]=Ee,_e in p&&(p[_e]=Hr)):typeof Ee!="function"&&Xt(t,_e,Ee)}}}return x}function ly(t,r,i=[],o=[],d,p=!1){Nh(i,o,b=>{var _=void 0,x={},R=t.nodeName==="SELECT",P=!1;if(Fs(()=>{var F=r(...b.map(Q)),W=oy(t,_,F,d,p);P&&R&&"value"in F&&xc(t,F.value);for(let Z of Object.getOwnPropertySymbols(x))F[Z]||Mn(x[Z]);for(let Z of Object.getOwnPropertySymbols(F)){var H=F[Z];Z.description===n0&&(!_||H!==_[Z])&&(x[Z]&&Mn(x[Z]),x[Z]=ji(()=>ty(t,()=>H))),W[Z]=H}_=W}),R){var O=t;Zc(()=>{xc(O,_.value,!0),ay(O)})}P=!0})}function hp(t){return t.__attributes??={[fp]:t.nodeName.includes("-"),[dp]:t.namespaceURI===r0}}var gd=new Map;function pp(t){var r=gd.get(t.nodeName);if(r)return r;gd.set(t.nodeName,r=[]);for(var i,o=t,d=Element.prototype;d!==o;){i=Ah(o);for(var p in i)i[p].set&&r.push(p);o=jc(o)}return r}function md(t,r,i=r){var o=Ns(),d=new WeakSet;L0(t,"input",p=>{var b=p?t.defaultValue:t.value;if(b=Fu(t)?Bu(b):b,i(b),Wt!==null&&d.add(Wt),o&&b!==(b=r())){var _=t.selectionStart,x=t.selectionEnd;t.value=b??"",x!==null&&(t.selectionStart=_,t.selectionEnd=Math.min(x,t.value.length))}}),dn(r)==null&&t.value&&(i(Fu(t)?Bu(t.value):t.value),Wt!==null&&d.add(Wt)),Bo(()=>{var p=r();if(t===document.activeElement){var b=Tl??Wt;if(d.has(b))return}Fu(t)&&p===Bu(t.value)||t.type==="date"&&!p&&!t.value||p!==t.value&&(t.value=p??"")})}function Fu(t){var r=t.type;return r==="number"||r==="range"}function Bu(t){return t===""?null:+t}function yd(t,r){return t===r||t?.[Si]===r}function vp(t={},r,i,o){return Zc(()=>{var d,p;return Bo(()=>{d=p,p=[],dn(()=>{t!==i(...p)&&(r(t,...p),d&&yd(i(...d),t)&&r(null,...d))})}),()=>{No(()=>{p&&yd(i(...p),t)&&r(null,...p)})}}),t}function uy(t=!1){const r=qt,i=r.l.u;if(!i)return;let o=()=>ip(r.s);if(t){let d=0,p={};const b=Fo(()=>{let _=!1;const x=r.s;for(const R in x)x[R]!==p[R]&&(p[R]=x[R],_=!0);return _&&d++,d});o=()=>Q(b)}i.b.length&&w0(()=>{bd(r,o),_o(i.b)}),Vn(()=>{const d=dn(()=>i.m.map(Pm));return()=>{for(const p of d)typeof p=="function"&&p()}}),i.a.length&&Vn(()=>{bd(r,o),_o(i.a)})}function bd(t,r){if(t.l.s)for(const i of t.l.s)Q(i);r()}function Ed(t,r){var i=t.$$events?.[r.type],o=Ms(i)?i.slice():i==null?[]:[i];for(var d of o)d.call(this,r)}function cy(t,r,i){if(t==null)return r(void 0),i&&i(void 0),rn;const o=dn(()=>t.subscribe(r,i));return o.unsubscribe?()=>o.unsubscribe():o}const Ss=[];function gp(t,r){return{subscribe:mp(t,r).subscribe}}function mp(t,r=rn){let i=null;const o=new Set;function d(_){if(wh(t,_)&&(t=_,i)){const x=!Ss.length;for(const R of o)R[1](),Ss.push(R,t);if(x){for(let R=0;R<Ss.length;R+=2)Ss[R][0](Ss[R+1]);Ss.length=0}}}function p(_){d(_(t))}function b(_,x=rn){const R=[_,x];return o.add(R),o.size===1&&(i=r(d,p)||rn),_(t),()=>{o.delete(R),o.size===0&&i&&(i(),i=null)}}return{set:d,update:p,subscribe:b}}function yp(t,r,i){const o=!Array.isArray(t),d=o?[t]:t;if(!d.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const p=r.length<2;return gp(i,(b,_)=>{let x=!1;const R=[];let P=0,O=rn;const F=()=>{if(P)return;O();const H=r(o?R[0]:R,b,_);p?b(H):O=typeof H=="function"?H:rn},W=d.map((H,Z)=>cy(H,_e=>{R[Z]=_e,P&=~(1<<Z),x&&F()},()=>{P|=1<<Z}));return x=!0,F(),function(){_o(W),O(),x=!1}})}let bl=!1;function fy(t){var r=bl;try{return bl=!1,[t(),bl]}finally{bl=r}}const dy={get(t,r){if(!t.exclude.includes(r))return t.props[r]},set(t,r){return!1},getOwnPropertyDescriptor(t,r){if(!t.exclude.includes(r)&&r in t.props)return{enumerable:!0,configurable:!0,value:t.props[r]}},has(t,r){return t.exclude.includes(r)?!1:r in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(r=>!t.exclude.includes(r))}};function hy(t,r,i){return new Proxy({props:t,exclude:r},dy)}const py={get(t,r){let i=t.props.length;for(;i--;){let o=t.props[i];if(uo(o)&&(o=o()),typeof o=="object"&&o!==null&&r in o)return o[r]}},set(t,r,i){let o=t.props.length;for(;o--;){let d=t.props[o];uo(d)&&(d=d());const p=da(d,r);if(p&&p.set)return p.set(i),!0}return!1},getOwnPropertyDescriptor(t,r){let i=t.props.length;for(;i--;){let o=t.props[i];if(uo(o)&&(o=o()),typeof o=="object"&&o!==null&&r in o){const d=da(o,r);return d&&!d.configurable&&(d.configurable=!0),d}}},has(t,r){if(r===Si||r===Lh)return!1;for(let i of t.props)if(uo(i)&&(i=i()),i!=null&&r in i)return!0;return!1},ownKeys(t){const r=[];for(let i of t.props)if(uo(i)&&(i=i()),!!i){for(const o in i)r.includes(o)||r.push(o);for(const o of Object.getOwnPropertySymbols(i))r.includes(o)||r.push(o)}return r}};function bo(...t){return new Proxy({props:t},py)}function fr(t,r,i,o){var d=!Os||(i&Xm)!==0,p=(i&Jm)!==0,b=(i&Zm)!==0,_=o,x=!0,R=()=>(x&&(x=!1,_=b?dn(o):o),_),P;if(p){var O=Si in t||Lh in t;P=da(t,r)?.set??(O&&r in t?ce=>t[r]=ce:void 0)}var F,W=!1;p?[F,W]=fy(()=>t[r]):F=t[r],F===void 0&&o!==void 0&&(F=R(),P&&(d&&Km(),P(F)));var H;if(d?H=()=>{var ce=t[r];return ce===void 0?R():(x=!0,ce)}:H=()=>{var ce=t[r];return ce!==void 0&&(_=void 0),ce===void 0?_:ce},d&&(i&Qm)===0)return H;if(P){var Z=t.$$legacy;return function(ce,Ee){return arguments.length>0?((!d||!Ee||Z||W)&&P(Ee?H():ce),ce):H()}}var _e=!1,me=((i&$m)!==0?Fo:Xc)(()=>(_e=!1,H()));p&&Q(me);var le=Ut;return function(ce,Ee){if(arguments.length>0){const Se=Ee?Q(me):d&&p?jn(ce):ce;return qe(me,Se),_e=!0,_!==void 0&&(_=Se),ce}return ja&&_e||(le.f&Fa)!==0?me.v:Q(me)}}function jo(t){qt===null&&Oo(),Os&&qt.l!==null?bp(qt).m.push(t):Vn(()=>{const r=dn(t);if(typeof r=="function")return r})}function vy(t){qt===null&&Oo(),jo(()=>()=>dn(t))}function gy(t,r,{bubbles:i=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:r,bubbles:i,cancelable:o})}function my(){const t=qt;return t===null&&Oo(),(r,i,o)=>{const d=t.s.$$events?.[r];if(d){const p=Ms(d)?d.slice():[d],b=gy(r,i,o);for(const _ of p)_.call(t.x,b);return!b.defaultPrevented}return!0}}function yy(t){qt===null&&Oo(),qt.l===null&&Vm(),bp(qt).a.push(t)}function bp(t){var r=t.l;return r.u??={a:[],b:[],m:[]}}const by="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(by);o0();function Ey(t,r){if(t instanceof RegExp)return{keys:!1,pattern:t};var i,o,d,p,b=[],_="",x=t.split("/");for(x[0]||x.shift();d=x.shift();)i=d[0],i==="*"?(b.push("wild"),_+="/(.*)"):i===":"?(o=d.indexOf("?",1),p=d.indexOf(".",1),b.push(d.substring(1,~o?o:~p?p:d.length)),_+=~o&&!~p?"(?:/([^/]+?))?":"/([^/]+?)",~p&&(_+=(~o?"?":"")+"\\"+d.substring(p))):_+="/"+d;return{keys:b,pattern:new RegExp("^"+_+"/?$","i")}}function _d(){const t=window.location.href.indexOf("#/");let r=t>-1?window.location.href.substr(t+1):"/";const i=r.indexOf("?");let o="";return i>-1&&(o=r.substr(i+1),r=r.substr(0,i)),{location:r,querystring:o}}const nf=gp(null,function(r){r(_d());const i=()=>{r(_d())};return window.addEventListener("hashchange",i,!1),function(){window.removeEventListener("hashchange",i,!1)}});yp(nf,t=>t.location);yp(nf,t=>t.querystring);const Td=mp(void 0);function _y(t){t?window.scrollTo(t.__svelte_spa_router_scrollX,t.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Ty(t,r){Ba(r,!1);let i=fr(r,"routes",24,()=>({})),o=fr(r,"prefix",8,""),d=fr(r,"restoreScrollState",8,!1);class p{constructor(z,ne){if(!ne||typeof ne!="function"&&(typeof ne!="object"||ne._sveltesparouter!==!0))throw Error("Invalid component object");if(!z||typeof z=="string"&&(z.length<1||z.charAt(0)!="/"&&z.charAt(0)!="*")||typeof z=="object"&&!(z instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:ke,keys:Ce}=Ey(z);this.path=z,typeof ne=="object"&&ne._sveltesparouter===!0?(this.component=ne.component,this.conditions=ne.conditions||[],this.userData=ne.userData,this.props=ne.props||{}):(this.component=()=>Promise.resolve(ne),this.conditions=[],this.props={}),this._pattern=ke,this._keys=Ce}match(z){if(o()){if(typeof o()=="string")if(z.startsWith(o()))z=z.substr(o().length)||"/";else return null;else if(o()instanceof RegExp){const Be=z.match(o());if(Be&&Be[0])z=z.substr(Be[0].length)||"/";else return null}}const ne=this._pattern.exec(z);if(ne===null)return null;if(this._keys===!1)return ne;const ke={};let Ce=0;for(;Ce<this._keys.length;){try{ke[this._keys[Ce]]=decodeURIComponent(ne[Ce+1]||"")||null}catch{ke[this._keys[Ce]]=null}Ce++}return ke}async checkConditions(z){for(let ne=0;ne<this.conditions.length;ne++)if(!await this.conditions[ne](z))return!1;return!0}}const b=[];i()instanceof Map?i().forEach((Se,z)=>{b.push(new p(z,Se))}):Object.keys(i()).forEach(Se=>{b.push(new p(Se,i()[Se]))});let _=xl(null),x=xl(null),R=xl({});const P=my();async function O(Se,z){await U0(),P(Se,z)}let F=null,W=null;d()&&(W=Se=>{Se.state&&(Se.state.__svelte_spa_router_scrollY||Se.state.__svelte_spa_router_scrollX)?F=Se.state:F=null},window.addEventListener("popstate",W),yy(()=>{_y(F)}));let H=null,Z=null;const _e=nf.subscribe(async Se=>{H=Se;let z=0;for(;z<b.length;){const ne=b[z].match(Se.location);if(!ne){z++;continue}const ke={route:b[z].path,location:Se.location,querystring:Se.querystring,userData:b[z].userData,params:ne&&typeof ne=="object"&&Object.keys(ne).length?ne:null};if(!await b[z].checkConditions(ke)){qe(_,null),Z=null,O("conditionsFailed",ke);return}O("routeLoading",Object.assign({},ke));const Ce=b[z].component;if(Z!=Ce){Ce.loading?(qe(_,Ce.loading),Z=Ce,qe(x,Ce.loadingParams),qe(R,{}),O("routeLoaded",Object.assign({},ke,{component:Q(_),name:Q(_).name,params:Q(x)}))):(qe(_,null),Z=null);const Be=await Ce();if(Se!=H)return;qe(_,Be&&Be.default||Be),Z=Ce}ne&&typeof ne=="object"&&Object.keys(ne).length?qe(x,ne):qe(x,null),qe(R,b[z].props),O("routeLoaded",Object.assign({},ke,{component:Q(_),name:Q(_).name,params:Q(x)})).then(()=>{Td.set(Q(x))});return}qe(_,null),Z=null,Td.set(void 0)});vy(()=>{_e(),W&&window.removeEventListener("popstate",W)}),P0(()=>ip(d()),()=>{history.scrollRestoration=d()?"manual":"auto"}),D0(),uy();var me=St(),le=yt(me);{var ce=Se=>{var z=St(),ne=yt(z);Fi(ne,()=>Q(_),(ke,Ce)=>{Ce(ke,bo({get params(){return Q(x)}},()=>Q(R),{$$events:{routeEvent(Be){Ed.call(this,r,Be)}}}))}),et(Se,z)},Ee=Se=>{var z=St(),ne=yt(z);Fi(ne,()=>Q(_),(ke,Ce)=>{Ce(ke,bo(()=>Q(R),{$$events:{routeEvent(Be){Ed.call(this,r,Be)}}}))}),et(Se,z)};Ot(le,Se=>{Q(x)?Se(ce):Se(Ee,!1)})}et(t,me),Ua()}class Sy{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(r){this.flush(),this._parts.push(r)}append(r){this._pieces.push(r)}flush(){if(this._pieces.length>0){const r=new Uint8Array(this._pieces);this._parts.push(r),this._pieces=[]}}toArrayBuffer(){const r=[];for(const i of this._parts)r.push(i);return xy(r).buffer}}function xy(t){let r=0;for(const d of t)r+=d.byteLength;const i=new Uint8Array(r);let o=0;for(const d of t){const p=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);i.set(p,o),o+=d.byteLength}return i}function Ep(t){return new Ay(t).unpack()}function _p(t){const r=new Cy,i=r.pack(t);return i instanceof Promise?i.then(()=>r.getBuffer()):r.getBuffer()}class Ay{constructor(r){this.index=0,this.dataBuffer=r,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const r=this.unpack_uint8();if(r<128)return r;if((r^224)<32)return(r^224)-32;let i;if((i=r^160)<=15)return this.unpack_raw(i);if((i=r^176)<=15)return this.unpack_string(i);if((i=r^144)<=15)return this.unpack_array(i);if((i=r^128)<=15)return this.unpack_map(i);switch(r){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return i=this.unpack_uint16(),this.unpack_string(i);case 217:return i=this.unpack_uint32(),this.unpack_string(i);case 218:return i=this.unpack_uint16(),this.unpack_raw(i);case 219:return i=this.unpack_uint32(),this.unpack_raw(i);case 220:return i=this.unpack_uint16(),this.unpack_array(i);case 221:return i=this.unpack_uint32(),this.unpack_array(i);case 222:return i=this.unpack_uint16(),this.unpack_map(i);case 223:return i=this.unpack_uint32(),this.unpack_map(i)}}unpack_uint8(){const r=this.dataView[this.index]&255;return this.index++,r}unpack_uint16(){const r=this.read(2),i=(r[0]&255)*256+(r[1]&255);return this.index+=2,i}unpack_uint32(){const r=this.read(4),i=((r[0]*256+r[1])*256+r[2])*256+r[3];return this.index+=4,i}unpack_uint64(){const r=this.read(8),i=((((((r[0]*256+r[1])*256+r[2])*256+r[3])*256+r[4])*256+r[5])*256+r[6])*256+r[7];return this.index+=8,i}unpack_int8(){const r=this.unpack_uint8();return r<128?r:r-256}unpack_int16(){const r=this.unpack_uint16();return r<32768?r:r-65536}unpack_int32(){const r=this.unpack_uint32();return r<2**31?r:r-2**32}unpack_int64(){const r=this.unpack_uint64();return r<2**63?r:r-2**64}unpack_raw(r){if(this.length<this.index+r)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${r} ${this.length}`);const i=this.dataBuffer.slice(this.index,this.index+r);return this.index+=r,i}unpack_string(r){const i=this.read(r);let o=0,d="",p,b;for(;o<r;)p=i[o],p<160?(b=p,o++):(p^192)<32?(b=(p&31)<<6|i[o+1]&63,o+=2):(p^224)<16?(b=(p&15)<<12|(i[o+1]&63)<<6|i[o+2]&63,o+=3):(b=(p&7)<<18|(i[o+1]&63)<<12|(i[o+2]&63)<<6|i[o+3]&63,o+=4),d+=String.fromCodePoint(b);return this.index+=r,d}unpack_array(r){const i=new Array(r);for(let o=0;o<r;o++)i[o]=this.unpack();return i}unpack_map(r){const i={};for(let o=0;o<r;o++){const d=this.unpack();i[d]=this.unpack()}return i}unpack_float(){const r=this.unpack_uint32(),i=r>>31,o=(r>>23&255)-127,d=r&8388607|8388608;return(i===0?1:-1)*d*2**(o-23)}unpack_double(){const r=this.unpack_uint32(),i=this.unpack_uint32(),o=r>>31,d=(r>>20&2047)-1023,b=(r&1048575|1048576)*2**(d-20)+i*2**(d-52);return(o===0?1:-1)*b}read(r){const i=this.index;if(i+r<=this.length)return this.dataView.subarray(i,i+r);throw new Error("BinaryPackFailure: read index out of range")}}class Cy{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(r){if(typeof r=="string")this.pack_string(r);else if(typeof r=="number")Math.floor(r)===r?this.pack_integer(r):this.pack_double(r);else if(typeof r=="boolean")r===!0?this._bufferBuilder.append(195):r===!1&&this._bufferBuilder.append(194);else if(r===void 0)this._bufferBuilder.append(192);else if(typeof r=="object")if(r===null)this._bufferBuilder.append(192);else{const i=r.constructor;if(r instanceof Array){const o=this.pack_array(r);if(o instanceof Promise)return o.then(()=>this._bufferBuilder.flush())}else if(r instanceof ArrayBuffer)this.pack_bin(new Uint8Array(r));else if("BYTES_PER_ELEMENT"in r){const o=r;this.pack_bin(new Uint8Array(o.buffer,o.byteOffset,o.byteLength))}else if(r instanceof Date)this.pack_string(r.toString());else{if(r instanceof Blob)return r.arrayBuffer().then(o=>{this.pack_bin(new Uint8Array(o)),this._bufferBuilder.flush()});if(i==Object||i.toString().startsWith("class")){const o=this.pack_object(r);if(o instanceof Promise)return o.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${i.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof r}" not yet supported`);this._bufferBuilder.flush()}pack_bin(r){const i=r.length;if(i<=15)this.pack_uint8(160+i);else if(i<=65535)this._bufferBuilder.append(218),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(i);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(r)}pack_string(r){const i=this._textEncoder.encode(r),o=i.length;if(o<=15)this.pack_uint8(176+o);else if(o<=65535)this._bufferBuilder.append(216),this.pack_uint16(o);else if(o<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(o);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(i)}pack_array(r){const i=r.length;if(i<=15)this.pack_uint8(144+i);else if(i<=65535)this._bufferBuilder.append(220),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(i);else throw new Error("Invalid length");const o=d=>{if(d<i){const p=this.pack(r[d]);return p instanceof Promise?p.then(()=>o(d+1)):o(d+1)}};return o(0)}pack_integer(r){if(r>=-32&&r<=127)this._bufferBuilder.append(r&255);else if(r>=0&&r<=255)this._bufferBuilder.append(204),this.pack_uint8(r);else if(r>=-128&&r<=127)this._bufferBuilder.append(208),this.pack_int8(r);else if(r>=0&&r<=65535)this._bufferBuilder.append(205),this.pack_uint16(r);else if(r>=-32768&&r<=32767)this._bufferBuilder.append(209),this.pack_int16(r);else if(r>=0&&r<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(r);else if(r>=-2147483648&&r<=2147483647)this._bufferBuilder.append(210),this.pack_int32(r);else if(r>=-9223372036854776e3&&r<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(r);else if(r>=0&&r<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(r);else throw new Error("Invalid integer")}pack_double(r){let i=0;r<0&&(i=1,r=-r);const o=Math.floor(Math.log(r)/Math.LN2),d=r/2**o-1,p=Math.floor(d*2**52),b=2**32,_=i<<31|o+1023<<20|p/b&1048575,x=p%b;this._bufferBuilder.append(203),this.pack_int32(_),this.pack_int32(x)}pack_object(r){const i=Object.keys(r),o=i.length;if(o<=15)this.pack_uint8(128+o);else if(o<=65535)this._bufferBuilder.append(222),this.pack_uint16(o);else if(o<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(o);else throw new Error("Invalid length");const d=p=>{if(p<i.length){const b=i[p];if(r.hasOwnProperty(b)){this.pack(b);const _=this.pack(r[b]);if(_ instanceof Promise)return _.then(()=>d(p+1))}return d(p+1)}};return d(0)}pack_uint8(r){this._bufferBuilder.append(r)}pack_uint16(r){this._bufferBuilder.append(r>>8),this._bufferBuilder.append(r&255)}pack_uint32(r){const i=r&4294967295;this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255)}pack_uint64(r){const i=r/4294967296,o=r%2**32;this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255),this._bufferBuilder.append((o&4278190080)>>>24),this._bufferBuilder.append((o&16711680)>>>16),this._bufferBuilder.append((o&65280)>>>8),this._bufferBuilder.append(o&255)}pack_int8(r){this._bufferBuilder.append(r&255)}pack_int16(r){this._bufferBuilder.append((r&65280)>>8),this._bufferBuilder.append(r&255)}pack_int32(r){this._bufferBuilder.append(r>>>24&255),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int64(r){const i=Math.floor(r/4294967296),o=r%2**32;this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255),this._bufferBuilder.append((o&4278190080)>>>24),this._bufferBuilder.append((o&16711680)>>>16),this._bufferBuilder.append((o&65280)>>>8),this._bufferBuilder.append(o&255)}constructor(){this._bufferBuilder=new Sy,this._textEncoder=new TextEncoder}}let Tp=!0,Sp=!0;function mo(t,r,i){const o=t.match(r);return o&&o.length>=i&&parseFloat(o[i],10)}function Va(t,r,i){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,d=o.addEventListener;o.addEventListener=function(b,_){if(b!==r)return d.apply(this,arguments);const x=R=>{const P=i(R);P&&(_.handleEvent?_.handleEvent(P):_(P))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(_,x),d.apply(this,[b,x])};const p=o.removeEventListener;o.removeEventListener=function(b,_){if(b!==r||!this._eventMap||!this._eventMap[r])return p.apply(this,arguments);if(!this._eventMap[r].has(_))return p.apply(this,arguments);const x=this._eventMap[r].get(_);return this._eventMap[r].delete(_),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,p.apply(this,[b,x])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(b){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),b&&this.addEventListener(r,this["_on"+r]=b)},enumerable:!0,configurable:!0})}function Ly(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Tp=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ry(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Sp=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function xp(){if(typeof window=="object"){if(Tp)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function af(t,r){Sp&&console.warn(t+" is deprecated, please use "+r+" instead.")}function ky(t){const r={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return r.browser="Not a browser.",r;const{navigator:i}=t;if(i.userAgentData&&i.userAgentData.brands){const o=i.userAgentData.brands.find(d=>d.brand==="Chromium");if(o)return{browser:"chrome",version:parseInt(o.version,10)}}if(i.mozGetUserMedia)r.browser="firefox",r.version=parseInt(mo(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)r.browser="chrome",r.version=parseInt(mo(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))r.browser="safari",r.version=parseInt(mo(i.userAgent,/AppleWebKit\/(\d+)\./,1)),r.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,r._safariVersion=mo(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return r.browser="Not a supported browser.",r;return r}function Sd(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ap(t){return Sd(t)?Object.keys(t).reduce(function(r,i){const o=Sd(t[i]),d=o?Ap(t[i]):t[i],p=o&&!Object.keys(d).length;return d===void 0||p?r:Object.assign(r,{[i]:d})},{}):t}function Ac(t,r,i){!r||i.has(r.id)||(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?Ac(t,t.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(d=>{Ac(t,t.get(d),i)})}))}function xd(t,r,i){const o=i?"outbound-rtp":"inbound-rtp",d=new Map;if(r===null)return d;const p=[];return t.forEach(b=>{b.type==="track"&&b.trackIdentifier===r.id&&p.push(b)}),p.forEach(b=>{t.forEach(_=>{_.type===o&&_.trackId===b.id&&Ac(t,_,d)})}),d}const Ad=xp;function Cp(t,r){const i=t&&t.navigator;if(!i.mediaDevices)return;const o=function(_){if(typeof _!="object"||_.mandatory||_.optional)return _;const x={};return Object.keys(_).forEach(R=>{if(R==="require"||R==="advanced"||R==="mediaSource")return;const P=typeof _[R]=="object"?_[R]:{ideal:_[R]};P.exact!==void 0&&typeof P.exact=="number"&&(P.min=P.max=P.exact);const O=function(F,W){return F?F+W.charAt(0).toUpperCase()+W.slice(1):W==="deviceId"?"sourceId":W};if(P.ideal!==void 0){x.optional=x.optional||[];let F={};typeof P.ideal=="number"?(F[O("min",R)]=P.ideal,x.optional.push(F),F={},F[O("max",R)]=P.ideal,x.optional.push(F)):(F[O("",R)]=P.ideal,x.optional.push(F))}P.exact!==void 0&&typeof P.exact!="number"?(x.mandatory=x.mandatory||{},x.mandatory[O("",R)]=P.exact):["min","max"].forEach(F=>{P[F]!==void 0&&(x.mandatory=x.mandatory||{},x.mandatory[O(F,R)]=P[F])})}),_.advanced&&(x.optional=(x.optional||[]).concat(_.advanced)),x},d=function(_,x){if(r.version>=61)return x(_);if(_=JSON.parse(JSON.stringify(_)),_&&typeof _.audio=="object"){const R=function(P,O,F){O in P&&!(F in P)&&(P[F]=P[O],delete P[O])};_=JSON.parse(JSON.stringify(_)),R(_.audio,"autoGainControl","googAutoGainControl"),R(_.audio,"noiseSuppression","googNoiseSuppression"),_.audio=o(_.audio)}if(_&&typeof _.video=="object"){let R=_.video.facingMode;R=R&&(typeof R=="object"?R:{ideal:R});const P=r.version<66;if(R&&(R.exact==="user"||R.exact==="environment"||R.ideal==="user"||R.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!P)){delete _.video.facingMode;let O;if(R.exact==="environment"||R.ideal==="environment"?O=["back","rear"]:(R.exact==="user"||R.ideal==="user")&&(O=["front"]),O)return i.mediaDevices.enumerateDevices().then(F=>{F=F.filter(H=>H.kind==="videoinput");let W=F.find(H=>O.some(Z=>H.label.toLowerCase().includes(Z)));return!W&&F.length&&O.includes("back")&&(W=F[F.length-1]),W&&(_.video.deviceId=R.exact?{exact:W.deviceId}:{ideal:W.deviceId}),_.video=o(_.video),Ad("chrome: "+JSON.stringify(_)),x(_)})}_.video=o(_.video)}return Ad("chrome: "+JSON.stringify(_)),x(_)},p=function(_){return r.version>=64?_:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[_.name]||_.name,message:_.message,constraint:_.constraint||_.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},b=function(_,x,R){d(_,P=>{i.webkitGetUserMedia(P,x,O=>{R&&R(p(O))})})};if(i.getUserMedia=b.bind(i),i.mediaDevices.getUserMedia){const _=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(x){return d(x,R=>_(R).then(P=>{if(R.audio&&!P.getAudioTracks().length||R.video&&!P.getVideoTracks().length)throw P.getTracks().forEach(O=>{O.stop()}),new DOMException("","NotFoundError");return P},P=>Promise.reject(p(P))))}}}function Lp(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Rp(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",d=>{let p;t.RTCPeerConnection.prototype.getReceivers?p=this.getReceivers().find(_=>_.track&&_.track.id===d.track.id):p={track:d.track};const b=new Event("track");b.track=d.track,b.receiver=p,b.transceiver={receiver:p},b.streams=[o.stream],this.dispatchEvent(b)}),o.stream.getTracks().forEach(d=>{let p;t.RTCPeerConnection.prototype.getReceivers?p=this.getReceivers().find(_=>_.track&&_.track.id===d.id):p={track:d};const b=new Event("track");b.track=d,b.receiver=p,b.transceiver={receiver:p},b.streams=[o.stream],this.dispatchEvent(b)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else Va(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function kp(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(d,p){return{track:p,get dtmf(){return this._dtmf===void 0&&(p.kind==="audio"?this._dtmf=d.createDTMFSender(p):this._dtmf=null),this._dtmf},_pc:d}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const d=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(_,x){let R=d.apply(this,arguments);return R||(R=r(this,_),this._senders.push(R)),R};const p=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(_){p.apply(this,arguments);const x=this._senders.indexOf(_);x!==-1&&this._senders.splice(x,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){this._senders=this._senders||[],i.apply(this,[p]),p.getTracks().forEach(b=>{this._senders.push(r(this,b))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){this._senders=this._senders||[],o.apply(this,[p]),p.getTracks().forEach(b=>{const _=this._senders.find(x=>x.track===b);_&&this._senders.splice(this._senders.indexOf(_),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(d=>d._pc=this),o},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function wp(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const p=i.apply(this,[]);return p.forEach(b=>b._pc=this),p});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const p=o.apply(this,arguments);return p._pc=this,p}),t.RTCRtpSender.prototype.getStats=function(){const p=this;return this._pc.getStats().then(b=>xd(b,p.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const d=i.apply(this,[]);return d.forEach(p=>p._pc=this),d}),Va(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const d=this;return this._pc.getStats().then(p=>xd(p,d.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const o=arguments[0];let d,p,b;return this.getSenders().forEach(_=>{_.track===o&&(d?b=!0:d=_)}),this.getReceivers().forEach(_=>(_.track===o&&(p?b=!0:p=_),_.track===o)),b||d&&p?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():p?p.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function Ip(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(b=>this._shimmedLocalStreams[b][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(b,_){if(!_)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const x=r.apply(this,arguments);return this._shimmedLocalStreams[_.id]?this._shimmedLocalStreams[_.id].indexOf(x)===-1&&this._shimmedLocalStreams[_.id].push(x):this._shimmedLocalStreams[_.id]=[_,x],x};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(b){this._shimmedLocalStreams=this._shimmedLocalStreams||{},b.getTracks().forEach(R=>{if(this.getSenders().find(O=>O.track===R))throw new DOMException("Track already exists.","InvalidAccessError")});const _=this.getSenders();i.apply(this,arguments);const x=this.getSenders().filter(R=>_.indexOf(R)===-1);this._shimmedLocalStreams[b.id]=[b].concat(x)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[b.id],o.apply(this,arguments)};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},b&&Object.keys(this._shimmedLocalStreams).forEach(_=>{const x=this._shimmedLocalStreams[_].indexOf(b);x!==-1&&this._shimmedLocalStreams[_].splice(x,1),this._shimmedLocalStreams[_].length===1&&delete this._shimmedLocalStreams[_]}),d.apply(this,arguments)}}function Pp(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return Ip(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const P=i.apply(this);return this._reverseStreams=this._reverseStreams||{},P.map(O=>this._reverseStreams[O.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(P){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},P.getTracks().forEach(O=>{if(this.getSenders().find(W=>W.track===O))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[P.id]){const O=new t.MediaStream(P.getTracks());this._streams[P.id]=O,this._reverseStreams[O.id]=P,P=O}o.apply(this,[P])};const d=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(P){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[P.id]||P]),delete this._reverseStreams[this._streams[P.id]?this._streams[P.id].id:P.id],delete this._streams[P.id]},t.RTCPeerConnection.prototype.addTrack=function(P,O){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const F=[].slice.call(arguments,1);if(F.length!==1||!F[0].getTracks().find(Z=>Z===P))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Z=>Z.track===P))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const H=this._streams[O.id];if(H)H.addTrack(P),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Z=new t.MediaStream([P]);this._streams[O.id]=Z,this._reverseStreams[Z.id]=O,this.addStream(Z)}return this.getSenders().find(Z=>Z.track===P)};function p(R,P){let O=P.sdp;return Object.keys(R._reverseStreams||[]).forEach(F=>{const W=R._reverseStreams[F],H=R._streams[W.id];O=O.replace(new RegExp(H.id,"g"),W.id)}),new RTCSessionDescription({type:P.type,sdp:O})}function b(R,P){let O=P.sdp;return Object.keys(R._reverseStreams||[]).forEach(F=>{const W=R._reverseStreams[F],H=R._streams[W.id];O=O.replace(new RegExp(W.id,"g"),H.id)}),new RTCSessionDescription({type:P.type,sdp:O})}["createOffer","createAnswer"].forEach(function(R){const P=t.RTCPeerConnection.prototype[R],O={[R](){const F=arguments;return arguments.length&&typeof arguments[0]=="function"?P.apply(this,[H=>{const Z=p(this,H);F[0].apply(null,[Z])},H=>{F[1]&&F[1].apply(null,H)},arguments[2]]):P.apply(this,arguments).then(H=>p(this,H))}};t.RTCPeerConnection.prototype[R]=O[R]});const _=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?_.apply(this,arguments):(arguments[0]=b(this,arguments[0]),_.apply(this,arguments))};const x=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const R=x.get.apply(this);return R.type===""?R:p(this,R)}}),t.RTCPeerConnection.prototype.removeTrack=function(P){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!P._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(P._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let F;Object.keys(this._streams).forEach(W=>{this._streams[W].getTracks().find(Z=>P.track===Z)&&(F=this._streams[W])}),F&&(F.getTracks().length===1?this.removeStream(this._reverseStreams[F.id]):F.removeTrack(P.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Cc(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],d={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=d[i]})}function Dp(t,r){Va(t,"negotiationneeded",i=>{const o=i.target;if(!((r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")&&o.signalingState!=="stable"))return i})}const Cd=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Dp,shimAddTrackRemoveTrack:Pp,shimAddTrackRemoveTrackWithNative:Ip,shimGetSendersWithDtmf:kp,shimGetUserMedia:Cp,shimMediaStream:Lp,shimOnTrack:Rp,shimPeerConnection:Cc,shimSenderReceiverGetStats:wp},Symbol.toStringTag,{value:"Module"}));function Mp(t,r){const i=t&&t.navigator,o=t&&t.MediaStreamTrack;if(i.getUserMedia=function(d,p,b){af("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(d).then(p,b)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const d=function(b,_,x){_ in b&&!(x in b)&&(b[x]=b[_],delete b[_])},p=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(b){return typeof b=="object"&&typeof b.audio=="object"&&(b=JSON.parse(JSON.stringify(b)),d(b.audio,"autoGainControl","mozAutoGainControl"),d(b.audio,"noiseSuppression","mozNoiseSuppression")),p(b)},o&&o.prototype.getSettings){const b=o.prototype.getSettings;o.prototype.getSettings=function(){const _=b.apply(this,arguments);return d(_,"mozAutoGainControl","autoGainControl"),d(_,"mozNoiseSuppression","noiseSuppression"),_}}if(o&&o.prototype.applyConstraints){const b=o.prototype.applyConstraints;o.prototype.applyConstraints=function(_){return this.kind==="audio"&&typeof _=="object"&&(_=JSON.parse(JSON.stringify(_)),d(_,"autoGainControl","mozAutoGainControl"),d(_,"noiseSuppression","mozNoiseSuppression")),b.apply(this,[_])}}}}function wy(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(o){if(!(o&&o.video)){const d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return o.video===!0?o.video={mediaSource:r}:o.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(o)})}function Op(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lc(t,r){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const p=t.RTCPeerConnection.prototype[d],b={[d](){return arguments[0]=new(d==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),p.apply(this,arguments)}};t.RTCPeerConnection.prototype[d]=b[d]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[p,b,_]=arguments;return o.apply(this,[p||null]).then(x=>{if(r.version<53&&!b)try{x.forEach(R=>{R.type=i[R.type]||R.type})}catch(R){if(R.name!=="TypeError")throw R;x.forEach((P,O)=>{x.set(O,Object.assign({},P,{type:i[P.type]||P.type}))})}return x}).then(b,_)}}function Np(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const d=r.apply(this,[]);return d.forEach(p=>p._pc=this),d});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const d=i.apply(this,arguments);return d._pc=this,d}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Fp(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=r.apply(this,[]);return o.forEach(d=>d._pc=this),o}),Va(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Bp(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(i){af("removeStream","removeTrack"),this.getSenders().forEach(o=>{o.track&&i.getTracks().includes(o.track)&&this.removeTrack(o)})})}function Up(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Gp(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;o===void 0&&(o=[]),o=[...o];const d=o.length>0;d&&o.forEach(b=>{if("rid"in b&&!/^[a-z0-9]{0,16}$/i.test(b.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in b&&!(parseFloat(b.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in b&&!(parseFloat(b.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const p=r.apply(this,arguments);if(d){const{sender:b}=p,_=b.getParameters();(!("encodings"in _)||_.encodings.length===1&&Object.keys(_.encodings[0]).length===0)&&(_.encodings=o,b.sendEncodings=o,this.setParametersPromises.push(b.setParameters(_).then(()=>{delete b.sendEncodings}).catch(()=>{delete b.sendEncodings})))}return p})}function jp(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const o=r.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function Vp(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function Kp(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}const Ld=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Gp,shimCreateAnswer:Kp,shimCreateOffer:Vp,shimGetDisplayMedia:wy,shimGetParameters:jp,shimGetUserMedia:Mp,shimOnTrack:Op,shimPeerConnection:Lc,shimRTCDataChannel:Up,shimReceiverGetStats:Fp,shimRemoveStream:Bp,shimSenderGetStats:Np},Symbol.toStringTag,{value:"Module"}));function Hp(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(o){this._localStreams||(this._localStreams=[]),this._localStreams.includes(o)||this._localStreams.push(o),o.getAudioTracks().forEach(d=>r.call(this,d,o)),o.getVideoTracks().forEach(d=>r.call(this,d,o))},t.RTCPeerConnection.prototype.addTrack=function(o,...d){return d&&d.forEach(p=>{this._localStreams?this._localStreams.includes(p)||this._localStreams.push(p):this._localStreams=[p]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const o=this._localStreams.indexOf(i);if(o===-1)return;this._localStreams.splice(o,1);const d=i.getTracks();this.getSenders().forEach(p=>{d.includes(p.track)&&this.removeTrack(p)})})}}function qp(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(d=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(d))return;this._remoteStreams.push(d);const p=new Event("addstream");p.stream=d,this.dispatchEvent(p)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(d){d.streams.forEach(p=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(p)>=0)return;o._remoteStreams.push(p);const b=new Event("addstream");b.stream=p,o.dispatchEvent(b)})}),r.apply(o,arguments)}}}function Wp(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,d=r.setLocalDescription,p=r.setRemoteDescription,b=r.addIceCandidate;r.createOffer=function(R,P){const O=arguments.length>=2?arguments[2]:arguments[0],F=i.apply(this,[O]);return P?(F.then(R,P),Promise.resolve()):F},r.createAnswer=function(R,P){const O=arguments.length>=2?arguments[2]:arguments[0],F=o.apply(this,[O]);return P?(F.then(R,P),Promise.resolve()):F};let _=function(x,R,P){const O=d.apply(this,[x]);return P?(O.then(R,P),Promise.resolve()):O};r.setLocalDescription=_,_=function(x,R,P){const O=p.apply(this,[x]);return P?(O.then(R,P),Promise.resolve()):O},r.setRemoteDescription=_,_=function(x,R,P){const O=b.apply(this,[x]);return P?(O.then(R,P),Promise.resolve()):O},r.addIceCandidate=_}function Yp(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=d=>o(zp(d))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(o,d,p){r.mediaDevices.getUserMedia(o).then(d,p)}).bind(r))}function zp(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ap(t.video)}):t}function $p(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(o,d){if(o&&o.iceServers){const p=[];for(let b=0;b<o.iceServers.length;b++){let _=o.iceServers[b];_.urls===void 0&&_.url?(af("RTCIceServer.url","RTCIceServer.urls"),_=JSON.parse(JSON.stringify(_)),_.urls=_.url,delete _.url,p.push(_)):p.push(o.iceServers[b])}o.iceServers=p}return new r(o,d)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return r.generateCertificate}})}function Xp(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qp(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(o){if(o){typeof o.offerToReceiveAudio<"u"&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);const d=this.getTransceivers().find(b=>b.receiver.track.kind==="audio");o.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):o.offerToReceiveAudio===!0&&!d&&this.addTransceiver("audio",{direction:"recvonly"}),typeof o.offerToReceiveVideo<"u"&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);const p=this.getTransceivers().find(b=>b.receiver.track.kind==="video");o.offerToReceiveVideo===!1&&p?p.direction==="sendrecv"?p.setDirection?p.setDirection("sendonly"):p.direction="sendonly":p.direction==="recvonly"&&(p.setDirection?p.setDirection("inactive"):p.direction="inactive"):o.offerToReceiveVideo===!0&&!p&&this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function Jp(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Rd=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Jp,shimCallbacksAPI:Wp,shimConstraints:zp,shimCreateOfferLegacy:Qp,shimGetUserMedia:Yp,shimLocalStreamsAPI:Hp,shimRTCIceServerUrls:$p,shimRemoteStreamsAPI:qp,shimTrackEventTransceiver:Xp},Symbol.toStringTag,{value:"Module"}));var Iy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Uu={exports:{}},kd;function Py(){return kd||(kd=1,function(t){const r={};r.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((d,p)=>(p>0?"m="+d:d).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(d=>d.indexOf(o)===0)},r.parseCandidate=function(i){let o;i.indexOf("a=candidate:")===0?o=i.substring(12).split(" "):o=i.substring(10).split(" ");const d={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let p=8;p<o.length;p+=2)switch(o[p]){case"raddr":d.relatedAddress=o[p+1];break;case"rport":d.relatedPort=parseInt(o[p+1],10);break;case"tcptype":d.tcpType=o[p+1];break;case"ufrag":d.ufrag=o[p+1],d.usernameFragment=o[p+1];break;default:d[o[p]]===void 0&&(d[o[p]]=o[p+1]);break}return d},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const d=i.component;d==="rtp"?o.push(1):d==="rtcp"?o.push(2):o.push(d),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const p=i.type;return o.push("typ"),o.push(p),p!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const d={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),d.name=o[0],d.clockRate=parseInt(o[1],10),d.channels=o.length===3?parseInt(o[2],10):1,d.numChannels=d.channels,d},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const d=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(d!==1?"/"+d:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let d;const p=i.substring(i.indexOf(" ")+1).split(";");for(let b=0;b<p.length;b++)d=p[b].trim().split("="),o[d[0].trim()]=d[1];return o},r.writeFmtp=function(i){let o="",d=i.payloadType;if(i.preferredPayloadType!==void 0&&(d=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const p=[];Object.keys(i.parameters).forEach(b=>{i.parameters[b]!==void 0?p.push(b+"="+i.parameters[b]):p.push(b)}),o+="a=fmtp:"+d+" "+p.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",d=i.payloadType;return i.preferredPayloadType!==void 0&&(d=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(p=>{o+="a=rtcp-fb:"+d+" "+p.type+(p.parameter&&p.parameter.length?" "+p.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),d={ssrc:parseInt(i.substring(7,o),10)},p=i.indexOf(":",o);return p>-1?(d.attribute=i.substring(o+1,p),d.value=i.substring(p+1)):d.attribute=i.substring(o+1),d},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(d=>parseInt(d,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let d="a=setup:"+o+`\r
`;return i.fingerprints.forEach(p=>{d+="a=fingerprint:"+p.algorithm+" "+p.value+`\r
`}),d},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const d=r.matchPrefix(i+o,"a=ice-ufrag:")[0],p=r.matchPrefix(i+o,"a=ice-pwd:")[0];return d&&p?{usernameFragment:d.substring(12),password:p.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},p=r.splitLines(i)[0].split(" ");o.profile=p[2];for(let _=3;_<p.length;_++){const x=p[_],R=r.matchPrefix(i,"a=rtpmap:"+x+" ")[0];if(R){const P=r.parseRtpMap(R),O=r.matchPrefix(i,"a=fmtp:"+x+" ");switch(P.parameters=O.length?r.parseFmtp(O[0]):{},P.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+x+" ").map(r.parseRtcpFb),o.codecs.push(P),P.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(P.name.toUpperCase());break}}}r.matchPrefix(i,"a=extmap:").forEach(_=>{o.headerExtensions.push(r.parseExtmap(_))});const b=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(_=>{b.forEach(x=>{_.rtcpFeedback.find(P=>P.type===x.type&&P.parameter===x.parameter)||_.rtcpFeedback.push(x)})}),o},r.writeRtpDescription=function(i,o){let d="";d+="m="+i+" ",d+=o.codecs.length>0?"9":"0",d+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",d+=o.codecs.map(b=>b.preferredPayloadType!==void 0?b.preferredPayloadType:b.payloadType).join(" ")+`\r
`,d+=`c=IN IP4 0.0.0.0\r
`,d+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(b=>{d+=r.writeRtpMap(b),d+=r.writeFmtp(b),d+=r.writeRtcpFb(b)});let p=0;return o.codecs.forEach(b=>{b.maxptime>p&&(p=b.maxptime)}),p>0&&(d+="a=maxptime:"+p+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(b=>{d+=r.writeExtmap(b)}),d},r.parseRtpEncodingParameters=function(i){const o=[],d=r.parseRtpParameters(i),p=d.fecMechanisms.indexOf("RED")!==-1,b=d.fecMechanisms.indexOf("ULPFEC")!==-1,_=r.matchPrefix(i,"a=ssrc:").map(F=>r.parseSsrcMedia(F)).filter(F=>F.attribute==="cname"),x=_.length>0&&_[0].ssrc;let R;const P=r.matchPrefix(i,"a=ssrc-group:FID").map(F=>F.substring(17).split(" ").map(H=>parseInt(H,10)));P.length>0&&P[0].length>1&&P[0][0]===x&&(R=P[0][1]),d.codecs.forEach(F=>{if(F.name.toUpperCase()==="RTX"&&F.parameters.apt){let W={ssrc:x,codecPayloadType:parseInt(F.parameters.apt,10)};x&&R&&(W.rtx={ssrc:R}),o.push(W),p&&(W=JSON.parse(JSON.stringify(W)),W.fec={ssrc:x,mechanism:b?"red+ulpfec":"red"},o.push(W))}}),o.length===0&&x&&o.push({ssrc:x});let O=r.matchPrefix(i,"b=");return O.length&&(O[0].indexOf("b=TIAS:")===0?O=parseInt(O[0].substring(7),10):O[0].indexOf("b=AS:")===0?O=parseInt(O[0].substring(5),10)*1e3*.95-2e3*8:O=void 0,o.forEach(F=>{F.maxBitrate=O})),o},r.parseRtcpParameters=function(i){const o={},d=r.matchPrefix(i,"a=ssrc:").map(_=>r.parseSsrcMedia(_)).filter(_=>_.attribute==="cname")[0];d&&(o.cname=d.value,o.ssrc=d.ssrc);const p=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=p.length>0,o.compound=p.length===0;const b=r.matchPrefix(i,"a=rtcp-mux");return o.mux=b.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const d=r.matchPrefix(i,"a=msid:");if(d.length===1)return o=d[0].substring(7).split(" "),{stream:o[0],track:o[1]};const p=r.matchPrefix(i,"a=ssrc:").map(b=>r.parseSsrcMedia(b)).filter(b=>b.attribute==="msid");if(p.length>0)return o=p[0].value.split(" "),{stream:o[0],track:o[1]}},r.parseSctpDescription=function(i){const o=r.parseMLine(i),d=r.matchPrefix(i,"a=max-message-size:");let p;d.length>0&&(p=parseInt(d[0].substring(19),10)),isNaN(p)&&(p=65536);const b=r.matchPrefix(i,"a=sctp-port:");if(b.length>0)return{port:parseInt(b[0].substring(12),10),protocol:o.fmt,maxMessageSize:p};const _=r.matchPrefix(i,"a=sctpmap:");if(_.length>0){const x=_[0].substring(10).split(" ");return{port:parseInt(x[0],10),protocol:x[1],maxMessageSize:p}}},r.writeSctpDescription=function(i,o){let d=[];return i.protocol!=="DTLS/SCTP"?d=["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:d=["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&d.push("a=max-message-size:"+o.maxMessageSize+`\r
`),d.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,d){let p;const b=o!==void 0?o:2;return i?p=i:p=r.generateSessionId(),`v=0\r
o=`+(d||"thisisadapterortc")+" "+p+" "+b+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const d=r.splitLines(i);for(let p=0;p<d.length;p++)switch(d[p]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[p].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const d=r.splitLines(i)[0].substring(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},r.parseOLine=function(i){const d=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let d=0;d<o.length;d++)if(o[d].length<2||o[d].charAt(1)!=="=")return!1;return!0},t.exports=r}(Uu)),Uu.exports}var Zp=Py();const Rs=nu(Zp),Dy=Rm({__proto__:null,default:Rs},[Zp]);function Cl(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(o){if(typeof o=="object"&&o.candidate&&o.candidate.indexOf("a=")===0&&(o=JSON.parse(JSON.stringify(o)),o.candidate=o.candidate.substring(2)),o.candidate&&o.candidate.length){const d=new r(o),p=Rs.parseCandidate(o.candidate);for(const b in p)b in d||Object.defineProperty(d,b,{value:p[b]});return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(o)},t.RTCIceCandidate.prototype=r.prototype,Va(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Rc(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Va(t,"icecandidate",r=>{if(r.candidate){const i=Rs.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function Ll(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(_){if(!_||!_.sdp)return!1;const x=Rs.splitSections(_.sdp);return x.shift(),x.some(R=>{const P=Rs.parseMLine(R);return P&&P.kind==="application"&&P.protocol.indexOf("SCTP")!==-1})},o=function(_){const x=_.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(x===null||x.length<2)return-1;const R=parseInt(x[1],10);return R!==R?-1:R},d=function(_){let x=65536;return r.browser==="firefox"&&(r.version<57?_===-1?x=16384:x=2147483637:r.version<60?x=r.version===57?65535:65536:x=2147483637),x},p=function(_,x){let R=65536;r.browser==="firefox"&&r.version===57&&(R=65535);const P=Rs.matchPrefix(_.sdp,"a=max-message-size:");return P.length>0?R=parseInt(P[0].substring(19),10):r.browser==="firefox"&&x!==-1&&(R=2147483637),R},b=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:x}=this.getConfiguration();x==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const x=o(arguments[0]),R=d(x),P=p(arguments[0],x);let O;R===0&&P===0?O=Number.POSITIVE_INFINITY:R===0||P===0?O=Math.max(R,P):O=Math.min(R,P);const F={};Object.defineProperty(F,"maxMessageSize",{get(){return O}}),this._sctp=F}return b.apply(this,arguments)}}function Rl(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,d){const p=o.send;o.send=function(){const _=arguments[0],x=_.length||_.size||_.byteLength;if(o.readyState==="open"&&d.sctp&&x>d.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+d.sctp.maxMessageSize+" bytes)");return p.apply(o,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const d=i.apply(this,arguments);return r(d,this),d},Va(t,"datachannel",o=>(r(o.channel,o.target),o))}function kc(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const p=d.target;if(p._lastConnectionState!==p.connectionState){p._lastConnectionState=p.connectionState;const b=new Event("connectionstatechange",d);p.dispatchEvent(b)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function wc(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r._safariVersion>=13.1)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(d){if(d&&d.sdp&&d.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const p=d.sdp.split(`
`).filter(b=>b.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&d instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:d.type,sdp:p}):d.sdp=p}return i.apply(this,arguments)}}function kl(t,r){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const i=t.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function wl(t,r){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const i=t.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let d=arguments[0]||{};if(typeof d!="object"||d.type&&d.sdp)return i.apply(this,arguments);if(d={type:d.type,sdp:d.sdp},!d.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":d.type="offer";break;default:d.type="answer";break}return d.sdp||d.type!=="offer"&&d.type!=="answer"?i.apply(this,[d]):(d.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(b=>i.apply(this,[b]))})}const My=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:wc,shimAddIceCandidateNullOrEmpty:kl,shimConnectionState:kc,shimMaxMessageSize:Ll,shimParameterlessSetLocalDescription:wl,shimRTCIceCandidate:Cl,shimRTCIceCandidateRelayProtocol:Rc,shimSendThrowTypeError:Rl},Symbol.toStringTag,{value:"Module"}));function Oy({window:t}={},r={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=xp,o=ky(t),d={browserDetails:o,commonShim:My,extractVersion:mo,disableLog:Ly,disableWarnings:Ry,sdp:Dy};switch(o.browser){case"chrome":if(!Cd||!Cc||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),d;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),d;i("adapter.js shimming chrome."),d.browserShim=Cd,kl(t,o),wl(t),Cp(t,o),Lp(t),Cc(t,o),Rp(t),Pp(t,o),kp(t),wp(t),Dp(t,o),Cl(t),Rc(t),kc(t),Ll(t,o),Rl(t),wc(t,o);break;case"firefox":if(!Ld||!Lc||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),d;i("adapter.js shimming firefox."),d.browserShim=Ld,kl(t,o),wl(t),Mp(t,o),Lc(t,o),Op(t),Bp(t),Np(t),Fp(t),Up(t),Gp(t),jp(t),Vp(t),Kp(t),Cl(t),kc(t),Ll(t,o),Rl(t);break;case"safari":if(!Rd||!r.shimSafari)return i("Safari shim is not included in this adapter release."),d;i("adapter.js shimming safari."),d.browserShim=Rd,kl(t,o),wl(t),$p(t),Qp(t),Wp(t),Hp(t),qp(t),Xp(t),Yp(t),Jp(t),Cl(t),Rc(t),Ll(t,o),Rl(t),wc(t,o);break;default:i("Unsupported browser!");break}return d}const wd=Oy({window:typeof window>"u"?void 0:window});function Ka(t,r,i,o){Object.defineProperty(t,r,{get:i,set:o,enumerable:!0,configurable:!0})}class ev{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=r=>{const i=[],o=r.byteLength,d=Math.ceil(o/this.chunkedMTU);let p=0,b=0;for(;b<o;){const _=Math.min(o,b+this.chunkedMTU),x=r.slice(b,_),R={__peerData:this._dataCount,n:p,data:x,total:d};i.push(R),b=_,p++}return this._dataCount++,i}}}function Ny(t){let r=0;for(const d of t)r+=d.byteLength;const i=new Uint8Array(r);let o=0;for(const d of t)i.set(d,o),o+=d.byteLength;return i}const Gu=wd.default||wd,fo=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),r=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?r>=this.minChromeVersion:t==="firefox"?r>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&r>=this.minSafariVersion:!1:!1}getBrowser(){return Gu.browserDetails.browser}getVersion(){return Gu.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),r=Gu.browserDetails.version||0;if(t==="chrome"&&r<this.minChromeVersion)return!1;if(t==="firefox"&&r>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let i,o=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),o=!0}catch{}finally{i&&i.close()}return o}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Fy=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),tv=()=>Math.random().toString(36).slice(2),Id={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class By extends ev{noop(){}blobToArrayBuffer(r,i){const o=new FileReader;return o.onload=function(d){d.target&&i(d.target.result)},o.readAsArrayBuffer(r),o}binaryStringToArrayBuffer(r){const i=new Uint8Array(r.length);for(let o=0;o<r.length;o++)i[o]=r.charCodeAt(o)&255;return i.buffer}isSecure(){return location.protocol==="https:"}constructor(...r){super(...r),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Id,this.browser=fo.getBrowser(),this.browserVersion=fo.getVersion(),this.pack=_p,this.unpack=Ep,this.supports=function(){const i={browser:fo.isBrowserSupported(),webRTC:fo.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!i.webRTC)return i;let o;try{o=new RTCPeerConnection(Id),i.audioVideo=!0;let d;try{d=o.createDataChannel("_PEERJSTEST",{ordered:!0}),i.data=!0,i.reliable=!!d.ordered;try{d.binaryType="blob",i.binaryBlob=!fo.isIOS}catch{}}catch{}finally{d&&d.close()}}catch{}finally{o&&o.close()}return i}(),this.validateId=Fy,this.randomToken=tv}}const xn=new By,Uy="PeerJS: ";class Gy{get logLevel(){return this._logLevel}set logLevel(r){this._logLevel=r}log(...r){this._logLevel>=3&&this._print(3,...r)}warn(...r){this._logLevel>=2&&this._print(2,...r)}error(...r){this._logLevel>=1&&this._print(1,...r)}setLogFunction(r){this._print=r}_print(r,...i){const o=[Uy,...i];for(const d in o)o[d]instanceof Error&&(o[d]="("+o[d].name+") "+o[d].message);r>=3?console.log(...o):r>=2?console.warn("WARNING",...o):r>=1&&console.error("ERROR",...o)}constructor(){this._logLevel=0}}var nt=new Gy,sf={},jy=Object.prototype.hasOwnProperty,bn="~";function Co(){}Object.create&&(Co.prototype=Object.create(null),new Co().__proto__||(bn=!1));function Vy(t,r,i){this.fn=t,this.context=r,this.once=i||!1}function rv(t,r,i,o,d){if(typeof i!="function")throw new TypeError("The listener must be a function");var p=new Vy(i,o||t,d),b=bn?bn+r:r;return t._events[b]?t._events[b].fn?t._events[b]=[t._events[b],p]:t._events[b].push(p):(t._events[b]=p,t._eventsCount++),t}function Il(t,r){--t._eventsCount===0?t._events=new Co:delete t._events[r]}function hn(){this._events=new Co,this._eventsCount=0}hn.prototype.eventNames=function(){var r=[],i,o;if(this._eventsCount===0)return r;for(o in i=this._events)jy.call(i,o)&&r.push(bn?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(i)):r};hn.prototype.listeners=function(r){var i=bn?bn+r:r,o=this._events[i];if(!o)return[];if(o.fn)return[o.fn];for(var d=0,p=o.length,b=new Array(p);d<p;d++)b[d]=o[d].fn;return b};hn.prototype.listenerCount=function(r){var i=bn?bn+r:r,o=this._events[i];return o?o.fn?1:o.length:0};hn.prototype.emit=function(r,i,o,d,p,b){var _=bn?bn+r:r;if(!this._events[_])return!1;var x=this._events[_],R=arguments.length,P,O;if(x.fn){switch(x.once&&this.removeListener(r,x.fn,void 0,!0),R){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,i),!0;case 3:return x.fn.call(x.context,i,o),!0;case 4:return x.fn.call(x.context,i,o,d),!0;case 5:return x.fn.call(x.context,i,o,d,p),!0;case 6:return x.fn.call(x.context,i,o,d,p,b),!0}for(O=1,P=new Array(R-1);O<R;O++)P[O-1]=arguments[O];x.fn.apply(x.context,P)}else{var F=x.length,W;for(O=0;O<F;O++)switch(x[O].once&&this.removeListener(r,x[O].fn,void 0,!0),R){case 1:x[O].fn.call(x[O].context);break;case 2:x[O].fn.call(x[O].context,i);break;case 3:x[O].fn.call(x[O].context,i,o);break;case 4:x[O].fn.call(x[O].context,i,o,d);break;default:if(!P)for(W=1,P=new Array(R-1);W<R;W++)P[W-1]=arguments[W];x[O].fn.apply(x[O].context,P)}}return!0};hn.prototype.on=function(r,i,o){return rv(this,r,i,o,!1)};hn.prototype.once=function(r,i,o){return rv(this,r,i,o,!0)};hn.prototype.removeListener=function(r,i,o,d){var p=bn?bn+r:r;if(!this._events[p])return this;if(!i)return Il(this,p),this;var b=this._events[p];if(b.fn)b.fn===i&&(!d||b.once)&&(!o||b.context===o)&&Il(this,p);else{for(var _=0,x=[],R=b.length;_<R;_++)(b[_].fn!==i||d&&!b[_].once||o&&b[_].context!==o)&&x.push(b[_]);x.length?this._events[p]=x.length===1?x[0]:x:Il(this,p)}return this};hn.prototype.removeAllListeners=function(r){var i;return r?(i=bn?bn+r:r,this._events[i]&&Il(this,i)):(this._events=new Co,this._eventsCount=0),this};hn.prototype.off=hn.prototype.removeListener;hn.prototype.addListener=hn.prototype.on;hn.prefixed=bn;hn.EventEmitter=hn;sf=hn;var Ha={};Ka(Ha,"ConnectionType",()=>ha);Ka(Ha,"PeerErrorType",()=>Rr);Ka(Ha,"BaseConnectionErrorType",()=>Ic);Ka(Ha,"DataConnectionErrorType",()=>of);Ka(Ha,"SerializationType",()=>iu);Ka(Ha,"SocketEventType",()=>ca);Ka(Ha,"ServerMessageType",()=>fn);var ha=function(t){return t.Data="data",t.Media="media",t}({}),Rr=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Ic=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),of=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),iu=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),ca=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),fn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const nv="1.5.5";class Ky extends sf.EventEmitter{constructor(r,i,o,d,p,b=5e3){super(),this.pingInterval=b,this._disconnected=!0,this._messagesQueue=[];const _=r?"wss://":"ws://";this._baseUrl=_+i+":"+o+d+"peerjs?key="+p}start(r,i){this._id=r;const o=`${this._baseUrl}&id=${r}&token=${i}`;this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+nv),this._disconnected=!1,this._socket.onmessage=d=>{let p;try{p=JSON.parse(d.data),nt.log("Server message received:",p)}catch{nt.log("Invalid server message",d.data);return}this.emit(ca.Message,p)},this._socket.onclose=d=>{this._disconnected||(nt.log("Socket closed.",d),this._cleanup(),this._disconnected=!0,this.emit(ca.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),nt.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){nt.log("Cannot send heartbeat, because socket closed");return}const r=JSON.stringify({type:fn.Heartbeat});this._socket.send(r),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const r=[...this._messagesQueue];this._messagesQueue=[];for(const i of r)this.send(i)}send(r){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(r);return}if(!r.type){this.emit(ca.Error,"Invalid message");return}if(!this._wsOpen())return;const i=JSON.stringify(r);this._socket.send(i)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class iv{constructor(r){this.connection=r}startConnection(r){const i=this._startPeerConnection();if(this.connection.peerConnection=i,this.connection.type===ha.Media&&r._stream&&this._addTracksToConnection(r._stream,i),r.originator){const o=this.connection,d={ordered:!!r.reliable},p=i.createDataChannel(o.label,d);o._initializeDataChannel(p),this._makeOffer()}else this.handleSDP("OFFER",r.sdp)}_startPeerConnection(){nt.log("Creating RTCPeerConnection.");const r=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(r),r}_setupListeners(r){const i=this.connection.peer,o=this.connection.connectionId,d=this.connection.type,p=this.connection.provider;nt.log("Listening for ICE candidates."),r.onicecandidate=b=>{!b.candidate||!b.candidate.candidate||(nt.log(`Received ICE candidates for ${i}:`,b.candidate),p.socket.send({type:fn.Candidate,payload:{candidate:b.candidate,type:d,connectionId:o},dst:i}))},r.oniceconnectionstatechange=()=>{switch(r.iceConnectionState){case"failed":nt.log("iceConnectionState is failed, closing connections to "+i),this.connection.emitError(Ic.NegotiationFailed,"Negotiation of connection to "+i+" failed."),this.connection.close();break;case"closed":nt.log("iceConnectionState is closed, closing connections to "+i),this.connection.emitError(Ic.ConnectionClosed,"Connection to "+i+" closed."),this.connection.close();break;case"disconnected":nt.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":r.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",r.iceConnectionState)},nt.log("Listening for data channel"),r.ondatachannel=b=>{nt.log("Received data channel");const _=b.channel;p.getConnection(i,o)._initializeDataChannel(_)},nt.log("Listening for remote stream"),r.ontrack=b=>{nt.log("Received remote stream");const _=b.streams[0],x=p.getConnection(i,o);if(x.type===ha.Media){const R=x;this._addStreamToMediaConnection(_,R)}}}cleanup(){nt.log("Cleaning up PeerConnection to "+this.connection.peer);const r=this.connection.peerConnection;if(!r)return;this.connection.peerConnection=null,r.onicecandidate=r.oniceconnectionstatechange=r.ondatachannel=r.ontrack=()=>{};const i=r.signalingState!=="closed";let o=!1;const d=this.connection.dataChannel;d&&(o=!!d.readyState&&d.readyState!=="closed"),(i||o)&&r.close()}async _makeOffer(){const r=this.connection.peerConnection,i=this.connection.provider;try{const o=await r.createOffer(this.connection.options.constraints);nt.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(o.sdp=this.connection.options.sdpTransform(o.sdp)||o.sdp);try{await r.setLocalDescription(o),nt.log("Set localDescription:",o,`for:${this.connection.peer}`);let d={sdp:o,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ha.Data){const p=this.connection;d={...d,label:p.label,reliable:p.reliable,serialization:p.serialization}}i.socket.send({type:fn.Offer,payload:d,dst:this.connection.peer})}catch(d){d!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(i.emitError(Rr.WebRTC,d),nt.log("Failed to setLocalDescription, ",d))}}catch(o){i.emitError(Rr.WebRTC,o),nt.log("Failed to createOffer, ",o)}}async _makeAnswer(){const r=this.connection.peerConnection,i=this.connection.provider;try{const o=await r.createAnswer();nt.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(o.sdp=this.connection.options.sdpTransform(o.sdp)||o.sdp);try{await r.setLocalDescription(o),nt.log("Set localDescription:",o,`for:${this.connection.peer}`),i.socket.send({type:fn.Answer,payload:{sdp:o,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(d){i.emitError(Rr.WebRTC,d),nt.log("Failed to setLocalDescription, ",d)}}catch(o){i.emitError(Rr.WebRTC,o),nt.log("Failed to create answer, ",o)}}async handleSDP(r,i){i=new RTCSessionDescription(i);const o=this.connection.peerConnection,d=this.connection.provider;nt.log("Setting remote description",i);const p=this;try{await o.setRemoteDescription(i),nt.log(`Set remoteDescription:${r} for:${this.connection.peer}`),r==="OFFER"&&await p._makeAnswer()}catch(b){d.emitError(Rr.WebRTC,b),nt.log("Failed to setRemoteDescription, ",b)}}async handleCandidate(r){nt.log("handleCandidate:",r);try{await this.connection.peerConnection.addIceCandidate(r),nt.log(`Added ICE candidate for:${this.connection.peer}`)}catch(i){this.connection.provider.emitError(Rr.WebRTC,i),nt.log("Failed to handleCandidate, ",i)}}_addTracksToConnection(r,i){if(nt.log(`add tracks from stream ${r.id} to peer connection`),!i.addTrack)return nt.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");r.getTracks().forEach(o=>{i.addTrack(o,r)})}_addStreamToMediaConnection(r,i){nt.log(`add stream ${r.id} to media connection ${i.connectionId}`),i.addStream(r)}}class av extends sf.EventEmitter{emitError(r,i){nt.error("Error:",i),this.emit("error",new Hy(`${r}`,i))}}class Hy extends Error{constructor(r,i){typeof i=="string"?super(i):(super(),Object.assign(this,i)),this.type=r}}class sv extends av{get open(){return this._open}constructor(r,i,o){super(),this.peer=r,this.provider=i,this.options=o,this._open=!1,this.metadata=o.metadata}}class Vl extends sv{static#e=this.ID_PREFIX="mc_";get type(){return ha.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(r,i,o){super(r,i,o),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Vl.ID_PREFIX+xn.randomToken(),this._negotiator=new iv(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(r){this.dataChannel=r,this.dataChannel.onopen=()=>{nt.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{nt.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(r){nt.log("Receiving stream",r),this._remoteStream=r,super.emit("stream",r)}handleMessage(r){const i=r.type,o=r.payload;switch(r.type){case fn.Answer:this._negotiator.handleSDP(i,o.sdp),this._open=!0;break;case fn.Candidate:this._negotiator.handleCandidate(o.candidate);break;default:nt.warn(`Unrecognized message type:${i} from peer:${this.peer}`);break}}answer(r,i={}){if(this._localStream){nt.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=r,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:r});const o=this.provider._getMessages(this.connectionId);for(const d of o)this.handleMessage(d);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class qy{constructor(r){this._options=r}_buildRequest(r){const i=this._options.secure?"https":"http",{host:o,port:d,path:p,key:b}=this._options,_=new URL(`${i}://${o}:${d}${p}${b}/${r}`);return _.searchParams.set("ts",`${Date.now()}${Math.random()}`),_.searchParams.set("version",nv),fetch(_.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const r=await this._buildRequest("id");if(r.status!==200)throw new Error(`Error. Status:${r.status}`);return r.text()}catch(r){nt.error("Error retrieving ID",r);let i="";throw this._options.path==="/"&&this._options.host!==xn.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i)}}async listAllPeers(){try{const r=await this._buildRequest("peers");if(r.status!==200){if(r.status===401){let i="";throw this._options.host===xn.CLOUD_HOST?i="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":i="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+i)}throw new Error(`Error. Status:${r.status}`)}return r.json()}catch(r){throw nt.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r)}}}class Kl extends sv{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return ha.Data}constructor(r,i,o){super(r,i,o),this.connectionId=this.options.connectionId||Kl.ID_PREFIX+tv(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new iv(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(r){this.dataChannel=r,this.dataChannel.onopen=()=>{nt.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=i=>{nt.log(`DC#${this.connectionId} dc onmessage:`,i.data)},this.dataChannel.onclose=()=>{nt.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(r){if(r?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(r,i=!1){if(!this.open){this.emitError(of.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(r,i)}async handleMessage(r){const i=r.payload;switch(r.type){case fn.Answer:await this._negotiator.handleSDP(r.type,i.sdp);break;case fn.Candidate:await this._negotiator.handleCandidate(i.candidate);break;default:nt.warn("Unrecognized message type:",r.type,"from peer:",this.peer);break}}}class lf extends Kl{get bufferSize(){return this._bufferSize}_initializeDataChannel(r){super._initializeDataChannel(r),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",i=>this._handleDataMessage(i))}_bufferedSend(r){(this._buffering||!this._trySend(r))&&(this._buffer.push(r),this._bufferSize=this._buffer.length)}_trySend(r){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Kl.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(r)}catch(i){return nt.error(`DC#:${this.connectionId} Error when sending:`,i),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const r=this._buffer[0];this._trySend(r)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(r){if(r?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...r){super(...r),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class ju extends lf{close(r){super.close(r),this._chunkedData={}}constructor(r,i,o){super(r,i,o),this.chunker=new ev,this.serialization=iu.Binary,this._chunkedData={}}_handleDataMessage({data:r}){const i=Ep(r),o=i.__peerData;if(o){if(o.type==="close"){this.close();return}this._handleChunk(i);return}this.emit("data",i)}_handleChunk(r){const i=r.__peerData,o=this._chunkedData[i]||{data:[],count:0,total:r.total};if(o.data[r.n]=new Uint8Array(r.data),o.count++,this._chunkedData[i]=o,o.total===o.count){delete this._chunkedData[i];const d=Ny(o.data);this._handleDataMessage({data:d})}}_send(r,i){const o=_p(r);if(o instanceof Promise)return this._send_blob(o);if(!i&&o.byteLength>this.chunker.chunkedMTU){this._sendChunks(o);return}this._bufferedSend(o)}async _send_blob(r){const i=await r;if(i.byteLength>this.chunker.chunkedMTU){this._sendChunks(i);return}this._bufferedSend(i)}_sendChunks(r){const i=this.chunker.chunk(r);nt.log(`DC#${this.connectionId} Try to send ${i.length} chunks...`);for(const o of i)this.send(o,!0)}}class Wy extends lf{_handleDataMessage({data:r}){super.emit("data",r)}_send(r,i){this._bufferedSend(r)}constructor(...r){super(...r),this.serialization=iu.None}}class Yy extends lf{_handleDataMessage({data:r}){const i=this.parse(this.decoder.decode(r)),o=i.__peerData;if(o&&o.type==="close"){this.close();return}this.emit("data",i)}_send(r,i){const o=this.encoder.encode(this.stringify(r));if(o.byteLength>=xn.chunkedMTU){this.emitError(of.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(o)}constructor(...r){super(...r),this.serialization=iu.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class au extends av{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const r=Object.create(null);for(const[i,o]of this._connections)r[i]=o;return r}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(r,i){super(),this._serializers={raw:Wy,json:Yy,binary:ju,"binary-utf8":ju,default:ju},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let o;if(r&&r.constructor==Object?i=r:r&&(o=r.toString()),i={debug:0,host:xn.CLOUD_HOST,port:xn.CLOUD_PORT,path:"/",key:au.DEFAULT_KEY,token:xn.randomToken(),config:xn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...i},this._options=i,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==xn.CLOUD_HOST?this._options.secure=xn.isSecure():this._options.host==xn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&nt.setLogFunction(this._options.logFunction),nt.logLevel=this._options.debug||0,this._api=new qy(i),this._socket=this._createServerConnection(),!xn.supports.audioVideo&&!xn.supports.data){this._delayedAbort(Rr.BrowserIncompatible,"The current browser does not support WebRTC");return}if(o&&!xn.validateId(o)){this._delayedAbort(Rr.InvalidID,`ID "${o}" is invalid`);return}o?this._initialize(o):this._api.retrieveId().then(d=>this._initialize(d)).catch(d=>this._abort(Rr.ServerError,d))}_createServerConnection(){const r=new Ky(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return r.on(ca.Message,i=>{this._handleMessage(i)}),r.on(ca.Error,i=>{this._abort(Rr.SocketError,i)}),r.on(ca.Disconnected,()=>{this.disconnected||(this.emitError(Rr.Network,"Lost connection to server."),this.disconnect())}),r.on(ca.Close,()=>{this.disconnected||this._abort(Rr.SocketClosed,"Underlying socket is already closed.")}),r}_initialize(r){this._id=r,this.socket.start(r,this._options.token)}_handleMessage(r){const i=r.type,o=r.payload,d=r.src;switch(i){case fn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case fn.Error:this._abort(Rr.ServerError,o.msg);break;case fn.IdTaken:this._abort(Rr.UnavailableID,`ID "${this.id}" is taken`);break;case fn.InvalidKey:this._abort(Rr.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case fn.Leave:nt.log(`Received leave message from ${d}`),this._cleanupPeer(d),this._connections.delete(d);break;case fn.Expire:this.emitError(Rr.PeerUnavailable,`Could not connect to peer ${d}`);break;case fn.Offer:{const p=o.connectionId;let b=this.getConnection(d,p);if(b&&(b.close(),nt.warn(`Offer received for existing Connection ID:${p}`)),o.type===ha.Media){const x=new Vl(d,this,{connectionId:p,_payload:o,metadata:o.metadata});b=x,this._addConnection(d,b),this.emit("call",x)}else if(o.type===ha.Data){const x=new this._serializers[o.serialization](d,this,{connectionId:p,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});b=x,this._addConnection(d,b),this.emit("connection",x)}else{nt.warn(`Received malformed connection type:${o.type}`);return}const _=this._getMessages(p);for(const x of _)b.handleMessage(x);break}default:{if(!o){nt.warn(`You received a malformed message from ${d} of type ${i}`);return}const p=o.connectionId,b=this.getConnection(d,p);b&&b.peerConnection?b.handleMessage(r):p?this._storeMessage(p,r):nt.warn("You received an unrecognized message:",r);break}}}_storeMessage(r,i){this._lostMessages.has(r)||this._lostMessages.set(r,[]),this._lostMessages.get(r).push(i)}_getMessages(r){const i=this._lostMessages.get(r);return i?(this._lostMessages.delete(r),i):[]}connect(r,i={}){if(i={serialization:"default",...i},this.disconnected){nt.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Rr.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const o=new this._serializers[i.serialization](r,this,i);return this._addConnection(r,o),o}call(r,i,o={}){if(this.disconnected){nt.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Rr.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){nt.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const d=new Vl(r,this,{...o,_stream:i});return this._addConnection(r,d),d}_addConnection(r,i){nt.log(`add connection ${i.type}:${i.connectionId} to peerId:${r}`),this._connections.has(r)||this._connections.set(r,[]),this._connections.get(r).push(i)}_removeConnection(r){const i=this._connections.get(r.peer);if(i){const o=i.indexOf(r);o!==-1&&i.splice(o,1)}this._lostMessages.delete(r.connectionId)}getConnection(r,i){const o=this._connections.get(r);if(!o)return null;for(const d of o)if(d.connectionId===i)return d;return null}_delayedAbort(r,i){setTimeout(()=>{this._abort(r,i)},0)}_abort(r,i){nt.error("Aborting!"),this.emitError(r,i),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(nt.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const r of this._connections.keys())this._cleanupPeer(r),this._connections.delete(r);this.socket.removeAllListeners()}_cleanupPeer(r){const i=this._connections.get(r);if(i)for(const o of i)o.close()}disconnect(){if(this.disconnected)return;const r=this.id;nt.log(`Disconnect peer with ID:${r}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=r,this._id=null,this.emit("disconnected",r)}reconnect(){if(this.disconnected&&!this.destroyed)nt.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)nt.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(r=i=>{}){this._api.listAllPeers().then(i=>r(i)).catch(i=>this._abort(Rr.ServerError,i))}}var zy=au,xs={},Vu,Pd;function $y(){return Pd||(Pd=1,Vu=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Vu}var Ku={},oa={},Dd;function qa(){if(Dd)return oa;Dd=1;let t;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return oa.getSymbolSize=function(o){if(!o)throw new Error('"version" cannot be null or undefined');if(o<1||o>40)throw new Error('"version" should be in range from 1 to 40');return o*4+17},oa.getSymbolTotalCodewords=function(o){return r[o]},oa.getBCHDigit=function(i){let o=0;for(;i!==0;)o++,i>>>=1;return o},oa.setToSJISFunction=function(o){if(typeof o!="function")throw new Error('"toSJISFunc" is not a valid function.');t=o},oa.isKanjiModeEnabled=function(){return typeof t<"u"},oa.toSJIS=function(o){return t(o)},oa}var Hu={},Md;function uf(){return Md||(Md=1,function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+i)}}t.isValid=function(o){return o&&typeof o.bit<"u"&&o.bit>=0&&o.bit<4},t.from=function(o,d){if(t.isValid(o))return o;try{return r(o)}catch{return d}}}(Hu)),Hu}var qu,Od;function Xy(){if(Od)return qu;Od=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(r){const i=Math.floor(r/8);return(this.buffer[i]>>>7-r%8&1)===1},put:function(r,i){for(let o=0;o<i;o++)this.putBit((r>>>i-o-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),r&&(this.buffer[i]|=128>>>this.length%8),this.length++}},qu=t,qu}var Wu,Nd;function Qy(){if(Nd)return Wu;Nd=1;function t(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}return t.prototype.set=function(r,i,o,d){const p=r*this.size+i;this.data[p]=o,d&&(this.reservedBit[p]=!0)},t.prototype.get=function(r,i){return this.data[r*this.size+i]},t.prototype.xor=function(r,i,o){this.data[r*this.size+i]^=o},t.prototype.isReserved=function(r,i){return this.reservedBit[r*this.size+i]},Wu=t,Wu}var Yu={},Fd;function Jy(){return Fd||(Fd=1,function(t){const r=qa().getSymbolSize;t.getRowColCoords=function(o){if(o===1)return[];const d=Math.floor(o/7)+2,p=r(o),b=p===145?26:Math.ceil((p-13)/(2*d-2))*2,_=[p-7];for(let x=1;x<d-1;x++)_[x]=_[x-1]-b;return _.push(6),_.reverse()},t.getPositions=function(o){const d=[],p=t.getRowColCoords(o),b=p.length;for(let _=0;_<b;_++)for(let x=0;x<b;x++)_===0&&x===0||_===0&&x===b-1||_===b-1&&x===0||d.push([p[_],p[x]]);return d}}(Yu)),Yu}var zu={},Bd;function Zy(){if(Bd)return zu;Bd=1;const t=qa().getSymbolSize,r=7;return zu.getPositions=function(o){const d=t(o);return[[0,0],[d-r,0],[0,d-r]]},zu}var $u={},Ud;function eb(){return Ud||(Ud=1,function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const r={N1:3,N2:3,N3:40,N4:10};t.isValid=function(d){return d!=null&&d!==""&&!isNaN(d)&&d>=0&&d<=7},t.from=function(d){return t.isValid(d)?parseInt(d,10):void 0},t.getPenaltyN1=function(d){const p=d.size;let b=0,_=0,x=0,R=null,P=null;for(let O=0;O<p;O++){_=x=0,R=P=null;for(let F=0;F<p;F++){let W=d.get(O,F);W===R?_++:(_>=5&&(b+=r.N1+(_-5)),R=W,_=1),W=d.get(F,O),W===P?x++:(x>=5&&(b+=r.N1+(x-5)),P=W,x=1)}_>=5&&(b+=r.N1+(_-5)),x>=5&&(b+=r.N1+(x-5))}return b},t.getPenaltyN2=function(d){const p=d.size;let b=0;for(let _=0;_<p-1;_++)for(let x=0;x<p-1;x++){const R=d.get(_,x)+d.get(_,x+1)+d.get(_+1,x)+d.get(_+1,x+1);(R===4||R===0)&&b++}return b*r.N2},t.getPenaltyN3=function(d){const p=d.size;let b=0,_=0,x=0;for(let R=0;R<p;R++){_=x=0;for(let P=0;P<p;P++)_=_<<1&2047|d.get(R,P),P>=10&&(_===1488||_===93)&&b++,x=x<<1&2047|d.get(P,R),P>=10&&(x===1488||x===93)&&b++}return b*r.N3},t.getPenaltyN4=function(d){let p=0;const b=d.data.length;for(let x=0;x<b;x++)p+=d.data[x];return Math.abs(Math.ceil(p*100/b/5)-10)*r.N4};function i(o,d,p){switch(o){case t.Patterns.PATTERN000:return(d+p)%2===0;case t.Patterns.PATTERN001:return d%2===0;case t.Patterns.PATTERN010:return p%3===0;case t.Patterns.PATTERN011:return(d+p)%3===0;case t.Patterns.PATTERN100:return(Math.floor(d/2)+Math.floor(p/3))%2===0;case t.Patterns.PATTERN101:return d*p%2+d*p%3===0;case t.Patterns.PATTERN110:return(d*p%2+d*p%3)%2===0;case t.Patterns.PATTERN111:return(d*p%3+(d+p)%2)%2===0;default:throw new Error("bad maskPattern:"+o)}}t.applyMask=function(d,p){const b=p.size;for(let _=0;_<b;_++)for(let x=0;x<b;x++)p.isReserved(x,_)||p.xor(x,_,i(d,x,_))},t.getBestMask=function(d,p){const b=Object.keys(t.Patterns).length;let _=0,x=1/0;for(let R=0;R<b;R++){p(R),t.applyMask(R,d);const P=t.getPenaltyN1(d)+t.getPenaltyN2(d)+t.getPenaltyN3(d)+t.getPenaltyN4(d);t.applyMask(R,d),P<x&&(x=P,_=R)}return _}}($u)),$u}var El={},Gd;function ov(){if(Gd)return El;Gd=1;const t=uf(),r=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return El.getBlocksCount=function(d,p){switch(p){case t.L:return r[(d-1)*4+0];case t.M:return r[(d-1)*4+1];case t.Q:return r[(d-1)*4+2];case t.H:return r[(d-1)*4+3];default:return}},El.getTotalCodewordsCount=function(d,p){switch(p){case t.L:return i[(d-1)*4+0];case t.M:return i[(d-1)*4+1];case t.Q:return i[(d-1)*4+2];case t.H:return i[(d-1)*4+3];default:return}},El}var Xu={},ho={},jd;function tb(){if(jd)return ho;jd=1;const t=new Uint8Array(512),r=new Uint8Array(256);return function(){let o=1;for(let d=0;d<255;d++)t[d]=o,r[o]=d,o<<=1,o&256&&(o^=285);for(let d=255;d<512;d++)t[d]=t[d-255]}(),ho.log=function(o){if(o<1)throw new Error("log("+o+")");return r[o]},ho.exp=function(o){return t[o]},ho.mul=function(o,d){return o===0||d===0?0:t[r[o]+r[d]]},ho}var Vd;function rb(){return Vd||(Vd=1,function(t){const r=tb();t.mul=function(o,d){const p=new Uint8Array(o.length+d.length-1);for(let b=0;b<o.length;b++)for(let _=0;_<d.length;_++)p[b+_]^=r.mul(o[b],d[_]);return p},t.mod=function(o,d){let p=new Uint8Array(o);for(;p.length-d.length>=0;){const b=p[0];for(let x=0;x<d.length;x++)p[x]^=r.mul(d[x],b);let _=0;for(;_<p.length&&p[_]===0;)_++;p=p.slice(_)}return p},t.generateECPolynomial=function(o){let d=new Uint8Array([1]);for(let p=0;p<o;p++)d=t.mul(d,new Uint8Array([1,r.exp(p)]));return d}}(Xu)),Xu}var Qu,Kd;function nb(){if(Kd)return Qu;Kd=1;const t=rb();function r(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}return r.prototype.initialize=function(o){this.degree=o,this.genPoly=t.generateECPolynomial(this.degree)},r.prototype.encode=function(o){if(!this.genPoly)throw new Error("Encoder not initialized");const d=new Uint8Array(o.length+this.degree);d.set(o);const p=t.mod(d,this.genPoly),b=this.degree-p.length;if(b>0){const _=new Uint8Array(this.degree);return _.set(p,b),_}return p},Qu=r,Qu}var Ju={},Zu={},ec={},Hd;function lv(){return Hd||(Hd=1,ec.isValid=function(r){return!isNaN(r)&&r>=1&&r<=40}),ec}var mi={},qd;function uv(){if(qd)return mi;qd=1;const t="[0-9]+",r="[A-Z $%*+\\-./:]+";let i="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";i=i.replace(/u/g,"\\u");const o="(?:(?![A-Z0-9 $%*+\\-./:]|"+i+`)(?:.|[\r
]))+`;mi.KANJI=new RegExp(i,"g"),mi.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),mi.BYTE=new RegExp(o,"g"),mi.NUMERIC=new RegExp(t,"g"),mi.ALPHANUMERIC=new RegExp(r,"g");const d=new RegExp("^"+i+"$"),p=new RegExp("^"+t+"$"),b=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return mi.testKanji=function(x){return d.test(x)},mi.testNumeric=function(x){return p.test(x)},mi.testAlphanumeric=function(x){return b.test(x)},mi}var Wd;function Wa(){return Wd||(Wd=1,function(t){const r=lv(),i=uv();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(p,b){if(!p.ccBits)throw new Error("Invalid mode: "+p);if(!r.isValid(b))throw new Error("Invalid version: "+b);return b>=1&&b<10?p.ccBits[0]:b<27?p.ccBits[1]:p.ccBits[2]},t.getBestModeForData=function(p){return i.testNumeric(p)?t.NUMERIC:i.testAlphanumeric(p)?t.ALPHANUMERIC:i.testKanji(p)?t.KANJI:t.BYTE},t.toString=function(p){if(p&&p.id)return p.id;throw new Error("Invalid mode")},t.isValid=function(p){return p&&p.bit&&p.ccBits};function o(d){if(typeof d!="string")throw new Error("Param is not a string");switch(d.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+d)}}t.from=function(p,b){if(t.isValid(p))return p;try{return o(p)}catch{return b}}}(Zu)),Zu}var Yd;function ib(){return Yd||(Yd=1,function(t){const r=qa(),i=ov(),o=uf(),d=Wa(),p=lv(),b=7973,_=r.getBCHDigit(b);function x(F,W,H){for(let Z=1;Z<=40;Z++)if(W<=t.getCapacity(Z,H,F))return Z}function R(F,W){return d.getCharCountIndicator(F,W)+4}function P(F,W){let H=0;return F.forEach(function(Z){const _e=R(Z.mode,W);H+=_e+Z.getBitsLength()}),H}function O(F,W){for(let H=1;H<=40;H++)if(P(F,H)<=t.getCapacity(H,W,d.MIXED))return H}t.from=function(W,H){return p.isValid(W)?parseInt(W,10):H},t.getCapacity=function(W,H,Z){if(!p.isValid(W))throw new Error("Invalid QR Code version");typeof Z>"u"&&(Z=d.BYTE);const _e=r.getSymbolTotalCodewords(W),me=i.getTotalCodewordsCount(W,H),le=(_e-me)*8;if(Z===d.MIXED)return le;const ce=le-R(Z,W);switch(Z){case d.NUMERIC:return Math.floor(ce/10*3);case d.ALPHANUMERIC:return Math.floor(ce/11*2);case d.KANJI:return Math.floor(ce/13);case d.BYTE:default:return Math.floor(ce/8)}},t.getBestVersionForData=function(W,H){let Z;const _e=o.from(H,o.M);if(Array.isArray(W)){if(W.length>1)return O(W,_e);if(W.length===0)return 1;Z=W[0]}else Z=W;return x(Z.mode,Z.getLength(),_e)},t.getEncodedBits=function(W){if(!p.isValid(W)||W<7)throw new Error("Invalid QR Code version");let H=W<<12;for(;r.getBCHDigit(H)-_>=0;)H^=b<<r.getBCHDigit(H)-_;return W<<12|H}}(Ju)),Ju}var tc={},zd;function ab(){if(zd)return tc;zd=1;const t=qa(),r=1335,i=21522,o=t.getBCHDigit(r);return tc.getEncodedBits=function(p,b){const _=p.bit<<3|b;let x=_<<10;for(;t.getBCHDigit(x)-o>=0;)x^=r<<t.getBCHDigit(x)-o;return(_<<10|x)^i},tc}var rc={},nc,$d;function sb(){if($d)return nc;$d=1;const t=Wa();function r(i){this.mode=t.NUMERIC,this.data=i.toString()}return r.getBitsLength=function(o){return 10*Math.floor(o/3)+(o%3?o%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(o){let d,p,b;for(d=0;d+3<=this.data.length;d+=3)p=this.data.substr(d,3),b=parseInt(p,10),o.put(b,10);const _=this.data.length-d;_>0&&(p=this.data.substr(d),b=parseInt(p,10),o.put(b,_*3+1))},nc=r,nc}var ic,Xd;function ob(){if(Xd)return ic;Xd=1;const t=Wa(),r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(o){this.mode=t.ALPHANUMERIC,this.data=o}return i.getBitsLength=function(d){return 11*Math.floor(d/2)+6*(d%2)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(d){let p;for(p=0;p+2<=this.data.length;p+=2){let b=r.indexOf(this.data[p])*45;b+=r.indexOf(this.data[p+1]),d.put(b,11)}this.data.length%2&&d.put(r.indexOf(this.data[p]),6)},ic=i,ic}var ac,Qd;function lb(){if(Qd)return ac;Qd=1;const t=Wa();function r(i){this.mode=t.BYTE,typeof i=="string"?this.data=new TextEncoder().encode(i):this.data=new Uint8Array(i)}return r.getBitsLength=function(o){return o*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(i){for(let o=0,d=this.data.length;o<d;o++)i.put(this.data[o],8)},ac=r,ac}var sc,Jd;function ub(){if(Jd)return sc;Jd=1;const t=Wa(),r=qa();function i(o){this.mode=t.KANJI,this.data=o}return i.getBitsLength=function(d){return d*13},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(o){let d;for(d=0;d<this.data.length;d++){let p=r.toSJIS(this.data[d]);if(p>=33088&&p<=40956)p-=33088;else if(p>=57408&&p<=60351)p-=49472;else throw new Error("Invalid SJIS character: "+this.data[d]+`
Make sure your charset is UTF-8`);p=(p>>>8&255)*192+(p&255),o.put(p,13)}},sc=i,sc}var oc={exports:{}},Zd;function cb(){return Zd||(Zd=1,function(t){var r={single_source_shortest_paths:function(i,o,d){var p={},b={};b[o]=0;var _=r.PriorityQueue.make();_.push(o,0);for(var x,R,P,O,F,W,H,Z,_e;!_.empty();){x=_.pop(),R=x.value,O=x.cost,F=i[R]||{};for(P in F)F.hasOwnProperty(P)&&(W=F[P],H=O+W,Z=b[P],_e=typeof b[P]>"u",(_e||Z>H)&&(b[P]=H,_.push(P,H),p[P]=R))}if(typeof d<"u"&&typeof b[d]>"u"){var me=["Could not find a path from ",o," to ",d,"."].join("");throw new Error(me)}return p},extract_shortest_path_from_predecessor_list:function(i,o){for(var d=[],p=o;p;)d.push(p),i[p],p=i[p];return d.reverse(),d},find_path:function(i,o,d){var p=r.single_source_shortest_paths(i,o,d);return r.extract_shortest_path_from_predecessor_list(p,d)},PriorityQueue:{make:function(i){var o=r.PriorityQueue,d={},p;i=i||{};for(p in o)o.hasOwnProperty(p)&&(d[p]=o[p]);return d.queue=[],d.sorter=i.sorter||o.default_sorter,d},default_sorter:function(i,o){return i.cost-o.cost},push:function(i,o){var d={value:i,cost:o};this.queue.push(d),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=r}(oc)),oc.exports}var eh;function fb(){return eh||(eh=1,function(t){const r=Wa(),i=sb(),o=ob(),d=lb(),p=ub(),b=uv(),_=qa(),x=cb();function R(me){return unescape(encodeURIComponent(me)).length}function P(me,le,ce){const Ee=[];let Se;for(;(Se=me.exec(ce))!==null;)Ee.push({data:Se[0],index:Se.index,mode:le,length:Se[0].length});return Ee}function O(me){const le=P(b.NUMERIC,r.NUMERIC,me),ce=P(b.ALPHANUMERIC,r.ALPHANUMERIC,me);let Ee,Se;return _.isKanjiModeEnabled()?(Ee=P(b.BYTE,r.BYTE,me),Se=P(b.KANJI,r.KANJI,me)):(Ee=P(b.BYTE_KANJI,r.BYTE,me),Se=[]),le.concat(ce,Ee,Se).sort(function(ne,ke){return ne.index-ke.index}).map(function(ne){return{data:ne.data,mode:ne.mode,length:ne.length}})}function F(me,le){switch(le){case r.NUMERIC:return i.getBitsLength(me);case r.ALPHANUMERIC:return o.getBitsLength(me);case r.KANJI:return p.getBitsLength(me);case r.BYTE:return d.getBitsLength(me)}}function W(me){return me.reduce(function(le,ce){const Ee=le.length-1>=0?le[le.length-1]:null;return Ee&&Ee.mode===ce.mode?(le[le.length-1].data+=ce.data,le):(le.push(ce),le)},[])}function H(me){const le=[];for(let ce=0;ce<me.length;ce++){const Ee=me[ce];switch(Ee.mode){case r.NUMERIC:le.push([Ee,{data:Ee.data,mode:r.ALPHANUMERIC,length:Ee.length},{data:Ee.data,mode:r.BYTE,length:Ee.length}]);break;case r.ALPHANUMERIC:le.push([Ee,{data:Ee.data,mode:r.BYTE,length:Ee.length}]);break;case r.KANJI:le.push([Ee,{data:Ee.data,mode:r.BYTE,length:R(Ee.data)}]);break;case r.BYTE:le.push([{data:Ee.data,mode:r.BYTE,length:R(Ee.data)}])}}return le}function Z(me,le){const ce={},Ee={start:{}};let Se=["start"];for(let z=0;z<me.length;z++){const ne=me[z],ke=[];for(let Ce=0;Ce<ne.length;Ce++){const Be=ne[Ce],ze=""+z+Ce;ke.push(ze),ce[ze]={node:Be,lastCount:0},Ee[ze]={};for(let Ye=0;Ye<Se.length;Ye++){const He=Se[Ye];ce[He]&&ce[He].node.mode===Be.mode?(Ee[He][ze]=F(ce[He].lastCount+Be.length,Be.mode)-F(ce[He].lastCount,Be.mode),ce[He].lastCount+=Be.length):(ce[He]&&(ce[He].lastCount=Be.length),Ee[He][ze]=F(Be.length,Be.mode)+4+r.getCharCountIndicator(Be.mode,le))}}Se=ke}for(let z=0;z<Se.length;z++)Ee[Se[z]].end=0;return{map:Ee,table:ce}}function _e(me,le){let ce;const Ee=r.getBestModeForData(me);if(ce=r.from(le,Ee),ce!==r.BYTE&&ce.bit<Ee.bit)throw new Error('"'+me+'" cannot be encoded with mode '+r.toString(ce)+`.
 Suggested mode is: `+r.toString(Ee));switch(ce===r.KANJI&&!_.isKanjiModeEnabled()&&(ce=r.BYTE),ce){case r.NUMERIC:return new i(me);case r.ALPHANUMERIC:return new o(me);case r.KANJI:return new p(me);case r.BYTE:return new d(me)}}t.fromArray=function(le){return le.reduce(function(ce,Ee){return typeof Ee=="string"?ce.push(_e(Ee,null)):Ee.data&&ce.push(_e(Ee.data,Ee.mode)),ce},[])},t.fromString=function(le,ce){const Ee=O(le,_.isKanjiModeEnabled()),Se=H(Ee),z=Z(Se,ce),ne=x.find_path(z.map,"start","end"),ke=[];for(let Ce=1;Ce<ne.length-1;Ce++)ke.push(z.table[ne[Ce]].node);return t.fromArray(W(ke))},t.rawSplit=function(le){return t.fromArray(O(le,_.isKanjiModeEnabled()))}}(rc)),rc}var th;function db(){if(th)return Ku;th=1;const t=qa(),r=uf(),i=Xy(),o=Qy(),d=Jy(),p=Zy(),b=eb(),_=ov(),x=nb(),R=ib(),P=ab(),O=Wa(),F=fb();function W(z,ne){const ke=z.size,Ce=p.getPositions(ne);for(let Be=0;Be<Ce.length;Be++){const ze=Ce[Be][0],Ye=Ce[Be][1];for(let He=-1;He<=7;He++)if(!(ze+He<=-1||ke<=ze+He))for(let xe=-1;xe<=7;xe++)Ye+xe<=-1||ke<=Ye+xe||(He>=0&&He<=6&&(xe===0||xe===6)||xe>=0&&xe<=6&&(He===0||He===6)||He>=2&&He<=4&&xe>=2&&xe<=4?z.set(ze+He,Ye+xe,!0,!0):z.set(ze+He,Ye+xe,!1,!0))}}function H(z){const ne=z.size;for(let ke=8;ke<ne-8;ke++){const Ce=ke%2===0;z.set(ke,6,Ce,!0),z.set(6,ke,Ce,!0)}}function Z(z,ne){const ke=d.getPositions(ne);for(let Ce=0;Ce<ke.length;Ce++){const Be=ke[Ce][0],ze=ke[Ce][1];for(let Ye=-2;Ye<=2;Ye++)for(let He=-2;He<=2;He++)Ye===-2||Ye===2||He===-2||He===2||Ye===0&&He===0?z.set(Be+Ye,ze+He,!0,!0):z.set(Be+Ye,ze+He,!1,!0)}}function _e(z,ne){const ke=z.size,Ce=R.getEncodedBits(ne);let Be,ze,Ye;for(let He=0;He<18;He++)Be=Math.floor(He/3),ze=He%3+ke-8-3,Ye=(Ce>>He&1)===1,z.set(Be,ze,Ye,!0),z.set(ze,Be,Ye,!0)}function me(z,ne,ke){const Ce=z.size,Be=P.getEncodedBits(ne,ke);let ze,Ye;for(ze=0;ze<15;ze++)Ye=(Be>>ze&1)===1,ze<6?z.set(ze,8,Ye,!0):ze<8?z.set(ze+1,8,Ye,!0):z.set(Ce-15+ze,8,Ye,!0),ze<8?z.set(8,Ce-ze-1,Ye,!0):ze<9?z.set(8,15-ze-1+1,Ye,!0):z.set(8,15-ze-1,Ye,!0);z.set(Ce-8,8,1,!0)}function le(z,ne){const ke=z.size;let Ce=-1,Be=ke-1,ze=7,Ye=0;for(let He=ke-1;He>0;He-=2)for(He===6&&He--;;){for(let xe=0;xe<2;xe++)if(!z.isReserved(Be,He-xe)){let er=!1;Ye<ne.length&&(er=(ne[Ye]>>>ze&1)===1),z.set(Be,He-xe,er),ze--,ze===-1&&(Ye++,ze=7)}if(Be+=Ce,Be<0||ke<=Be){Be-=Ce,Ce=-Ce;break}}}function ce(z,ne,ke){const Ce=new i;ke.forEach(function(xe){Ce.put(xe.mode.bit,4),Ce.put(xe.getLength(),O.getCharCountIndicator(xe.mode,z)),xe.write(Ce)});const Be=t.getSymbolTotalCodewords(z),ze=_.getTotalCodewordsCount(z,ne),Ye=(Be-ze)*8;for(Ce.getLengthInBits()+4<=Ye&&Ce.put(0,4);Ce.getLengthInBits()%8!==0;)Ce.putBit(0);const He=(Ye-Ce.getLengthInBits())/8;for(let xe=0;xe<He;xe++)Ce.put(xe%2?17:236,8);return Ee(Ce,z,ne)}function Ee(z,ne,ke){const Ce=t.getSymbolTotalCodewords(ne),Be=_.getTotalCodewordsCount(ne,ke),ze=Ce-Be,Ye=_.getBlocksCount(ne,ke),He=Ce%Ye,xe=Ye-He,er=Math.floor(Ce/Ye),Tr=Math.floor(ze/Ye),ft=Tr+1,be=er-Tr,N=new x(be);let ut=0;const st=new Array(Ye),zr=new Array(Ye);let $r=0;const rt=new Uint8Array(z.buffer);for(let Je=0;Je<Ye;Je++){const An=Je<xe?Tr:ft;st[Je]=rt.slice(ut,ut+An),zr[Je]=N.encode(st[Je]),ut+=An,$r=Math.max($r,An)}const _t=new Uint8Array(Ce);let lr=0,Zt,br;for(Zt=0;Zt<$r;Zt++)for(br=0;br<Ye;br++)Zt<st[br].length&&(_t[lr++]=st[br][Zt]);for(Zt=0;Zt<be;Zt++)for(br=0;br<Ye;br++)_t[lr++]=zr[br][Zt];return _t}function Se(z,ne,ke,Ce){let Be;if(Array.isArray(z))Be=F.fromArray(z);else if(typeof z=="string"){let er=ne;if(!er){const Tr=F.rawSplit(z);er=R.getBestVersionForData(Tr,ke)}Be=F.fromString(z,er||40)}else throw new Error("Invalid data");const ze=R.getBestVersionForData(Be,ke);if(!ze)throw new Error("The amount of data is too big to be stored in a QR Code");if(!ne)ne=ze;else if(ne<ze)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+ze+`.
`);const Ye=ce(ne,ke,Be),He=t.getSymbolSize(ne),xe=new o(He);return W(xe,ne),H(xe),Z(xe,ne),me(xe,ke,0),ne>=7&&_e(xe,ne),le(xe,Ye),isNaN(Ce)&&(Ce=b.getBestMask(xe,me.bind(null,xe,ke))),b.applyMask(Ce,xe),me(xe,ke,Ce),{modules:xe,version:ne,errorCorrectionLevel:ke,maskPattern:Ce,segments:Be}}return Ku.create=function(ne,ke){if(typeof ne>"u"||ne==="")throw new Error("No input text");let Ce=r.M,Be,ze;return typeof ke<"u"&&(Ce=r.from(ke.errorCorrectionLevel,r.M),Be=R.from(ke.version),ze=b.from(ke.maskPattern),ke.toSJISFunc&&t.setToSJISFunction(ke.toSJISFunc)),Se(ne,Be,Ce,ze)},Ku}var lc={},uc={},rh;function cv(){return rh||(rh=1,function(t){function r(i){if(typeof i=="number"&&(i=i.toString()),typeof i!="string")throw new Error("Color should be defined as hex string");let o=i.slice().replace("#","").split("");if(o.length<3||o.length===5||o.length>8)throw new Error("Invalid hex color: "+i);(o.length===3||o.length===4)&&(o=Array.prototype.concat.apply([],o.map(function(p){return[p,p]}))),o.length===6&&o.push("F","F");const d=parseInt(o.join(""),16);return{r:d>>24&255,g:d>>16&255,b:d>>8&255,a:d&255,hex:"#"+o.slice(0,6).join("")}}t.getOptions=function(o){o||(o={}),o.color||(o.color={});const d=typeof o.margin>"u"||o.margin===null||o.margin<0?4:o.margin,p=o.width&&o.width>=21?o.width:void 0,b=o.scale||4;return{width:p,scale:p?4:b,margin:d,color:{dark:r(o.color.dark||"#000000ff"),light:r(o.color.light||"#ffffffff")},type:o.type,rendererOpts:o.rendererOpts||{}}},t.getScale=function(o,d){return d.width&&d.width>=o+d.margin*2?d.width/(o+d.margin*2):d.scale},t.getImageWidth=function(o,d){const p=t.getScale(o,d);return Math.floor((o+d.margin*2)*p)},t.qrToImageData=function(o,d,p){const b=d.modules.size,_=d.modules.data,x=t.getScale(b,p),R=Math.floor((b+p.margin*2)*x),P=p.margin*x,O=[p.color.light,p.color.dark];for(let F=0;F<R;F++)for(let W=0;W<R;W++){let H=(F*R+W)*4,Z=p.color.light;if(F>=P&&W>=P&&F<R-P&&W<R-P){const _e=Math.floor((F-P)/x),me=Math.floor((W-P)/x);Z=O[_[_e*b+me]?1:0]}o[H++]=Z.r,o[H++]=Z.g,o[H++]=Z.b,o[H]=Z.a}}}(uc)),uc}var nh;function hb(){return nh||(nh=1,function(t){const r=cv();function i(d,p,b){d.clearRect(0,0,p.width,p.height),p.style||(p.style={}),p.height=b,p.width=b,p.style.height=b+"px",p.style.width=b+"px"}function o(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(p,b,_){let x=_,R=b;typeof x>"u"&&(!b||!b.getContext)&&(x=b,b=void 0),b||(R=o()),x=r.getOptions(x);const P=r.getImageWidth(p.modules.size,x),O=R.getContext("2d"),F=O.createImageData(P,P);return r.qrToImageData(F.data,p,x),i(O,R,P),O.putImageData(F,0,0),R},t.renderToDataURL=function(p,b,_){let x=_;typeof x>"u"&&(!b||!b.getContext)&&(x=b,b=void 0),x||(x={});const R=t.render(p,b,x),P=x.type||"image/png",O=x.rendererOpts||{};return R.toDataURL(P,O.quality)}}(lc)),lc}var cc={},ih;function pb(){if(ih)return cc;ih=1;const t=cv();function r(d,p){const b=d.a/255,_=p+'="'+d.hex+'"';return b<1?_+" "+p+'-opacity="'+b.toFixed(2).slice(1)+'"':_}function i(d,p,b){let _=d+p;return typeof b<"u"&&(_+=" "+b),_}function o(d,p,b){let _="",x=0,R=!1,P=0;for(let O=0;O<d.length;O++){const F=Math.floor(O%p),W=Math.floor(O/p);!F&&!R&&(R=!0),d[O]?(P++,O>0&&F>0&&d[O-1]||(_+=R?i("M",F+b,.5+W+b):i("m",x,0),x=0,R=!1),F+1<p&&d[O+1]||(_+=i("h",P),P=0)):x++}return _}return cc.render=function(p,b,_){const x=t.getOptions(b),R=p.modules.size,P=p.modules.data,O=R+x.margin*2,F=x.color.light.a?"<path "+r(x.color.light,"fill")+' d="M0 0h'+O+"v"+O+'H0z"/>':"",W="<path "+r(x.color.dark,"stroke")+' d="'+o(P,R,x.margin)+'"/>',H='viewBox="0 0 '+O+" "+O+'"',_e='<svg xmlns="http://www.w3.org/2000/svg" '+(x.width?'width="'+x.width+'" height="'+x.width+'" ':"")+H+' shape-rendering="crispEdges">'+F+W+`</svg>
`;return typeof _=="function"&&_(null,_e),_e},cc}var ah;function vb(){if(ah)return xs;ah=1;const t=$y(),r=db(),i=hb(),o=pb();function d(p,b,_,x,R){const P=[].slice.call(arguments,1),O=P.length,F=typeof P[O-1]=="function";if(!F&&!t())throw new Error("Callback required as last argument");if(F){if(O<2)throw new Error("Too few arguments provided");O===2?(R=_,_=b,b=x=void 0):O===3&&(b.getContext&&typeof R>"u"?(R=x,x=void 0):(R=x,x=_,_=b,b=void 0))}else{if(O<1)throw new Error("Too few arguments provided");return O===1?(_=b,b=x=void 0):O===2&&!b.getContext&&(x=_,_=b,b=void 0),new Promise(function(W,H){try{const Z=r.create(_,x);W(p(Z,b,x))}catch(Z){H(Z)}})}try{const W=r.create(_,x);R(null,p(W,b,x))}catch(W){R(W)}}return xs.create=r.create,xs.toCanvas=d.bind(null,i.render),xs.toDataURL=d.bind(null,i.renderToDataURL),xs.toString=d.bind(null,function(p,b,_){return o.render(p,_)}),xs}var gb=vb();const mb=nu(gb);var Pl={exports:{}},yb=Pl.exports,sh;function bb(){return sh||(sh=1,function(t,r){(function(i,o){t.exports=o()})(yb,function(){var i=function(v,y){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,C){S.__proto__=C}||function(S,C){for(var w in C)Object.prototype.hasOwnProperty.call(C,w)&&(S[w]=C[w])})(v,y)},o=function(){return(o=Object.assign||function(v){for(var y,S=1,C=arguments.length;S<C;S++)for(var w in y=arguments[S])Object.prototype.hasOwnProperty.call(y,w)&&(v[w]=y[w]);return v}).apply(this,arguments)};function d(v,y,S){for(var C,w=0,M=y.length;w<M;w++)!C&&w in y||((C=C||Array.prototype.slice.call(y,0,w))[w]=y[w]);return v.concat(C||Array.prototype.slice.call(y))}var p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Iy,b=Object.keys,_=Array.isArray;function x(v,y){return typeof y!="object"||b(y).forEach(function(S){v[S]=y[S]}),v}typeof Promise>"u"||p.Promise||(p.Promise=Promise);var R=Object.getPrototypeOf,P={}.hasOwnProperty;function O(v,y){return P.call(v,y)}function F(v,y){typeof y=="function"&&(y=y(R(v))),(typeof Reflect>"u"?b:Reflect.ownKeys)(y).forEach(function(S){H(v,S,y[S])})}var W=Object.defineProperty;function H(v,y,S,C){W(v,y,x(S&&O(S,"get")&&typeof S.get=="function"?{get:S.get,set:S.set,configurable:!0}:{value:S,configurable:!0,writable:!0},C))}function Z(v){return{from:function(y){return v.prototype=Object.create(y.prototype),H(v.prototype,"constructor",v),{extend:F.bind(null,v.prototype)}}}}var _e=Object.getOwnPropertyDescriptor,me=[].slice;function le(v,y,S){return me.call(v,y,S)}function ce(v,y){return y(v)}function Ee(v){if(!v)throw new Error("Assertion Failed")}function Se(v){p.setImmediate?setImmediate(v):setTimeout(v,0)}function z(v,y){if(typeof y=="string"&&O(v,y))return v[y];if(!y)return v;if(typeof y!="string"){for(var S=[],C=0,w=y.length;C<w;++C){var M=z(v,y[C]);S.push(M)}return S}var B=y.indexOf(".");if(B!==-1){var q=v[y.substr(0,B)];return q==null?void 0:z(q,y.substr(B+1))}}function ne(v,y,S){if(v&&y!==void 0&&!("isFrozen"in Object&&Object.isFrozen(v)))if(typeof y!="string"&&"length"in y){Ee(typeof S!="string"&&"length"in S);for(var C=0,w=y.length;C<w;++C)ne(v,y[C],S[C])}else{var M,B,q=y.indexOf(".");q!==-1?(M=y.substr(0,q),(B=y.substr(q+1))===""?S===void 0?_(v)&&!isNaN(parseInt(M))?v.splice(M,1):delete v[M]:v[M]=S:ne(q=!(q=v[M])||!O(v,M)?v[M]={}:q,B,S)):S===void 0?_(v)&&!isNaN(parseInt(y))?v.splice(y,1):delete v[y]:v[y]=S}}function ke(v){var y,S={};for(y in v)O(v,y)&&(S[y]=v[y]);return S}var Ce=[].concat;function Be(v){return Ce.apply([],v)}var Gt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Be([8,16,32,64].map(function(v){return["Int","Uint","Float"].map(function(y){return y+v+"Array"})}))).filter(function(v){return p[v]}),ze=new Set(Gt.map(function(v){return p[v]})),Ye=null;function He(v){return Ye=new WeakMap,v=function y(S){if(!S||typeof S!="object")return S;var C=Ye.get(S);if(C)return C;if(_(S)){C=[],Ye.set(S,C);for(var w=0,M=S.length;w<M;++w)C.push(y(S[w]))}else if(ze.has(S.constructor))C=S;else{var B,q=R(S);for(B in C=q===Object.prototype?{}:Object.create(q),Ye.set(S,C),S)O(S,B)&&(C[B]=y(S[B]))}return C}(v),Ye=null,v}var xe={}.toString;function er(v){return xe.call(v).slice(8,-1)}var Tr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ft=typeof Tr=="symbol"?function(v){var y;return v!=null&&(y=v[Tr])&&y.apply(v)}:function(){return null};function be(v,y){return y=v.indexOf(y),0<=y&&v.splice(y,1),0<=y}var N={};function ut(v){var y,S,C,w;if(arguments.length===1){if(_(v))return v.slice();if(this===N&&typeof v=="string")return[v];if(w=ft(v)){for(S=[];!(C=w.next()).done;)S.push(C.value);return S}if(v==null)return[v];if(typeof(y=v.length)!="number")return[v];for(S=new Array(y);y--;)S[y]=v[y];return S}for(y=arguments.length,S=new Array(y);y--;)S[y]=arguments[y];return S}var st=typeof Symbol<"u"?function(v){return v[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ot=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],sn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ot),zr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $r(v,y){this.name=v,this.message=y}function rt(v,y){return v+". Errors: "+Object.keys(y).map(function(S){return y[S].toString()}).filter(function(S,C,w){return w.indexOf(S)===C}).join(`
`)}function _t(v,y,S,C){this.failures=y,this.failedKeys=C,this.successCount=S,this.message=rt(v,y)}function lr(v,y){this.name="BulkError",this.failures=Object.keys(y).map(function(S){return y[S]}),this.failuresByPos=y,this.message=rt(v,this.failures)}Z($r).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Z(_t).from($r),Z(lr).from($r);var Zt=sn.reduce(function(v,y){return v[y]=y+"Error",v},{}),br=$r,Je=sn.reduce(function(v,y){var S=y+"Error";function C(w,M){this.name=S,w?typeof w=="string"?(this.message="".concat(w).concat(M?`
 `+M:""),this.inner=M||null):typeof w=="object"&&(this.message="".concat(w.name," ").concat(w.message),this.inner=w):(this.message=zr[y]||S,this.inner=null)}return Z(C).from(br),v[y]=C,v},{});Je.Syntax=SyntaxError,Je.Type=TypeError,Je.Range=RangeError;var An=ot.reduce(function(v,y){return v[y+"Error"]=Je[y],v},{}),On=sn.reduce(function(v,y){return["Syntax","Type","Range"].indexOf(y)===-1&&(v[y+"Error"]=Je[y]),v},{});function tt(){}function Nr(v){return v}function kr(v,y){return v==null||v===Nr?y:function(S){return y(v(S))}}function Et(v,y){return function(){v.apply(this,arguments),y.apply(this,arguments)}}function qn(v,y){return v===tt?y:function(){var S=v.apply(this,arguments);S!==void 0&&(arguments[0]=S);var C=this.onsuccess,w=this.onerror;this.onsuccess=null,this.onerror=null;var M=y.apply(this,arguments);return C&&(this.onsuccess=this.onsuccess?Et(C,this.onsuccess):C),w&&(this.onerror=this.onerror?Et(w,this.onerror):w),M!==void 0?M:S}}function va(v,y){return v===tt?y:function(){v.apply(this,arguments);var S=this.onsuccess,C=this.onerror;this.onsuccess=this.onerror=null,y.apply(this,arguments),S&&(this.onsuccess=this.onsuccess?Et(S,this.onsuccess):S),C&&(this.onerror=this.onerror?Et(C,this.onerror):C)}}function En(v,y){return v===tt?y:function(S){var C=v.apply(this,arguments);x(S,C);var w=this.onsuccess,M=this.onerror;return this.onsuccess=null,this.onerror=null,S=y.apply(this,arguments),w&&(this.onsuccess=this.onsuccess?Et(w,this.onsuccess):w),M&&(this.onerror=this.onerror?Et(M,this.onerror):M),C===void 0?S===void 0?void 0:S:x(C,S)}}function ga(v,y){return v===tt?y:function(){return y.apply(this,arguments)!==!1&&v.apply(this,arguments)}}function Ci(v,y){return v===tt?y:function(){var S=v.apply(this,arguments);if(S&&typeof S.then=="function"){for(var C=this,w=arguments.length,M=new Array(w);w--;)M[w]=arguments[w];return S.then(function(){return y.apply(C,M)})}return y.apply(this,arguments)}}On.ModifyError=_t,On.DexieError=$r,On.BulkError=lr;var tr=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pt(v){tr=v}var Tt={},kt=100,Gt=typeof Promise>"u"?[]:function(){var v=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[v,R(v),v];var y=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[y,R(y),v]}(),ot=Gt[0],sn=Gt[1],Gt=Gt[2],sn=sn&&sn.then,ht=ot&&ot.constructor,ur=!!Gt,pn=function(v,y){Le.push([v,y]),si&&(queueMicrotask(vr),si=!1)},Nn=!0,si=!0,dr=[],hr=[],Fr=Nr,Lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:tt,pgp:!1,env:{},finalize:tt},Ne=Lt,Le=[],dt=0,wt=[];function Pe(v){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var y=this._PSD=Ne;if(typeof v!="function"){if(v!==Tt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&rr(this,this._value))}this._state=null,this._value=null,++y.ref,function S(C,w){try{w(function(M){if(C._state===null){if(M===C)throw new TypeError("A promise cannot be resolved with itself.");var B=C._lib&&cr();M&&typeof M.then=="function"?S(C,function(q,$){M instanceof Pe?M._then(q,$):M.then(q,$)}):(C._state=!0,C._value=M,Lr(C)),B&&gr()}},rr.bind(null,C))}catch(M){rr(C,M)}}(this,v)}var De={get:function(){var v=Ne,y=Cn;function S(C,w){var M=this,B=!v.global&&(v!==Ne||y!==Cn),q=B&&!Ln(),$=new Pe(function(J,re){zt(M,new Dt(Wi(C,v,B,q),Wi(w,v,B,q),J,re,v))});return this._consoleTask&&($._consoleTask=this._consoleTask),$}return S.prototype=Tt,S},set:function(v){H(this,"then",v&&v.prototype===Tt?De:{get:function(){return v},set:De.set})}};function Dt(v,y,S,C,w){this.onFulfilled=typeof v=="function"?v:null,this.onRejected=typeof y=="function"?y:null,this.resolve=S,this.reject=C,this.psd=w}function rr(v,y){var S,C;hr.push(y),v._state===null&&(S=v._lib&&cr(),y=Fr(y),v._state=!1,v._value=y,C=v,dr.some(function(w){return w._value===C._value})||dr.push(C),Lr(v),S&&gr())}function Lr(v){var y=v._listeners;v._listeners=[];for(var S=0,C=y.length;S<C;++S)zt(v,y[S]);var w=v._PSD;--w.ref||w.finalize(),dt===0&&(++dt,pn(function(){--dt==0&&Wn()},[]))}function zt(v,y){if(v._state!==null){var S=v._state?y.onFulfilled:y.onRejected;if(S===null)return(v._state?y.resolve:y.reject)(v._value);++y.psd.ref,++dt,pn(pr,[S,v,y])}else v._listeners.push(y)}function pr(v,y,S){try{var C,w=y._value;!y._state&&hr.length&&(hr=[]),C=tr&&y._consoleTask?y._consoleTask.run(function(){return v(w)}):v(w),y._state||hr.indexOf(w)!==-1||function(M){for(var B=dr.length;B;)if(dr[--B]._value===M._value)return dr.splice(B,1)}(y),S.resolve(C)}catch(M){S.reject(M)}finally{--dt==0&&Wn(),--S.psd.ref||S.psd.finalize()}}function vr(){Qr(Lt,function(){cr()&&gr()})}function cr(){var v=Nn;return si=Nn=!1,v}function gr(){var v,y,S;do for(;0<Le.length;)for(v=Le,Le=[],S=v.length,y=0;y<S;++y){var C=v[y];C[0].apply(null,C[1])}while(0<Le.length);si=Nn=!0}function Wn(){var v=dr;dr=[],v.forEach(function(C){C._PSD.onunhandled.call(null,C._value,C)});for(var y=wt.slice(0),S=y.length;S;)y[--S]()}function Fn(v){return new Pe(Tt,!1,v)}function jt(v,y){var S=Ne;return function(){var C=cr(),w=Ne;try{return an(S,!0),v.apply(this,arguments)}catch(M){y&&y(M)}finally{an(w,!1),C&&gr()}}}F(Pe.prototype,{then:De,_then:function(v,y){zt(this,new Dt(null,null,v,y,Ne))},catch:function(v){if(arguments.length===1)return this.then(null,v);var y=v,S=arguments[1];return typeof y=="function"?this.then(null,function(C){return(C instanceof y?S:Fn)(C)}):this.then(null,function(C){return(C&&C.name===y?S:Fn)(C)})},finally:function(v){return this.then(function(y){return Pe.resolve(v()).then(function(){return y})},function(y){return Pe.resolve(v()).then(function(){return Fn(y)})})},timeout:function(v,y){var S=this;return v<1/0?new Pe(function(C,w){var M=setTimeout(function(){return w(new Je.Timeout(y))},v);S.then(C,w).finally(clearTimeout.bind(null,M))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&H(Pe.prototype,Symbol.toStringTag,"Dexie.Promise"),Lt.env=qi(),F(Pe,{all:function(){var v=ut.apply(null,arguments).map(Br);return new Pe(function(y,S){v.length===0&&y([]);var C=v.length;v.forEach(function(w,M){return Pe.resolve(w).then(function(B){v[M]=B,--C||y(v)},S)})})},resolve:function(v){return v instanceof Pe?v:v&&typeof v.then=="function"?new Pe(function(y,S){v.then(y,S)}):new Pe(Tt,!0,v)},reject:Fn,race:function(){var v=ut.apply(null,arguments).map(Br);return new Pe(function(y,S){v.map(function(C){return Pe.resolve(C).then(y,S)})})},PSD:{get:function(){return Ne},set:function(v){return Ne=v}},totalEchoes:{get:function(){return Cn}},newPSD:vn,usePSD:Qr,scheduler:{get:function(){return pn},set:function(v){pn=v}},rejectionMapper:{get:function(){return Fr},set:function(v){Fr=v}},follow:function(v,y){return new Pe(function(S,C){return vn(function(w,M){var B=Ne;B.unhandleds=[],B.onunhandled=M,B.finalize=Et(function(){var q,$=this;q=function(){$.unhandleds.length===0?w():M($.unhandleds[0])},wt.push(function J(){q(),wt.splice(wt.indexOf(J),1)}),++dt,pn(function(){--dt==0&&Wn()},[])},B.finalize),v()},y,S,C)})}}),ht&&(ht.allSettled&&H(Pe,"allSettled",function(){var v=ut.apply(null,arguments).map(Br);return new Pe(function(y){v.length===0&&y([]);var S=v.length,C=new Array(S);v.forEach(function(w,M){return Pe.resolve(w).then(function(B){return C[M]={status:"fulfilled",value:B}},function(B){return C[M]={status:"rejected",reason:B}}).then(function(){return--S||y(C)})})})}),ht.any&&typeof AggregateError<"u"&&H(Pe,"any",function(){var v=ut.apply(null,arguments).map(Br);return new Pe(function(y,S){v.length===0&&S(new AggregateError([]));var C=v.length,w=new Array(C);v.forEach(function(M,B){return Pe.resolve(M).then(function(q){return y(q)},function(q){w[B]=q,--C||S(new AggregateError(w))})})})}),ht.withResolvers&&(Pe.withResolvers=ht.withResolvers));var nr={awaits:0,echoes:0,id:0},Xr=0,Li=[],oi=0,Cn=0,li=0;function vn(v,y,S,C){var w=Ne,M=Object.create(w);return M.parent=w,M.ref=0,M.global=!1,M.id=++li,Lt.env,M.env=ur?{Promise:Pe,PromiseProp:{value:Pe,configurable:!0,writable:!0},all:Pe.all,race:Pe.race,allSettled:Pe.allSettled,any:Pe.any,resolve:Pe.resolve,reject:Pe.reject}:{},y&&x(M,y),++w.ref,M.finalize=function(){--this.parent.ref||this.parent.finalize()},C=Qr(M,v,S,C),M.ref===0&&M.finalize(),C}function ui(){return nr.id||(nr.id=++Xr),++nr.awaits,nr.echoes+=kt,nr.id}function Ln(){return!!nr.awaits&&(--nr.awaits==0&&(nr.id=0),nr.echoes=nr.awaits*kt,!0)}function Br(v){return nr.echoes&&v&&v.constructor===ht?(ui(),v.then(function(y){return Ln(),y},function(y){return Ln(),ar(y)})):v}function Yn(){var v=Li[Li.length-1];Li.pop(),an(v,!1)}function an(v,y){var S,C=Ne;(y?!nr.echoes||oi++&&v===Ne:!oi||--oi&&v===Ne)||queueMicrotask(y?(function(w){++Cn,nr.echoes&&--nr.echoes!=0||(nr.echoes=nr.awaits=nr.id=0),Li.push(Ne),an(w,!0)}).bind(null,v):Yn),v!==Ne&&(Ne=v,C===Lt&&(Lt.env=qi()),ur&&(S=Lt.env.Promise,y=v.env,(C.global||v.global)&&(Object.defineProperty(p,"Promise",y.PromiseProp),S.all=y.all,S.race=y.race,S.resolve=y.resolve,S.reject=y.reject,y.allSettled&&(S.allSettled=y.allSettled),y.any&&(S.any=y.any))))}function qi(){var v=p.Promise;return ur?{Promise:v,PromiseProp:Object.getOwnPropertyDescriptor(p,"Promise"),all:v.all,race:v.race,allSettled:v.allSettled,any:v.any,resolve:v.resolve,reject:v.reject}:{}}function Qr(v,y,S,C,w){var M=Ne;try{return an(v,!0),y(S,C,w)}finally{an(M,!1)}}function Wi(v,y,S,C){return typeof v!="function"?v:function(){var w=Ne;S&&ui(),an(y,!0);try{return v.apply(this,arguments)}finally{an(w,!1),C&&queueMicrotask(Ln)}}}function ci(v){Promise===ht&&nr.echoes===0?oi===0?v():enqueueNativeMicroTask(v):setTimeout(v,0)}(""+sn).indexOf("[native code]")===-1&&(ui=Ln=tt);var ar=Pe.reject,Ri="￿",zn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ma="String expected.",Yi=[],ki="__dbnames",Ya="readonly",Bs="readwrite";function wi(v,y){return v?y?function(){return v.apply(this,arguments)&&y.apply(this,arguments)}:v:y}var Us={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function zi(v){return typeof v!="string"||/\./.test(v)?function(y){return y}:function(y){return y[v]===void 0&&v in y&&delete(y=He(y))[v],y}}function za(){throw Je.Type()}function It(v,y){try{var S=ya(v),C=ya(y);if(S!==C)return S==="Array"?1:C==="Array"?-1:S==="binary"?1:C==="binary"?-1:S==="string"?1:C==="string"?-1:S==="Date"?1:C!=="Date"?NaN:-1;switch(S){case"number":case"Date":case"string":return y<v?1:v<y?-1:0;case"binary":return function(w,M){for(var B=w.length,q=M.length,$=B<q?B:q,J=0;J<$;++J)if(w[J]!==M[J])return w[J]<M[J]?-1:1;return B===q?0:B<q?-1:1}(qo(v),qo(y));case"Array":return function(w,M){for(var B=w.length,q=M.length,$=B<q?B:q,J=0;J<$;++J){var re=It(w[J],M[J]);if(re!==0)return re}return B===q?0:B<q?-1:1}(v,y)}}catch{}return NaN}function ya(v){var y=typeof v;return y!="object"?y:ArrayBuffer.isView(v)?"binary":(v=er(v),v==="ArrayBuffer"?"binary":v)}function qo(v){return v instanceof Uint8Array?v:ArrayBuffer.isView(v)?new Uint8Array(v.buffer,v.byteOffset,v.byteLength):new Uint8Array(v)}var ba=($t.prototype._trans=function(v,y,S){var C=this._tx||Ne.trans,w=this.name,M=tr&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(v==="readonly"?"read":"write"," ").concat(this.name));function B(J,re,Y){if(!Y.schema[w])throw new Je.NotFound("Table "+w+" not part of transaction");return y(Y.idbtrans,Y)}var q=cr();try{var $=C&&C.db._novip===this.db._novip?C===Ne.trans?C._promise(v,B,S):vn(function(){return C._promise(v,B,S)},{trans:C,transless:Ne.transless||Ne}):function J(re,Y,oe,X){if(re.idbdb&&(re._state.openComplete||Ne.letThrough||re._vip)){var te=re._createTransaction(Y,oe,re._dbSchema);try{te.create(),re._state.PR1398_maxLoop=3}catch(ae){return ae.name===Zt.InvalidState&&re.isOpen()&&0<--re._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),re.close({disableAutoOpen:!1}),re.open().then(function(){return J(re,Y,oe,X)})):ar(ae)}return te._promise(Y,function(ae,ee){return vn(function(){return Ne.trans=te,X(ae,ee,te)})}).then(function(ae){if(Y==="readwrite")try{te.idbtrans.commit()}catch{}return Y==="readonly"?ae:te._completion.then(function(){return ae})})}if(re._state.openComplete)return ar(new Je.DatabaseClosed(re._state.dbOpenError));if(!re._state.isBeingOpened){if(!re._state.autoOpen)return ar(new Je.DatabaseClosed);re.open().catch(tt)}return re._state.dbReadyPromise.then(function(){return J(re,Y,oe,X)})}(this.db,v,[this.name],B);return M&&($._consoleTask=M,$=$.catch(function(J){return console.trace(J),ar(J)})),$}finally{q&&gr()}},$t.prototype.get=function(v,y){var S=this;return v&&v.constructor===Object?this.where(v).first(y):v==null?ar(new Je.Type("Invalid argument to Table.get()")):this._trans("readonly",function(C){return S.core.get({trans:C,key:v}).then(function(w){return S.hook.reading.fire(w)})}).then(y)},$t.prototype.where=function(v){if(typeof v=="string")return new this.db.WhereClause(this,v);if(_(v))return new this.db.WhereClause(this,"[".concat(v.join("+"),"]"));var y=b(v);if(y.length===1)return this.where(y[0]).equals(v[y[0]]);var S=this.schema.indexes.concat(this.schema.primKey).filter(function(q){if(q.compound&&y.every(function(J){return 0<=q.keyPath.indexOf(J)})){for(var $=0;$<y.length;++$)if(y.indexOf(q.keyPath[$])===-1)return!1;return!0}return!1}).sort(function(q,$){return q.keyPath.length-$.keyPath.length})[0];if(S&&this.db._maxKey!==Ri){var M=S.keyPath.slice(0,y.length);return this.where(M).equals(M.map(function($){return v[$]}))}!S&&tr&&console.warn("The query ".concat(JSON.stringify(v)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(y.join("+"),"]"));var C=this.schema.idxByName;function w(q,$){return It(q,$)===0}var B=y.reduce(function(Y,$){var J=Y[0],re=Y[1],Y=C[$],oe=v[$];return[J||Y,J||!Y?wi(re,Y&&Y.multi?function(X){return X=z(X,$),_(X)&&X.some(function(te){return w(oe,te)})}:function(X){return w(oe,z(X,$))}):re]},[null,null]),M=B[0],B=B[1];return M?this.where(M.name).equals(v[M.keyPath]).filter(B):S?this.filter(B):this.where(y).equals("")},$t.prototype.filter=function(v){return this.toCollection().and(v)},$t.prototype.count=function(v){return this.toCollection().count(v)},$t.prototype.offset=function(v){return this.toCollection().offset(v)},$t.prototype.limit=function(v){return this.toCollection().limit(v)},$t.prototype.each=function(v){return this.toCollection().each(v)},$t.prototype.toArray=function(v){return this.toCollection().toArray(v)},$t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},$t.prototype.orderBy=function(v){return new this.db.Collection(new this.db.WhereClause(this,_(v)?"[".concat(v.join("+"),"]"):v))},$t.prototype.reverse=function(){return this.toCollection().reverse()},$t.prototype.mapToClass=function(v){var y,S=this.db,C=this.name;function w(){return y!==null&&y.apply(this,arguments)||this}(this.schema.mappedClass=v).prototype instanceof za&&(function($,J){if(typeof J!="function"&&J!==null)throw new TypeError("Class extends value "+String(J)+" is not a constructor or null");function re(){this.constructor=$}i($,J),$.prototype=J===null?Object.create(J):(re.prototype=J.prototype,new re)}(w,y=v),Object.defineProperty(w.prototype,"db",{get:function(){return S},enumerable:!1,configurable:!0}),w.prototype.table=function(){return C},v=w);for(var M=new Set,B=v.prototype;B;B=R(B))Object.getOwnPropertyNames(B).forEach(function($){return M.add($)});function q($){if(!$)return $;var J,re=Object.create(v.prototype);for(J in $)if(!M.has(J))try{re[J]=$[J]}catch{}return re}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=q,this.hook("reading",q),v},$t.prototype.defineClass=function(){return this.mapToClass(function(v){x(this,v)})},$t.prototype.add=function(v,y){var S=this,C=this.schema.primKey,w=C.auto,M=C.keyPath,B=v;return M&&w&&(B=zi(M)(v)),this._trans("readwrite",function(q){return S.core.mutate({trans:q,type:"add",keys:y!=null?[y]:null,values:[B]})}).then(function(q){return q.numFailures?Pe.reject(q.failures[0]):q.lastResult}).then(function(q){if(M)try{ne(v,M,q)}catch{}return q})},$t.prototype.update=function(v,y){return typeof v!="object"||_(v)?this.where(":id").equals(v).modify(y):(v=z(v,this.schema.primKey.keyPath),v===void 0?ar(new Je.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(v).modify(y))},$t.prototype.put=function(v,y){var S=this,C=this.schema.primKey,w=C.auto,M=C.keyPath,B=v;return M&&w&&(B=zi(M)(v)),this._trans("readwrite",function(q){return S.core.mutate({trans:q,type:"put",values:[B],keys:y!=null?[y]:null})}).then(function(q){return q.numFailures?Pe.reject(q.failures[0]):q.lastResult}).then(function(q){if(M)try{ne(v,M,q)}catch{}return q})},$t.prototype.delete=function(v){var y=this;return this._trans("readwrite",function(S){return y.core.mutate({trans:S,type:"delete",keys:[v]})}).then(function(S){return S.numFailures?Pe.reject(S.failures[0]):void 0})},$t.prototype.clear=function(){var v=this;return this._trans("readwrite",function(y){return v.core.mutate({trans:y,type:"deleteRange",range:Us})}).then(function(y){return y.numFailures?Pe.reject(y.failures[0]):void 0})},$t.prototype.bulkGet=function(v){var y=this;return this._trans("readonly",function(S){return y.core.getMany({keys:v,trans:S}).then(function(C){return C.map(function(w){return y.hook.reading.fire(w)})})})},$t.prototype.bulkAdd=function(v,y,S){var C=this,w=Array.isArray(y)?y:void 0,M=(S=S||(w?void 0:y))?S.allKeys:void 0;return this._trans("readwrite",function(B){var J=C.schema.primKey,q=J.auto,J=J.keyPath;if(J&&w)throw new Je.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(w&&w.length!==v.length)throw new Je.InvalidArgument("Arguments objects and keys must have the same length");var $=v.length,J=J&&q?v.map(zi(J)):v;return C.core.mutate({trans:B,type:"add",keys:w,values:J,wantResults:M}).then(function(te){var Y=te.numFailures,oe=te.results,X=te.lastResult,te=te.failures;if(Y===0)return M?oe:X;throw new lr("".concat(C.name,".bulkAdd(): ").concat(Y," of ").concat($," operations failed"),te)})})},$t.prototype.bulkPut=function(v,y,S){var C=this,w=Array.isArray(y)?y:void 0,M=(S=S||(w?void 0:y))?S.allKeys:void 0;return this._trans("readwrite",function(B){var J=C.schema.primKey,q=J.auto,J=J.keyPath;if(J&&w)throw new Je.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(w&&w.length!==v.length)throw new Je.InvalidArgument("Arguments objects and keys must have the same length");var $=v.length,J=J&&q?v.map(zi(J)):v;return C.core.mutate({trans:B,type:"put",keys:w,values:J,wantResults:M}).then(function(te){var Y=te.numFailures,oe=te.results,X=te.lastResult,te=te.failures;if(Y===0)return M?oe:X;throw new lr("".concat(C.name,".bulkPut(): ").concat(Y," of ").concat($," operations failed"),te)})})},$t.prototype.bulkUpdate=function(v){var y=this,S=this.core,C=v.map(function(B){return B.key}),w=v.map(function(B){return B.changes}),M=[];return this._trans("readwrite",function(B){return S.getMany({trans:B,keys:C,cache:"clone"}).then(function(q){var $=[],J=[];v.forEach(function(Y,oe){var X=Y.key,te=Y.changes,ae=q[oe];if(ae){for(var ee=0,fe=Object.keys(te);ee<fe.length;ee++){var pe=fe[ee],ye=te[pe];if(pe===y.schema.primKey.keyPath){if(It(ye,X)!==0)throw new Je.Constraint("Cannot update primary key in bulkUpdate()")}else ne(ae,pe,ye)}M.push(oe),$.push(X),J.push(ae)}});var re=$.length;return S.mutate({trans:B,type:"put",keys:$,values:J,updates:{keys:C,changeSpecs:w}}).then(function(Y){var oe=Y.numFailures,X=Y.failures;if(oe===0)return re;for(var te=0,ae=Object.keys(X);te<ae.length;te++){var ee,fe=ae[te],pe=M[Number(fe)];pe!=null&&(ee=X[fe],delete X[fe],X[pe]=ee)}throw new lr("".concat(y.name,".bulkUpdate(): ").concat(oe," of ").concat(re," operations failed"),X)})})})},$t.prototype.bulkDelete=function(v){var y=this,S=v.length;return this._trans("readwrite",function(C){return y.core.mutate({trans:C,type:"delete",keys:v})}).then(function(B){var w=B.numFailures,M=B.lastResult,B=B.failures;if(w===0)return M;throw new lr("".concat(y.name,".bulkDelete(): ").concat(w," of ").concat(S," operations failed"),B)})},$t);function $t(){}function $i(v){function y(B,q){if(q){for(var $=arguments.length,J=new Array($-1);--$;)J[$-1]=arguments[$];return S[B].subscribe.apply(null,J),v}if(typeof B=="string")return S[B]}var S={};y.addEventType=M;for(var C=1,w=arguments.length;C<w;++C)M(arguments[C]);return y;function M(B,q,$){if(typeof B!="object"){var J;q=q||ga;var re={subscribers:[],fire:$=$||tt,subscribe:function(Y){re.subscribers.indexOf(Y)===-1&&(re.subscribers.push(Y),re.fire=q(re.fire,Y))},unsubscribe:function(Y){re.subscribers=re.subscribers.filter(function(oe){return oe!==Y}),re.fire=re.subscribers.reduce(q,$)}};return S[B]=y[B]=re}b(J=B).forEach(function(Y){var oe=J[Y];if(_(oe))M(Y,J[Y][0],J[Y][1]);else{if(oe!=="asap")throw new Je.InvalidArgument("Invalid event config");var X=M(Y,Nr,function(){for(var te=arguments.length,ae=new Array(te);te--;)ae[te]=arguments[te];X.subscribers.forEach(function(ee){Se(function(){ee.apply(null,ae)})})})}})}}function Xi(v,y){return Z(y).from({prototype:v}),y}function Ii(v,y){return!(v.filter||v.algorithm||v.or)&&(y?v.justLimit:!v.replayFilter)}function Gs(v,y){v.filter=wi(v.filter,y)}function js(v,y,S){var C=v.replayFilter;v.replayFilter=C?function(){return wi(C(),y())}:y,v.justLimit=S&&!C}function $a(v,y){if(v.isPrimKey)return y.primaryKey;var S=y.getIndexByKeyPath(v.index);if(!S)throw new Je.Schema("KeyPath "+v.index+" on object store "+y.name+" is not indexed");return S}function Ur(v,y,S){var C=$a(v,y.schema);return y.openCursor({trans:S,values:!v.keysOnly,reverse:v.dir==="prev",unique:!!v.unique,query:{index:C,range:v.range}})}function Xa(v,y,S,C){var w=v.replayFilter?wi(v.filter,v.replayFilter()):v.filter;if(v.or){var M={},B=function(q,$,J){var re,Y;w&&!w($,J,function(oe){return $.stop(oe)},function(oe){return $.fail(oe)})||((Y=""+(re=$.primaryKey))=="[object ArrayBuffer]"&&(Y=""+new Uint8Array(re)),O(M,Y)||(M[Y]=!0,y(q,$,J)))};return Promise.all([v.or._iterate(B,S),Rn(Ur(v,C,S),v.algorithm,B,!v.keysOnly&&v.valueMapper)])}return Rn(Ur(v,C,S),wi(v.algorithm,w),y,!v.keysOnly&&v.valueMapper)}function Rn(v,y,S,C){var w=jt(C?function(M,B,q){return S(C(M),B,q)}:S);return v.then(function(M){if(M)return M.start(function(){var B=function(){return M.continue()};y&&!y(M,function(q){return B=q},function(q){M.stop(q),B=tt},function(q){M.fail(q),B=tt})||w(M.value,M,function(q){return B=q}),B()})})}var Qi=(Wo.prototype.execute=function(v){var y=this["@@propmod"];if(y.add!==void 0){var S=y.add;if(_(S))return d(d([],_(v)?v:[],!0),S).sort();if(typeof S=="number")return(Number(v)||0)+S;if(typeof S=="bigint")try{return BigInt(v)+S}catch{return BigInt(0)+S}throw new TypeError("Invalid term ".concat(S))}if(y.remove!==void 0){var C=y.remove;if(_(C))return _(v)?v.filter(function(w){return!C.includes(w)}).sort():[];if(typeof C=="number")return Number(v)-C;if(typeof C=="bigint")try{return BigInt(v)-C}catch{return BigInt(0)-C}throw new TypeError("Invalid subtrahend ".concat(C))}return S=(S=y.replacePrefix)===null||S===void 0?void 0:S[0],S&&typeof v=="string"&&v.startsWith(S)?y.replacePrefix[1]+v.substring(S.length):v},Wo);function Wo(v){this["@@propmod"]=v}var Yo=(Ft.prototype._read=function(v,y){var S=this._ctx;return S.error?S.table._trans(null,ar.bind(null,S.error)):S.table._trans("readonly",v).then(y)},Ft.prototype._write=function(v){var y=this._ctx;return y.error?y.table._trans(null,ar.bind(null,y.error)):y.table._trans("readwrite",v,"locked")},Ft.prototype._addAlgorithm=function(v){var y=this._ctx;y.algorithm=wi(y.algorithm,v)},Ft.prototype._iterate=function(v,y){return Xa(this._ctx,v,y,this._ctx.table.core)},Ft.prototype.clone=function(v){var y=Object.create(this.constructor.prototype),S=Object.create(this._ctx);return v&&x(S,v),y._ctx=S,y},Ft.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ft.prototype.each=function(v){var y=this._ctx;return this._read(function(S){return Xa(y,v,S,y.table.core)})},Ft.prototype.count=function(v){var y=this;return this._read(function(S){var C=y._ctx,w=C.table.core;if(Ii(C,!0))return w.count({trans:S,query:{index:$a(C,w.schema),range:C.range}}).then(function(B){return Math.min(B,C.limit)});var M=0;return Xa(C,function(){return++M,!1},S,w).then(function(){return M})}).then(v)},Ft.prototype.sortBy=function(v,y){var S=v.split(".").reverse(),C=S[0],w=S.length-1;function M($,J){return J?M($[S[J]],J-1):$[C]}var B=this._ctx.dir==="next"?1:-1;function q($,J){return It(M($,w),M(J,w))*B}return this.toArray(function($){return $.sort(q)}).then(y)},Ft.prototype.toArray=function(v){var y=this;return this._read(function(S){var C=y._ctx;if(C.dir==="next"&&Ii(C,!0)&&0<C.limit){var w=C.valueMapper,M=$a(C,C.table.core.schema);return C.table.core.query({trans:S,limit:C.limit,values:!0,query:{index:M,range:C.range}}).then(function(q){return q=q.result,w?q.map(w):q})}var B=[];return Xa(C,function(q){return B.push(q)},S,C.table.core).then(function(){return B})},v)},Ft.prototype.offset=function(v){var y=this._ctx;return v<=0||(y.offset+=v,Ii(y)?js(y,function(){var S=v;return function(C,w){return S===0||(S===1?--S:w(function(){C.advance(S),S=0}),!1)}}):js(y,function(){var S=v;return function(){return--S<0}})),this},Ft.prototype.limit=function(v){return this._ctx.limit=Math.min(this._ctx.limit,v),js(this._ctx,function(){var y=v;return function(S,C,w){return--y<=0&&C(w),0<=y}},!0),this},Ft.prototype.until=function(v,y){return Gs(this._ctx,function(S,C,w){return!v(S.value)||(C(w),y)}),this},Ft.prototype.first=function(v){return this.limit(1).toArray(function(y){return y[0]}).then(v)},Ft.prototype.last=function(v){return this.reverse().first(v)},Ft.prototype.filter=function(v){var y;return Gs(this._ctx,function(S){return v(S.value)}),(y=this._ctx).isMatch=wi(y.isMatch,v),this},Ft.prototype.and=function(v){return this.filter(v)},Ft.prototype.or=function(v){return new this.db.WhereClause(this._ctx.table,v,this)},Ft.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ft.prototype.desc=function(){return this.reverse()},Ft.prototype.eachKey=function(v){var y=this._ctx;return y.keysOnly=!y.isMatch,this.each(function(S,C){v(C.key,C)})},Ft.prototype.eachUniqueKey=function(v){return this._ctx.unique="unique",this.eachKey(v)},Ft.prototype.eachPrimaryKey=function(v){var y=this._ctx;return y.keysOnly=!y.isMatch,this.each(function(S,C){v(C.primaryKey,C)})},Ft.prototype.keys=function(v){var y=this._ctx;y.keysOnly=!y.isMatch;var S=[];return this.each(function(C,w){S.push(w.key)}).then(function(){return S}).then(v)},Ft.prototype.primaryKeys=function(v){var y=this._ctx;if(y.dir==="next"&&Ii(y,!0)&&0<y.limit)return this._read(function(C){var w=$a(y,y.table.core.schema);return y.table.core.query({trans:C,values:!1,limit:y.limit,query:{index:w,range:y.range}})}).then(function(C){return C.result}).then(v);y.keysOnly=!y.isMatch;var S=[];return this.each(function(C,w){S.push(w.primaryKey)}).then(function(){return S}).then(v)},Ft.prototype.uniqueKeys=function(v){return this._ctx.unique="unique",this.keys(v)},Ft.prototype.firstKey=function(v){return this.limit(1).keys(function(y){return y[0]}).then(v)},Ft.prototype.lastKey=function(v){return this.reverse().firstKey(v)},Ft.prototype.distinct=function(){var v=this._ctx,v=v.index&&v.table.schema.idxByName[v.index];if(!v||!v.multi)return this;var y={};return Gs(this._ctx,function(w){var C=w.primaryKey.toString(),w=O(y,C);return y[C]=!0,!w}),this},Ft.prototype.modify=function(v){var y=this,S=this._ctx;return this._write(function(C){var w,M,B;B=typeof v=="function"?v:(w=b(v),M=w.length,function(ee){for(var fe=!1,pe=0;pe<M;++pe){var ye=w[pe],Te=v[ye],Me=z(ee,ye);Te instanceof Qi?(ne(ee,ye,Te.execute(Me)),fe=!0):Me!==Te&&(ne(ee,ye,Te),fe=!0)}return fe});var q=S.table.core,Y=q.schema.primaryKey,$=Y.outbound,J=Y.extractKey,re=200,Y=y.db._options.modifyChunkSize;Y&&(re=typeof Y=="object"?Y[q.name]||Y["*"]||200:Y);function oe(ee,ye){var pe=ye.failures,ye=ye.numFailures;te+=ee-ye;for(var Te=0,Me=b(pe);Te<Me.length;Te++){var Ge=Me[Te];X.push(pe[Ge])}}var X=[],te=0,ae=[];return y.clone().primaryKeys().then(function(ee){function fe(ye){var Te=Math.min(re,ee.length-ye);return q.getMany({trans:C,keys:ee.slice(ye,ye+Te),cache:"immutable"}).then(function(Me){for(var Ge=[],Oe=[],we=$?[]:null,Fe=[],Ue=0;Ue<Te;++Ue){var Xe=Me[Ue],mt={value:He(Xe),primKey:ee[ye+Ue]};B.call(mt,mt.value,mt)!==!1&&(mt.value==null?Fe.push(ee[ye+Ue]):$||It(J(Xe),J(mt.value))===0?(Oe.push(mt.value),$&&we.push(ee[ye+Ue])):(Fe.push(ee[ye+Ue]),Ge.push(mt.value)))}return Promise.resolve(0<Ge.length&&q.mutate({trans:C,type:"add",values:Ge}).then(function(At){for(var Ct in At.failures)Fe.splice(parseInt(Ct),1);oe(Ge.length,At)})).then(function(){return(0<Oe.length||pe&&typeof v=="object")&&q.mutate({trans:C,type:"put",keys:we,values:Oe,criteria:pe,changeSpec:typeof v!="function"&&v,isAdditionalChunk:0<ye}).then(function(At){return oe(Oe.length,At)})}).then(function(){return(0<Fe.length||pe&&v===Vs)&&q.mutate({trans:C,type:"delete",keys:Fe,criteria:pe,isAdditionalChunk:0<ye}).then(function(At){return oe(Fe.length,At)})}).then(function(){return ee.length>ye+Te&&fe(ye+re)})})}var pe=Ii(S)&&S.limit===1/0&&(typeof v!="function"||v===Vs)&&{index:S.index,range:S.range};return fe(0).then(function(){if(0<X.length)throw new _t("Error modifying one or more objects",X,te,ae);return ee.length})})})},Ft.prototype.delete=function(){var v=this._ctx,y=v.range;return Ii(v)&&(v.isPrimKey||y.type===3)?this._write(function(S){var C=v.table.core.schema.primaryKey,w=y;return v.table.core.count({trans:S,query:{index:C,range:w}}).then(function(M){return v.table.core.mutate({trans:S,type:"deleteRange",range:w}).then(function(B){var q=B.failures;if(B.lastResult,B.results,B=B.numFailures,B)throw new _t("Could not delete some values",Object.keys(q).map(function($){return q[$]}),M-B);return M-B})})}):this.modify(Vs)},Ft);function Ft(){}var Vs=function(v,y){return y.value=null};function zo(v,y){return v<y?-1:v===y?0:1}function uu(v,y){return y<v?-1:v===y?0:1}function Jr(v,y,S){return v=v instanceof _a?new v.Collection(v):v,v._ctx.error=new(S||TypeError)(y),v}function Ji(v){return new v.Collection(v,function(){return $o("")}).limit(0)}function Ea(v,y,S,C){var w,M,B,q,$,J,re,Y=S.length;if(!S.every(function(te){return typeof te=="string"}))return Jr(v,ma);function oe(te){w=te==="next"?function(ee){return ee.toUpperCase()}:function(ee){return ee.toLowerCase()},M=te==="next"?function(ee){return ee.toLowerCase()}:function(ee){return ee.toUpperCase()},B=te==="next"?zo:uu;var ae=S.map(function(ee){return{lower:M(ee),upper:w(ee)}}).sort(function(ee,fe){return B(ee.lower,fe.lower)});q=ae.map(function(ee){return ee.upper}),$=ae.map(function(ee){return ee.lower}),re=(J=te)==="next"?"":C}oe("next"),v=new v.Collection(v,function(){return fi(q[0],$[Y-1]+C)}),v._ondirectionchange=function(te){oe(te)};var X=0;return v._addAlgorithm(function(te,ae,ee){var fe=te.key;if(typeof fe!="string")return!1;var pe=M(fe);if(y(pe,$,X))return!0;for(var ye=null,Te=X;Te<Y;++Te){var Me=function(Ge,Oe,we,Fe,Ue,Xe){for(var mt=Math.min(Ge.length,Fe.length),At=-1,Ct=0;Ct<mt;++Ct){var gn=Oe[Ct];if(gn!==Fe[Ct])return Ue(Ge[Ct],we[Ct])<0?Ge.substr(0,Ct)+we[Ct]+we.substr(Ct+1):Ue(Ge[Ct],Fe[Ct])<0?Ge.substr(0,Ct)+Fe[Ct]+we.substr(Ct+1):0<=At?Ge.substr(0,At)+Oe[At]+we.substr(At+1):null;Ue(Ge[Ct],gn)<0&&(At=Ct)}return mt<Fe.length&&Xe==="next"?Ge+we.substr(Ge.length):mt<Ge.length&&Xe==="prev"?Ge.substr(0,we.length):At<0?null:Ge.substr(0,At)+Fe[At]+we.substr(At+1)}(fe,pe,q[Te],$[Te],B,J);Me===null&&ye===null?X=Te+1:(ye===null||0<B(ye,Me))&&(ye=Me)}return ae(ye!==null?function(){te.continue(ye+re)}:ee),!1}),v}function fi(v,y,S,C){return{type:2,lower:v,upper:y,lowerOpen:S,upperOpen:C}}function $o(v){return{type:1,lower:v,upper:v}}var _a=(Object.defineProperty(Sr.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Sr.prototype.between=function(v,y,S,C){S=S!==!1,C=C===!0;try{return 0<this._cmp(v,y)||this._cmp(v,y)===0&&(S||C)&&(!S||!C)?Ji(this):new this.Collection(this,function(){return fi(v,y,!S,!C)})}catch{return Jr(this,zn)}},Sr.prototype.equals=function(v){return v==null?Jr(this,zn):new this.Collection(this,function(){return $o(v)})},Sr.prototype.above=function(v){return v==null?Jr(this,zn):new this.Collection(this,function(){return fi(v,void 0,!0)})},Sr.prototype.aboveOrEqual=function(v){return v==null?Jr(this,zn):new this.Collection(this,function(){return fi(v,void 0,!1)})},Sr.prototype.below=function(v){return v==null?Jr(this,zn):new this.Collection(this,function(){return fi(void 0,v,!1,!0)})},Sr.prototype.belowOrEqual=function(v){return v==null?Jr(this,zn):new this.Collection(this,function(){return fi(void 0,v)})},Sr.prototype.startsWith=function(v){return typeof v!="string"?Jr(this,ma):this.between(v,v+Ri,!0,!0)},Sr.prototype.startsWithIgnoreCase=function(v){return v===""?this.startsWith(v):Ea(this,function(y,S){return y.indexOf(S[0])===0},[v],Ri)},Sr.prototype.equalsIgnoreCase=function(v){return Ea(this,function(y,S){return y===S[0]},[v],"")},Sr.prototype.anyOfIgnoreCase=function(){var v=ut.apply(N,arguments);return v.length===0?Ji(this):Ea(this,function(y,S){return S.indexOf(y)!==-1},v,"")},Sr.prototype.startsWithAnyOfIgnoreCase=function(){var v=ut.apply(N,arguments);return v.length===0?Ji(this):Ea(this,function(y,S){return S.some(function(C){return y.indexOf(C)===0})},v,Ri)},Sr.prototype.anyOf=function(){var v=this,y=ut.apply(N,arguments),S=this._cmp;try{y.sort(S)}catch{return Jr(this,zn)}if(y.length===0)return Ji(this);var C=new this.Collection(this,function(){return fi(y[0],y[y.length-1])});C._ondirectionchange=function(M){S=M==="next"?v._ascending:v._descending,y.sort(S)};var w=0;return C._addAlgorithm(function(M,B,q){for(var $=M.key;0<S($,y[w]);)if(++w===y.length)return B(q),!1;return S($,y[w])===0||(B(function(){M.continue(y[w])}),!1)}),C},Sr.prototype.notEqual=function(v){return this.inAnyRange([[-1/0,v],[v,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Sr.prototype.noneOf=function(){var v=ut.apply(N,arguments);if(v.length===0)return new this.Collection(this);try{v.sort(this._ascending)}catch{return Jr(this,zn)}var y=v.reduce(function(S,C){return S?S.concat([[S[S.length-1][1],C]]):[[-1/0,C]]},null);return y.push([v[v.length-1],this.db._maxKey]),this.inAnyRange(y,{includeLowers:!1,includeUppers:!1})},Sr.prototype.inAnyRange=function(fe,y){var S=this,C=this._cmp,w=this._ascending,M=this._descending,B=this._min,q=this._max;if(fe.length===0)return Ji(this);if(!fe.every(function(pe){return pe[0]!==void 0&&pe[1]!==void 0&&w(pe[0],pe[1])<=0}))return Jr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Je.InvalidArgument);var $=!y||y.includeLowers!==!1,J=y&&y.includeUppers===!0,re,Y=w;function oe(pe,ye){return Y(pe[0],ye[0])}try{(re=fe.reduce(function(pe,ye){for(var Te=0,Me=pe.length;Te<Me;++Te){var Ge=pe[Te];if(C(ye[0],Ge[1])<0&&0<C(ye[1],Ge[0])){Ge[0]=B(Ge[0],ye[0]),Ge[1]=q(Ge[1],ye[1]);break}}return Te===Me&&pe.push(ye),pe},[])).sort(oe)}catch{return Jr(this,zn)}var X=0,te=J?function(pe){return 0<w(pe,re[X][1])}:function(pe){return 0<=w(pe,re[X][1])},ae=$?function(pe){return 0<M(pe,re[X][0])}:function(pe){return 0<=M(pe,re[X][0])},ee=te,fe=new this.Collection(this,function(){return fi(re[0][0],re[re.length-1][1],!$,!J)});return fe._ondirectionchange=function(pe){Y=pe==="next"?(ee=te,w):(ee=ae,M),re.sort(oe)},fe._addAlgorithm(function(pe,ye,Te){for(var Me,Ge=pe.key;ee(Ge);)if(++X===re.length)return ye(Te),!1;return!te(Me=Ge)&&!ae(Me)||(S._cmp(Ge,re[X][1])===0||S._cmp(Ge,re[X][0])===0||ye(function(){Y===w?pe.continue(re[X][0]):pe.continue(re[X][1])}),!1)}),fe},Sr.prototype.startsWithAnyOf=function(){var v=ut.apply(N,arguments);return v.every(function(y){return typeof y=="string"})?v.length===0?Ji(this):this.inAnyRange(v.map(function(y){return[y,y+Ri]})):Jr(this,"startsWithAnyOf() only works with strings")},Sr);function Sr(){}function _n(v){return jt(function(y){return Zi(y),v(y.target.error),!1})}function Zi(v){v.stopPropagation&&v.stopPropagation(),v.preventDefault&&v.preventDefault()}var di="storagemutated",Ks="x-storagemutated-1",sr=$i(null,di),kn=(Bn.prototype._lock=function(){return Ee(!Ne.global),++this._reculock,this._reculock!==1||Ne.global||(Ne.lockOwnerFor=this),this},Bn.prototype._unlock=function(){if(Ee(!Ne.global),--this._reculock==0)for(Ne.global||(Ne.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var v=this._blockedFuncs.shift();try{Qr(v[1],v[0])}catch{}}return this},Bn.prototype._locked=function(){return this._reculock&&Ne.lockOwnerFor!==this},Bn.prototype.create=function(v){var y=this;if(!this.mode)return this;var S=this.db.idbdb,C=this.db._state.dbOpenError;if(Ee(!this.idbtrans),!v&&!S)switch(C&&C.name){case"DatabaseClosedError":throw new Je.DatabaseClosed(C);case"MissingAPIError":throw new Je.MissingAPI(C.message,C);default:throw new Je.OpenFailed(C)}if(!this.active)throw new Je.TransactionInactive;return Ee(this._completion._state===null),(v=this.idbtrans=v||(this.db.core||S).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=jt(function(w){Zi(w),y._reject(v.error)}),v.onabort=jt(function(w){Zi(w),y.active&&y._reject(new Je.Abort(v.error)),y.active=!1,y.on("abort").fire(w)}),v.oncomplete=jt(function(){y.active=!1,y._resolve(),"mutatedParts"in v&&sr.storagemutated.fire(v.mutatedParts)}),this},Bn.prototype._promise=function(v,y,S){var C=this;if(v==="readwrite"&&this.mode!=="readwrite")return ar(new Je.ReadOnly("Transaction is readonly"));if(!this.active)return ar(new Je.TransactionInactive);if(this._locked())return new Pe(function(M,B){C._blockedFuncs.push([function(){C._promise(v,y,S).then(M,B)},Ne])});if(S)return vn(function(){var M=new Pe(function(B,q){C._lock();var $=y(B,q,C);$&&$.then&&$.then(B,q)});return M.finally(function(){return C._unlock()}),M._lib=!0,M});var w=new Pe(function(M,B){var q=y(M,B,C);q&&q.then&&q.then(M,B)});return w._lib=!0,w},Bn.prototype._root=function(){return this.parent?this.parent._root():this},Bn.prototype.waitFor=function(v){var y,S=this._root(),C=Pe.resolve(v);S._waitingFor?S._waitingFor=S._waitingFor.then(function(){return C}):(S._waitingFor=C,S._waitingQueue=[],y=S.idbtrans.objectStore(S.storeNames[0]),function M(){for(++S._spinCount;S._waitingQueue.length;)S._waitingQueue.shift()();S._waitingFor&&(y.get(-1/0).onsuccess=M)}());var w=S._waitingFor;return new Pe(function(M,B){C.then(function(q){return S._waitingQueue.push(jt(M.bind(null,q)))},function(q){return S._waitingQueue.push(jt(B.bind(null,q)))}).finally(function(){S._waitingFor===w&&(S._waitingFor=null)})})},Bn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Je.Abort))},Bn.prototype.table=function(v){var y=this._memoizedTables||(this._memoizedTables={});if(O(y,v))return y[v];var S=this.schema[v];if(!S)throw new Je.NotFound("Table "+v+" not part of transaction");return S=new this.db.Table(v,S,this),S.core=this.db.core.table(v),y[v]=S},Bn);function Bn(){}function ea(v,y,S,C,w,M,B){return{name:v,keyPath:y,unique:S,multi:C,auto:w,compound:M,src:(S&&!B?"&":"")+(C?"*":"")+(w?"++":"")+Hs(y)}}function Hs(v){return typeof v=="string"?v:v?"["+[].join.call(v,"+")+"]":""}function Mt(v,y,S){return{name:v,primKey:y,indexes:S,mappedClass:null,idxByName:(C=function(w){return[w.name,w]},S.reduce(function(w,M,B){return B=C(M,B),B&&(w[B[0]]=B[1]),w},{}))};var C}var ta=function(v){try{return v.only([[]]),ta=function(){return[[]]},[[]]}catch{return ta=function(){return Ri},Ri}};function Qa(v){return v==null?function(){}:typeof v=="string"?(y=v).split(".").length===1?function(S){return S[y]}:function(S){return z(S,y)}:function(S){return z(S,v)};var y}function Xo(v){return[].slice.call(v)}var cu=0;function ra(v){return v==null?":id":typeof v=="string"?v:"[".concat(v.join("+"),"]")}function fu(v,y,$){function C(ee){if(ee.type===3)return null;if(ee.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var X=ee.lower,te=ee.upper,ae=ee.lowerOpen,ee=ee.upperOpen;return X===void 0?te===void 0?null:y.upperBound(te,!!ee):te===void 0?y.lowerBound(X,!!ae):y.bound(X,te,!!ae,!!ee)}function w(oe){var X,te=oe.name;return{name:te,schema:oe,mutate:function(ae){var ee=ae.trans,fe=ae.type,pe=ae.keys,ye=ae.values,Te=ae.range;return new Promise(function(Me,Ge){Me=jt(Me);var Oe=ee.objectStore(te),we=Oe.keyPath==null,Fe=fe==="put"||fe==="add";if(!Fe&&fe!=="delete"&&fe!=="deleteRange")throw new Error("Invalid operation type: "+fe);var Ue,Xe=(pe||ye||{length:1}).length;if(pe&&ye&&pe.length!==ye.length)throw new Error("Given keys array must have same length as given values array.");if(Xe===0)return Me({numFailures:0,failures:{},results:[],lastResult:void 0});function mt(jr){++gn,Zi(jr)}var At=[],Ct=[],gn=0;if(fe==="deleteRange"){if(Te.type===4)return Me({numFailures:gn,failures:Ct,results:[],lastResult:void 0});Te.type===3?At.push(Ue=Oe.clear()):At.push(Ue=Oe.delete(C(Te)))}else{var we=Fe?we?[ye,pe]:[ye,null]:[pe,null],bt=we[0],wr=we[1];if(Fe)for(var Ir=0;Ir<Xe;++Ir)At.push(Ue=wr&&wr[Ir]!==void 0?Oe[fe](bt[Ir],wr[Ir]):Oe[fe](bt[Ir])),Ue.onerror=mt;else for(Ir=0;Ir<Xe;++Ir)At.push(Ue=Oe[fe](bt[Ir])),Ue.onerror=mt}function aa(jr){jr=jr.target.result,At.forEach(function(Pi,vs){return Pi.error!=null&&(Ct[vs]=Pi.error)}),Me({numFailures:gn,failures:Ct,results:fe==="delete"?pe:At.map(function(Pi){return Pi.result}),lastResult:jr})}Ue.onerror=function(jr){mt(jr),aa(jr)},Ue.onsuccess=aa})},getMany:function(ae){var ee=ae.trans,fe=ae.keys;return new Promise(function(pe,ye){pe=jt(pe);for(var Te,Me=ee.objectStore(te),Ge=fe.length,Oe=new Array(Ge),we=0,Fe=0,Ue=function(At){At=At.target,Oe[At._pos]=At.result,++Fe===we&&pe(Oe)},Xe=_n(ye),mt=0;mt<Ge;++mt)fe[mt]!=null&&((Te=Me.get(fe[mt]))._pos=mt,Te.onsuccess=Ue,Te.onerror=Xe,++we);we===0&&pe(Oe)})},get:function(ae){var ee=ae.trans,fe=ae.key;return new Promise(function(pe,ye){pe=jt(pe);var Te=ee.objectStore(te).get(fe);Te.onsuccess=function(Me){return pe(Me.target.result)},Te.onerror=_n(ye)})},query:(X=J,function(ae){return new Promise(function(ee,fe){ee=jt(ee);var pe,ye,Te,we=ae.trans,Me=ae.values,Ge=ae.limit,Ue=ae.query,Oe=Ge===1/0?void 0:Ge,Fe=Ue.index,Ue=Ue.range,we=we.objectStore(te),Fe=Fe.isPrimaryKey?we:we.index(Fe.name),Ue=C(Ue);if(Ge===0)return ee({result:[]});X?((Oe=Me?Fe.getAll(Ue,Oe):Fe.getAllKeys(Ue,Oe)).onsuccess=function(Xe){return ee({result:Xe.target.result})},Oe.onerror=_n(fe)):(pe=0,ye=!Me&&"openKeyCursor"in Fe?Fe.openKeyCursor(Ue):Fe.openCursor(Ue),Te=[],ye.onsuccess=function(Xe){var mt=ye.result;return mt?(Te.push(Me?mt.value:mt.primaryKey),++pe===Ge?ee({result:Te}):void mt.continue()):ee({result:Te})},ye.onerror=_n(fe))})}),openCursor:function(ae){var ee=ae.trans,fe=ae.values,pe=ae.query,ye=ae.reverse,Te=ae.unique;return new Promise(function(Me,Ge){Me=jt(Me);var Fe=pe.index,Oe=pe.range,we=ee.objectStore(te),we=Fe.isPrimaryKey?we:we.index(Fe.name),Fe=ye?Te?"prevunique":"prev":Te?"nextunique":"next",Ue=!fe&&"openKeyCursor"in we?we.openKeyCursor(C(Oe),Fe):we.openCursor(C(Oe),Fe);Ue.onerror=_n(Ge),Ue.onsuccess=jt(function(Xe){var mt,At,Ct,gn,bt=Ue.result;bt?(bt.___id=++cu,bt.done=!1,mt=bt.continue.bind(bt),At=(At=bt.continuePrimaryKey)&&At.bind(bt),Ct=bt.advance.bind(bt),gn=function(){throw new Error("Cursor not stopped")},bt.trans=ee,bt.stop=bt.continue=bt.continuePrimaryKey=bt.advance=function(){throw new Error("Cursor not started")},bt.fail=jt(Ge),bt.next=function(){var wr=this,Ir=1;return this.start(function(){return Ir--?wr.continue():wr.stop()}).then(function(){return wr})},bt.start=function(wr){function Ir(){if(Ue.result)try{wr()}catch(jr){bt.fail(jr)}else bt.done=!0,bt.start=function(){throw new Error("Cursor behind last entry")},bt.stop()}var aa=new Promise(function(jr,Pi){jr=jt(jr),Ue.onerror=_n(Pi),bt.fail=Pi,bt.stop=function(vs){bt.stop=bt.continue=bt.continuePrimaryKey=bt.advance=gn,jr(vs)}});return Ue.onsuccess=jt(function(jr){Ue.onsuccess=Ir,Ir()}),bt.continue=mt,bt.continuePrimaryKey=At,bt.advance=Ct,Ir(),aa},Me(bt)):Me(null)},Ge)})},count:function(ae){var ee=ae.query,fe=ae.trans,pe=ee.index,ye=ee.range;return new Promise(function(Te,Me){var Ge=fe.objectStore(te),Oe=pe.isPrimaryKey?Ge:Ge.index(pe.name),Ge=C(ye),Oe=Ge?Oe.count(Ge):Oe.count();Oe.onsuccess=jt(function(we){return Te(we.target.result)}),Oe.onerror=_n(Me)})}}}var M,B,q,re=(B=$,q=Xo((M=v).objectStoreNames),{schema:{name:M.name,tables:q.map(function(oe){return B.objectStore(oe)}).map(function(oe){var X=oe.keyPath,ee=oe.autoIncrement,te=_(X),ae={},ee={name:oe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:X==null,compound:te,keyPath:X,autoIncrement:ee,unique:!0,extractKey:Qa(X)},indexes:Xo(oe.indexNames).map(function(fe){return oe.index(fe)}).map(function(Te){var pe=Te.name,ye=Te.unique,Me=Te.multiEntry,Te=Te.keyPath,Me={name:pe,compound:_(Te),keyPath:Te,unique:ye,multiEntry:Me,extractKey:Qa(Te)};return ae[ra(Te)]=Me}),getIndexByKeyPath:function(fe){return ae[ra(fe)]}};return ae[":id"]=ee.primaryKey,X!=null&&(ae[ra(X)]=ee.primaryKey),ee})},hasGetAll:0<q.length&&"getAll"in B.objectStore(q[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),$=re.schema,J=re.hasGetAll,re=$.tables.map(w),Y={};return re.forEach(function(oe){return Y[oe.name]=oe}),{stack:"dbcore",transaction:v.transaction.bind(v),table:function(oe){if(!Y[oe])throw new Error("Table '".concat(oe,"' not found"));return Y[oe]},MIN_KEY:-1/0,MAX_KEY:ta(y),schema:$}}function qs(v,y,S,C){var w=S.IDBKeyRange;return S.indexedDB,{dbcore:(C=fu(y,w,C),v.dbcore.reduce(function(M,B){return B=B.create,o(o({},M),B(M))},C))}}function Ja(v,C){var S=C.db,C=qs(v._middlewares,S,v._deps,C);v.core=C.dbcore,v.tables.forEach(function(w){var M=w.name;v.core.schema.tables.some(function(B){return B.name===M})&&(w.core=v.core.table(M),v[M]instanceof v.Table&&(v[M].core=w.core))})}function Za(v,y,S,C){S.forEach(function(w){var M=C[w];y.forEach(function(B){var q=function $(J,re){return _e(J,re)||(J=R(J))&&$(J,re)}(B,w);(!q||"value"in q&&q.value===void 0)&&(B===v.Transaction.prototype||B instanceof v.Transaction?H(B,w,{get:function(){return this.table(w)},set:function($){W(this,w,{value:$,writable:!0,configurable:!0,enumerable:!0})}}):B[w]=new v.Table(w,M))})})}function es(v,y){y.forEach(function(S){for(var C in S)S[C]instanceof v.Table&&delete S[C]})}function xr(v,y){return v._cfg.version-y._cfg.version}function du(v,y,S,C){var w=v._dbSchema;S.objectStoreNames.contains("$meta")&&!w.$meta&&(w.$meta=Mt("$meta",Ys("")[0],[]),v._storeNames.push("$meta"));var M=v._createTransaction("readwrite",v._storeNames,w);M.create(S),M._completion.catch(C);var B=M._reject.bind(M),q=Ne.transless||Ne;vn(function(){return Ne.trans=M,Ne.transless=q,y!==0?(Ja(v,S),J=y,(($=M).storeNames.includes("$meta")?$.table("$meta").get("version").then(function(re){return re??J}):Pe.resolve(J)).then(function(re){return oe=re,X=M,te=S,ae=[],re=(Y=v)._versions,ee=Y._dbSchema=wn(0,Y.idbdb,te),(re=re.filter(function(fe){return fe._cfg.version>=oe})).length!==0?(re.forEach(function(fe){ae.push(function(){var pe=ee,ye=fe._cfg.dbschema;hi(Y,pe,te),hi(Y,ye,te),ee=Y._dbSchema=ye;var Te=Ws(pe,ye);Te.add.forEach(function(Fe){ts(te,Fe[0],Fe[1].primKey,Fe[1].indexes)}),Te.change.forEach(function(Fe){if(Fe.recreate)throw new Je.Upgrade("Not yet support for changing primary key");var Ue=te.objectStore(Fe.name);Fe.add.forEach(function(Xe){return rs(Ue,Xe)}),Fe.change.forEach(function(Xe){Ue.deleteIndex(Xe.name),rs(Ue,Xe)}),Fe.del.forEach(function(Xe){return Ue.deleteIndex(Xe)})});var Me=fe._cfg.contentUpgrade;if(Me&&fe._cfg.version>oe){Ja(Y,te),X._memoizedTables={};var Ge=ke(ye);Te.del.forEach(function(Fe){Ge[Fe]=pe[Fe]}),es(Y,[Y.Transaction.prototype]),Za(Y,[Y.Transaction.prototype],b(Ge),Ge),X.schema=Ge;var Oe,we=st(Me);return we&&ui(),Te=Pe.follow(function(){var Fe;(Oe=Me(X))&&we&&(Fe=Ln.bind(null,null),Oe.then(Fe,Fe))}),Oe&&typeof Oe.then=="function"?Pe.resolve(Oe):Te.then(function(){return Oe})}}),ae.push(function(pe){var ye,Te,Me=fe._cfg.dbschema;ye=Me,Te=pe,[].slice.call(Te.db.objectStoreNames).forEach(function(Ge){return ye[Ge]==null&&Te.db.deleteObjectStore(Ge)}),es(Y,[Y.Transaction.prototype]),Za(Y,[Y.Transaction.prototype],Y._storeNames,Y._dbSchema),X.schema=Y._dbSchema}),ae.push(function(pe){Y.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Y.idbdb.version/10)===fe._cfg.version?(Y.idbdb.deleteObjectStore("$meta"),delete Y._dbSchema.$meta,Y._storeNames=Y._storeNames.filter(function(ye){return ye!=="$meta"})):pe.objectStore("$meta").put(fe._cfg.version,"version"))})}),function fe(){return ae.length?Pe.resolve(ae.shift()(X.idbtrans)).then(fe):Pe.resolve()}().then(function(){Qo(ee,te)})):Pe.resolve();var Y,oe,X,te,ae,ee}).catch(B)):(b(w).forEach(function(re){ts(S,re,w[re].primKey,w[re].indexes)}),Ja(v,S),void Pe.follow(function(){return v.on.populate.fire(M)}).catch(B));var $,J})}function hu(v,y){Qo(v._dbSchema,y),y.db.version%10!=0||y.objectStoreNames.contains("$meta")||y.db.createObjectStore("$meta").add(Math.ceil(y.db.version/10-1),"version");var S=wn(0,v.idbdb,y);hi(v,v._dbSchema,y);for(var C=0,w=Ws(S,v._dbSchema).change;C<w.length;C++){var M=function(B){if(B.change.length||B.recreate)return console.warn("Unable to patch indexes of table ".concat(B.name," because it has changes on the type of index or primary key.")),{value:void 0};var q=y.objectStore(B.name);B.add.forEach(function($){tr&&console.debug("Dexie upgrade patch: Creating missing index ".concat(B.name,".").concat($.src)),rs(q,$)})}(w[C]);if(typeof M=="object")return M.value}}function Ws(v,y){var S,C={del:[],add:[],change:[]};for(S in v)y[S]||C.del.push(S);for(S in y){var w=v[S],M=y[S];if(w){var B={name:S,def:M,recreate:!1,del:[],add:[],change:[]};if(""+(w.primKey.keyPath||"")!=""+(M.primKey.keyPath||"")||w.primKey.auto!==M.primKey.auto)B.recreate=!0,C.change.push(B);else{var q=w.idxByName,$=M.idxByName,J=void 0;for(J in q)$[J]||B.del.push(J);for(J in $){var re=q[J],Y=$[J];re?re.src!==Y.src&&B.change.push(Y):B.add.push(Y)}(0<B.del.length||0<B.add.length||0<B.change.length)&&C.change.push(B)}}else C.add.push([S,M])}return C}function ts(v,y,S,C){var w=v.db.createObjectStore(y,S.keyPath?{keyPath:S.keyPath,autoIncrement:S.auto}:{autoIncrement:S.auto});return C.forEach(function(M){return rs(w,M)}),w}function Qo(v,y){b(v).forEach(function(S){y.db.objectStoreNames.contains(S)||(tr&&console.debug("Dexie: Creating missing table",S),ts(y,S,v[S].primKey,v[S].indexes))})}function rs(v,y){v.createIndex(y.name,y.keyPath,{unique:y.unique,multiEntry:y.multi})}function wn(v,y,S){var C={};return le(y.objectStoreNames,0).forEach(function(w){for(var M=S.objectStore(w),B=ea(Hs(J=M.keyPath),J||"",!0,!1,!!M.autoIncrement,J&&typeof J!="string",!0),q=[],$=0;$<M.indexNames.length;++$){var re=M.index(M.indexNames[$]),J=re.keyPath,re=ea(re.name,J,!!re.unique,!!re.multiEntry,!1,J&&typeof J!="string",!1);q.push(re)}C[w]=Mt(w,B,q)}),C}function hi(v,y,S){for(var C=S.db.objectStoreNames,w=0;w<C.length;++w){var M=C[w],B=S.objectStore(M);v._hasGetAll="getAll"in B;for(var q=0;q<B.indexNames.length;++q){var $=B.indexNames[q],J=B.index($).keyPath,re=typeof J=="string"?J:"["+le(J).join("+")+"]";!y[M]||(J=y[M].idxByName[re])&&(J.name=$,delete y[M].idxByName[re],y[M].idxByName[$]=J)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&p.WorkerGlobalScope&&p instanceof p.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(v._hasGetAll=!1)}function Ys(v){return v.split(",").map(function(y,S){var C=(y=y.trim()).replace(/([&*]|\+\+)/g,""),w=/^\[/.test(C)?C.match(/^\[(.*)\]$/)[1].split("+"):C;return ea(C,w||null,/\&/.test(y),/\*/.test(y),/\+\+/.test(y),_(w),S===0)})}var pu=(ns.prototype._parseStoresSpec=function(v,y){b(v).forEach(function(S){if(v[S]!==null){var C=Ys(v[S]),w=C.shift();if(w.unique=!0,w.multi)throw new Je.Schema("Primary key cannot be multi-valued");C.forEach(function(M){if(M.auto)throw new Je.Schema("Only primary key can be marked as autoIncrement (++)");if(!M.keyPath)throw new Je.Schema("Index must have a name and cannot be an empty string")}),y[S]=Mt(S,w,C)}})},ns.prototype.stores=function(S){var y=this.db;this._cfg.storesSource=this._cfg.storesSource?x(this._cfg.storesSource,S):S;var S=y._versions,C={},w={};return S.forEach(function(M){x(C,M._cfg.storesSource),w=M._cfg.dbschema={},M._parseStoresSpec(C,w)}),y._dbSchema=w,es(y,[y._allTables,y,y.Transaction.prototype]),Za(y,[y._allTables,y,y.Transaction.prototype,this._cfg.tables],b(w),w),y._storeNames=b(w),this},ns.prototype.upgrade=function(v){return this._cfg.contentUpgrade=Ci(this._cfg.contentUpgrade||tt,v),this},ns);function ns(){}function is(v,y){var S=v._dbNamesDB;return S||(S=v._dbNamesDB=new Qn(ki,{addons:[],indexedDB:v,IDBKeyRange:y})).version(1).stores({dbnames:"name"}),S.table("dbnames")}function as(v){return v&&typeof v.databases=="function"}function zs(v){return vn(function(){return Ne.letThrough=!0,v()})}function Ta(v){return!("from"in v)}var Gr=function(v,y){if(!this){var S=new Gr;return v&&"d"in v&&x(S,v),S}x(this,arguments.length?{d:1,from:v,to:1<arguments.length?y:v}:{d:0})};function $n(v,y,S){var C=It(y,S);if(!isNaN(C)){if(0<C)throw RangeError();if(Ta(v))return x(v,{from:y,to:S,d:1});var w=v.l,C=v.r;if(It(S,v.from)<0)return w?$n(w,y,S):v.l={from:y,to:S,d:1,l:null,r:null},$s(v);if(0<It(y,v.to))return C?$n(C,y,S):v.r={from:y,to:S,d:1,l:null,r:null},$s(v);It(y,v.from)<0&&(v.from=y,v.l=null,v.d=C?C.d+1:1),0<It(S,v.to)&&(v.to=S,v.r=null,v.d=v.l?v.l.d+1:1),S=!v.r,w&&!v.l&&na(v,w),C&&S&&na(v,C)}}function na(v,y){Ta(y)||function S(C,$){var M=$.from,B=$.to,q=$.l,$=$.r;$n(C,M,B),q&&S(C,q),$&&S(C,$)}(v,y)}function Jo(v,y){var S=Sa(y),C=S.next();if(C.done)return!1;for(var w=C.value,M=Sa(v),B=M.next(w.from),q=B.value;!C.done&&!B.done;){if(It(q.from,w.to)<=0&&0<=It(q.to,w.from))return!0;It(w.from,q.from)<0?w=(C=S.next(q.from)).value:q=(B=M.next(w.from)).value}return!1}function Sa(v){var y=Ta(v)?null:{s:0,n:v};return{next:function(S){for(var C=0<arguments.length;y;)switch(y.s){case 0:if(y.s=1,C)for(;y.n.l&&It(S,y.n.from)<0;)y={up:y,n:y.n.l,s:1};else for(;y.n.l;)y={up:y,n:y.n.l,s:1};case 1:if(y.s=2,!C||It(S,y.n.to)<=0)return{value:y.n,done:!1};case 2:if(y.n.r){y.s=3,y={up:y,n:y.n.r,s:0};continue}case 3:y=y.up}return{done:!0}}}}function $s(v){var y,S,C=(((y=v.r)===null||y===void 0?void 0:y.d)||0)-(((S=v.l)===null||S===void 0?void 0:S.d)||0),w=1<C?"r":C<-1?"l":"";w&&(y=w=="r"?"l":"r",S=o({},v),C=v[w],v.from=C.from,v.to=C.to,v[w]=C[w],S[w]=C[y],(v[y]=S).d=Xs(S)),v.d=Xs(v)}function Xs(S){var y=S.r,S=S.l;return(y?S?Math.max(y.d,S.d):y.d:S?S.d:0)+1}function xa(v,y){return b(y).forEach(function(S){v[S]?na(v[S],y[S]):v[S]=function C(w){var M,B,q={};for(M in w)O(w,M)&&(B=w[M],q[M]=!B||typeof B!="object"||ze.has(B.constructor)?B:C(B));return q}(y[S])}),v}function Qs(v,y){return v.all||y.all||Object.keys(v).some(function(S){return y[S]&&Jo(y[S],v[S])})}F(Gr.prototype,((sn={add:function(v){return na(this,v),this},addKey:function(v){return $n(this,v,v),this},addKeys:function(v){var y=this;return v.forEach(function(S){return $n(y,S,S)}),this},hasKey:function(v){var y=Sa(this).next(v).value;return y&&It(y.from,v)<=0&&0<=It(y.to,v)}})[Tr]=function(){return Sa(this)},sn));var Xn={},ss={},os=!1;function Tn(v){xa(ss,v),os||(os=!0,setTimeout(function(){os=!1,ls(ss,!(ss={}))},0))}function ls(v,y){y===void 0&&(y=!1);var S=new Set;if(v.all)for(var C=0,w=Object.values(Xn);C<w.length;C++)us(B=w[C],v,S,y);else for(var M in v){var B,q=/^idb\:\/\/(.*)\/(.*)\//.exec(M);q&&(M=q[1],q=q[2],(B=Xn["idb://".concat(M,"/").concat(q)])&&us(B,v,S,y))}S.forEach(function($){return $()})}function us(v,y,S,C){for(var w=[],M=0,B=Object.entries(v.queries.query);M<B.length;M++){for(var q=B[M],$=q[0],J=[],re=0,Y=q[1];re<Y.length;re++){var oe=Y[re];Qs(y,oe.obsSet)?oe.subscribers.forEach(function(ee){return S.add(ee)}):C&&J.push(oe)}C&&w.push([$,J])}if(C)for(var X=0,te=w;X<te.length;X++){var ae=te[X],$=ae[0],J=ae[1];v.queries.query[$]=J}}function Zo(v){var y=v._state,S=v._deps.indexedDB;if(y.isBeingOpened||v.idbdb)return y.dbReadyPromise.then(function(){return y.dbOpenError?ar(y.dbOpenError):v});y.isBeingOpened=!0,y.dbOpenError=null,y.openComplete=!1;var C=y.openCanceller,w=Math.round(10*v.verno),M=!1;function B(){if(y.openCanceller!==C)throw new Je.DatabaseClosed("db.open() was cancelled")}function q(){return new Pe(function(oe,X){if(B(),!S)throw new Je.MissingAPI;var te=v.name,ae=y.autoSchema||!w?S.open(te):S.open(te,w);if(!ae)throw new Je.MissingAPI;ae.onerror=_n(X),ae.onblocked=jt(v._fireOnBlocked),ae.onupgradeneeded=jt(function(ee){var fe;re=ae.transaction,y.autoSchema&&!v._options.allowEmptyDB?(ae.onerror=Zi,re.abort(),ae.result.close(),(fe=S.deleteDatabase(te)).onsuccess=fe.onerror=jt(function(){X(new Je.NoSuchDatabase("Database ".concat(te," doesnt exist")))})):(re.onerror=_n(X),ee=ee.oldVersion>Math.pow(2,62)?0:ee.oldVersion,Y=ee<1,v.idbdb=ae.result,M&&hu(v,re),du(v,ee/10,re,X))},X),ae.onsuccess=jt(function(){re=null;var ee,fe,pe,ye,Te,Me=v.idbdb=ae.result,Ge=le(Me.objectStoreNames);if(0<Ge.length)try{var Oe=Me.transaction((ye=Ge).length===1?ye[0]:ye,"readonly");if(y.autoSchema)fe=Me,pe=Oe,(ee=v).verno=fe.version/10,pe=ee._dbSchema=wn(0,fe,pe),ee._storeNames=le(fe.objectStoreNames,0),Za(ee,[ee._allTables],b(pe),pe);else if(hi(v,v._dbSchema,Oe),((Te=Ws(wn(0,(Te=v).idbdb,Oe),Te._dbSchema)).add.length||Te.change.some(function(we){return we.add.length||we.change.length}))&&!M)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Me.close(),w=Me.version+1,M=!0,oe(q());Ja(v,Oe)}catch{}Yi.push(v),Me.onversionchange=jt(function(we){y.vcFired=!0,v.on("versionchange").fire(we)}),Me.onclose=jt(function(we){v.on("close").fire(we)}),Y&&(Te=v._deps,Oe=te,Me=Te.indexedDB,Te=Te.IDBKeyRange,as(Me)||Oe===ki||is(Me,Te).put({name:Oe}).catch(tt)),oe()},X)}).catch(function(oe){switch(oe?.name){case"UnknownError":if(0<y.PR1398_maxLoop)return y.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),q();break;case"VersionError":if(0<w)return w=0,q()}return Pe.reject(oe)})}var $,J=y.dbReadyResolve,re=null,Y=!1;return Pe.race([C,(typeof navigator>"u"?Pe.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(oe){function X(){return indexedDB.databases().finally(oe)}$=setInterval(X,100),X()}).finally(function(){return clearInterval($)}):Promise.resolve()).then(q)]).then(function(){return B(),y.onReadyBeingFired=[],Pe.resolve(zs(function(){return v.on.ready.fire(v.vip)})).then(function oe(){if(0<y.onReadyBeingFired.length){var X=y.onReadyBeingFired.reduce(Ci,tt);return y.onReadyBeingFired=[],Pe.resolve(zs(function(){return X(v.vip)})).then(oe)}})}).finally(function(){y.openCanceller===C&&(y.onReadyBeingFired=null,y.isBeingOpened=!1)}).catch(function(oe){y.dbOpenError=oe;try{re&&re.abort()}catch{}return C===y.openCanceller&&v._close(),ar(oe)}).finally(function(){y.openComplete=!0,J()}).then(function(){var oe;return Y&&(oe={},v.tables.forEach(function(X){X.schema.indexes.forEach(function(te){te.name&&(oe["idb://".concat(v.name,"/").concat(X.name,"/").concat(te.name)]=new Gr(-1/0,[[[]]]))}),oe["idb://".concat(v.name,"/").concat(X.name,"/")]=oe["idb://".concat(v.name,"/").concat(X.name,"/:dels")]=new Gr(-1/0,[[[]]])}),sr(di).fire(oe),ls(oe,!0)),v})}function Js(v){function y(M){return v.next(M)}var S=w(y),C=w(function(M){return v.throw(M)});function w(M){return function($){var q=M($),$=q.value;return q.done?$:$&&typeof $.then=="function"?$.then(S,C):_($)?Promise.all($).then(S,C):S($)}}return w(y)()}function cs(v,y,S){for(var C=_(v)?v.slice():[v],w=0;w<S;++w)C.push(y);return C}var vu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(v){return o(o({},v),{table:function(y){var S=v.table(y),C=S.schema,w={},M=[];function B(Y,oe,X){var te=ra(Y),ae=w[te]=w[te]||[],ee=Y==null?0:typeof Y=="string"?1:Y.length,fe=0<oe,fe=o(o({},X),{name:fe?"".concat(te,"(virtual-from:").concat(X.name,")"):X.name,lowLevelIndex:X,isVirtual:fe,keyTail:oe,keyLength:ee,extractKey:Qa(Y),unique:!fe&&X.unique});return ae.push(fe),fe.isPrimaryKey||M.push(fe),1<ee&&B(ee===2?Y[0]:Y.slice(0,ee-1),oe+1,X),ae.sort(function(pe,ye){return pe.keyTail-ye.keyTail}),fe}y=B(C.primaryKey.keyPath,0,C.primaryKey),w[":id"]=[y];for(var q=0,$=C.indexes;q<$.length;q++){var J=$[q];B(J.keyPath,0,J)}function re(Y){var oe,X=Y.query.index;return X.isVirtual?o(o({},Y),{query:{index:X.lowLevelIndex,range:(oe=Y.query.range,X=X.keyTail,{type:oe.type===1?2:oe.type,lower:cs(oe.lower,oe.lowerOpen?v.MAX_KEY:v.MIN_KEY,X),lowerOpen:!0,upper:cs(oe.upper,oe.upperOpen?v.MIN_KEY:v.MAX_KEY,X),upperOpen:!0})}}):Y}return o(o({},S),{schema:o(o({},C),{primaryKey:y,indexes:M,getIndexByKeyPath:function(Y){return(Y=w[ra(Y)])&&Y[0]}}),count:function(Y){return S.count(re(Y))},query:function(Y){return S.query(re(Y))},openCursor:function(Y){var oe=Y.query.index,X=oe.keyTail,te=oe.isVirtual,ae=oe.keyLength;return te?S.openCursor(re(Y)).then(function(fe){return fe&&ee(fe)}):S.openCursor(Y);function ee(fe){return Object.create(fe,{continue:{value:function(pe){pe!=null?fe.continue(cs(pe,Y.reverse?v.MAX_KEY:v.MIN_KEY,X)):Y.unique?fe.continue(fe.key.slice(0,ae).concat(Y.reverse?v.MIN_KEY:v.MAX_KEY,X)):fe.continue()}},continuePrimaryKey:{value:function(pe,ye){fe.continuePrimaryKey(cs(pe,v.MAX_KEY,X),ye)}},primaryKey:{get:function(){return fe.primaryKey}},key:{get:function(){var pe=fe.key;return ae===1?pe[0]:pe.slice(0,ae)}},value:{get:function(){return fe.value}}})}}})}})}};function Zs(v,y,S,C){return S=S||{},C=C||"",b(v).forEach(function(w){var M,B,q;O(y,w)?(M=v[w],B=y[w],typeof M=="object"&&typeof B=="object"&&M&&B?(q=er(M))!==er(B)?S[C+w]=y[w]:q==="Object"?Zs(M,B,S,C+w+"."):M!==B&&(S[C+w]=y[w]):M!==B&&(S[C+w]=y[w])):S[C+w]=void 0}),b(y).forEach(function(w){O(v,w)||(S[C+w]=y[w])}),S}function fs(v,y){return y.type==="delete"?y.keys:y.keys||y.values.map(v.extractKey)}var el={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(v){return o(o({},v),{table:function(y){var S=v.table(y),C=S.schema.primaryKey;return o(o({},S),{mutate:function(w){var M=Ne.trans,B=M.table(y).hook,q=B.deleting,$=B.creating,J=B.updating;switch(w.type){case"add":if($.fire===tt)break;return M._promise("readwrite",function(){return re(w)},!0);case"put":if($.fire===tt&&J.fire===tt)break;return M._promise("readwrite",function(){return re(w)},!0);case"delete":if(q.fire===tt)break;return M._promise("readwrite",function(){return re(w)},!0);case"deleteRange":if(q.fire===tt)break;return M._promise("readwrite",function(){return function Y(oe,X,te){return S.query({trans:oe,values:!1,query:{index:C,range:X},limit:te}).then(function(ae){var ee=ae.result;return re({type:"delete",keys:ee,trans:oe}).then(function(fe){return 0<fe.numFailures?Promise.reject(fe.failures[0]):ee.length<te?{failures:[],numFailures:0,lastResult:void 0}:Y(oe,o(o({},X),{lower:ee[ee.length-1],lowerOpen:!0}),te)})})}(w.trans,w.range,1e4)},!0)}return S.mutate(w);function re(Y){var oe,X,te,ae=Ne.trans,ee=Y.keys||fs(C,Y);if(!ee)throw new Error("Keys missing");return(Y=Y.type==="add"||Y.type==="put"?o(o({},Y),{keys:ee}):o({},Y)).type!=="delete"&&(Y.values=d([],Y.values)),Y.keys&&(Y.keys=d([],Y.keys)),oe=S,te=ee,((X=Y).type==="add"?Promise.resolve([]):oe.getMany({trans:X.trans,keys:te,cache:"immutable"})).then(function(fe){var pe=ee.map(function(ye,Te){var Me,Ge,Oe,we=fe[Te],Fe={onerror:null,onsuccess:null};return Y.type==="delete"?q.fire.call(Fe,ye,we,ae):Y.type==="add"||we===void 0?(Me=$.fire.call(Fe,ye,Y.values[Te],ae),ye==null&&Me!=null&&(Y.keys[Te]=ye=Me,C.outbound||ne(Y.values[Te],C.keyPath,ye))):(Me=Zs(we,Y.values[Te]),(Ge=J.fire.call(Fe,Me,ye,we,ae))&&(Oe=Y.values[Te],Object.keys(Ge).forEach(function(Ue){O(Oe,Ue)?Oe[Ue]=Ge[Ue]:ne(Oe,Ue,Ge[Ue])}))),Fe});return S.mutate(Y).then(function(ye){for(var Te=ye.failures,Me=ye.results,Ge=ye.numFailures,ye=ye.lastResult,Oe=0;Oe<ee.length;++Oe){var we=(Me||ee)[Oe],Fe=pe[Oe];we==null?Fe.onerror&&Fe.onerror(Te[Oe]):Fe.onsuccess&&Fe.onsuccess(Y.type==="put"&&fe[Oe]?Y.values[Oe]:we)}return{failures:Te,results:Me,numFailures:Ge,lastResult:ye}}).catch(function(ye){return pe.forEach(function(Te){return Te.onerror&&Te.onerror(ye)}),Promise.reject(ye)})})}}})}})}};function tl(v,y,S){try{if(!y||y.keys.length<v.length)return null;for(var C=[],w=0,M=0;w<y.keys.length&&M<v.length;++w)It(y.keys[w],v[M])===0&&(C.push(S?He(y.values[w]):y.values[w]),++M);return C.length===v.length?C:null}catch{return null}}var rl={stack:"dbcore",level:-1,create:function(v){return{table:function(y){var S=v.table(y);return o(o({},S),{getMany:function(C){if(!C.cache)return S.getMany(C);var w=tl(C.keys,C.trans._cache,C.cache==="clone");return w?Pe.resolve(w):S.getMany(C).then(function(M){return C.trans._cache={keys:C.keys,values:C.cache==="clone"?He(M):M},M})},mutate:function(C){return C.type!=="add"&&(C.trans._cache=null),S.mutate(C)}})}}}};function eo(v,y){return v.trans.mode==="readonly"&&!!v.subscr&&!v.trans.explicit&&v.trans.db._options.cache!=="disabled"&&!y.schema.primaryKey.outbound}function to(v,y){switch(v){case"query":return y.values&&!y.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var nl={stack:"dbcore",level:0,name:"Observability",create:function(v){var y=v.schema.name,S=new Gr(v.MIN_KEY,v.MAX_KEY);return o(o({},v),{transaction:function(C,w,M){if(Ne.subscr&&w!=="readonly")throw new Je.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ne.querier));return v.transaction(C,w,M)},table:function(C){var w=v.table(C),M=w.schema,B=M.primaryKey,Y=M.indexes,q=B.extractKey,$=B.outbound,J=B.autoIncrement&&Y.filter(function(X){return X.compound&&X.keyPath.includes(B.keyPath)}),re=o(o({},w),{mutate:function(X){function te(Ue){return Ue="idb://".concat(y,"/").concat(C,"/").concat(Ue),ye[Ue]||(ye[Ue]=new Gr)}var ae,ee,fe,pe=X.trans,ye=X.mutatedParts||(X.mutatedParts={}),Te=te(""),Me=te(":dels"),Ge=X.type,Fe=X.type==="deleteRange"?[X.range]:X.type==="delete"?[X.keys]:X.values.length<50?[fs(B,X).filter(function(Ue){return Ue}),X.values]:[],Oe=Fe[0],we=Fe[1],Fe=X.trans._cache;return _(Oe)?(Te.addKeys(Oe),(Fe=Ge==="delete"||Oe.length===we.length?tl(Oe,Fe):null)||Me.addKeys(Oe),(Fe||we)&&(ae=te,ee=Fe,fe=we,M.indexes.forEach(function(Ue){var Xe=ae(Ue.name||"");function mt(Ct){return Ct!=null?Ue.extractKey(Ct):null}function At(Ct){return Ue.multiEntry&&_(Ct)?Ct.forEach(function(gn){return Xe.addKey(gn)}):Xe.addKey(Ct)}(ee||fe).forEach(function(Ct,wr){var bt=ee&&mt(ee[wr]),wr=fe&&mt(fe[wr]);It(bt,wr)!==0&&(bt!=null&&At(bt),wr!=null&&At(wr))})}))):Oe?(we={from:(we=Oe.lower)!==null&&we!==void 0?we:v.MIN_KEY,to:(we=Oe.upper)!==null&&we!==void 0?we:v.MAX_KEY},Me.add(we),Te.add(we)):(Te.add(S),Me.add(S),M.indexes.forEach(function(Ue){return te(Ue.name).add(S)})),w.mutate(X).then(function(Ue){return!Oe||X.type!=="add"&&X.type!=="put"||(Te.addKeys(Ue.results),J&&J.forEach(function(Xe){for(var mt=X.values.map(function(bt){return Xe.extractKey(bt)}),At=Xe.keyPath.findIndex(function(bt){return bt===B.keyPath}),Ct=0,gn=Ue.results.length;Ct<gn;++Ct)mt[Ct][At]=Ue.results[Ct];te(Xe.name).addKeys(mt)})),pe.mutatedParts=xa(pe.mutatedParts||{},ye),Ue})}}),Y=function(te){var ae=te.query,te=ae.index,ae=ae.range;return[te,new Gr((te=ae.lower)!==null&&te!==void 0?te:v.MIN_KEY,(ae=ae.upper)!==null&&ae!==void 0?ae:v.MAX_KEY)]},oe={get:function(X){return[B,new Gr(X.key)]},getMany:function(X){return[B,new Gr().addKeys(X.keys)]},count:Y,query:Y,openCursor:Y};return b(oe).forEach(function(X){re[X]=function(te){var ae=Ne.subscr,ee=!!ae,fe=eo(Ne,w)&&to(X,te)?te.obsSet={}:ae;if(ee){var pe=function(we){return we="idb://".concat(y,"/").concat(C,"/").concat(we),fe[we]||(fe[we]=new Gr)},ye=pe(""),Te=pe(":dels"),ae=oe[X](te),ee=ae[0],ae=ae[1];if((X==="query"&&ee.isPrimaryKey&&!te.values?Te:pe(ee.name||"")).add(ae),!ee.isPrimaryKey){if(X!=="count"){var Me=X==="query"&&$&&te.values&&w.query(o(o({},te),{values:!1}));return w[X].apply(this,arguments).then(function(we){if(X==="query"){if($&&te.values)return Me.then(function(mt){return mt=mt.result,ye.addKeys(mt),we});var Fe=te.values?we.result.map(q):we.result;(te.values?ye:Te).addKeys(Fe)}else if(X==="openCursor"){var Ue=we,Xe=te.values;return Ue&&Object.create(Ue,{key:{get:function(){return Te.addKey(Ue.primaryKey),Ue.key}},primaryKey:{get:function(){var mt=Ue.primaryKey;return Te.addKey(mt),mt}},value:{get:function(){return Xe&&ye.addKey(Ue.primaryKey),Ue.value}}})}return we})}Te.add(S)}}return w[X].apply(this,arguments)}}),re}})}};function ro(v,y,S){if(S.numFailures===0)return y;if(y.type==="deleteRange")return null;var C=y.keys?y.keys.length:"values"in y&&y.values?y.values.length:1;return S.numFailures===C?null:(y=o({},y),_(y.keys)&&(y.keys=y.keys.filter(function(w,M){return!(M in S.failures)})),"values"in y&&_(y.values)&&(y.values=y.values.filter(function(w,M){return!(M in S.failures)})),y)}function no(v,y){return S=v,((C=y).lower===void 0||(C.lowerOpen?0<It(S,C.lower):0<=It(S,C.lower)))&&(v=v,(y=y).upper===void 0||(y.upperOpen?It(v,y.upper)<0:It(v,y.upper)<=0));var S,C}function io(v,y,oe,C,w,M){if(!oe||oe.length===0)return v;var B=y.query.index,q=B.multiEntry,$=y.query.range,J=C.schema.primaryKey.extractKey,re=B.extractKey,Y=(B.lowLevelIndex||B).extractKey,oe=oe.reduce(function(X,te){var ae=X,ee=[];if(te.type==="add"||te.type==="put")for(var fe=new Gr,pe=te.values.length-1;0<=pe;--pe){var ye,Te=te.values[pe],Me=J(Te);fe.hasKey(Me)||(ye=re(Te),(q&&_(ye)?ye.some(function(Ue){return no(Ue,$)}):no(ye,$))&&(fe.addKey(Me),ee.push(Te)))}switch(te.type){case"add":var Ge=new Gr().addKeys(y.values?X.map(function(Xe){return J(Xe)}):X),ae=X.concat(y.values?ee.filter(function(Xe){return Xe=J(Xe),!Ge.hasKey(Xe)&&(Ge.addKey(Xe),!0)}):ee.map(function(Xe){return J(Xe)}).filter(function(Xe){return!Ge.hasKey(Xe)&&(Ge.addKey(Xe),!0)}));break;case"put":var Oe=new Gr().addKeys(te.values.map(function(Xe){return J(Xe)}));ae=X.filter(function(Xe){return!Oe.hasKey(y.values?J(Xe):Xe)}).concat(y.values?ee:ee.map(function(Xe){return J(Xe)}));break;case"delete":var we=new Gr().addKeys(te.keys);ae=X.filter(function(Xe){return!we.hasKey(y.values?J(Xe):Xe)});break;case"deleteRange":var Fe=te.range;ae=X.filter(function(Xe){return!no(J(Xe),Fe)})}return ae},v);return oe===v?v:(oe.sort(function(X,te){return It(Y(X),Y(te))||It(J(X),J(te))}),y.limit&&y.limit<1/0&&(oe.length>y.limit?oe.length=y.limit:v.length===y.limit&&oe.length<y.limit&&(w.dirty=!0)),M?Object.freeze(oe):oe)}function il(v,y){return It(v.lower,y.lower)===0&&It(v.upper,y.upper)===0&&!!v.lowerOpen==!!y.lowerOpen&&!!v.upperOpen==!!y.upperOpen}function gu(v,y){return function(S,C,w,M){if(S===void 0)return C!==void 0?-1:0;if(C===void 0)return 1;if((C=It(S,C))===0){if(w&&M)return 0;if(w)return 1;if(M)return-1}return C}(v.lower,y.lower,v.lowerOpen,y.lowerOpen)<=0&&0<=function(S,C,w,M){if(S===void 0)return C!==void 0?1:0;if(C===void 0)return-1;if((C=It(S,C))===0){if(w&&M)return 0;if(w)return-1;if(M)return 1}return C}(v.upper,y.upper,v.upperOpen,y.upperOpen)}function al(v,y,S,C){v.subscribers.add(S),C.addEventListener("abort",function(){var w,M;v.subscribers.delete(S),v.subscribers.size===0&&(w=v,M=y,setTimeout(function(){w.subscribers.size===0&&be(M,w)},3e3))})}var sl={stack:"dbcore",level:0,name:"Cache",create:function(v){var y=v.schema.name;return o(o({},v),{transaction:function(S,C,w){var M,B,q=v.transaction(S,C,w);return C==="readwrite"&&(B=(M=new AbortController).signal,w=function($){return function(){if(M.abort(),C==="readwrite"){for(var J=new Set,re=0,Y=S;re<Y.length;re++){var oe=Y[re],X=Xn["idb://".concat(y,"/").concat(oe)];if(X){var te=v.table(oe),ae=X.optimisticOps.filter(function(Xe){return Xe.trans===q});if(q._explicit&&$&&q.mutatedParts)for(var ee=0,fe=Object.values(X.queries.query);ee<fe.length;ee++)for(var pe=0,ye=(Ge=fe[ee]).slice();pe<ye.length;pe++)Qs((Oe=ye[pe]).obsSet,q.mutatedParts)&&(be(Ge,Oe),Oe.subscribers.forEach(function(Xe){return J.add(Xe)}));else if(0<ae.length){X.optimisticOps=X.optimisticOps.filter(function(Xe){return Xe.trans!==q});for(var Te=0,Me=Object.values(X.queries.query);Te<Me.length;Te++)for(var Ge,Oe,we,Fe=0,Ue=(Ge=Me[Te]).slice();Fe<Ue.length;Fe++)(Oe=Ue[Fe]).res!=null&&q.mutatedParts&&($&&!Oe.dirty?(we=Object.isFrozen(Oe.res),we=io(Oe.res,Oe.req,ae,te,Oe,we),Oe.dirty?(be(Ge,Oe),Oe.subscribers.forEach(function(Xe){return J.add(Xe)})):we!==Oe.res&&(Oe.res=we,Oe.promise=Pe.resolve({result:we}))):(Oe.dirty&&be(Ge,Oe),Oe.subscribers.forEach(function(Xe){return J.add(Xe)})))}}}J.forEach(function(Xe){return Xe()})}}},q.addEventListener("abort",w(!1),{signal:B}),q.addEventListener("error",w(!1),{signal:B}),q.addEventListener("complete",w(!0),{signal:B})),q},table:function(S){var C=v.table(S),w=C.schema.primaryKey;return o(o({},C),{mutate:function(M){var B=Ne.trans;if(w.outbound||B.db._options.cache==="disabled"||B.explicit||B.idbtrans.mode!=="readwrite")return C.mutate(M);var q=Xn["idb://".concat(y,"/").concat(S)];return q?(B=C.mutate(M),M.type!=="add"&&M.type!=="put"||!(50<=M.values.length||fs(w,M).some(function($){return $==null}))?(q.optimisticOps.push(M),M.mutatedParts&&Tn(M.mutatedParts),B.then(function($){0<$.numFailures&&(be(q.optimisticOps,M),($=ro(0,M,$))&&q.optimisticOps.push($),M.mutatedParts&&Tn(M.mutatedParts))}),B.catch(function(){be(q.optimisticOps,M),M.mutatedParts&&Tn(M.mutatedParts)})):B.then(function($){var J=ro(0,o(o({},M),{values:M.values.map(function(re,Y){var oe;return $.failures[Y]?re:(re=(oe=w.keyPath)!==null&&oe!==void 0&&oe.includes(".")?He(re):o({},re),ne(re,w.keyPath,$.results[Y]),re)})}),$);q.optimisticOps.push(J),queueMicrotask(function(){return M.mutatedParts&&Tn(M.mutatedParts)})}),B):C.mutate(M)},query:function(M){if(!eo(Ne,C)||!to("query",M))return C.query(M);var B=((J=Ne.trans)===null||J===void 0?void 0:J.db._options.cache)==="immutable",Y=Ne,q=Y.requery,$=Y.signal,J=function(te,ae,ee,fe){var pe=Xn["idb://".concat(te,"/").concat(ae)];if(!pe)return[];if(!(ae=pe.queries[ee]))return[null,!1,pe,null];var ye=ae[(fe.query?fe.query.index.name:null)||""];if(!ye)return[null,!1,pe,null];switch(ee){case"query":var Te=ye.find(function(Me){return Me.req.limit===fe.limit&&Me.req.values===fe.values&&il(Me.req.query.range,fe.query.range)});return Te?[Te,!0,pe,ye]:[ye.find(function(Me){return("limit"in Me.req?Me.req.limit:1/0)>=fe.limit&&(!fe.values||Me.req.values)&&gu(Me.req.query.range,fe.query.range)}),!1,pe,ye];case"count":return Te=ye.find(function(Me){return il(Me.req.query.range,fe.query.range)}),[Te,!!Te,pe,ye]}}(y,S,"query",M),re=J[0],Y=J[1],oe=J[2],X=J[3];return re&&Y?re.obsSet=M.obsSet:(Y=C.query(M).then(function(te){var ae=te.result;if(re&&(re.res=ae),B){for(var ee=0,fe=ae.length;ee<fe;++ee)Object.freeze(ae[ee]);Object.freeze(ae)}else te.result=He(ae);return te}).catch(function(te){return X&&re&&be(X,re),Promise.reject(te)}),re={obsSet:M.obsSet,promise:Y,subscribers:new Set,type:"query",req:M,dirty:!1},X?X.push(re):(X=[re],(oe=oe||(Xn["idb://".concat(y,"/").concat(S)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[M.query.index.name||""]=X)),al(re,X,q,$),re.promise.then(function(te){return{result:io(te.result,M,oe?.optimisticOps,C,re,B)}})}})}})}};function ds(v,y){return new Proxy(v,{get:function(S,C,w){return C==="db"?y:Reflect.get(S,C,w)}})}var Qn=(mr.prototype.version=function(v){if(isNaN(v)||v<.1)throw new Je.Type("Given version is not a positive number");if(v=Math.round(10*v)/10,this.idbdb||this._state.isBeingOpened)throw new Je.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,v);var y=this._versions,S=y.filter(function(C){return C._cfg.version===v})[0];return S||(S=new this.Version(v),y.push(S),y.sort(xr),S.stores({}),this._state.autoSchema=!1,S)},mr.prototype._whenReady=function(v){var y=this;return this.idbdb&&(this._state.openComplete||Ne.letThrough||this._vip)?v():new Pe(function(S,C){if(y._state.openComplete)return C(new Je.DatabaseClosed(y._state.dbOpenError));if(!y._state.isBeingOpened){if(!y._state.autoOpen)return void C(new Je.DatabaseClosed);y.open().catch(tt)}y._state.dbReadyPromise.then(S,C)}).then(v)},mr.prototype.use=function(v){var y=v.stack,S=v.create,C=v.level,w=v.name;return w&&this.unuse({stack:y,name:w}),v=this._middlewares[y]||(this._middlewares[y]=[]),v.push({stack:y,create:S,level:C??10,name:w}),v.sort(function(M,B){return M.level-B.level}),this},mr.prototype.unuse=function(v){var y=v.stack,S=v.name,C=v.create;return y&&this._middlewares[y]&&(this._middlewares[y]=this._middlewares[y].filter(function(w){return C?w.create!==C:!!S&&w.name!==S})),this},mr.prototype.open=function(){var v=this;return Qr(Lt,function(){return Zo(v)})},mr.prototype._close=function(){var v=this._state,y=Yi.indexOf(this);if(0<=y&&Yi.splice(y,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}v.isBeingOpened||(v.dbReadyPromise=new Pe(function(S){v.dbReadyResolve=S}),v.openCanceller=new Pe(function(S,C){v.cancelOpen=C}))},mr.prototype.close=function(S){var y=(S===void 0?{disableAutoOpen:!0}:S).disableAutoOpen,S=this._state;y?(S.isBeingOpened&&S.cancelOpen(new Je.DatabaseClosed),this._close(),S.autoOpen=!1,S.dbOpenError=new Je.DatabaseClosed):(this._close(),S.autoOpen=this._options.autoOpen||S.isBeingOpened,S.openComplete=!1,S.dbOpenError=null)},mr.prototype.delete=function(v){var y=this;v===void 0&&(v={disableAutoOpen:!0});var S=0<arguments.length&&typeof arguments[0]!="object",C=this._state;return new Pe(function(w,M){function B(){y.close(v);var q=y._deps.indexedDB.deleteDatabase(y.name);q.onsuccess=jt(function(){var $,J,re;$=y._deps,J=y.name,re=$.indexedDB,$=$.IDBKeyRange,as(re)||J===ki||is(re,$).delete(J).catch(tt),w()}),q.onerror=_n(M),q.onblocked=y._fireOnBlocked}if(S)throw new Je.InvalidArgument("Invalid closeOptions argument to db.delete()");C.isBeingOpened?C.dbReadyPromise.then(B):B()})},mr.prototype.backendDB=function(){return this.idbdb},mr.prototype.isOpen=function(){return this.idbdb!==null},mr.prototype.hasBeenClosed=function(){var v=this._state.dbOpenError;return v&&v.name==="DatabaseClosed"},mr.prototype.hasFailed=function(){return this._state.dbOpenError!==null},mr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(mr.prototype,"tables",{get:function(){var v=this;return b(this._allTables).map(function(y){return v._allTables[y]})},enumerable:!1,configurable:!0}),mr.prototype.transaction=function(){var v=(function(y,S,C){var w=arguments.length;if(w<2)throw new Je.InvalidArgument("Too few arguments");for(var M=new Array(w-1);--w;)M[w-1]=arguments[w];return C=M.pop(),[y,Be(M),C]}).apply(this,arguments);return this._transaction.apply(this,v)},mr.prototype._transaction=function(v,y,S){var C=this,w=Ne.trans;w&&w.db===this&&v.indexOf("!")===-1||(w=null);var M,B,q=v.indexOf("?")!==-1;v=v.replace("!","").replace("?","");try{if(B=y.map(function(J){if(J=J instanceof C.Table?J.name:J,typeof J!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return J}),v=="r"||v===Ya)M=Ya;else{if(v!="rw"&&v!=Bs)throw new Je.InvalidArgument("Invalid transaction mode: "+v);M=Bs}if(w){if(w.mode===Ya&&M===Bs){if(!q)throw new Je.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&B.forEach(function(J){if(w&&w.storeNames.indexOf(J)===-1){if(!q)throw new Je.SubTransaction("Table "+J+" not included in parent transaction.");w=null}}),q&&w&&!w.active&&(w=null)}}catch(J){return w?w._promise(null,function(re,Y){Y(J)}):ar(J)}var $=(function J(re,Y,oe,X,te){return Pe.resolve().then(function(){var ae=Ne.transless||Ne,ee=re._createTransaction(Y,oe,re._dbSchema,X);if(ee.explicit=!0,ae={trans:ee,transless:ae},X)ee.idbtrans=X.idbtrans;else try{ee.create(),ee.idbtrans._explicit=!0,re._state.PR1398_maxLoop=3}catch(ye){return ye.name===Zt.InvalidState&&re.isOpen()&&0<--re._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),re.close({disableAutoOpen:!1}),re.open().then(function(){return J(re,Y,oe,null,te)})):ar(ye)}var fe,pe=st(te);return pe&&ui(),ae=Pe.follow(function(){var ye;(fe=te.call(ee,ee))&&(pe?(ye=Ln.bind(null,null),fe.then(ye,ye)):typeof fe.next=="function"&&typeof fe.throw=="function"&&(fe=Js(fe)))},ae),(fe&&typeof fe.then=="function"?Pe.resolve(fe).then(function(ye){return ee.active?ye:ar(new Je.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):ae.then(function(){return fe})).then(function(ye){return X&&ee._resolve(),ee._completion.then(function(){return ye})}).catch(function(ye){return ee._reject(ye),ar(ye)})})}).bind(null,this,M,B,w,S);return w?w._promise(M,$,"lock"):Ne.trans?Qr(Ne.transless,function(){return C._whenReady($)}):this._whenReady($)},mr.prototype.table=function(v){if(!O(this._allTables,v))throw new Je.InvalidTable("Table ".concat(v," does not exist"));return this._allTables[v]},mr);function mr(v,y){var S=this;this._middlewares={},this.verno=0;var C=mr.dependencies;this._options=y=o({addons:mr.addons,autoOpen:!0,indexedDB:C.indexedDB,IDBKeyRange:C.IDBKeyRange,cache:"cloned"},y),this._deps={indexedDB:y.indexedDB,IDBKeyRange:y.IDBKeyRange},C=y.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var w,M,B,q,$,J={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:tt,dbReadyPromise:null,cancelOpen:tt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:y.autoOpen};J.dbReadyPromise=new Pe(function(Y){J.dbReadyResolve=Y}),J.openCanceller=new Pe(function(Y,oe){J.cancelOpen=oe}),this._state=J,this.name=v,this.on=$i(this,"populate","blocked","versionchange","close",{ready:[Ci,tt]}),this.on.ready.subscribe=ce(this.on.ready.subscribe,function(Y){return function(oe,X){mr.vip(function(){var te,ae=S._state;ae.openComplete?(ae.dbOpenError||Pe.resolve().then(oe),X&&Y(oe)):ae.onReadyBeingFired?(ae.onReadyBeingFired.push(oe),X&&Y(oe)):(Y(oe),te=S,X||Y(function ee(){te.on.ready.unsubscribe(oe),te.on.ready.unsubscribe(ee)}))})}}),this.Collection=(w=this,Xi(Yo.prototype,function(fe,ee){this.db=w;var X=Us,te=null;if(ee)try{X=ee()}catch(pe){te=pe}var ae=fe._ctx,ee=ae.table,fe=ee.hook.reading.fire;this._ctx={table:ee,index:ae.index,isPrimKey:!ae.index||ee.schema.primKey.keyPath&&ae.index===ee.schema.primKey.name,range:X,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:te,or:ae.or,valueMapper:fe!==Nr?fe:null}})),this.Table=(M=this,Xi(ba.prototype,function(Y,oe,X){this.db=M,this._tx=X,this.name=Y,this.schema=oe,this.hook=M._allTables[Y]?M._allTables[Y].hook:$i(null,{creating:[qn,tt],reading:[kr,Nr],updating:[En,tt],deleting:[va,tt]})})),this.Transaction=(B=this,Xi(kn.prototype,function(Y,oe,X,te,ae){var ee=this;this.db=B,this.mode=Y,this.storeNames=oe,this.schema=X,this.chromeTransactionDurability=te,this.idbtrans=null,this.on=$i(this,"complete","error","abort"),this.parent=ae||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Pe(function(fe,pe){ee._resolve=fe,ee._reject=pe}),this._completion.then(function(){ee.active=!1,ee.on.complete.fire()},function(fe){var pe=ee.active;return ee.active=!1,ee.on.error.fire(fe),ee.parent?ee.parent._reject(fe):pe&&ee.idbtrans&&ee.idbtrans.abort(),ar(fe)})})),this.Version=(q=this,Xi(pu.prototype,function(Y){this.db=q,this._cfg={version:Y,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=($=this,Xi(_a.prototype,function(Y,oe,X){if(this.db=$,this._ctx={table:Y,index:oe===":id"?null:oe,or:X},this._cmp=this._ascending=It,this._descending=function(te,ae){return It(ae,te)},this._max=function(te,ae){return 0<It(te,ae)?te:ae},this._min=function(te,ae){return It(te,ae)<0?te:ae},this._IDBKeyRange=$._deps.IDBKeyRange,!this._IDBKeyRange)throw new Je.MissingAPI})),this.on("versionchange",function(Y){0<Y.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(Y){!Y.newVersion||Y.newVersion<Y.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(Y.oldVersion/10))}),this._maxKey=ta(y.IDBKeyRange),this._createTransaction=function(Y,oe,X,te){return new S.Transaction(Y,oe,X,S._options.chromeTransactionDurability,te)},this._fireOnBlocked=function(Y){S.on("blocked").fire(Y),Yi.filter(function(oe){return oe.name===S.name&&oe!==S&&!oe._state.vcFired}).map(function(oe){return oe.on("versionchange").fire(Y)})},this.use(rl),this.use(sl),this.use(nl),this.use(vu),this.use(el);var re=new Proxy(this,{get:function(Y,oe,X){if(oe==="_vip")return!0;if(oe==="table")return function(ae){return ds(S.table(ae),re)};var te=Reflect.get(Y,oe,X);return te instanceof ba?ds(te,re):oe==="tables"?te.map(function(ae){return ds(ae,re)}):oe==="_createTransaction"?function(){return ds(te.apply(this,arguments),re)}:te}});this.vip=re,C.forEach(function(Y){return Y(S)})}var Aa,sn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",hs=(ia.prototype.subscribe=function(v,y,S){return this._subscribe(v&&typeof v!="function"?v:{next:v,error:y,complete:S})},ia.prototype[sn]=function(){return this},ia);function ia(v){this._subscribe=v}try{Aa={indexedDB:p.indexedDB||p.mozIndexedDB||p.webkitIndexedDB||p.msIndexedDB,IDBKeyRange:p.IDBKeyRange||p.webkitIDBKeyRange}}catch{Aa={indexedDB:null,IDBKeyRange:null}}function ol(v){var y,S=!1,C=new hs(function(w){var M=st(v),B,q=!1,$={},J={},re={get closed(){return q},unsubscribe:function(){q||(q=!0,B&&B.abort(),Y&&sr.storagemutated.unsubscribe(X))}};w.start&&w.start(re);var Y=!1,oe=function(){return ci(te)},X=function(ae){xa($,ae),Qs(J,$)&&oe()},te=function(){var ae,ee,fe;!q&&Aa.indexedDB&&($={},ae={},B&&B.abort(),B=new AbortController,fe=function(pe){var ye=cr();try{M&&ui();var Te=vn(v,pe);return Te=M?Te.finally(Ln):Te}finally{ye&&gr()}}(ee={subscr:ae,signal:B.signal,requery:oe,querier:v,trans:null}),Promise.resolve(fe).then(function(pe){S=!0,y=pe,q||ee.signal.aborted||($={},function(ye){for(var Te in ye)if(O(ye,Te))return;return 1}(J=ae)||Y||(sr(di,X),Y=!0),ci(function(){return!q&&w.next&&w.next(pe)}))},function(pe){S=!1,["DatabaseClosedError","AbortError"].includes(pe?.name)||q||ci(function(){q||w.error&&w.error(pe)})}))};return setTimeout(oe,0),re});return C.hasValue=function(){return S},C.getValue=function(){return y},C}var pi=Qn;function ps(v){var y=gi;try{gi=!0,sr.storagemutated.fire(v),ls(v,!0)}finally{gi=y}}F(pi,o(o({},On),{delete:function(v){return new pi(v,{addons:[]}).delete()},exists:function(v){return new pi(v,{addons:[]}).open().then(function(y){return y.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(v){try{return y=pi.dependencies,S=y.indexedDB,y=y.IDBKeyRange,(as(S)?Promise.resolve(S.databases()).then(function(C){return C.map(function(w){return w.name}).filter(function(w){return w!==ki})}):is(S,y).toCollection().primaryKeys()).then(v)}catch{return ar(new Je.MissingAPI)}var y,S},defineClass:function(){return function(v){x(this,v)}},ignoreTransaction:function(v){return Ne.trans?Qr(Ne.transless,v):v()},vip:zs,async:function(v){return function(){try{var y=Js(v.apply(this,arguments));return y&&typeof y.then=="function"?y:Pe.resolve(y)}catch(S){return ar(S)}}},spawn:function(v,y,S){try{var C=Js(v.apply(S,y||[]));return C&&typeof C.then=="function"?C:Pe.resolve(C)}catch(w){return ar(w)}},currentTransaction:{get:function(){return Ne.trans||null}},waitFor:function(v,y){return y=Pe.resolve(typeof v=="function"?pi.ignoreTransaction(v):v).timeout(y||6e4),Ne.trans?Ne.trans.waitFor(y):y},Promise:Pe,debug:{get:function(){return tr},set:function(v){pt(v)}},derive:Z,extend:x,props:F,override:ce,Events:$i,on:sr,liveQuery:ol,extendObservabilitySet:xa,getByKeyPath:z,setByKeyPath:ne,delByKeyPath:function(v,y){typeof y=="string"?ne(v,y,void 0):"length"in y&&[].map.call(y,function(S){ne(v,S,void 0)})},shallowClone:ke,deepClone:He,getObjectDiff:Zs,cmp:It,asap:Se,minKey:-1/0,addons:[],connections:Yi,errnames:Zt,dependencies:Aa,cache:Xn,semVer:"4.0.11",version:"4.0.11".split(".").map(function(v){return parseInt(v)}).reduce(function(v,y,S){return v+y/Math.pow(10,2*S)})})),pi.maxKey=ta(pi.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(sr(di,function(v){gi||(v=new CustomEvent(Ks,{detail:v}),gi=!0,dispatchEvent(v),gi=!1)}),addEventListener(Ks,function(v){v=v.detail,gi||ps(v)}));var vi,gi=!1,Ca=function(){};return typeof BroadcastChannel<"u"&&((Ca=function(){(vi=new BroadcastChannel(Ks)).onmessage=function(v){return v.data&&ps(v.data)}})(),typeof vi.unref=="function"&&vi.unref(),sr(di,function(v){gi||vi.postMessage(v)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(v){if(!Qn.disableBfCache&&v.persisted){tr&&console.debug("Dexie: handling persisted pagehide"),vi?.close();for(var y=0,S=Yi;y<S.length;y++)S[y].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(v){!Qn.disableBfCache&&v.persisted&&(tr&&console.debug("Dexie: handling persisted pageshow"),Ca(),ps({all:new Gr(-1/0,[[]])}))})),Pe.rejectionMapper=function(v,y){return!v||v instanceof $r||v instanceof TypeError||v instanceof SyntaxError||!v.name||!An[v.name]?v:(y=new An[v.name](y||v.message,v),"stack"in v&&H(y,"stack",{get:function(){return this.inner.stack}}),y)},pt(tr),o(Qn,Object.freeze({__proto__:null,Dexie:Qn,liveQuery:ol,Entity:za,cmp:It,PropModification:Qi,replacePrefix:function(v,y){return new Qi({replacePrefix:[v,y]})},add:function(v){return new Qi({add:v})},remove:function(v){return new Qi({remove:v})},default:Qn,RangeSet:Gr,mergeRanges:na,rangesOverlap:Jo}),{default:Qn}),Qn})}(Pl)),Pl.exports}var Eb=bb();const Pc=nu(Eb),oh=Symbol.for("Dexie"),Hl=globalThis[oh]||(globalThis[oh]=Pc);if(Pc.semVer!==Hl.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Pc.semVer} and ${Hl.semVer}`);const{liveQuery:V_,mergeRanges:K_,rangesOverlap:H_,RangeSet:q_,cmp:W_,Entity:Y_,PropModification:z_,replacePrefix:$_,add:X_,remove:Q_}=Hl,Bi=jn({channels:[]}),Lo=new Hl("playlist");Lo.version(1).stores({channels:"++id, name, url ,createAt"});const Ro=()=>Lo.channels.toArray(),lh=async(t,r)=>{const i=await Lo.channels.where("url").equals(r).first();return i?(console.warn("Channel already exists:",i.name),i.id):(await Lo.channels.add({name:t,url:r,createdAt:Date.now()}),Bi.channels=await Ro(),{status:"success",message:"Channel Added!",remainingChannels:await Ro()})},_b=async t=>{try{return await Lo.channels.delete(t),Bi.channels=await Ro(),{status:"success",message:"Channel deleted!",remainingChannels:await Ro()}}catch(r){return console.error("Delete error:",r),{status:"error",message:r.message||"Delete failed"}}};var fc={exports:{}},uh;function Tb(){return uh||(uh=1,function(t,r){(function i(o){(function(d,p){t.exports=p()})(this,function(){function d(l,c,s){if(F())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,c);var e=new(l.bind.apply(l,n));return s&&Z(e,s.prototype),e}function p(l,c){for(var s=0;s<c.length;s++){var n=c[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(l,me(n.key),n)}}function b(l,c,s){return c&&p(l.prototype,c),s&&p(l,s),Object.defineProperty(l,"prototype",{writable:!1}),l}function _(l,c,s){return(c=me(c))in l?Object.defineProperty(l,c,{value:s,enumerable:!0,configurable:!0,writable:!0}):l[c]=s,l}function x(){return x=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var s=arguments[c];for(var n in s)({}).hasOwnProperty.call(s,n)&&(l[n]=s[n])}return l},x.apply(null,arguments)}function R(l){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},R(l)}function P(l,c){l.prototype=Object.create(c.prototype),l.prototype.constructor=l,Z(l,c)}function O(l){try{return Function.toString.call(l).indexOf("[native code]")!==-1}catch{return typeof l=="function"}}function F(){try{var l=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(F=function(){return!!l})()}function W(l,c){var s=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);c&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})),s.push.apply(s,n)}return s}function H(l){for(var c=1;c<arguments.length;c++){var s=arguments[c]!=null?arguments[c]:{};c%2?W(Object(s),!0).forEach(function(n){_(l,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(s)):W(Object(s)).forEach(function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(s,n))})}return l}function Z(l,c){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,n){return s.__proto__=n,s},Z(l,c)}function _e(l,c){if(typeof l!="object"||!l)return l;var s=l[Symbol.toPrimitive];if(s!==void 0){var n=s.call(l,c);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(l)}function me(l){var c=_e(l,"string");return typeof c=="symbol"?c:c+""}function le(l){var c=typeof Map=="function"?new Map:void 0;return le=function(s){if(s===null||!O(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(s))return c.get(s);c.set(s,n)}function n(){return d(s,arguments,R(this).constructor)}return n.prototype=Object.create(s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Z(n,s)},le(l)}function ce(){try{return crypto.randomUUID()}catch{try{var l=URL.createObjectURL(new Blob),c=l.toString();return URL.revokeObjectURL(l),c.slice(c.lastIndexOf("/")+1)}catch{var s=new Date().getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var f=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(u=="x"?f:f&3|8).toString(16)});return n}}}function Ee(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Se={exports:{}},z;function ne(){return z||(z=1,function(l){var c=Object.prototype.hasOwnProperty,s="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(s=!1));function e(h,g,m){this.fn=h,this.context=g,this.once=m||!1}function a(h,g,m,E,T){if(typeof m!="function")throw new TypeError("The listener must be a function");var A=new e(m,E||h,T),L=s?s+g:g;return h._events[L]?h._events[L].fn?h._events[L]=[h._events[L],A]:h._events[L].push(A):(h._events[L]=A,h._eventsCount++),h}function u(h,g){--h._eventsCount===0?h._events=new n:delete h._events[g]}function f(){this._events=new n,this._eventsCount=0}f.prototype.eventNames=function(){var g=[],m,E;if(this._eventsCount===0)return g;for(E in m=this._events)c.call(m,E)&&g.push(s?E.slice(1):E);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(m)):g},f.prototype.listeners=function(g){var m=s?s+g:g,E=this._events[m];if(!E)return[];if(E.fn)return[E.fn];for(var T=0,A=E.length,L=new Array(A);T<A;T++)L[T]=E[T].fn;return L},f.prototype.listenerCount=function(g){var m=s?s+g:g,E=this._events[m];return E?E.fn?1:E.length:0},f.prototype.emit=function(g,m,E,T,A,L){var k=s?s+g:g;if(!this._events[k])return!1;var I=this._events[k],D=arguments.length,U,K;if(I.fn){switch(I.once&&this.removeListener(g,I.fn,void 0,!0),D){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,m),!0;case 3:return I.fn.call(I.context,m,E),!0;case 4:return I.fn.call(I.context,m,E,T),!0;case 5:return I.fn.call(I.context,m,E,T,A),!0;case 6:return I.fn.call(I.context,m,E,T,A,L),!0}for(K=1,U=new Array(D-1);K<D;K++)U[K-1]=arguments[K];I.fn.apply(I.context,U)}else{var G=I.length,j;for(K=0;K<G;K++)switch(I[K].once&&this.removeListener(g,I[K].fn,void 0,!0),D){case 1:I[K].fn.call(I[K].context);break;case 2:I[K].fn.call(I[K].context,m);break;case 3:I[K].fn.call(I[K].context,m,E);break;case 4:I[K].fn.call(I[K].context,m,E,T);break;default:if(!U)for(j=1,U=new Array(D-1);j<D;j++)U[j-1]=arguments[j];I[K].fn.apply(I[K].context,U)}}return!0},f.prototype.on=function(g,m,E){return a(this,g,m,E,!1)},f.prototype.once=function(g,m,E){return a(this,g,m,E,!0)},f.prototype.removeListener=function(g,m,E,T){var A=s?s+g:g;if(!this._events[A])return this;if(!m)return u(this,A),this;var L=this._events[A];if(L.fn)L.fn===m&&(!T||L.once)&&(!E||L.context===E)&&u(this,A);else{for(var k=0,I=[],D=L.length;k<D;k++)(L[k].fn!==m||T&&!L[k].once||E&&L[k].context!==E)&&I.push(L[k]);I.length?this._events[A]=I.length===1?I[0]:I:u(this,A)}return this},f.prototype.removeAllListeners=function(g){var m;return g?(m=s?s+g:g,this._events[m]&&u(this,m)):(this._events=new n,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=s,f.EventEmitter=f,l.exports=f}(Se)),Se.exports}var ke=ne(),Ce=Ee(ke),Be={exports:{}},ze;function Ye(){return ze||(ze=1,function(l,c){(function(s){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,u=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f={buildAbsoluteURL:function(h,g,m){if(m=m||{},h=h.trim(),g=g.trim(),!g){if(!m.alwaysNormalize)return h;var E=f.parseURL(h);if(!E)throw new Error("Error trying to parse base URL.");return E.path=f.normalizePath(E.path),f.buildURLFromParts(E)}var T=f.parseURL(g);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return m.alwaysNormalize?(T.path=f.normalizePath(T.path),f.buildURLFromParts(T)):g;var A=f.parseURL(h);if(!A)throw new Error("Error trying to parse base URL.");if(!A.netLoc&&A.path&&A.path[0]!=="/"){var L=e.exec(A.path);A.netLoc=L[1],A.path=L[2]}A.netLoc&&!A.path&&(A.path="/");var k={scheme:A.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(k.netLoc=A.netLoc,T.path[0]!=="/"))if(!T.path)k.path=A.path,T.params||(k.params=A.params,T.query||(k.query=A.query));else{var I=A.path,D=I.substring(0,I.lastIndexOf("/")+1)+T.path;k.path=f.normalizePath(D)}return k.path===null&&(k.path=m.alwaysNormalize?f.normalizePath(T.path):T.path),f.buildURLFromParts(k)},parseURL:function(h){var g=n.exec(h);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(u,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};l.exports=f})()}(Be)),Be.exports}var He=Ye(),xe=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},er=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=Tr},Tr=Number.MAX_SAFE_INTEGER||9007199254740991,ft=function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l}({}),be=function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l}({}),N=function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l}({}),ut={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},st={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},zr=function(){function l(s,n,e){n===void 0&&(n=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=s,this.alpha_=s?Math.exp(Math.log(.5)/s):0,this.estimate_=n,this.totalWeight_=e}var c=l.prototype;return c.sample=function(n,e){var a=Math.pow(this.alpha_,n);this.estimate_=e*(1-a)+a*this.estimate_,this.totalWeight_+=n},c.getTotalWeight=function(){return this.totalWeight_},c.getEstimate=function(){if(this.alpha_){var n=1-Math.pow(this.alpha_,this.totalWeight_);if(n)return this.estimate_/n}return this.estimate_},l}(),$r=function(){function l(s,n,e,a){a===void 0&&(a=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new zr(s),this.fast_=new zr(n),this.defaultTTFB_=a,this.ttfb_=new zr(s)}var c=l.prototype;return c.update=function(n,e){var a=this.slow_,u=this.fast_,f=this.ttfb_;a.halfLife!==n&&(this.slow_=new zr(n,a.getEstimate(),a.getTotalWeight())),u.halfLife!==e&&(this.fast_=new zr(e,u.getEstimate(),u.getTotalWeight())),f.halfLife!==n&&(this.ttfb_=new zr(n,f.getEstimate(),f.getTotalWeight()))},c.sample=function(n,e){n=Math.max(n,this.minDelayMs_);var a=8*e,u=n/1e3,f=a/u;this.fast_.sample(u,f),this.slow_.sample(u,f)},c.sampleTTFB=function(n){var e=n/1e3,a=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(a,Math.max(n,5))},c.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},c.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},c.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},c.destroy=function(){},b(l,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),rt=function(c,s){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var n="["+c+"]:";this.trace=_t,this.debug=s.debug.bind(null,n),this.log=s.log.bind(null,n),this.warn=s.warn.bind(null,n),this.info=s.info.bind(null,n),this.error=s.error.bind(null,n)},_t=function(){},lr={trace:_t,debug:_t,log:_t,warn:_t,info:_t,error:_t};function Zt(){return x({},lr)}function br(l,c){var s=self.console[l];return s?s.bind(self.console,(c?"["+c+"] ":"")+"["+l+"] >"):_t}function Je(l,c,s){return c[l]?c[l].bind(c):br(l,s)}var An=Zt();function On(l,c,s){var n=Zt();if(typeof console=="object"&&l===!0||typeof l=="object"){var e=["debug","log","info","warn","error"];e.forEach(function(a){n[a]=Je(a,l,s)});try{n.log('Debug logs enabled for "'+c+'" in hls.js version 1.6.10')}catch{return Zt()}e.forEach(function(a){An[a]=Je(a,l)})}else x(An,n);return n}var tt=An,Nr,kr;function Et(){return kr||(kr=1,Nr=void 0),Nr}var qn=Et(),va=Ee(qn);function En(l){if(l===void 0&&(l=!0),!(typeof self>"u")){var c=(l||!self.MediaSource)&&self.ManagedMediaSource;return c||self.MediaSource||self.WebKitMediaSource}}function ga(l){return typeof self<"u"&&l===self.ManagedMediaSource}function Ci(l,c){var s=Object.keys(l),n=Object.keys(c),e=s.length,a=n.length;return!e||!a||e===a&&!s.some(function(u){return n.indexOf(u)===-1})}function tr(l,c){if(c===void 0&&(c=!1),typeof TextDecoder<"u"){var s=new TextDecoder("utf-8"),n=s.decode(l);if(c){var e=n.indexOf("\0");return e!==-1?n.substring(0,e):n}return n.replace(/\0/g,"")}for(var a=l.length,u,f,h,g="",m=0;m<a;){if(u=l[m++],u===0&&c)return g;if(u===0||u===3)continue;switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(u);break;case 12:case 13:f=l[m++],g+=String.fromCharCode((u&31)<<6|f&63);break;case 14:f=l[m++],h=l[m++],g+=String.fromCharCode((u&15)<<12|(f&63)<<6|(h&63)<<0);break}}return g}var pt={hexDump:function(c){for(var s="",n=0;n<c.length;n++){var e=c[n].toString(16);e.length<2&&(e="0"+e),s+=e}return s}};function Tt(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var kt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},ot={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Gt=function(){function l(s){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof s=="string"&&(s={url:s}),this.base=s,si(this,"stats")}var c=l.prototype;return c.setByteRange=function(n,e){var a=n.split("@",2),u;a.length===1?u=e?.byteRangeEndOffset||0:u=parseInt(a[1]),this._byteRange=[u,parseInt(a[0])+u]},c.clearElementaryStreamInfo=function(){var n=this.elementaryStreams;n[ot.AUDIO]=null,n[ot.VIDEO]=null,n[ot.AUDIOVIDEO]=null},b(l,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var n;this._streams=(n={},n[ot.AUDIO]=null,n[ot.VIDEO]=null,n[ot.AUDIOVIDEO]=null,n)}return this._streams},set:function(n){this._streams=n}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new kt),this._stats},set:function(n){this._stats=n}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=He.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}])}();function ht(l){return l.sn!=="initSegment"}var ur=function(l){function c(n,e){var a;return a=l.call(this,e)||this,a._decryptdata=null,a._programDateTime=null,a._ref=null,a._bitrate=void 0,a.rawProgramDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkeys=void 0,a.type=void 0,a.loader=null,a.keyLoader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.playlistOffset=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.endList=void 0,a.gap=void 0,a.urlId=0,a.type=n,a}P(c,l);var s=c.prototype;return s.addStart=function(e){this.setStart(this.start+e)},s.setStart=function(e){this.start=e,this._ref&&(this._ref.start=e)},s.setDuration=function(e){this.duration=e,this._ref&&(this._ref.duration=e)},s.setKeyFormat=function(e){if(this.levelkeys){var a=this.levelkeys[e];a&&!this._decryptdata&&(this._decryptdata=a.getDecryptData(this.sn))}},s.abortRequests=function(){var e,a;(e=this.loader)==null||e.abort(),(a=this.keyLoader)==null||a.abort()},s.setElementaryStreamInfo=function(e,a,u,f,h,g){g===void 0&&(g=!1);var m=this.elementaryStreams,E=m[e];if(!E){m[e]={startPTS:a,endPTS:u,startDTS:f,endDTS:h,partial:g};return}E.startPTS=Math.min(E.startPTS,a),E.endPTS=Math.max(E.endPTS,u),E.startDTS=Math.min(E.startDTS,f),E.endDTS=Math.max(E.endDTS,h)},b(c,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange.length){var a=this.byteRange[0],u=this.byteRange[1];if(xe(a)&&xe(u))return u-a}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var a=this.levelkeys.identity;if(a)this._decryptdata=a.getDecryptData(this.sn);else{var u=Object.keys(this.levelkeys);if(u.length===1){var f=this._decryptdata=this.levelkeys[u[0]]||null;if(f)return f.getDecryptData(this.sn)}}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var e=xe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var a,u=Object.keys(this.levelkeys),f=u.length;if(f>1||f===1&&(a=this.levelkeys[u[0]])!=null&&a.encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!xe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return ht(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(Gt),pn=function(l){function c(s,n,e,a,u){var f;f=l.call(this,e)||this,f.fragOffset=0,f.duration=0,f.gap=!1,f.independent=!1,f.relurl=void 0,f.fragment=void 0,f.index=void 0,f.duration=s.decimalFloatingPoint("DURATION"),f.gap=s.bool("GAP"),f.independent=s.bool("INDEPENDENT"),f.relurl=s.enumeratedString("URI"),f.fragment=n,f.index=a;var h=s.enumeratedString("BYTERANGE");return h&&f.setByteRange(h,u),u&&(f.fragOffset=u.fragOffset+u.duration),f}return P(c,l),b(c,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}])}(Gt);function Nn(l,c){var s=Object.getPrototypeOf(l);if(s){var n=Object.getOwnPropertyDescriptor(s,c);return n||Nn(s,c)}}function si(l,c){var s=Nn(l,c);s&&(s.enumerable=!0,Object.defineProperty(l,c,s))}var dr=Math.pow(2,32)-1,hr=[].push,Fr={video:1,audio:2,id3:3,text:4};function Lt(l){return String.fromCharCode.apply(null,l)}function Ne(l,c){var s=l[c]<<8|l[c+1];return s<0?65536+s:s}function Le(l,c){var s=wt(l,c);return s<0?4294967296+s:s}function dt(l,c){var s=Le(l,c);return s*=Math.pow(2,32),s+=Le(l,c+4),s}function wt(l,c){return l[c]<<24|l[c+1]<<16|l[c+2]<<8|l[c+3]}function Pe(l){for(var c=l.byteLength,s=0;s<c;){var n=Le(l,s);if(n>8&&l[s+4]===109&&l[s+5]===111&&l[s+6]===111&&l[s+7]===102)return!0;s=n>1?s+n:c}return!1}function De(l,c){var s=[];if(!c.length)return s;for(var n=l.byteLength,e=0;e<n;){var a=Le(l,e),u=Lt(l.subarray(e+4,e+8)),f=a>1?e+a:n;if(u===c[0])if(c.length===1)s.push(l.subarray(e+8,f));else{var h=De(l.subarray(e+8,f),c.slice(1));h.length&&hr.apply(s,h)}e=f}return s}function Dt(l){var c=[],s=l[0],n=8,e=Le(l,n);n+=4;var a=0,u=0;s===0?(a=Le(l,n),u=Le(l,n+4),n+=8):(a=dt(l,n),u=dt(l,n+8),n+=16),n+=2;var f=l.length+u,h=Ne(l,n);n+=2;for(var g=0;g<h;g++){var m=n,E=Le(l,m);m+=4;var T=E&2147483647,A=(E&2147483648)>>>31;if(A===1)return tt.warn("SIDX has hierarchical references (not supported)"),null;var L=Le(l,m);m+=4,c.push({referenceSize:T,subsegmentDuration:L,info:{duration:L/e,start:f,end:f+T-1}}),f+=T,m+=4,n=m}return{earliestPresentationTime:a,timescale:e,version:s,referencesCount:h,references:c}}function rr(l){for(var c=[],s=De(l,["moov","trak"]),n=0;n<s.length;n++){var e=s[n],a=De(e,["tkhd"])[0];if(a){var u=a[0],f=Le(a,u===0?12:20),h=De(e,["mdia","mdhd"])[0];if(h){u=h[0];var g=Le(h,u===0?12:20),m=De(e,["mdia","hdlr"])[0];if(m){var E=Lt(m.subarray(8,12)),T={soun:ot.AUDIO,vide:ot.VIDEO}[E],A=De(e,["mdia","minf","stbl","stsd"])[0],L=Lr(A);T?(c[f]={timescale:g,type:T,stsd:L},c[T]=H({timescale:g,id:f},L)):c[f]={timescale:g,type:E,stsd:L}}}}}var k=De(l,["moov","mvex","trex"]);return k.forEach(function(I){var D=Le(I,4),U=c[D];U&&(U.default={duration:Le(I,12),flags:Le(I,20)})}),c}function Lr(l){var c=l.subarray(8),s=c.subarray(86),n=Lt(c.subarray(4,8)),e=n,a,u=n==="enca"||n==="encv";if(u){var f=De(c,[n])[0],h=f.subarray(n==="enca"?28:78),g=De(h,["sinf"]);g.forEach(function(tn){var on=De(tn,["schm"])[0];if(on){var Un=Lt(on.subarray(4,8));if(Un==="cbcs"||Un==="cenc"){var _r=De(tn,["frma"])[0];_r&&(e=Lt(_r))}}})}var m=e;switch(e){case"avc1":case"avc2":case"avc3":case"avc4":{var E=De(s,["avcC"])[0];E&&E.length>3&&(e+="."+cr(E[1])+cr(E[2])+cr(E[3]),a=zt(m==="avc1"?"dva1":"dvav",s));break}case"mp4a":{var T=De(c,[n])[0],A=De(T.subarray(28),["esds"])[0];if(A&&A.length>7){var L=4;if(A[L++]!==3)break;L=vr(A,L),L+=2;var k=A[L++];if(k&128&&(L+=2),k&64&&(L+=A[L++]),A[L++]!==4)break;L=vr(A,L);var I=A[L++];if(I===64)e+="."+cr(I);else break;if(L+=12,A[L++]!==5)break;L=vr(A,L);var D=A[L++],U=(D&248)>>3;U===31&&(U+=1+((D&7)<<3)+((A[L]&224)>>5)),e+="."+U}break}case"hvc1":case"hev1":{var K=De(s,["hvcC"])[0];if(K&&K.length>12){var G=K[1],j=["","A","B","C"][G>>6],ie=G&31,se=Le(K,2),he=(G&32)>>5?"H":"L",ve=K[12],ge=K.subarray(6,12);e+="."+j+ie,e+="."+pr(se).toString(16).toUpperCase(),e+="."+he+ve;for(var de="",ue=ge.length;ue--;){var Ae=ge[ue];if(Ae||de){var je=Ae.toString(16).toUpperCase();de="."+je+de}}e+=de}a=zt(m=="hev1"?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{e=zt(e,s)||e;break}case"vp09":{var Re=De(s,["vpcC"])[0];if(Re&&Re.length>6){var Ie=Re[4],$e=Re[5],Ze=Re[6]>>4&15;e+="."+gr(Ie)+"."+gr($e)+"."+gr(Ze)}break}case"av01":{var Qe=De(s,["av1C"])[0];if(Qe&&Qe.length>2){var it=Qe[1]>>>5,xt=Qe[1]&31,at=Qe[2]>>>7?"H":"M",ct=(Qe[2]&64)>>6,lt=(Qe[2]&32)>>5,Nt=it===2&&ct?lt?12:10:ct?10:8,ir=(Qe[2]&16)>>4,yr=(Qe[2]&8)>>3,Pr=(Qe[2]&4)>>2,Kr=Qe[2]&3,Er=1,en=1,Dr=1,or=0;e+="."+it+"."+gr(xt)+at+"."+gr(Nt)+"."+ir+"."+yr+Pr+Kr+"."+gr(Er)+"."+gr(en)+"."+gr(Dr)+"."+or,a=zt("dav1",s)}break}}return{codec:e,encrypted:u,supplemental:a}}function zt(l,c){var s=De(c,["dvvC"]),n=s.length?s[0]:De(c,["dvcC"])[0];if(n){var e=n[2]>>1&127,a=n[2]<<5&32|n[3]>>3&31;return l+"."+gr(e)+"."+gr(a)}}function pr(l){for(var c=0,s=0;s<32;s++)c|=(l>>s&1)<<31-s;return c>>>0}function vr(l,c){for(var s=c+5;l[c++]&128&&c<s;);return c}function cr(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function gr(l){return(l<10?"0":"")+l}function Wn(l,c){if(!(!l||!c)){var s=c.keyId;if(s&&c.isCommonEncryption){var n=De(l,["moov","trak"]);n.forEach(function(e){var a=De(e,["mdia","minf","stbl","stsd"])[0],u=a.subarray(8),f=De(u,["enca"]),h=f.length>0;h||(f=De(u,["encv"])),f.forEach(function(g){var m=h?g.subarray(28):g.subarray(78),E=De(m,["sinf"]);E.forEach(function(T){var A=Fn(T);if(A){var L=A.subarray(8,24);L.some(function(k){return k!==0})||(tt.log("[eme] Patching keyId in 'enc"+(h?"a":"v")+">sinf>>tenc' box: "+pt.hexDump(L)+" -> "+pt.hexDump(s)),A.set(s,8))}})})})}}}function Fn(l){var c=De(l,["schm"])[0];if(c){var s=Lt(c.subarray(4,8));if(s==="cbcs"||s==="cenc")return De(l,["schi","tenc"])[0]}return null}function jt(l,c,s){for(var n={},e=De(l,["moof","traf"]),a=0;a<e.length;a++){var u=e[a],f=De(u,["tfhd"])[0],h=Le(f,4),g=c[h];if(g){n[h]||(n[h]={start:NaN,duration:0,sampleCount:0,timescale:g.timescale,type:g.type});var m=n[h],E=De(u,["tfdt"])[0];if(E){var T=E[0],A=Le(E,4);T===1&&(A===dr?s.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(A*=dr+1,A+=Le(E,8))),xe(A)&&(!xe(m.start)||A<m.start)&&(m.start=A)}var L=g.default,k=Le(f,0)|L?.flags,I=L?.duration||0;k&8&&(k&2?I=Le(f,12):I=Le(f,8));for(var D=De(u,["trun"]),U=m.start||0,K=0,G=I,j=0;j<D.length;j++){var ie=D[j],se=Le(ie,4),he=m.sampleCount;m.sampleCount+=se;var ve=ie[3]&1,ge=ie[3]&4,de=ie[2]&1,ue=ie[2]&2,Ae=ie[2]&4,je=ie[2]&8,Re=8,Ie=se;if(ve&&(Re+=4),ge&&se){var $e=ie[Re+1]&1;!$e&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=he),Re+=4,de?(G=Le(ie,Re),Re+=4):G=I,ue&&(Re+=4),je&&(Re+=4),U+=G,K+=G,Ie--}for(;Ie--;){if(de?(G=Le(ie,Re),Re+=4):G=I,ue&&(Re+=4),Ae){var Ze=ie[Re+1]&1;Ze||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(Ie+1),m.keyFrameStart=U),Re+=4}je&&(Re+=4),U+=G,K+=G}!K&&I&&(K+=I*se)}m.duration+=K}}if(!Object.keys(n).some(function(Nt){return n[Nt].duration})){for(var Qe=1/0,it=0,xt=De(l,["sidx"]),at=0;at<xt.length;at++){var ct=Dt(xt[at]);if(ct!=null&&ct.references){Qe=Math.min(Qe,ct.earliestPresentationTime/ct.timescale);var lt=ct.references.reduce(function(Nt,ir){return Nt+ir.info.duration||0},0);it=Math.max(it,lt+ct.earliestPresentationTime/ct.timescale)}}it&&xe(it)&&Object.keys(n).forEach(function(Nt){n[Nt].duration||(n[Nt].duration=it*n[Nt].timescale-n[Nt].start)})}return n}function nr(l){var c={valid:null,remainder:null},s=De(l,["moof"]);if(s.length<2)return c.remainder=l,c;var n=s[s.length-1];return c.valid=l.slice(0,n.byteOffset-8),c.remainder=l.slice(n.byteOffset-8),c}function Xr(l,c){var s=new Uint8Array(l.length+c.length);return s.set(l),s.set(c,l.length),s}function Li(l,c){var s=[],n=c.samples,e=c.timescale,a=c.id,u=!1,f=De(n,["moof"]);return f.map(function(h){var g=h.byteOffset-8,m=De(h,["traf"]);m.map(function(E){var T=De(E,["tfdt"]).map(function(A){var L=A[0],k=Le(A,4);return L===1&&(k*=Math.pow(2,32),k+=Le(A,8)),k/e})[0];return T!==void 0&&(l=T),De(E,["tfhd"]).map(function(A){var L=Le(A,4),k=Le(A,0)&16777215,I=(k&1)!==0,D=(k&2)!==0,U=(k&8)!==0,K=0,G=(k&16)!==0,j=0,ie=(k&32)!==0,se=8;L===a&&(I&&(se+=8),D&&(se+=4),U&&(K=Le(A,se),se+=4),G&&(j=Le(A,se),se+=4),ie&&(se+=4),c.type==="video"&&(u=oi(c.codec)),De(E,["trun"]).map(function(he){var ve=he[0],ge=Le(he,0)&16777215,de=(ge&1)!==0,ue=0,Ae=(ge&4)!==0,je=(ge&256)!==0,Re=0,Ie=(ge&512)!==0,$e=0,Ze=(ge&1024)!==0,Qe=(ge&2048)!==0,it=0,xt=Le(he,4),at=8;de&&(ue=Le(he,at),at+=4),Ae&&(at+=4);for(var ct=ue+g,lt=0;lt<xt;lt++){if(je?(Re=Le(he,at),at+=4):Re=K,Ie?($e=Le(he,at),at+=4):$e=j,Ze&&(at+=4),Qe&&(ve===0?it=Le(he,at):it=wt(he,at),at+=4),c.type===ot.VIDEO)for(var Nt=0;Nt<$e;){var ir=Le(n,ct);if(ct+=4,Cn(u,n[ct])){var yr=n.subarray(ct,ct+ir);li(yr,u?2:1,l+it/e,s)}ct+=ir,Nt+=ir+4}l+=Re/e}}))})})}),s}function oi(l){if(!l)return!1;var c=l.substring(0,4);return c==="hvc1"||c==="hev1"||c==="dvh1"||c==="dvhe"}function Cn(l,c){if(l){var s=c>>1&63;return s===39||s===40}else{var n=c&31;return n===6}}function li(l,c,s,n){var e=vn(l),a=0;a+=c;for(var u=0,f=0,h=0;a<e.length;){u=0;do{if(a>=e.length)break;h=e[a++],u+=h}while(h===255);f=0;do{if(a>=e.length)break;h=e[a++],f+=h}while(h===255);var g=e.length-a,m=a;if(f<g)a+=f;else if(f>g){tt.error("Malformed SEI payload. "+f+" is too small, only "+g+" bytes left to parse.");break}if(u===4){var E=e[m++];if(E===181){var T=Ne(e,m);if(m+=2,T===49){var A=Le(e,m);if(m+=4,A===1195456820){var L=e[m++];if(L===3){var k=e[m++],I=31&k,D=64&k,U=D?2+I*3:0,K=new Uint8Array(U);if(D){K[0]=k;for(var G=1;G<U;G++)K[G]=e[m++]}n.push({type:L,payloadType:u,pts:s,bytes:K})}}}}}else if(u===5&&f>16){for(var j=[],ie=0;ie<16;ie++){var se=e[m++].toString(16);j.push(se.length==1?"0"+se:se),(ie===3||ie===5||ie===7||ie===9)&&j.push("-")}for(var he=f-16,ve=new Uint8Array(he),ge=0;ge<he;ge++)ve[ge]=e[m++];n.push({payloadType:u,pts:s,uuid:j.join(""),userData:tr(ve),userDataBytes:ve})}}}function vn(l){for(var c=l.byteLength,s=[],n=1;n<c-2;)l[n]===0&&l[n+1]===0&&l[n+2]===3?(s.push(n+2),n+=2):n++;if(s.length===0)return l;var e=c-s.length,a=new Uint8Array(e),u=0;for(n=0;n<e;u++,n++)u===s[0]&&(u++,s.shift()),a[n]=l[u];return a}function ui(l){var c=l[0],s="",n="",e=0,a=0,u=0,f=0,h=0,g=0;if(c===0){for(;Lt(l.subarray(g,g+1))!=="\0";)s+=Lt(l.subarray(g,g+1)),g+=1;for(s+=Lt(l.subarray(g,g+1)),g+=1;Lt(l.subarray(g,g+1))!=="\0";)n+=Lt(l.subarray(g,g+1)),g+=1;n+=Lt(l.subarray(g,g+1)),g+=1,e=Le(l,12),a=Le(l,16),f=Le(l,20),h=Le(l,24),g=28}else if(c===1){g+=4,e=Le(l,g),g+=4;var m=Le(l,g);g+=4;var E=Le(l,g);for(g+=4,u=Math.pow(2,32)*m+E,er(u)||(u=Number.MAX_SAFE_INTEGER,tt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),f=Le(l,g),g+=4,h=Le(l,g),g+=4;Lt(l.subarray(g,g+1))!=="\0";)s+=Lt(l.subarray(g,g+1)),g+=1;for(s+=Lt(l.subarray(g,g+1)),g+=1;Lt(l.subarray(g,g+1))!=="\0";)n+=Lt(l.subarray(g,g+1)),g+=1;n+=Lt(l.subarray(g,g+1)),g+=1}var T=l.subarray(g,l.byteLength);return{schemeIdUri:s,value:n,timeScale:e,presentationTime:u,presentationTimeDelta:a,eventDuration:f,id:h,payload:T}}var Ln=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},Br={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Yn(l,c){var s=Br[c];return!!s&&!!s[l.slice(0,4)]}function an(l,c,s){return s===void 0&&(s=!0),!l.split(",").some(function(n){return!qi(n,c,s)})}function qi(l,c,s){var n;s===void 0&&(s=!0);var e=En(s);return(n=e?.isTypeSupported(Qr(l,c)))!=null?n:!1}function Qr(l,c){return c+"/mp4;codecs="+l}function Wi(l){if(l){var c=l.substring(0,4);return Br.video[c]}return 2}function ci(l){var c=Ln();return l.split(",").reduce(function(s,n){var e=c&&oi(n),a=e?9:Br.video[n];return a?(a*2+s)/(s?3:2):(Br.audio[n]+s)/(s?2:1)},0)}var ar={};function Ri(l,c){if(c===void 0&&(c=!0),ar[l])return ar[l];for(var s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l],n=0;n<s.length;n++){var e;if(qi(s[n],"audio",c))return ar[l]=s[n],s[n];if(s[n]==="mp3"&&(e=En(c))!=null&&e.isTypeSupported("audio/mpeg"))return""}return l}var zn=/flac|opus|mp4a\.40\.34/i;function ma(l,c){return c===void 0&&(c=!0),l.replace(zn,function(s){return Ri(s.toLowerCase(),c)})}function Yi(l,c){var s=[];if(l)for(var n=l.split(","),e=0;e<n.length;e++)Yn(n[e],"video")||s.push(n[e]);return c&&s.push(c),s.join(",")}function ki(l,c){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(Ya(l,"audio")||Ya(l,"video")))return l;if(c){var s=c.split(",");if(s.length>1){if(l){for(var n=s.length;n--;)if(s[n].substring(0,4)===l.substring(0,4))return s[n]}return s[0]}}return c||l}function Ya(l,c){return Yn(l,c)&&qi(l,c)}function Bs(l){for(var c=l.split(","),s=0;s<c.length;s++){var n=c[s].split(".");n.length>2&&n[0]==="avc1"&&(c[s]="avc1."+parseInt(n[1]).toString(16)+("000"+parseInt(n[2]).toString(16)).slice(-4))}return c.join(",")}function wi(l){if(l.startsWith("av01.")){for(var c=l.split("."),s=["0","111","01","01","01","0"],n=c.length;n>4&&n<10;n++)c[n]=s[n-4];return c.join(".")}return l}function Us(l){var c=En(l)||{isTypeSupported:function(){return!1}};return{mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:!1}}function zi(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var za=["NONE","TYPE-0","TYPE-1",null];function It(l){return za.indexOf(l)>-1}var ya=["SDR","PQ","HLG"];function qo(l){return!!l&&ya.indexOf(l)>-1}var ba={No:"",Yes:"YES",v2:"v2"};function $t(l){var c=l.canSkipUntil,s=l.canSkipDateRanges,n=l.age,e=n<c/2;return c&&e?s?ba.v2:ba.Yes:ba.No}var $i=function(){function l(s,n,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=s,this.part=n,this.skip=e}var c=l.prototype;return c.addDirectives=function(n){var e=new self.URL(n);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},l}(),Xi=function(){function l(s){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[s.url],this._attrs=[s.attrs],this.bitrate=s.bitrate,s.details&&(this.details=s.details),this.id=s.id||0,this.name=s.name,this.width=s.width||0,this.height=s.height||0,this.frameRate=s.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=s.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=s.audioCodec,this.videoCodec=s.videoCodec,this.codecSet=[s.videoCodec,s.audioCodec].filter(function(a){return!!a}).map(function(a){return a.substring(0,4)}).join(","),"supplemental"in s){var n;this.supplemental=s.supplemental;var e=(n=s.supplemental)==null?void 0:n.videoCodec;e&&e!==s.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",s.attrs.AUDIO),this.addGroupId("text",s.attrs.SUBTITLES)}var c=l.prototype;return c.hasAudioGroup=function(n){return Ii(this._audioGroups,n)},c.hasSubtitleGroup=function(n){return Ii(this._subtitleGroups,n)},c.addGroupId=function(n,e){if(e){if(n==="audio"){var a=this._audioGroups;a||(a=this._audioGroups=[]),a.indexOf(e)===-1&&a.push(e)}else if(n==="text"){var u=this._subtitleGroups;u||(u=this._subtitleGroups=[]),u.indexOf(e)===-1&&u.push(e)}}},c.addFallback=function(){},b(l,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(n){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var n;return(n=this.audioGroups)==null?void 0:n[0]}},{key:"textGroupId",get:function(){var n;return(n=this.subtitleGroups)==null?void 0:n[0]}}])}();function Ii(l,c){return!c||!l?!1:l.indexOf(c)!==-1}function Gs(){if(typeof matchMedia=="function"){var l=matchMedia("(dynamic-range: high)"),c=matchMedia("bad query");if(l.media!==c.media)return l.matches===!0}return!1}function js(l,c){var s=!1,n=[];if(l&&(s=l!=="SDR",n=[l]),c){n=c.allowedVideoRanges||ya.slice(0);var e=n.join("")!=="SDR"&&!c.videoCodec;s=c.preferHDR!==void 0?c.preferHDR:e&&Gs(),s||(n=["SDR"])}return{preferHDR:s,allowedVideoRanges:n}}var $a=function(c){var s=new WeakSet;return function(n,e){if(c&&(e=c(n,e)),typeof e=="object"&&e!==null){if(s.has(e))return;s.add(e)}return e}},Ur=function(c,s){return JSON.stringify(c,$a(s))};function Xa(l,c,s,n,e){for(var a=Object.keys(l),u=n?.channels,f=n?.audioCodec,h=e?.videoCodec,g=u&&parseInt(u)===2,m=!1,E=!1,T=1/0,A=1/0,L=1/0,k=1/0,I=0,D=[],U=js(c,e),K=U.preferHDR,G=U.allowedVideoRanges,j=function(){var ue=l[a[ie]];m||(m=ue.channels[2]>0),T=Math.min(T,ue.minHeight),A=Math.min(A,ue.minFramerate),L=Math.min(L,ue.minBitrate);var Ae=G.filter(function(je){return ue.videoRanges[je]>0});Ae.length>0&&(E=!0)},ie=a.length;ie--;)j();T=xe(T)?T:0,A=xe(A)?A:0;var se=Math.max(1080,T),he=Math.max(30,A);L=xe(L)?L:s,s=Math.max(L,s),E||(c=void 0);var ve=a.length>1,ge=a.reduce(function(de,ue){var Ae=l[ue];if(ue===de)return de;if(D=E?G.filter(function(je){return Ae.videoRanges[je]>0}):[],ve){if(Ae.minBitrate>s)return Rn(ue,"min bitrate of "+Ae.minBitrate+" > current estimate of "+s),de;if(!Ae.hasDefaultAudio)return Rn(ue,"no renditions with default or auto-select sound found"),de;if(f&&ue.indexOf(f.substring(0,4))%5!==0)return Rn(ue,'audio codec preference "'+f+'" not found'),de;if(u&&!g){if(!Ae.channels[u])return Rn(ue,"no renditions with "+u+" channel sound found (channels options: "+Object.keys(Ae.channels)+")"),de}else if((!f||g)&&m&&Ae.channels[2]===0)return Rn(ue,"no renditions with stereo sound found"),de;if(Ae.minHeight>se)return Rn(ue,"min resolution of "+Ae.minHeight+" > maximum of "+se),de;if(Ae.minFramerate>he)return Rn(ue,"min framerate of "+Ae.minFramerate+" > maximum of "+he),de;if(!D.some(function(je){return Ae.videoRanges[je]>0}))return Rn(ue,"no variants with VIDEO-RANGE of "+Ur(D)+" found"),de;if(h&&ue.indexOf(h.substring(0,4))%5!==0)return Rn(ue,'video codec preference "'+h+'" not found'),de;if(Ae.maxScore<I)return Rn(ue,"max score of "+Ae.maxScore+" < selected max of "+I),de}return de&&(ci(ue)>=ci(de)||Ae.fragmentError>l[de].fragmentError)?de:(k=Ae.minIndex,I=Ae.maxScore,ue)},void 0);return{codecSet:ge,videoRanges:D,preferHDR:K,minFramerate:A,minBitrate:L,minIndex:k}}function Rn(l,c){tt.log('[abr] start candidates with "'+l+'" ignored because '+c)}function Qi(l){return l.reduce(function(c,s){var n=c.groups[s.groupId];n||(n=c.groups[s.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(s);var e=s.channels||"2";return n.channels[e]=(n.channels[e]||0)+1,n.hasDefault=n.hasDefault||s.default,n.hasAutoSelect=n.hasAutoSelect||s.autoselect,n.hasDefault&&(c.hasDefaultAudio=!0),n.hasAutoSelect&&(c.hasAutoSelectAudio=!0),c},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Wo(l,c,s,n){return l.slice(s,n+1).reduce(function(e,a,u){if(!a.codecSet)return e;var f=a.audioGroups,h=e[a.codecSet];h||(e[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:u,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!f,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);var g=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,g),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,u),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,e},{})}function Yo(l,c){var s;return!!l&&l!==((s=c.loadLevelObj)==null?void 0:s.uri)}var Ft=function(l){function c(n){var e;return e=l.call(this,"abr",n.logger)||this,e.hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.supportedCache={},e.bwEstimator=void 0,e._abandonRulesCheck=function(a){var u,f=e,h=f.fragCurrent,g=f.partCurrent,m=f.hls,E=m.autoLevelEnabled,T=m.media;if(!(!h||!T)){var A=performance.now(),L=g?g.stats:h.stats,k=g?g.duration:h.duration,I=A-L.loading.start,D=m.minAutoLevel,U=h.level,K=e._nextAutoLevel;if(L.aborted||L.loaded&&L.loaded===L.total||U<=D){e.clearTimer(),e._nextAutoLevel=-1;return}if(E){var G=K>-1&&K!==U,j=!!a||G;if(!(!j&&(T.paused||!T.playbackRate||!T.readyState))){var ie=m.mainForwardBufferInfo;if(!(!j&&ie===null)){var se=e.bwEstimator.getEstimateTTFB(),he=Math.abs(T.playbackRate);if(!(I<=Math.max(se,1e3*(k/(he*2))))){var ve=ie?ie.len/he:0,ge=L.loading.first?L.loading.first-L.loading.start:-1,de=L.loaded&&ge>-1,ue=e.getBwEstimate(),Ae=m.levels,je=Ae[U],Re=Math.max(L.loaded,Math.round(k*(h.bitrate||je.averageBitrate)/8)),Ie=de?I-ge:I;Ie<1&&de&&(Ie=Math.min(I,L.loaded*8/ue));var $e=de?L.loaded*1e3/Ie:0,Ze=se/1e3,Qe=$e?(Re-L.loaded)/$e:Re*8/ue+Ze;if(!(Qe<=ve)){var it=$e?$e*8:ue,xt=((u=a?.details||e.hls.latestLevelDetails)==null?void 0:u.live)===!0,at=e.hls.config.abrBandWidthUpFactor,ct=Number.POSITIVE_INFINITY,lt;for(lt=U-1;lt>D;lt--){var Nt=Ae[lt].maxBitrate,ir=!Ae[lt].details||xt;if(ct=e.getTimeToLoadFrag(Ze,it,k*Nt,ir),ct<Math.min(ve,k+Ze))break}if(!(ct>=Qe)&&!(ct>k*10)){de?e.bwEstimator.sample(I-Math.min(se,ge),L.loaded):e.bwEstimator.sampleTTFB(I);var yr=Ae[lt].maxBitrate;e.getBwEstimate()*at>yr&&e.resetEstimator(yr);var Pr=e.findBestLevel(yr,D,lt,0,ve,1,1);Pr>-1&&(lt=Pr),e.warn("Fragment "+h.sn+(g?" part "+g.index:"")+" of level "+U+` is loading too slowly;
      Fragment duration: `+h.duration.toFixed(3)+`
      Time to underbuffer: `+ve.toFixed(3)+` s
      Estimated load time for current fragment: `+Qe.toFixed(3)+` s
      Estimated load time for down switch fragment: `+ct.toFixed(3)+` s
      TTFB estimate: `+(ge|0)+` ms
      Current BW estimate: `+(xe(ue)?ue|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+lt+" @ "+(yr|0)+" bps"),m.nextLoadLevel=m.nextAutoLevel=lt,e.clearTimer();var Kr=function(){if(e.clearTimer(),e.fragCurrent===h&&e.hls.loadLevel===lt&&lt>0){var en=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(lt>0?"and switching down":"")+`
      Fragment duration: `+h.duration.toFixed(3)+` s
      Time to underbuffer: `+en.toFixed(3)+" s"),h.abortRequests(),e.fragCurrent=e.partCurrent=null,lt>D){var Dr=e.findBestLevel(e.hls.levels[D].bitrate,D,lt,0,en,1,1);Dr===-1&&(Dr=D),e.hls.nextLoadLevel=e.hls.nextAutoLevel=Dr,e.resetEstimator(e.hls.levels[Dr].bitrate)}}};G||Qe>ct*2?Kr():e.timer=self.setInterval(Kr,ct*1e3),m.trigger(N.FRAG_LOAD_EMERGENCY_ABORTED,{frag:h,part:g,stats:L})}}}}}}}},e.hls=n,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}P(c,l);var s=c.prototype;return s.resetEstimator=function(e){e&&(this.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},s.initEstimator=function(){var e=this.hls.config;return new $r(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},s.registerListeners=function(){var e=this.hls;e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.FRAG_LOADING,this.onFragLoading,this),e.on(N.FRAG_LOADED,this.onFragLoaded,this),e.on(N.FRAG_BUFFERED,this.onFragBuffered,this),e.on(N.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(N.LEVEL_LOADED,this.onLevelLoaded,this),e.on(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(N.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(N.ERROR,this.onError,this)},s.unregisterListeners=function(){var e=this.hls;e&&(e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.FRAG_LOADING,this.onFragLoading,this),e.off(N.FRAG_LOADED,this.onFragLoaded,this),e.off(N.FRAG_BUFFERED,this.onFragBuffered,this),e.off(N.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(N.LEVEL_LOADED,this.onLevelLoaded,this),e.off(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(N.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(N.ERROR,this.onError,this))},s.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null},s.onManifestLoading=function(e,a){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},s.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},s.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},s.onFragLoading=function(e,a){var u=a.frag;if(!this.ignoreFragment(u)){if(!u.bitrateTest){var f;this.fragCurrent=u,this.partCurrent=(f=a.part)!=null?f:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},s.onLevelSwitching=function(e,a){this.clearTimer()},s.onError=function(e,a){if(!a.fatal)switch(a.details){case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case be.FRAG_LOAD_TIMEOUT:{var u=a.frag,f=this.fragCurrent,h=this.partCurrent;if(u&&f&&u.sn===f.sn&&u.level===f.level){var g=performance.now(),m=h?h.stats:u.stats,E=g-m.loading.start,T=m.loading.first?m.loading.first-m.loading.start:-1,A=m.loaded&&T>-1;if(A){var L=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(E-Math.min(L,T),m.loaded)}else this.bwEstimator.sampleTTFB(E)}break}}},s.getTimeToLoadFrag=function(e,a,u,f){var h=e+u/a,g=f?e+this.lastLevelLoadSec:0;return h+g},s.onLevelLoaded=function(e,a){var u=this.hls.config,f=a.stats.loading,h=f.end-f.first;xe(h)&&(this.lastLevelLoadSec=h/1e3),a.details.live?this.bwEstimator.update(u.abrEwmaSlowLive,u.abrEwmaFastLive):this.bwEstimator.update(u.abrEwmaSlowVoD,u.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(a.levelInfo)},s.onFragLoaded=function(e,a){var u=a.frag,f=a.part,h=f?f.stats:u.stats;if(u.type===st.MAIN&&this.bwEstimator.sampleTTFB(h.loading.first-h.loading.start),!this.ignoreFragment(u)){if(this.clearTimer(),u.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var g=f?f.duration:u.duration,m=this.hls.levels[u.level],E=(m.loaded?m.loaded.bytes:0)+h.loaded,T=(m.loaded?m.loaded.duration:0)+g;m.loaded={bytes:E,duration:T},m.realBitrate=Math.round(8*E/T)}if(u.bitrateTest){var A={stats:h,frag:u,part:f,id:u.type};this.onFragBuffered(N.FRAG_BUFFERED,A),u.bitrateTest=!1}else this.lastLoadedFragLevel=u.level}},s.onFragBuffered=function(e,a){var u=a.frag,f=a.part,h=f!=null&&f.stats.loaded?f.stats:u.stats;if(!h.aborted&&!this.ignoreFragment(u)){var g=h.parsing.end-h.loading.start-Math.min(h.loading.first-h.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(g,h.loaded),h.bwEstimate=this.getBwEstimate(),u.bitrateTest?this.bitrateTestDelay=g/1e3:this.bitrateTestDelay=0}},s.ignoreFragment=function(e){return e.type!==st.MAIN||e.sn==="initSegment"},s.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},s.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},s.getNextABRAutoLevel=function(){var e=this.fragCurrent,a=this.partCurrent,u=this.hls;if(u.levels.length<=1)return u.loadLevel;var f=u.maxAutoLevel,h=u.config,g=u.minAutoLevel,m=a?a.duration:e?e.duration:0,E=this.getBwEstimate(),T=this.getStarvationDelay(),A=h.abrBandWidthFactor,L=h.abrBandWidthUpFactor;if(T){var k=this.findBestLevel(E,g,f,T,0,A,L);if(k>=0)return this.rebufferNotice=-1,k}var I=m?Math.min(m,h.maxStarvationDelay):h.maxStarvationDelay;if(!T){var D=this.bitrateTestDelay;if(D){var U=m?Math.min(m,h.maxLoadingDelay):h.maxLoadingDelay;I=U-D,this.info("bitrate test took "+Math.round(1e3*D)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*I)+" ms"),A=L=1}}var K=this.findBestLevel(E,g,f,T,I,A,L);if(this.rebufferNotice!==K&&(this.rebufferNotice=K,this.info((T?"rebuffering expected":"buffer is empty")+", optimal quality level "+K)),K>-1)return K;var G=u.levels[g],j=u.loadLevelObj;return j&&G?.bitrate<j.bitrate?g:u.loadLevel},s.getStarvationDelay=function(){var e=this.hls,a=e.media;if(!a)return 1/0;var u=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,f=e.mainForwardBufferInfo;return(f?f.len:0)/u},s.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},s.findBestLevel=function(e,a,u,f,h,g,m){var E,T=this,A=f+h,L=this.lastLoadedFragLevel,k=L===-1?this.hls.firstLevel:L,I=this.fragCurrent,D=this.partCurrent,U=this.hls,K=U.levels,G=U.allAudioTracks,j=U.loadLevel,ie=U.config;if(K.length===1)return 0;var se=K[k],he=!!((E=this.hls.latestLevelDetails)!=null&&E.live),ve=j===-1||L===-1,ge,de="SDR",ue=se?.frameRate||0,Ae=ie.audioPreference,je=ie.videoPreference,Re=this.audioTracksByGroup||(this.audioTracksByGroup=Qi(G)),Ie=-1;if(ve){if(this.firstSelection!==-1)return this.firstSelection;var $e=this.codecTiers||(this.codecTiers=Wo(K,Re,a,u)),Ze=Xa($e,de,e,Ae,je),Qe=Ze.codecSet,it=Ze.videoRanges,xt=Ze.minFramerate,at=Ze.minBitrate,ct=Ze.minIndex,lt=Ze.preferHDR;Ie=ct,ge=Qe,de=lt?it[it.length-1]:it[0],ue=xt,e=Math.max(e,at),this.log("picked start tier "+Ur(Ze))}else ge=se?.codecSet,de=se?.videoRange;for(var Nt=D?D.duration:I?I.duration:0,ir=this.bwEstimator.getEstimateTTFB()/1e3,yr=[],Pr=function(){var Dr,or=K[Er],tn=Er>k;if(!or)return 0;if((ge&&or.codecSet!==ge||de&&or.videoRange!==de||tn&&ue>or.frameRate||!tn&&ue>0&&ue<or.frameRate||(Dr=or.supportedResult)!=null&&(Dr=Dr.decodingInfoResults)!=null&&Dr.some(function(ei){return ei.smooth===!1}))&&(!ve||Er!==Ie))return yr.push(Er),0;var on=or.details,Un=(D?on?.partTarget:on?.averagetargetduration)||Nt,_r;tn?_r=m*e:_r=g*e;var Zn=Nt&&f>=Nt*2&&h===0?or.averageBitrate:or.maxBitrate,In=T.getTimeToLoadFrag(ir,_r,Zn*Un,on===void 0),Oi=_r>=Zn&&(Er===L||or.loadError===0&&or.fragmentError===0)&&(In<=ir||!xe(In)||he&&!T.bitrateTestDelay||In<A);if(Oi){var ln=T.forcedAutoLevel;return Er!==j&&(ln===-1||ln!==j)&&(yr.length&&T.trace("Skipped level(s) "+yr.join(",")+" of "+u+' max with CODECS and VIDEO-RANGE:"'+K[yr[0]].codecs+'" '+K[yr[0]].videoRange+'; not compatible with "'+ge+'" '+de),T.info("switch candidate:"+k+"->"+Er+" adjustedbw("+Math.round(_r)+")-bitrate="+Math.round(_r-Zn)+" ttfb:"+ir.toFixed(1)+" avgDuration:"+Un.toFixed(1)+" maxFetchDuration:"+A.toFixed(1)+" fetchDuration:"+In.toFixed(1)+" firstSelection:"+ve+" codecSet:"+or.codecSet+" videoRange:"+or.videoRange+" hls.loadLevel:"+j)),ve&&(T.firstSelection=Er),{v:Er}}},Kr,Er=u;Er>=a;Er--)if(Kr=Pr(),Kr!==0&&Kr)return Kr.v;return-1},s.deriveNextAutoLevel=function(e){var a=this.hls,u=a.maxAutoLevel,f=a.minAutoLevel;return Math.min(Math.max(e,f),u)},b(c,[{key:"firstAutoLevel",get:function(){var e=this.hls,a=e.maxAutoLevel,u=e.minAutoLevel,f=this.getBwEstimate(),h=this.hls.config.maxStarvationDelay,g=this.findBestLevel(f,u,a,0,h,1,1);if(g>-1)return g;var m=this.hls.firstLevel,E=Math.min(Math.max(m,u),a);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+m+" clamped to "+E),E}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,a=this.bwEstimator,u=a.canEstimate(),f=this.lastLoadedFragLevel>-1;if(e!==-1&&(!u||!f||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var h=u&&f?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var g=this.hls.levels;if(g.length>Math.max(e,h)&&g[e].loadError<=g[h].loadError)return e}return this._nextAutoLevel=h,this.nextAutoLevelKey=this.getAutoLevelKey(),h},set:function(e){var a=this.deriveNextAutoLevel(e);this._nextAutoLevel!==a&&(this.nextAutoLevelKey="",this._nextAutoLevel=a)}}])}(rt),Vs=function(){function l(s){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=s}var c=l.prototype;return c.destroy=function(){this.tracks=this.queues=null},c.append=function(n,e,a){if(!(this.queues===null||this.tracks===null)){var u=this.queues[e];u.push(n),u.length===1&&!a&&this.executeNext(e)}},c.appendBlocker=function(n){var e=this;return new Promise(function(a){var u={label:"async-blocker",execute:a,onStart:function(){},onComplete:function(){},onError:function(){}};e.append(u,n)})},c.prependBlocker=function(n){var e=this;return new Promise(function(a){if(e.queues){var u={label:"async-blocker-prepend",execute:a,onStart:function(){},onComplete:function(){},onError:function(){}};e.queues[n].unshift(u)}})},c.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(n){var e,a=(e=n[0])==null?void 0:e.label;(a==="async-blocker"||a==="async-blocker-prepend")&&(n[0].execute(),n.splice(0,1))})},c.unblockAudio=function(n){if(this.queues!==null){var e=this.queues.audio;e[0]===n&&this.shiftAndExecuteNext("audio")}},c.executeNext=function(n){if(!(this.queues===null||this.tracks===null)){var e=this.queues[n];if(e.length){var a=e[0];try{a.execute()}catch(h){var u;if(a.onError(h),this.queues===null||this.tracks===null)return;var f=(u=this.tracks[n])==null?void 0:u.buffer;f!=null&&f.updating||this.shiftAndExecuteNext(n)}}}},c.shiftAndExecuteNext=function(n){this.queues!==null&&(this.queues[n].shift(),this.executeNext(n))},c.current=function(n){var e;return((e=this.queues)==null?void 0:e[n][0])||null},c.toString=function(){var n=this.queues,e=this.tracks;return n===null||e===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},c.list=function(n){var e,a;return(e=this.queues)!=null&&e[n]||(a=this.tracks)!=null&&a[n]?n+": ("+this.listSbInfo(n)+") "+this.listOps(n):""},c.listSbInfo=function(n){var e,a=(e=this.tracks)==null?void 0:e[n],u=a?.buffer;return u?"SourceBuffer"+(u.updating?" updating":"")+(a.ended?" ended":"")+(a.ending?" ending":""):"none"},c.listOps=function(n){var e;return((e=this.queues)==null?void 0:e[n].map(function(a){return a.label}).join(", "))||""},l}(),zo={search:function(c,s){for(var n=0,e=c.length-1,a=null,u=null;n<=e;){a=(n+e)/2|0,u=c[a];var f=s(u);if(f>0)n=a+1;else if(f<0)e=a-1;else return u}return null}};function uu(l,c,s){if(c===null||!Array.isArray(l)||!l.length||!xe(c))return null;var n=l[0].programDateTime;if(c<(n||0))return null;var e=l[l.length-1].endProgramDateTime;if(c>=(e||0))return null;for(var a=0;a<l.length;++a){var u=l[a];if(fi(c,s,u))return u}return null}function Jr(l,c,s,n,e){s===void 0&&(s=0),n===void 0&&(n=0),e===void 0&&(e=.005);var a=null;if(l){a=c[1+l.sn-c[0].sn]||null;var u=l.endDTS-s;u>0&&u<15e-7&&(s+=15e-7),a&&l.level!==a.level&&a.end<=l.end&&(a=c[2+l.sn-c[0].sn]||null)}else s===0&&c[0].start===0&&(a=c[0]);if(a&&((!l||l.level===a.level)&&Ea(s,n,a)===0||Ji(a,l,Math.min(e,n))))return a;var f=zo.search(c,Ea.bind(null,s,n));return f&&(f!==l||!a)?f:a}function Ji(l,c,s){if(c&&c.start===0&&c.level<l.level&&(c.endPTS||0)>0){var n=c.tagList.reduce(function(e,a){return a[0]==="INF"&&(e+=parseFloat(a[1])),e},s);return l.start<=n}return!1}function Ea(l,c,s){if(l===void 0&&(l=0),c===void 0&&(c=0),s.start<=l&&s.start+s.duration>l)return 0;var n=Math.min(c,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-n<=l?1:s.start-n>l&&s.start?-1:0}function fi(l,c,s){var n=Math.min(c,s.duration+(s.deltaPTS?s.deltaPTS:0))*1e3,e=s.endProgramDateTime||0;return e-n>l}function $o(l,c,s){if(l&&l.startCC<=c&&l.endCC>=c){var n=l.fragments,e=l.fragmentHint;e&&(n=n.concat(e));var a;return zo.search(n,function(u){return u.cc<c?1:u.cc>c?-1:(a=u,u.end<=s?1:u.start>s?-1:0)}),a||null}return null}function _a(l){switch(l.details){case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_TIMEOUT:case be.LEVEL_LOAD_TIMEOUT:case be.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Sr(l,c){var s=_a(c);return l.default[(s?"timeout":"error")+"Retry"]}function _n(l,c){var s=l.backoff==="linear"?1:Math.pow(2,c);return Math.min(s*l.retryDelayMs,l.maxRetryDelayMs)}function Zi(l){return H(H({},l),{errorRetry:null,timeoutRetry:null})}function di(l,c,s,n){if(!l)return!1;var e=n?.code,a=c<l.maxNumRetry&&(Ks(e)||!!s);return l.shouldRetry?l.shouldRetry(l,c,s,n,a):a}function Ks(l){return l===0&&navigator.onLine===!1||!!l&&(l<400||l>499)}var sr={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},kn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},Bn=function(l){function c(n){var e;return e=l.call(this,"error-controller",n.logger)||this,e.hls=void 0,e.playlistError=0,e.penalizedRenditions={},e.hls=n,e.registerListeners(),e}P(c,l);var s=c.prototype;return s.registerListeners=function(){var e=this.hls;e.on(N.ERROR,this.onError,this),e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.LEVEL_UPDATED,this.onLevelUpdated,this)},s.unregisterListeners=function(){var e=this.hls;e&&(e.off(N.ERROR,this.onError,this),e.off(N.ERROR,this.onErrorOut,this),e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.LEVEL_UPDATED,this.onLevelUpdated,this))},s.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},s.startLoad=function(e){},s.stopLoad=function(){this.playlistError=0},s.getVariantLevelIndex=function(e){return e?.type===st.MAIN?e.level:this.hls.loadLevel},s.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},s.onLevelUpdated=function(){this.playlistError=0},s.onError=function(e,a){var u;if(!a.fatal){var f=this.hls,h=a.context;switch(a.details){case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:a.errorAction=this.getFragRetryOrSwitchAction(a);return;case be.FRAG_PARSING_ERROR:if((u=a.frag)!=null&&u.gap){a.errorAction=ea();return}case be.FRAG_GAP:case be.FRAG_DECRYPT_ERROR:{a.errorAction=this.getFragRetryOrSwitchAction(a),a.errorAction.action=sr.SendAlternateToPenaltyBox;return}case be.LEVEL_EMPTY_ERROR:case be.LEVEL_PARSING_ERROR:{var g,m=a.parent===st.MAIN?a.level:f.loadLevel;a.details===be.LEVEL_EMPTY_ERROR&&((g=a.context)!=null&&(g=g.levelDetails)!=null&&g.live)?a.errorAction=this.getPlaylistRetryOrSwitchAction(a,m):(a.levelRetry=!1,a.errorAction=this.getLevelSwitchAction(a,m))}return;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:typeof h?.level=="number"&&(a.errorAction=this.getPlaylistRetryOrSwitchAction(a,h.level));return;case be.AUDIO_TRACK_LOAD_ERROR:case be.AUDIO_TRACK_LOAD_TIMEOUT:case be.SUBTITLE_LOAD_ERROR:case be.SUBTITLE_TRACK_LOAD_TIMEOUT:if(h){var E=f.loadLevelObj;if(E&&(h.type===ut.AUDIO_TRACK&&E.hasAudioGroup(h.groupId)||h.type===ut.SUBTITLE_TRACK&&E.hasSubtitleGroup(h.groupId))){a.errorAction=this.getPlaylistRetryOrSwitchAction(a,f.loadLevel),a.errorAction.action=sr.SendAlternateToPenaltyBox,a.errorAction.flags=kn.MoveAllAlternatesMatchingHost;return}}return;case be.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var T=f.loadLevelObj,A=T?.attrs["HDCP-LEVEL"];A?a.errorAction={action:sr.SendAlternateToPenaltyBox,flags:kn.MoveAllAlternatesMatchingHDCP,hdcpLevel:A}:this.keySystemError(a)}return;case be.BUFFER_ADD_CODEC_ERROR:case be.REMUX_ALLOC_ERROR:case be.BUFFER_APPEND_ERROR:if(!a.errorAction){var L;a.errorAction=this.getLevelSwitchAction(a,(L=a.level)!=null?L:f.loadLevel)}return;case be.INTERNAL_EXCEPTION:case be.BUFFER_APPENDING_ERROR:case be.BUFFER_FULL_ERROR:case be.LEVEL_SWITCH_ERROR:case be.BUFFER_STALLED_ERROR:case be.BUFFER_SEEK_OVER_HOLE:case be.BUFFER_NUDGE_ON_STALL:a.errorAction=ea();return}a.type===ft.KEY_SYSTEM_ERROR&&this.keySystemError(a)}},s.keySystemError=function(e){var a=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,a)},s.getPlaylistRetryOrSwitchAction=function(e,a){var u=this.hls,f=Sr(u.config.playlistLoadPolicy,e),h=this.playlistError++,g=di(f,h,_a(e),e.response);if(g)return{action:sr.RetryRequest,flags:kn.None,retryConfig:f,retryCount:h};var m=this.getLevelSwitchAction(e,a);return f&&(m.retryConfig=f,m.retryCount=h),m},s.getFragRetryOrSwitchAction=function(e){var a=this.hls,u=this.getVariantLevelIndex(e.frag),f=a.levels[u],h=a.config,g=h.fragLoadPolicy,m=h.keyLoadPolicy,E=Sr(e.details.startsWith("key")?m:g,e),T=a.levels.reduce(function(k,I){return k+I.fragmentError},0);if(f){e.details!==be.FRAG_GAP&&f.fragmentError++;var A=di(E,T,_a(e),e.response);if(A)return{action:sr.RetryRequest,flags:kn.None,retryConfig:E,retryCount:T}}var L=this.getLevelSwitchAction(e,u);return E&&(L.retryConfig=E,L.retryCount=T),L},s.getLevelSwitchAction=function(e,a){var u=this.hls;a==null&&(a=u.loadLevel);var f=this.hls.levels[a];if(f){var h,g,m=e.details;f.loadError++,m===be.BUFFER_APPEND_ERROR&&f.fragmentError++;var E=-1,T=u.levels,A=u.loadLevel,L=u.minAutoLevel,k=u.maxAutoLevel;!u.autoLevelEnabled&&!u.config.preserveManualLevelOnError&&(u.loadLevel=-1);for(var I=(h=e.frag)==null?void 0:h.type,D=I===st.AUDIO&&m===be.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(m===be.BUFFER_ADD_CODEC_ERROR||m===be.BUFFER_APPEND_ERROR),U=D&&T.some(function(de){var ue=de.audioCodec;return f.audioCodec!==ue}),K=e.sourceBufferName==="video"&&(m===be.BUFFER_ADD_CODEC_ERROR||m===be.BUFFER_APPEND_ERROR),G=K&&T.some(function(de){var ue=de.codecSet,Ae=de.audioCodec;return f.codecSet!==ue&&f.audioCodec===Ae}),j=(g=e.context)!=null?g:{},ie=j.type,se=j.groupId,he=function(){var ue=(ge+A)%T.length;if(ue!==A&&ue>=L&&ue<=k&&T[ue].loadError===0){var Ae,je,Re=T[ue];if(m===be.FRAG_GAP&&I===st.MAIN&&e.frag){var Ie=T[ue].details;if(Ie){var $e=Jr(e.frag,Ie.fragments,e.frag.start);if($e!=null&&$e.gap)return 0}}else{if(ie===ut.AUDIO_TRACK&&Re.hasAudioGroup(se)||ie===ut.SUBTITLE_TRACK&&Re.hasSubtitleGroup(se))return 0;if(I===st.AUDIO&&(Ae=f.audioGroups)!=null&&Ae.some(function(Ze){return Re.hasAudioGroup(Ze)})||I===st.SUBTITLE&&(je=f.subtitleGroups)!=null&&je.some(function(Ze){return Re.hasSubtitleGroup(Ze)})||U&&f.audioCodec===Re.audioCodec||G&&f.codecSet===Re.codecSet||!U&&f.codecSet!==Re.codecSet)return 0}return E=ue,1}},ve,ge=T.length;ge--&&(ve=he(),!(ve!==0&&ve===1)););if(E>-1&&u.loadLevel!==E)return e.levelRetry=!0,this.playlistError=0,{action:sr.SendAlternateToPenaltyBox,flags:kn.None,nextAutoLevel:E}}return{action:sr.SendAlternateToPenaltyBox,flags:kn.MoveAllAlternatesMatchingHost}},s.onErrorOut=function(e,a){var u;switch((u=a.errorAction)==null?void 0:u.action){case sr.DoNothing:break;case sr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(a),!a.errorAction.resolved&&a.details!==be.FRAG_GAP?a.fatal=!0:/MediaSource readyState: ended/.test(a.error.message)&&(this.warn('MediaSource ended after "'+a.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(a.fatal){this.hls.stopLoad();return}},s.sendAlternateToPenaltyBox=function(e){var a=this.hls,u=e.errorAction;if(u){var f=u.flags,h=u.hdcpLevel,g=u.nextAutoLevel;switch(f){case kn.None:this.switchLevel(e,g);break;case kn.MoveAllAlternatesMatchingHDCP:h&&(a.maxHdcpLevel=za[za.indexOf(h)-1],u.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+a.maxHdcpLevel+'" or lower');break}u.resolved||this.switchLevel(e,g)}},s.switchLevel=function(e,a){if(a!==void 0&&e.errorAction&&(this.warn("switching to level "+a+" after "+e.details),this.hls.nextAutoLevel=a,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===be.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo"))for(var u=zi(e.mimeType),f=this.hls.levels,h=f.length;h--;)f[h][e.sourceBufferName+"Codec"]===u&&this.hls.removeLevel(h)},c}(rt);function ea(l){var c={action:sr.DoNothing,flags:kn.None};return l&&(c.resolved=!0),c}var Hs={length:0,start:function(){return 0},end:function(){return 0}},Mt=function(){function l(){}return l.isBuffered=function(s,n){if(s){for(var e=l.getBuffered(s),a=e.length;a--;)if(n>=e.start(a)&&n<=e.end(a))return!0}return!1},l.bufferedRanges=function(s){if(s){var n=l.getBuffered(s);return l.timeRangesToArray(n)}return[]},l.timeRangesToArray=function(s){for(var n=[],e=0;e<s.length;e++)n.push({start:s.start(e),end:s.end(e)});return n},l.bufferInfo=function(s,n,e){if(s){var a=l.bufferedRanges(s);if(a.length)return l.bufferedInfo(a,n,e)}return{len:0,start:n,end:n,bufferedIndex:-1}},l.bufferedInfo=function(s,n,e){n=Math.max(0,n),s.length>1&&s.sort(function(D,U){return D.start-U.start||U.end-D.end});var a=-1,u=[];if(e)for(var f=0;f<s.length;f++){n>=s[f].start&&n<=s[f].end&&(a=f);var h=u.length;if(h){var g=u[h-1].end;s[f].start-g<e?s[f].end>g&&(u[h-1].end=s[f].end):u.push(s[f])}else u.push(s[f])}else u=s;for(var m=0,E,T=n,A=n,L=0;L<u.length;L++){var k=u[L].start,I=u[L].end;if(a===-1&&n>=k&&n<=I&&(a=L),n+e>=k&&n<I)T=k,A=I,m=A-n;else if(n+e<k){E=k;break}}return{len:m,start:T||0,end:A||0,nextStart:E,buffered:s,bufferedIndex:a}},l.getBuffered=function(s){try{return s.buffered||Hs}catch(n){return tt.log("failed to get media.buffered",n),Hs}},l}(),ta=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Qa="HlsJsTrackRemovedError",Xo=function(l){function c(s){var n;return n=l.call(this,s)||this,n.name=Qa,n}return P(c,l),c}(le(Error)),cu=function(l){function c(n,e){var a;return a=l.call(this,"buffer-controller",n.logger)||this,a.hls=void 0,a.fragmentTracker=void 0,a.details=null,a._objectUrl=null,a.operationQueue=null,a.bufferCodecEventsTotal=0,a.media=null,a.mediaSource=null,a.lastMpegAudioChunk=null,a.blockedAudioAppend=null,a.lastVideoAppendEnd=0,a.appendSource=void 0,a.transferData=void 0,a.overrides=void 0,a.appendErrors={audio:0,video:0,audiovideo:0},a.tracks={},a.sourceBuffers=[[null,null],[null,null]],a._onEndStreaming=function(u){var f;a.hls&&((f=a.mediaSource)==null?void 0:f.readyState)==="open"&&a.hls.pauseBuffering()},a._onStartStreaming=function(u){a.hls&&a.hls.resumeBuffering()},a._onMediaSourceOpen=function(u){var f=a,h=f.media,g=f.mediaSource;u&&a.log("Media source opened"),!(!h||!g)&&(g.removeEventListener("sourceopen",a._onMediaSourceOpen),h.removeEventListener("emptied",a._onMediaEmptied),a.updateDuration(),a.hls.trigger(N.MEDIA_ATTACHED,{media:h,mediaSource:g}),a.mediaSource!==null&&a.checkPendingTracks())},a._onMediaSourceClose=function(){a.log("Media source closed")},a._onMediaSourceEnded=function(){a.log("Media source ended")},a._onMediaEmptied=function(){var u=a,f=u.mediaSrc,h=u._objectUrl;f!==h&&a.error("Media element src was set while attaching MediaSource ("+h+" > "+f+")")},a.hls=n,a.fragmentTracker=e,a.appendSource=ga(En(n.config.preferManagedMediaSource)),a.initTracks(),a.registerListeners(),a}P(c,l);var s=c.prototype;return s.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},s.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},s.registerListeners=function(){var e=this.hls;e.on(N.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.MANIFEST_PARSED,this.onManifestParsed,this),e.on(N.BUFFER_RESET,this.onBufferReset,this),e.on(N.BUFFER_APPENDING,this.onBufferAppending,this),e.on(N.BUFFER_CODECS,this.onBufferCodecs,this),e.on(N.BUFFER_EOS,this.onBufferEos,this),e.on(N.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(N.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(N.FRAG_PARSED,this.onFragParsed,this),e.on(N.FRAG_CHANGED,this.onFragChanged,this),e.on(N.ERROR,this.onError,this)},s.unregisterListeners=function(){var e=this.hls;e.off(N.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.MANIFEST_PARSED,this.onManifestParsed,this),e.off(N.BUFFER_RESET,this.onBufferReset,this),e.off(N.BUFFER_APPENDING,this.onBufferAppending,this),e.off(N.BUFFER_CODECS,this.onBufferCodecs,this),e.off(N.BUFFER_EOS,this.onBufferEos,this),e.off(N.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(N.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(N.FRAG_PARSED,this.onFragParsed,this),e.off(N.FRAG_CHANGED,this.onFragChanged,this),e.off(N.ERROR,this.onError,this)},s.transferMedia=function(){var e=this,a=this.media,u=this.mediaSource;if(!a)return null;var f={};if(this.operationQueue){var h=this.isUpdating();h||this.operationQueue.removeBlockers();var g=this.isQueued();(h||g)&&this.warn("Transfering MediaSource with"+(g?" operations in queue":"")+(h?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var m=this.transferData;return!this.sourceBufferCount&&m&&m.mediaSource===u?x(f,m.tracks):this.sourceBuffers.forEach(function(E){var T=E[0];T&&(f[T]=x({},e.tracks[T]),e.removeBuffer(T)),E[0]=E[1]=null}),{media:a,mediaSource:u,tracks:f}},s.initTracks=function(){var e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},s.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},s.onManifestParsed=function(e,a){var u,f=2;(a.audio&&!a.video||!a.altAudio)&&(f=1),this.bufferCodecEventsTotal=f,this.log(f+" bufferCodec event(s) expected."),(u=this.transferData)!=null&&u.mediaSource&&this.sourceBufferCount&&f&&this.bufferCreated()},s.onMediaAttaching=function(e,a){var u=this.media=a.media;this.transferData=this.overrides=void 0;var f=En(this.appendSource);if(f){var h=!!a.mediaSource;(h||a.overrides)&&(this.transferData=a,this.overrides=a.overrides);var g=this.mediaSource=a.mediaSource||new f;if(this.assignMediaSource(g),h)this._objectUrl=u.src,this.attachTransferred();else{var m=this._objectUrl=self.URL.createObjectURL(g);if(this.appendSource)try{u.removeAttribute("src");var E=self.ManagedMediaSource;u.disableRemotePlayback=u.disableRemotePlayback||E&&g instanceof E,ra(u),fu(u,m),u.load()}catch{u.src=m}else u.src=m}u.addEventListener("emptied",this._onMediaEmptied)}},s.assignMediaSource=function(e){var a,u;this.log((((a=this.transferData)==null?void 0:a.mediaSource)===e?"transferred":"created")+" media source: "+((u=e.constructor)==null?void 0:u.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))},s.attachTransferred=function(){var e=this,a=this.media,u=this.transferData;if(!(!u||!a)){var f=this.tracks,h=u.tracks,g=h?Object.keys(h):null,m=g?g.length:0,E=function(){Promise.resolve().then(function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()})};if(h&&g&&m){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+Ur(f,function(k,I){return k==="initSegment"?void 0:I})+`;
transfer tracks: `+Ur(h,function(k,I){return k==="initSegment"?void 0:I})+"}"),!Ci(h,f)){u.mediaSource=null,u.tracks=void 0;var T=a.currentTime,A=this.details,L=Math.max(T,A?.fragments[0].start||0);if(L-T>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+T+" -> "+L);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(h)+'"->"'+Object.keys(f)+'") start time: '+L+" currentTime: "+T),this.onMediaDetaching(N.MEDIA_DETACHING,{}),this.onMediaAttaching(N.MEDIA_ATTACHING,u),a.currentTime=L;return}this.transferData=void 0,g.forEach(function(k){var I=k,D=h[I];if(D){var U=D.buffer;if(U){var K=e.fragmentTracker,G=D.id;if(K.hasFragments(G)||K.hasParts(G)){var j=Mt.getBuffered(U);K.detectEvictedFragments(I,j,G,null,!0)}var ie=qs(I),se=[I,U];e.sourceBuffers[ie]=se,U.updating&&e.operationQueue&&e.operationQueue.prependBlocker(I),e.trackSourceBuffer(I,D)}}}),E(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),E()}},s.onMediaDetaching=function(e,a){var u=this,f=!!a.transferMedia;this.transferData=this.overrides=void 0;var h=this.media,g=this.mediaSource,m=this._objectUrl;if(g){if(this.log("media source "+(f?"transferring":"detaching")),f)this.sourceBuffers.forEach(function(L){var k=L[0];k&&u.removeBuffer(k)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var E=g.readyState==="open";try{for(var T=g.sourceBuffers,A=T.length;A--;)E&&T[A].abort(),g.removeSourceBuffer(T[A]);E&&g.endOfStream()}catch(L){this.warn("onMediaDetaching: "+L.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}g.removeEventListener("sourceopen",this._onMediaSourceOpen),g.removeEventListener("sourceended",this._onMediaSourceEnded),g.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(g.removeEventListener("startstreaming",this._onStartStreaming),g.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}h&&(h.removeEventListener("emptied",this._onMediaEmptied),f||(m&&self.URL.revokeObjectURL(m),this.mediaSrc===m?(h.removeAttribute("src"),this.appendSource&&ra(h),h.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(N.MEDIA_DETACHED,a)},s.onBufferReset=function(){var e=this;this.sourceBuffers.forEach(function(a){var u=a[0];u&&e.resetBuffer(u)}),this.initTracks()},s.resetBuffer=function(e){var a,u=(a=this.tracks[e])==null?void 0:a.buffer;if(this.removeBuffer(e),u)try{var f;(f=this.mediaSource)!=null&&f.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(u)}catch(h){this.warn("onBufferReset "+e,h)}delete this.tracks[e]},s.removeBuffer=function(e){this.removeBufferListeners(e),this.sourceBuffers[qs(e)]=[null,null];var a=this.tracks[e];a&&(a.buffer=void 0)},s.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Vs(this.tracks)},s.onBufferCodecs=function(e,a){var u=this,f=this.tracks,h=Object.keys(a);this.log('BUFFER_CODECS: "'+h+'" (current SB count '+this.sourceBufferCount+")");var g="audiovideo"in a&&(f.audio||f.video)||f.audiovideo&&("audio"in a||"video"in a),m=!g&&this.sourceBufferCount&&this.media&&h.some(function(E){return!f[E]});if(g||m){this.warn('Unsupported transition between "'+Object.keys(f)+'" and "'+h+'" SourceBuffers');return}h.forEach(function(E){var T,A,L=a[E],k=L.id,I=L.codec,D=L.levelCodec,U=L.container,K=L.metadata,G=L.supplemental,j=f[E],ie=(T=u.transferData)==null||(T=T.tracks)==null?void 0:T[E],se=ie!=null&&ie.buffer?ie:j,he=se?.pendingCodec||se?.codec,ve=se?.levelCodec;j||(j=f[E]={buffer:void 0,listeners:[],codec:I,supplemental:G,container:U,levelCodec:D,metadata:K,id:k});var ge=ki(he,ve),de=ge?.replace(ta,"$1"),ue=ki(I,D),Ae=(A=ue)==null?void 0:A.replace(ta,"$1");ue&&ge&&de!==Ae&&(E.slice(0,5)==="audio"&&(ue=ma(ue,u.appendSource)),u.log("switching codec "+he+" to "+ue),ue!==(j.pendingCodec||j.codec)&&(j.pendingCodec=ue),j.container=U,u.appendChangeType(E,U,ue))}),(this.tracksReady||this.sourceBufferCount)&&(a.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},s.appendChangeType=function(e,a,u){var f=this,h=a+";codecs="+u,g={label:"change-type="+h,execute:function(){var E=f.tracks[e];if(E){var T=E.buffer;T!=null&&T.changeType&&(f.log("changing "+e+" sourceBuffer type to "+h),T.changeType(h),E.codec=u,E.container=a)}f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(E){f.warn("Failed to change "+e+" SourceBuffer type",E)}};this.append(g,e,this.isPending(this.tracks[e]))},s.blockAudio=function(e){var a,u=this,f=e.start,h=f+e.duration*.05,g=((a=this.fragmentTracker.getAppendedFrag(f,st.MAIN))==null?void 0:a.gap)===!0;if(!g){var m={label:"block-audio",execute:function(){var T,A=u.tracks.video;(u.lastVideoAppendEnd>h||A!=null&&A.buffer&&Mt.isBuffered(A.buffer,h)||((T=u.fragmentTracker.getAppendedFrag(h,st.MAIN))==null?void 0:T.gap)===!0)&&(u.blockedAudioAppend=null,u.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(T){u.warn("Error executing block-audio operation",T)}};this.blockedAudioAppend={op:m,frag:e},this.append(m,"audio",!0)}},s.unblockAudio=function(){var e=this.blockedAudioAppend,a=this.operationQueue;e&&a&&(this.blockedAudioAppend=null,a.unblockAudio(e.op))},s.onBufferAppending=function(e,a){var u=this,f=this.tracks,h=a.data,g=a.type,m=a.parent,E=a.frag,T=a.part,A=a.chunkMeta,L=a.offset,k=A.buffering[g],I=E.sn,D=E.cc,U=self.performance.now();k.start=U;var K=E.stats.buffering,G=T?T.stats.buffering:null;K.start===0&&(K.start=U),G&&G.start===0&&(G.start=U);var j=f.audio,ie=!1;g==="audio"&&j?.container==="audio/mpeg"&&(ie=!this.lastMpegAudioChunk||A.id===1||this.lastMpegAudioChunk.sn!==A.sn,this.lastMpegAudioChunk=A);var se=f.video,he=se?.buffer;if(he&&I!=="initSegment"){var ve=T||E,ge=this.blockedAudioAppend;if(g==="audio"&&m!=="main"&&!this.blockedAudioAppend&&!(se.ending||se.ended)){var de=ve.start,ue=de+ve.duration*.05,Ae=he.buffered,je=this.currentOp("video");!Ae.length&&!je?this.blockAudio(ve):!je&&!Mt.isBuffered(he,ue)&&this.lastVideoAppendEnd<ue&&this.blockAudio(ve)}else if(g==="video"){var Re=ve.end;if(ge){var Ie=ge.frag.start;(Re>Ie||Re<this.lastVideoAppendEnd||Mt.isBuffered(he,Ie))&&this.unblockAudio()}this.lastVideoAppendEnd=Re}}var $e=(T||E).start,Ze={label:"append-"+g,execute:function(){var it;k.executeStart=self.performance.now();var xt=(it=u.tracks[g])==null?void 0:it.buffer;xt&&(ie?u.updateTimestampOffset(xt,$e,.1,g,I,D):L!==void 0&&xe(L)&&u.updateTimestampOffset(xt,L,1e-6,g,I,D)),u.appendExecutor(h,g)},onStart:function(){},onComplete:function(){var it=self.performance.now();k.executeEnd=k.end=it,K.first===0&&(K.first=it),G&&G.first===0&&(G.first=it);var xt={};u.sourceBuffers.forEach(function(at){var ct=at[0],lt=at[1];ct&&(xt[ct]=Mt.getBuffered(lt))}),u.appendErrors[g]=0,g==="audio"||g==="video"?u.appendErrors.audiovideo=0:(u.appendErrors.audio=0,u.appendErrors.video=0),u.hls.trigger(N.BUFFER_APPENDED,{type:g,frag:E,part:T,chunkMeta:A,parent:E.type,timeRanges:xt})},onError:function(it){var xt,at={type:ft.MEDIA_ERROR,parent:E.type,details:be.BUFFER_APPEND_ERROR,sourceBufferName:g,frag:E,part:T,chunkMeta:A,error:it,err:it,fatal:!1},ct=(xt=u.media)==null?void 0:xt.error;if(it.code===DOMException.QUOTA_EXCEEDED_ERR||it.name=="QuotaExceededError"||"quota"in it)at.details=be.BUFFER_FULL_ERROR;else if(it.code===DOMException.INVALID_STATE_ERR&&u.mediaSourceOpenOrEnded&&!ct)at.errorAction=ea(!0);else if(it.name===Qa&&u.sourceBufferCount===0)at.errorAction=ea(!0);else{var lt=++u.appendErrors[g];u.warn("Failed "+lt+"/"+u.hls.config.appendErrorMaxRetry+' times to append segment in "'+g+'" sourceBuffer ('+(ct||"no media error")+")"),(lt>=u.hls.config.appendErrorMaxRetry||ct)&&(at.fatal=!0)}u.hls.trigger(N.ERROR,at)}};this.append(Ze,g,this.isPending(this.tracks[g]))},s.getFlushOp=function(e,a,u){var f=this;return this.log('queuing "'+e+'" remove '+a+"-"+u),{label:"remove",execute:function(){f.removeExecutor(e,a,u)},onStart:function(){},onComplete:function(){f.hls.trigger(N.BUFFER_FLUSHED,{type:e})},onError:function(g){f.warn("Failed to remove "+a+"-"+u+' from "'+e+'" SourceBuffer',g)}}},s.onBufferFlushing=function(e,a){var u=this,f=a.type,h=a.startOffset,g=a.endOffset;f?this.append(this.getFlushOp(f,h,g),f):this.sourceBuffers.forEach(function(m){var E=m[0];E&&u.append(u.getFlushOp(E,h,g),E)})},s.onFragParsed=function(e,a){var u=this,f=a.frag,h=a.part,g=[],m=h?h.elementaryStreams:f.elementaryStreams;m[ot.AUDIOVIDEO]?g.push("audiovideo"):(m[ot.AUDIO]&&g.push("audio"),m[ot.VIDEO]&&g.push("video"));var E=function(){var A=self.performance.now();f.stats.buffering.end=A,h&&(h.stats.buffering.end=A);var L=h?h.stats:f.stats;u.hls.trigger(N.FRAG_BUFFERED,{frag:f,part:h,stats:L,id:f.type})};g.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(E,g).catch(function(T){u.warn("Fragment buffered callback "+T),u.stepOperationQueue(u.sourceBufferTypes)})},s.onFragChanged=function(e,a){this.trimBuffers()},s.onBufferEos=function(e,a){var u=this,f;this.sourceBuffers.forEach(function(m){var E=m[0];if(E){var T=u.tracks[E];(!a.type||a.type===E)&&(T.ending=!0,T.ended||(T.ended=!0,u.log(E+" buffer reached EOS")))}});var h=((f=this.overrides)==null?void 0:f.endOfStream)!==!1,g=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(m){var E,T=m[0];return T&&!((E=u.tracks[T])!=null&&E.ended)});g?h?(this.log("Queueing EOS"),this.blockUntilOpen(function(){u.tracksEnded();var m=u.mediaSource;if(!m||m.readyState!=="open"){m&&u.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+m.readyState);return}u.log("Calling mediaSource.endOfStream()"),m.endOfStream(),u.hls.trigger(N.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(N.BUFFERED_TO_END,void 0)):a.type==="video"&&this.unblockAudio()},s.tracksEnded=function(){var e=this;this.sourceBuffers.forEach(function(a){var u=a[0];if(u!==null){var f=e.tracks[u];f&&(f.ending=!1)}})},s.onLevelUpdated=function(e,a){var u=a.details;u.fragments.length&&(this.details=u,this.updateDuration())},s.updateDuration=function(){var e=this;this.blockUntilOpen(function(){var a=e.getDurationAndRange();a&&e.updateMediaSource(a)})},s.onError=function(e,a){if(a.details===be.BUFFER_APPEND_ERROR&&a.frag){var u,f=(u=a.errorAction)==null?void 0:u.nextAutoLevel;xe(f)&&f!==a.frag.level&&this.resetAppendErrors()}},s.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},s.trimBuffers=function(){var e=this.hls,a=this.details,u=this.media;if(!(!u||a===null)&&this.sourceBufferCount){var f=e.config,h=u.currentTime,g=a.levelTargetDuration,m=a.live&&f.liveBackBufferLength!==null?f.liveBackBufferLength:f.backBufferLength;if(xe(m)&&m>=0){var E=Math.max(m,g),T=Math.floor(h/g)*g-E;this.flushBackBuffer(h,g,T)}var A=f.frontBufferFlushThreshold;if(xe(A)&&A>0){var L=Math.max(f.maxBufferLength,A),k=Math.max(L,g),I=Math.floor(h/g)*g+k;this.flushFrontBuffer(h,g,I)}}},s.flushBackBuffer=function(e,a,u){var f=this;this.sourceBuffers.forEach(function(h){var g=h[0],m=h[1];if(m){var E=Mt.getBuffered(m);if(E.length>0&&u>E.start(0)){var T;f.hls.trigger(N.BACK_BUFFER_REACHED,{bufferEnd:u});var A=f.tracks[g];if((T=f.details)!=null&&T.live)f.hls.trigger(N.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(A!=null&&A.ended){f.log("Cannot flush "+g+" back buffer while SourceBuffer is in ended state");return}f.hls.trigger(N.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:g})}}})},s.flushFrontBuffer=function(e,a,u){var f=this;this.sourceBuffers.forEach(function(h){var g=h[0],m=h[1];if(m){var E=Mt.getBuffered(m),T=E.length;if(T<2)return;var A=E.start(T-1),L=E.end(T-1);if(u>A||e>=A&&e<=L)return;f.hls.trigger(N.BUFFER_FLUSHING,{startOffset:A,endOffset:1/0,type:g})}})},s.getDurationAndRange=function(){var e,a=this.details,u=this.mediaSource;if(!a||!this.media||u?.readyState!=="open")return null;var f=a.edge;if(a.live&&this.hls.config.liveDurationInfinity){var h=a.fragments.length;if(h&&u.setLiveSeekableRange){var g=Math.max(0,a.fragmentStart),m=Math.max(g,f);return{duration:1/0,start:g,end:m}}return{duration:1/0}}var E=(e=this.overrides)==null?void 0:e.duration;if(E)return xe(E)?{duration:E}:null;var T=this.media.duration,A=xe(u.duration)?u.duration:0;return f>A&&f>T||!xe(T)?{duration:f}:null},s.updateMediaSource=function(e){var a=e.duration,u=e.start,f=e.end,h=this.mediaSource;!this.media||!h||h.readyState!=="open"||(h.duration!==a&&(xe(a)&&this.log("Updating MediaSource duration to "+a.toFixed(3)),h.duration=a),u!==void 0&&f!==void 0&&(this.log("MediaSource duration is set to "+h.duration+". Setting seekable range to "+u+"-"+f+"."),h.setLiveSeekableRange(u,f)))},s.checkPendingTracks=function(){var e=this.bufferCodecEventsTotal,a=this.pendingTrackCount,u=this.tracks;if(this.log("checkPendingTracks (pending: "+a+" codec events expected: "+e+") "+Ur(u)),this.tracksReady){var f,h=(f=this.transferData)==null?void 0:f.tracks;h&&Object.keys(h).length?this.attachTransferred():this.createSourceBuffers()}},s.bufferCreated=function(){var e=this;if(this.sourceBufferCount){var a={};this.sourceBuffers.forEach(function(f){var h=f[0],g=f[1];if(h){var m=e.tracks[h];a[h]={buffer:g,container:m.container,codec:m.codec,supplemental:m.supplemental,levelCodec:m.levelCodec,id:m.id,metadata:m.metadata}}}),this.hls.trigger(N.BUFFER_CREATED,{tracks:a}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(f){var h=f[0];e.executeNext(h)})}else{var u=new Error("could not create source buffer for media codec(s)");this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:u,reason:u.message})}},s.createSourceBuffers=function(){var e=this.tracks,a=this.sourceBuffers,u=this.mediaSource;if(!u)throw new Error("createSourceBuffers called when mediaSource was null");for(var f in e){var h=f,g=e[h];if(this.isPending(g)){var m=this.getTrackCodec(g,h),E=g.container+";codecs="+m;g.codec=m,this.log("creating sourceBuffer("+E+")"+(this.currentOp(h)?" Queued":"")+" "+Ur(g));try{var T=u.addSourceBuffer(E),A=qs(h),L=[h,T];a[A]=L,g.buffer=T}catch(I){var k;this.error("error while trying to add sourceBuffer: "+I.message),this.shiftAndExecuteNext(h),(k=this.operationQueue)==null||k.removeBlockers(),delete this.tracks[h],this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:I,sourceBufferName:h,mimeType:E,parent:g.id});return}this.trackSourceBuffer(h,g)}}this.bufferCreated()},s.getTrackCodec=function(e,a){var u=e.supplemental,f=e.codec;u&&(a==="video"||a==="audiovideo")&&an(u,"video")&&(f=Yi(f,u));var h=ki(f,e.levelCodec);return h?a.slice(0,5)==="audio"?ma(h,this.appendSource):h:""},s.trackSourceBuffer=function(e,a){var u=this,f=a.buffer;if(f){var h=this.getTrackCodec(a,e);this.tracks[e]={buffer:f,codec:h,container:a.container,levelCodec:a.levelCodec,supplemental:a.supplemental,metadata:a.metadata,id:a.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(g,m){var E=m.removedRanges;E!=null&&E.length&&u.hls.trigger(N.BUFFER_FLUSHED,{type:g})})}},s.onSBUpdateStart=function(e){var a=this.currentOp(e);a&&a.onStart()},s.onSBUpdateEnd=function(e){var a;if(((a=this.mediaSource)==null?void 0:a.readyState)==="closed"){this.resetBuffer(e);return}var u=this.currentOp(e);u&&(u.onComplete(),this.shiftAndExecuteNext(e))},s.onSBUpdateError=function(e,a){var u,f=new Error(e+" SourceBuffer error. MediaSource readyState: "+((u=this.mediaSource)==null?void 0:u.readyState));this.error(""+f,a),this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:f,fatal:!1});var h=this.currentOp(e);h&&h.onError(f)},s.updateTimestampOffset=function(e,a,u,f,h,g){var m=a-e.timestampOffset;Math.abs(m)>=u&&(this.log("Updating "+f+" SourceBuffer timestampOffset to "+a+" (sn: "+h+" cc: "+g+")"),e.timestampOffset=a)},s.removeExecutor=function(e,a,u){var f=this.media,h=this.mediaSource,g=this.tracks[e],m=g?.buffer;if(!f||!h||!m){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(e);return}var E=xe(f.duration)?f.duration:1/0,T=xe(h.duration)?h.duration:1/0,A=Math.max(0,a),L=Math.min(u,E,T);L>A&&(!g.ending||g.ended)?(g.ended=!1,this.log("Removing ["+A+","+L+"] from the "+e+" SourceBuffer"),m.remove(A,L)):this.shiftAndExecuteNext(e)},s.appendExecutor=function(e,a){var u=this.tracks[a],f=u?.buffer;if(!f)throw new Xo("Attempting to append to the "+a+" SourceBuffer, but it does not exist");u.ending=!1,u.ended=!1,f.appendBuffer(e)},s.blockUntilOpen=function(e){var a=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(u){a.warn("SourceBuffer blocked callback "+u),a.stepOperationQueue(a.sourceBufferTypes)});else try{e()}catch(u){this.warn("Callback run without blocking "+this.operationQueue+" "+u)}},s.isUpdating=function(){return this.sourceBuffers.some(function(e){var a=e[0],u=e[1];return a&&u.updating})},s.isQueued=function(){var e=this;return this.sourceBuffers.some(function(a){var u=a[0];return u&&!!e.currentOp(u)})},s.isPending=function(e){return!!e&&!e.buffer},s.blockBuffers=function(e,a){var u=this;if(a===void 0&&(a=this.sourceBufferTypes),!a.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var f=this.operationQueue,h=a.map(function(m){return u.appendBlocker(m)}),g=a.length>1&&!!this.blockedAudioAppend;return g&&this.unblockAudio(),Promise.all(h).then(function(m){f===u.operationQueue&&(e(),u.stepOperationQueue(u.sourceBufferTypes))})},s.stepOperationQueue=function(e){var a=this;e.forEach(function(u){var f,h=(f=a.tracks[u])==null?void 0:f.buffer;!h||h.updating||a.shiftAndExecuteNext(u)})},s.append=function(e,a,u){this.operationQueue&&this.operationQueue.append(e,a,u)},s.appendBlocker=function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)},s.currentOp=function(e){return this.operationQueue?this.operationQueue.current(e):null},s.executeNext=function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)},s.shiftAndExecuteNext=function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)},s.addBufferListener=function(e,a,u){var f=this.tracks[e];if(f){var h=f.buffer;if(h){var g=u.bind(this,e);f.listeners.push({event:a,listener:g}),h.addEventListener(a,g)}}},s.removeBufferListeners=function(e){var a=this.tracks[e];if(a){var u=a.buffer;u&&(a.listeners.forEach(function(f){u.removeEventListener(f.event,f.listener)}),a.listeners.length=0)}},b(c,[{key:"mediaSourceOpenOrEnded",get:function(){var e,a=(e=this.mediaSource)==null?void 0:e.readyState;return a==="open"||a==="ended"}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(a,u){var f=e.tracks[u];return a[u]={id:f.id,container:f.container,codec:f.codec,levelCodec:f.levelCodec},a},{})}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(a){var u=a[0];if(u){var f=e.tracks[u];if(f)return!f.ended||f.ending}return!1})}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var e,a,u=((e=this.media)==null||(a=e.querySelector)==null?void 0:a.call(e,"source"))||this.media;return u?.src}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(a,u){return a+(e.isPending(e.tracks[u])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,a){var u=a[0];return e+(u?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){var a=e[0];return a}).filter(function(e){return!!e})}}])}(rt);function ra(l){var c=l.querySelectorAll("source");[].slice.call(c).forEach(function(s){l.removeChild(s)})}function fu(l,c){var s=self.document.createElement("source");s.type="video/mp4",s.src=c,l.appendChild(s)}function qs(l){return l==="audio"?1:0}var Ja=function(){function l(s){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=s,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var c=l.prototype;return c.setStreamController=function(n){this.streamController=n},c.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},c.registerListeners=function(){var n=this.hls;n.on(N.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.on(N.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(N.MANIFEST_PARSED,this.onManifestParsed,this),n.on(N.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(N.BUFFER_CODECS,this.onBufferCodecs,this),n.on(N.MEDIA_DETACHING,this.onMediaDetaching,this)},c.unregisterListener=function(){var n=this.hls;n.off(N.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.off(N.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(N.MANIFEST_PARSED,this.onManifestParsed,this),n.off(N.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(N.BUFFER_CODECS,this.onBufferCodecs,this),n.off(N.MEDIA_DETACHING,this.onMediaDetaching,this)},c.onFpsDropLevelCapping=function(n,e){var a=this.hls.levels[e.droppedLevel];this.isLevelAllowed(a)&&this.restrictedLevels.push({bitrate:a.bitrate,height:a.height,width:a.width})},c.onMediaAttaching=function(n,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},c.onManifestParsed=function(n,e){var a=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,a.config.capLevelToPlayerSize&&e.video&&this.startCapping()},c.onLevelsUpdated=function(n,e){this.timer&&xe(this.autoLevelCapping)&&this.detectPlayerSize()},c.onBufferCodecs=function(n,e){var a=this.hls;a.config.capLevelToPlayerSize&&e.video&&this.startCapping()},c.onMediaDetaching=function(){this.stopCapping(),this.media=null},c.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var n=this.hls.levels;if(n.length){var e=this.hls,a=this.getMaxLevel(n.length-1);a!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to "+a+": "+n[a].height+"p@"+n[a].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=a,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},c.getMaxLevel=function(n){var e=this,a=this.hls.levels;if(!a.length)return-1;var u=a.filter(function(f,h){return e.isLevelAllowed(f)&&h<=n});return this.clientRect=null,l.getMaxLevelByMediaSize(u,this.mediaWidth,this.mediaHeight)},c.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},c.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},c.getDimensions=function(){if(this.clientRect)return this.clientRect;var n=this.media,e={width:0,height:0};if(n){var a=n.getBoundingClientRect();e.width=a.width,e.height=a.height,!e.width&&!e.height&&(e.width=a.right-a.left||n.width||0,e.height=a.bottom-a.top||n.height||0)}return this.clientRect=e,e},c.isLevelAllowed=function(n){var e=this.restrictedLevels;return!e.some(function(a){return n.bitrate===a.bitrate&&n.width===a.width&&n.height===a.height})},l.getMaxLevelByMediaSize=function(n,e,a){if(!(n!=null&&n.length))return-1;for(var u=function(T,A){return A?T.width!==A.width||T.height!==A.height:!0},f=n.length-1,h=Math.max(e,a),g=0;g<n.length;g+=1){var m=n[g];if((m.width>=h||m.height>=h)&&u(m,n[g+1])){f=g;break}}return f},b(l,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var n=1;if(!this.hls.config.ignoreDevicePixelRatio)try{n=self.devicePixelRatio}catch{}return Math.min(n,this.hls.config.maxDevicePixelRatio)}}])}(),Za=/^(\d+)x(\d+)$/,es=/(.+?)=(".*?"|.*?)(?:,|$)/g,xr=function(){function l(s,n){typeof s=="string"&&(s=l.parseAttrList(s,n)),x(this,s)}var c=l.prototype;return c.decimalInteger=function(n){var e=parseInt(this[n],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},c.hexadecimalInteger=function(n){if(this[n]){var e=(this[n]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var a=new Uint8Array(e.length/2),u=0;u<e.length/2;u++)a[u]=parseInt(e.slice(u*2,u*2+2),16);return a}return null},c.hexadecimalIntegerAsNumber=function(n){var e=parseInt(this[n],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},c.decimalFloatingPoint=function(n){return parseFloat(this[n])},c.optionalFloat=function(n,e){var a=this[n];return a?parseFloat(a):e},c.enumeratedString=function(n){return this[n]},c.enumeratedStringList=function(n,e){var a=this[n];return(a?a.split(/[ ,]+/):[]).reduce(function(u,f){return u[f.toLowerCase()]=!0,u},e)},c.bool=function(n){return this[n]==="YES"},c.decimalResolution=function(n){var e=Za.exec(this[n]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},l.parseAttrList=function(n,e){var a,u={},f='"';for(es.lastIndex=0;(a=es.exec(n))!==null;){var h=a[1].trim(),g=a[2],m=g.indexOf(f)===0&&g.lastIndexOf(f)===g.length-1,E=!1;if(m)g=g.slice(1,-1);else switch(h){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":E=!0}if(!(e&&(m||E))){if(!E&&!m)switch(h){case"CLOSED-CAPTIONS":if(g==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":tt.warn(n+": attribute "+h+" is missing quotes")}}u[h]=g}return u},b(l,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(n){return n.substring(0,2)==="X-"})}}])}(),du="com.apple.hls.interstitial";function hu(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function Ws(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}var ts=function(){function l(c,s,n){var e;if(n===void 0&&(n=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=s?.tagAnchor||null,this.tagOrder=(e=s?.tagOrder)!=null?e:n,s){var a=s.attr;for(var u in a)if(Object.prototype.hasOwnProperty.call(c,u)&&c[u]!==a[u]){tt.warn('DATERANGE tag attribute: "'+u+'" does not match for tags with ID: "'+c.ID+'"'),this._badValueForSameId=u;break}c=x(new xr({}),a,c)}if(this.attr=c,s?(this._startDate=s._startDate,this._cue=s._cue,this._endDate=s._endDate,this._dateAtEnd=s._dateAtEnd):this._startDate=new Date(c["START-DATE"]),"END-DATE"in this.attr){var f=s?.endDate||new Date(this.attr["END-DATE"]);xe(f.getTime())&&(this._endDate=f)}}return b(l,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var s=this._cue;return s===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):s}},{key:"startTime",get:function(){var s=this.tagAnchor;return s===null||s.programDateTime===null?(tt.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+s),NaN):s.start+(this.startDate.getTime()-s.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var s=this._endDate||this._dateAtEnd;if(s)return s;var n=this.duration;return n!==null?this._dateAtEnd=new Date(this._startDate.getTime()+n*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var s=this.attr.decimalFloatingPoint("DURATION");if(xe(s))return s}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===du}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&xe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),Qo=10,rs=function(){function l(s){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=s}var c=l.prototype;return c.reloaded=function(n){if(!n){this.advanced=!0,this.updated=!0;return}var e=this.lastPartSn-n.lastPartSn,a=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!a||!!e||!this.live,this.advanced=this.endSN>n.endSN||e>0||e===0&&a>0,this.updated||this.advanced?this.misses=Math.floor(n.misses*.6):this.misses=n.misses+1},b(l,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?xe(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||Qo}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;if(n>0){var e=this.driftEnd-this.driftStart;return e*1e3/n}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){return this.fragments.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var n=this.partList;if(n){var e=this.lastPartIndex;if(e!==-1){for(var a=n.length;a--;)if(n[a].index>e)return n[a].index;return e}}return 0}},{key:"lastPartSn",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var n=this.partEnd-this.fragmentStart;return this.age>Math.max(n,this.totalduration)+this.levelTargetDuration}return!1}}])}(),wn={cbc:0,ctr:1};function hi(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function Ys(l){switch(l){case"AES-128":case"AES-256":return wn.cbc;case"AES-256-CTR":return wn.ctr;default:throw new Error("invalid full segment method "+l)}}var pu=function(){function l(s,n,e,a,u,f){a===void 0&&(a=[1]),u===void 0&&(u=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=s,this.uri=n,this.keyFormat=e,this.keyFormatVersions=a,this.iv=u,this.encrypted=s?s!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!hi(s),f!=null&&f.startsWith("0x")&&(this.keyId=new Uint8Array(Tt(f)))}l.clearKeyUriToKeyIdMap=function(){};var c=l.prototype;return c.matches=function(n){var e,a;return n.uri===this.uri&&n.method===this.method&&n.encrypted===this.encrypted&&n.keyFormat===this.keyFormat&&n.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((e=n.iv)==null?void 0:e.join(","))===((a=this.iv)==null?void 0:a.join(","))},c.isSupported=function(){if(this.method){if(hi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES"}return!1},c.getDecryptData=function(n){if(!this.encrypted||!this.uri)return null;if(hi(this.method)&&this.uri&&!this.iv){typeof n!="number"&&(tt.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),n=0);var e=ns(n),a=new l(this.method,this.uri,"identity",this.keyFormatVersions,e);return a}return this},l}();function ns(l){for(var c=new Uint8Array(16),s=12;s<16;s++)c[s]=l>>8*(15-s)&255;return c}var is=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,as=/#EXT-X-MEDIA:(.*)/g,zs=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ta=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Gr=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),$n=function(){function l(){}return l.findGroup=function(s,n){for(var e=0;e<s.length;e++){var a=s[e];if(a.id===n)return a}},l.resolve=function(s,n){return He.buildAbsoluteURL(n,s,{alwaysNormalize:!0})},l.isMediaPlaylist=function(s){return zs.test(s)},l.parseMasterPlaylist=function(s,n){var e=!1,a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:e},u=[];is.lastIndex=0;for(var f;(f=is.exec(s))!=null;)if(f[1]){var h,g=new xr(f[1],a),m=f[2],E={attrs:g,bitrate:g.decimalInteger("BANDWIDTH")||g.decimalInteger("AVERAGE-BANDWIDTH"),name:g.NAME,url:l.resolve(m,n)},T=g.decimalResolution("RESOLUTION");T&&(E.width=T.width,E.height=T.height),Xs(g.CODECS,E);var A=g["SUPPLEMENTAL-CODECS"];A&&(E.supplemental={},Xs(A,E.supplemental)),(h=E.unknownCodecs)!=null&&h.length||u.push(E),a.levels.push(E)}else if(f[3]){var L=f[3],k=f[4];switch(L){case"SESSION-DATA":{var I=new xr(k,a),D=I["DATA-ID"];D&&(a.sessionData===null&&(a.sessionData={}),a.sessionData[D]=I);break}case"SESSION-KEY":{var U=Sa(k,n,a);U.encrypted&&U.isSupported()?(a.sessionKeys===null&&(a.sessionKeys=[]),a.sessionKeys.push(U)):tt.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+k+'"');break}case"DEFINE":break;case"CONTENT-STEERING":{var K=new xr(k,a);a.contentSteering={uri:l.resolve(K["SERVER-URI"],n),pathwayId:K["PATHWAY-ID"]||"."};break}case"START":{a.startTimeOffset=$s(k);break}}}var G=u.length>0&&u.length<a.levels.length;return a.levels=G?u:a.levels,a.levels.length===0&&(a.playlistParsingError=new Error("no levels found in manifest")),a},l.parseMasterPlaylistMedia=function(s,n,e){var a,u={},f=e.levels,h={AUDIO:f.map(function(j){return{id:j.attrs.AUDIO,audioCodec:j.audioCodec}}),SUBTITLES:f.map(function(j){return{id:j.attrs.SUBTITLES,textCodec:j.textCodec}}),"CLOSED-CAPTIONS":[]},g=0;for(as.lastIndex=0;(a=as.exec(s))!==null;){var m=new xr(a[1],e),E=m.TYPE;if(E){var T=h[E],A=u[E]||[];u[E]=A;var L=m.LANGUAGE,k=m["ASSOC-LANGUAGE"],I=m.CHANNELS,D=m.CHARACTERISTICS,U=m["INSTREAM-ID"],K={attrs:m,bitrate:0,id:g++,groupId:m["GROUP-ID"]||"",name:m.NAME||L||"",type:E,default:m.bool("DEFAULT"),autoselect:m.bool("AUTOSELECT"),forced:m.bool("FORCED"),lang:L,url:m.URI?l.resolve(m.URI,n):""};if(k&&(K.assocLang=k),I&&(K.channels=I),D&&(K.characteristics=D),U&&(K.instreamId=U),T!=null&&T.length){var G=l.findGroup(T,K.groupId)||T[0];xa(K,G,"audioCodec"),xa(K,G,"textCodec")}A.push(K)}}return u},l.parseLevelPlaylist=function(s,n,e,a,u,f){var h,g={url:n},m=new rs(n),E=m.fragments,T=[],A=null,L=0,k=0,I=0,D=0,U=0,K=null,G=new ur(a,g),j,ie,se,he=-1,ve=!1,ge=null,de;if(Ta.lastIndex=0,m.m3u8=s,m.hasVariableRefs=!1,((h=Ta.exec(s))==null?void 0:h[0])!=="#EXTM3U")return m.playlistParsingError=new Error("Missing format identifier #EXTM3U"),m;for(;(j=Ta.exec(s))!==null;){ve&&(ve=!1,G=new ur(a,g),G.playlistOffset=I,G.setStart(I),G.sn=L,G.cc=D,U&&(G.bitrate=U),G.level=e,A&&(G.initSegment=A,A.rawProgramDateTime&&(G.rawProgramDateTime=A.rawProgramDateTime,A.rawProgramDateTime=null),ge&&(G.setByteRange(ge),ge=null)));var ue=j[1];if(ue){G.duration=parseFloat(ue);var Ae=(" "+j[2]).slice(1);G.title=Ae||null,G.tagList.push(Ae?["INF",ue,Ae]:["INF",ue])}else if(j[3]){if(xe(G.duration)){G.playlistOffset=I,G.setStart(I),se&&os(G,se,m),G.sn=L,G.level=e,G.cc=D,E.push(G);var je=(" "+j[3]).slice(1);G.relurl=je,Xn(G,K,T),K=G,I+=G.duration,L++,k=0,ve=!0}}else{if(j=j[0].match(Gr),!j){tt.warn("No matches on slow regex match for level playlist!");continue}for(ie=1;ie<j.length&&j[ie]===void 0;ie++);var Re=(" "+j[ie]).slice(1),Ie=(" "+j[ie+1]).slice(1),$e=j[ie+2]?(" "+j[ie+2]).slice(1):null;switch(Re){case"BYTERANGE":K?G.setByteRange(Ie,K):G.setByteRange(Ie);break;case"PROGRAM-DATE-TIME":G.rawProgramDateTime=Ie,G.tagList.push(["PROGRAM-DATE-TIME",Ie]),he===-1&&(he=E.length);break;case"PLAYLIST-TYPE":m.type&&Tn(m,Re,j),m.type=Ie.toUpperCase();break;case"MEDIA-SEQUENCE":m.startSN!==0?Tn(m,Re,j):E.length>0&&ls(m,Re,j),L=m.startSN=parseInt(Ie);break;case"SKIP":{m.skippedSegments&&Tn(m,Re,j);var Ze=new xr(Ie,m),Qe=Ze.decimalInteger("SKIPPED-SEGMENTS");if(xe(Qe)){m.skippedSegments+=Qe;for(var it=Qe;it--;)E.push(null);L+=Qe}var xt=Ze.enumeratedString("RECENTLY-REMOVED-DATERANGES");xt&&(m.recentlyRemovedDateranges=(m.recentlyRemovedDateranges||[]).concat(xt.split("	")));break}case"TARGETDURATION":m.targetduration!==0&&Tn(m,Re,j),m.targetduration=Math.max(parseInt(Ie),1);break;case"VERSION":m.version!==null&&Tn(m,Re,j),m.version=parseInt(Ie);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":m.live||Tn(m,Re,j),m.live=!1;break;case"#":(Ie||$e)&&G.tagList.push($e?[Ie,$e]:[Ie]);break;case"DISCONTINUITY":D++,G.tagList.push(["DIS"]);break;case"GAP":G.gap=!0,G.tagList.push([Re]);break;case"BITRATE":G.tagList.push([Re,Ie]),U=parseInt(Ie)*1e3,xe(U)?G.bitrate=U:U=0;break;case"DATERANGE":{var at=new xr(Ie,m),ct=new ts(at,m.dateRanges[at.ID],m.dateRangeTagCount);m.dateRangeTagCount++,ct.isValid||m.skippedSegments?m.dateRanges[ct.id]=ct:tt.warn('Ignoring invalid DATERANGE tag: "'+Ie+'"'),G.tagList.push(["EXT-X-DATERANGE",Ie]);break}case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":m.startCC!==0?Tn(m,Re,j):E.length>0&&ls(m,Re,j),m.startCC=D=parseInt(Ie);break;case"KEY":{var lt=Sa(Ie,n,m);if(lt.isSupported()){if(lt.method==="NONE"){se=void 0;break}se||(se={});var Nt=se[lt.keyFormat];Nt!=null&&Nt.matches(lt)||(Nt&&(se=x({},se)),se[lt.keyFormat]=lt)}else tt.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Ie+'"');break}case"START":m.startTimeOffset=$s(Ie);break;case"MAP":{var ir=new xr(Ie,m);if(G.duration){var yr=new ur(a,g);ss(yr,ir,e,se),A=yr,G.initSegment=A,A.rawProgramDateTime&&!G.rawProgramDateTime&&(G.rawProgramDateTime=A.rawProgramDateTime)}else{var Pr=G.byteRangeEndOffset;if(Pr){var Kr=G.byteRangeStartOffset;ge=Pr-Kr+"@"+Kr}else ge=null;ss(G,ir,e,se),A=G,ve=!0}A.cc=D;break}case"SERVER-CONTROL":{de&&Tn(m,Re,j),de=new xr(Ie),m.canBlockReload=de.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=de.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&de.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=de.optionalFloat("PART-HOLD-BACK",0),m.holdBack=de.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{m.partTarget&&Tn(m,Re,j);var Er=new xr(Ie);m.partTarget=Er.decimalFloatingPoint("PART-TARGET");break}case"PART":{var en=m.partList;en||(en=m.partList=[]);var Dr=k>0?en[en.length-1]:void 0,or=k++,tn=new xr(Ie,m),on=new pn(tn,G,g,or,Dr);en.push(on),G.duration+=on.duration;break}case"PRELOAD-HINT":{var Un=new xr(Ie,m);m.preloadHint=Un;break}case"RENDITION-REPORT":{var _r=new xr(Ie,m);m.renditionReports=m.renditionReports||[],m.renditionReports.push(_r);break}default:tt.warn("line parsed but not handled: "+j);break}}}K&&!K.relurl?(E.pop(),I-=K.duration,m.partList&&(m.fragmentHint=K)):m.partList&&(Xn(G,K,T),G.cc=D,m.fragmentHint=G,se&&os(G,se,m)),m.targetduration||(m.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var Zn=E.length,In=E[0],Oi=E[Zn-1];if(I+=m.skippedSegments*m.targetduration,I>0&&Zn&&Oi){m.averagetargetduration=I/Zn;var ln=Oi.sn;m.endSN=ln!=="initSegment"?ln:0,m.live||(Oi.endList=!0),he>0&&(Qs(E,he),In&&T.unshift(In))}return m.fragmentHint&&(I+=m.fragmentHint.duration),m.totalduration=I,T.length&&m.dateRangeTagCount&&In&&na(T,m),m.endCC=D,m},l}();function na(l,c){var s=l.length;if(!s)if(c.hasProgramDateTime){var n=c.fragments[c.fragments.length-1];l.push(n),s++}else return;for(var e=l[s-1],a=c.live?1/0:c.totalduration,u=Object.keys(c.dateRanges),f=u.length;f--;){var h=c.dateRanges[u[f]],g=h.startDate.getTime();h.tagAnchor=e.ref;for(var m=s;m--;){var E;if(((E=l[m])==null?void 0:E.sn)<c.startSN)break;var T=Jo(c,g,l,m,a);if(T!==-1){h.tagAnchor=c.fragments[T].ref;break}}}}function Jo(l,c,s,n,e){var a=s[n];if(a){var u=a.programDateTime;if(c>=u||n===0){var f,h=(((f=s[n+1])==null?void 0:f.start)||e)-a.start;if(c<=u+h*1e3){var g=s[n].sn-l.startSN;if(g<0)return-1;var m=l.fragments;if(m.length>s.length)for(var E=s[n+1]||m[m.length-1],T=E.sn-l.startSN,A=T;A>g;A--){var L=m[A].programDateTime;if(c>=L&&c<L+m[A].duration*1e3)return A}return g}}}return-1}function Sa(l,c,s){var n,e,a=new xr(l,s),u=(n=a.METHOD)!=null?n:"",f=a.URI,h=a.hexadecimalInteger("IV"),g=a.KEYFORMATVERSIONS,m=(e=a.KEYFORMAT)!=null?e:"identity";f&&a.IV&&!h&&tt.error("Invalid IV: "+a.IV);var E=f?$n.resolve(f,c):"",T=(g||"1").split("/").map(Number).filter(Number.isFinite);return new pu(u,E,m,T,h,a.KEYID)}function $s(l){var c=new xr(l),s=c.decimalFloatingPoint("TIME-OFFSET");return xe(s)?s:null}function Xs(l,c){var s=(l||"").split(/[ ,]+/).filter(function(n){return n});["video","audio","text"].forEach(function(n){var e=s.filter(function(a){return Yn(a,n)});e.length&&(c[n+"Codec"]=e.map(function(a){return a.split("/")[0]}).join(","),s=s.filter(function(a){return e.indexOf(a)===-1}))}),c.unknownCodecs=s}function xa(l,c,s){var n=c[s];n&&(l[s]=n)}function Qs(l,c){for(var s=l[c],n=c;n--;){var e=l[n];if(!e)return;e.programDateTime=s.programDateTime-e.duration*1e3,s=e}}function Xn(l,c,s){l.rawProgramDateTime?s.push(l):c!=null&&c.programDateTime&&(l.programDateTime=c.endProgramDateTime)}function ss(l,c,s,n){l.relurl=c.URI,c.BYTERANGE&&l.setByteRange(c.BYTERANGE),l.level=s,l.sn="initSegment",n&&(l.levelkeys=n),l.initSegment=null}function os(l,c,s){l.levelkeys=c;var n=s.encryptedFragments;(!n.length||n[n.length-1].levelkeys!==c)&&Object.keys(c).some(function(e){return c[e].isCommonEncryption})&&n.push(l)}function Tn(l,c,s){l.playlistParsingError=new Error("#EXT-X-"+c+" must not appear more than once ("+s[0]+")")}function ls(l,c,s){l.playlistParsingError=new Error("#EXT-X-"+c+" must appear before the first Media Segment ("+s[0]+")")}function us(l,c){var s=c.startPTS;if(xe(s)){var n=0,e;c.sn>l.sn?(n=s-l.start,e=l):(n=l.start-s,e=c),e.duration!==n&&e.setDuration(n)}else if(c.sn>l.sn){var a=l.cc===c.cc;a&&l.minEndPTS?c.setStart(l.start+(l.minEndPTS-l.start)):c.setStart(l.start+l.duration)}else c.setStart(Math.max(l.start-c.duration,0))}function Zo(l,c,s,n,e,a,u){var f=n-s;f<=0&&(u.warn("Fragment should have a positive duration",c),n=s+c.duration,a=e+c.duration);var h=s,g=n,m=c.startPTS,E=c.endPTS;if(xe(m)){var T=Math.abs(m-s);l&&T>l.totalduration?u.warn("media timestamps and playlist times differ by "+T+"s for level "+c.level+" "+l.url):xe(c.deltaPTS)?c.deltaPTS=Math.max(T,c.deltaPTS):c.deltaPTS=T,h=Math.max(s,m),s=Math.min(s,m),e=c.startDTS!==void 0?Math.min(e,c.startDTS):e,g=Math.min(n,E),n=Math.max(n,E),a=c.endDTS!==void 0?Math.max(a,c.endDTS):a}var A=s-c.start;c.start!==0&&c.setStart(s),c.setDuration(n-c.start),c.startPTS=s,c.maxStartPTS=h,c.startDTS=e,c.endPTS=n,c.minEndPTS=g,c.endDTS=a;var L=c.sn;if(!l||L<l.startSN||L>l.endSN)return 0;var k,I=L-l.startSN,D=l.fragments;for(D[I]=c,k=I;k>0;k--)us(D[k],D[k-1]);for(k=I;k<D.length-1;k++)us(D[k],D[k+1]);return l.fragmentHint&&us(D[D.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,A}function Js(l,c,s){if(l!==c){for(var n=null,e=l.fragments,a=e.length-1;a>=0;a--){var u=e[a].initSegment;if(u){n=u;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var f;Zs(l,c,function(D,U,K,G){if((!c.startCC||c.skippedSegments)&&U.cc!==D.cc){for(var j=D.cc-U.cc,ie=K;ie<G.length;ie++)G[ie].cc+=j;c.endCC=G[G.length-1].cc}xe(D.startPTS)&&xe(D.endPTS)&&(U.setStart(U.startPTS=D.startPTS),U.startDTS=D.startDTS,U.maxStartPTS=D.maxStartPTS,U.endPTS=D.endPTS,U.endDTS=D.endDTS,U.minEndPTS=D.minEndPTS,U.setDuration(D.endPTS-D.startPTS),U.duration&&(f=U),c.PTSKnown=c.alignedSliding=!0),D.hasStreams&&(U.elementaryStreams=D.elementaryStreams),U.loader=D.loader,D.hasStats&&(U.stats=D.stats),D.initSegment&&(U.initSegment=D.initSegment,n=D.initSegment)});var h=c.fragments,g=c.fragmentHint?h.concat(c.fragmentHint):h;if(n&&g.forEach(function(D){var U;D&&(!D.initSegment||D.initSegment.relurl===((U=n)==null?void 0:U.relurl))&&(D.initSegment=n)}),c.skippedSegments){if(c.deltaUpdateFailed=h.some(function(D){return!D}),c.deltaUpdateFailed){s.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var m=c.skippedSegments;m--;)h.shift();c.startSN=h[0].sn}else{c.canSkipDateRanges&&(c.dateRanges=cs(l.dateRanges,c,s));var E=l.fragments.filter(function(D){return D.rawProgramDateTime});if(l.hasProgramDateTime&&!c.hasProgramDateTime)for(var T=1;T<g.length;T++)g[T].programDateTime===null&&Xn(g[T],g[T-1],E);na(E,c)}c.endCC=h[h.length-1].cc}if(!c.startCC){var A,L=eo(l,c.startSN-1);c.startCC=(A=L?.cc)!=null?A:h[0].cc}vu(l.partList,c.partList,function(D,U){U.elementaryStreams=D.elementaryStreams,U.stats=D.stats}),f?Zo(c,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS,s):el(l,c),h.length&&(c.totalduration=c.edge-h[0].start),c.driftStartTime=l.driftStartTime,c.driftStart=l.driftStart;var k=c.advancedDateTime;if(c.advanced&&k){var I=c.edge;c.driftStart||(c.driftStartTime=k,c.driftStart=I),c.driftEndTime=k,c.driftEnd=I}else c.driftEndTime=l.driftEndTime,c.driftEnd=l.driftEnd,c.advancedDateTime=l.advancedDateTime;c.requestScheduled===-1&&(c.requestScheduled=l.requestScheduled)}}function cs(l,c,s){var n=c.dateRanges,e=c.recentlyRemovedDateranges,a=x({},l);e&&e.forEach(function(h){delete a[h]});var u=Object.keys(a),f=u.length;return f?(Object.keys(n).forEach(function(h){var g=a[h],m=new ts(n[h].attr,g);m.isValid?(a[h]=m,g||(m.tagOrder+=f)):s.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+Ur(n[h].attr)+'"')}),a):n}function vu(l,c,s){if(l&&c)for(var n=0,e=0,a=l.length;e<=a;e++){var u=l[e],f=c[e+n];u&&f&&u.index===f.index&&u.fragment.sn===f.fragment.sn?s(u,f):n--}}function Zs(l,c,s){for(var n=c.skippedSegments,e=Math.max(l.startSN,c.startSN)-c.startSN,a=(l.fragmentHint?1:0)+(n?c.endSN:Math.min(l.endSN,c.endSN))-c.startSN,u=c.startSN-l.startSN,f=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments,h=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,g=e;g<=a;g++){var m=h[u+g],E=f[g];if(n&&!E&&m&&(E=c.fragments[g]=m),m&&E){s(m,E,g,f);var T=m.relurl,A=E.relurl;if(T&&no(T,A)){c.playlistParsingError=fs("media sequence mismatch "+E.sn+":",l,c,m,E);return}else if(m.cc!==E.cc){c.playlistParsingError=fs("discontinuity sequence mismatch ("+m.cc+"!="+E.cc+")",l,c,m,E);return}}}}function fs(l,c,s,n,e){return new Error(l+" "+e.url+`
Playlist starting @`+c.startSN+`
`+c.m3u8+`

Playlist starting @`+s.startSN+`
`+s.m3u8)}function el(l,c,s){s===void 0&&(s=!0);var n=c.startSN+c.skippedSegments-l.startSN,e=l.fragments,a=n>=0,u=0;if(a&&n<e.length)u=e[n].start;else if(a&&c.startSN===l.endSN+1)u=l.fragmentEnd;else if(a&&s)u=l.fragmentStart+n*c.levelTargetDuration;else if(!c.skippedSegments&&c.fragmentStart===0)u=l.fragmentStart;else return;tl(c,u)}function tl(l,c){if(c){for(var s=l.fragments,n=l.skippedSegments;n<s.length;n++)s[n].addStart(c);l.fragmentHint&&l.fragmentHint.addStart(c)}}function rl(l,c){c===void 0&&(c=1/0);var s=1e3*l.targetduration;if(l.updated){var n=l.fragments,e=4;if(n.length&&s*e>c){var a=n[n.length-1].duration*1e3;a<s&&(s=a)}}else s/=2;return Math.round(s)}function eo(l,c,s){if(!l)return null;var n=l.fragments[c-l.startSN];return n||(n=l.fragmentHint,n&&n.sn===c)?n:c<l.startSN&&s&&s.sn===c?s:null}function to(l,c,s){return l?nl(l.partList,c,s):null}function nl(l,c,s){if(l)for(var n=l.length;n--;){var e=l[n];if(e.index===s&&e.fragment.sn===c)return e}return null}function ro(l){l.forEach(function(c,s){var n;(n=c.details)==null||n.fragments.forEach(function(e){e.level=s,e.initSegment&&(e.initSegment.level=s)})})}function no(l,c){return l!==c&&c?io(l)!==io(c):!1}function io(l){return l.replace(/\?[^?]*$/,"")}var il=3e5,gu=function(l){function c(n){var e;return e=l.call(this,"content-steering",n.logger)||this,e.hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=n,e.registerListeners(),e}P(c,l);var s=c.prototype;return s.registerListeners=function(){var e=this.hls;e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(N.MANIFEST_PARSED,this.onManifestParsed,this),e.on(N.ERROR,this.onError,this)},s.unregisterListeners=function(){var e=this.hls;e&&(e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(N.MANIFEST_PARSED,this.onManifestParsed,this),e.off(N.ERROR,this.onError,this))},s.pathways=function(){return(this.levels||[]).reduce(function(e,a){return e.indexOf(a.pathwayId)===-1&&e.push(a.pathwayId),e},[])},s.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},s.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},s.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},s.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},s.removeLevel=function(e){var a=this.levels;a&&(this.levels=a.filter(function(u){return u!==e}))},s.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},s.onManifestLoaded=function(e,a){var u=a.contentSteering;u!==null&&(this.pathwayId=u.pathwayId,this.uri=u.uri,this.started&&this.startLoad())},s.onManifestParsed=function(e,a){this.audioTracks=a.audioTracks,this.subtitleTracks=a.subtitleTracks},s.onError=function(e,a){var u=a.errorAction;if(u?.action===sr.SendAlternateToPenaltyBox&&u.flags===kn.MoveAllAlternatesMatchingHost){var f=this.levels,h=this._pathwayPriority,g=this.pathwayId;if(a.context){var m=a.context,E=m.groupId,T=m.pathwayId,A=m.type;E&&f?g=this.getPathwayForGroupId(E,A,g):T&&(g=T)}g in this.penalizedPathways||(this.penalizedPathways[g]=performance.now()),!h&&f&&(h=this.pathways()),h&&h.length>1&&(this.updatePathwayPriority(h),u.resolved=this.pathwayId!==g),a.details===be.BUFFER_APPEND_ERROR&&!a.fatal?u.resolved=!0:u.resolved||this.warn("Could not resolve "+a.details+' ("'+a.error.message+'") with content-steering for Pathway: '+g+" levels: "+(f&&f.length)+" priorities: "+Ur(h)+" penalized: "+Ur(this.penalizedPathways))}},s.filterParsedLevels=function(e){this.levels=e;var a=this.getLevelsForPathway(this.pathwayId);if(a.length===0){var u=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+u+'"'),a=this.getLevelsForPathway(u),this.pathwayId=u}return a.length!==e.length&&this.log("Found "+a.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),a},s.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(a){return e===a.pathwayId})},s.updatePathwayPriority=function(e){this._pathwayPriority=e;var a,u=this.penalizedPathways,f=performance.now();Object.keys(u).forEach(function(A){f-u[A]>il&&delete u[A]});for(var h=0;h<e.length;h++){var g=e[h];if(!(g in u)){if(g===this.pathwayId)return;var m=this.hls.nextLoadLevel,E=this.hls.levels[m];if(a=this.getLevelsForPathway(g),a.length>0){this.log('Setting Pathway to "'+g+'"'),this.pathwayId=g,ro(a),this.hls.trigger(N.LEVELS_UPDATED,{levels:a});var T=this.hls.levels[m];E&&T&&this.levels&&(T.attrs["STABLE-VARIANT-ID"]!==E.attrs["STABLE-VARIANT-ID"]&&T.bitrate!==E.bitrate&&this.log("Unstable Pathways change from bitrate "+E.bitrate+" to "+T.bitrate),this.hls.nextLoadLevel=m);break}}}},s.getPathwayForGroupId=function(e,a,u){for(var f=this.getLevelsForPathway(u).concat(this.levels||[]),h=0;h<f.length;h++)if(a===ut.AUDIO_TRACK&&f[h].hasAudioGroup(e)||a===ut.SUBTITLE_TRACK&&f[h].hasSubtitleGroup(e))return f[h].pathwayId;return u},s.clonePathways=function(e){var a=this,u=this.levels;if(u){var f={},h={};e.forEach(function(g){var m=g.ID,E=g["BASE-ID"],T=g["URI-REPLACEMENT"];if(!u.some(function(L){return L.pathwayId===m})){var A=a.getLevelsForPathway(E).map(function(L){var k=new xr(L.attrs);k["PATHWAY-ID"]=m;var I=k.AUDIO&&k.AUDIO+"_clone_"+m,D=k.SUBTITLES&&k.SUBTITLES+"_clone_"+m;I&&(f[k.AUDIO]=I,k.AUDIO=I),D&&(h[k.SUBTITLES]=D,k.SUBTITLES=D);var U=sl(L.uri,k["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",T),K=new Xi({attrs:k,audioCodec:L.audioCodec,bitrate:L.bitrate,height:L.height,name:L.name,url:U,videoCodec:L.videoCodec,width:L.width});if(L.audioGroups)for(var G=1;G<L.audioGroups.length;G++)K.addGroupId("audio",L.audioGroups[G]+"_clone_"+m);if(L.subtitleGroups)for(var j=1;j<L.subtitleGroups.length;j++)K.addGroupId("text",L.subtitleGroups[j]+"_clone_"+m);return K});u.push.apply(u,A),al(a.audioTracks,f,T,m),al(a.subtitleTracks,h,T,m)}})}},s.loadSteeringManifest=function(e){var a=this,u=this.hls.config,f=u.loader;this.loader&&this.loader.destroy(),this.loader=new f(u);var h;try{h=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(h.protocol!=="data:"){var g=(this.hls.bandwidthEstimate||u.abrEwmaDefaultEstimate)|0;h.searchParams.set("_HLS_pathway",this.pathwayId),h.searchParams.set("_HLS_throughput",""+g)}var m={responseType:"json",url:h.href},E=u.steeringManifestLoadPolicy.default,T=E.errorRetry||E.timeoutRetry||{},A={loadPolicy:E,timeout:E.maxLoadTimeMs,maxRetry:T.maxNumRetry||0,retryDelay:T.retryDelayMs||0,maxRetryDelay:T.maxRetryDelayMs||0},L={onSuccess:function(I,D,U,K){a.log('Loaded steering manifest: "'+h+'"');var G=I.data;if(G?.VERSION!==1){a.log("Steering VERSION "+G.VERSION+" not supported!");return}a.updated=performance.now(),a.timeToLoad=G.TTL;var j=G["RELOAD-URI"],ie=G["PATHWAY-CLONES"],se=G["PATHWAY-PRIORITY"];if(j)try{a.uri=new self.URL(j,h).href}catch{a.enabled=!1,a.log("Failed to parse Steering Manifest RELOAD-URI: "+j);return}a.scheduleRefresh(a.uri||U.url),ie&&a.clonePathways(ie);var he={steeringManifest:G,url:h.toString()};a.hls.trigger(N.STEERING_MANIFEST_LOADED,he),se&&a.updatePathwayPriority(se)},onError:function(I,D,U,K){if(a.log("Error loading steering manifest: "+I.code+" "+I.text+" ("+D.url+")"),a.stopLoad(),I.code===410){a.enabled=!1,a.log("Steering manifest "+D.url+" no longer available");return}var G=a.timeToLoad*1e3;if(I.code===429){var j=a.loader;if(typeof j?.getResponseHeader=="function"){var ie=j.getResponseHeader("Retry-After");ie&&(G=parseFloat(ie)*1e3)}a.log("Steering manifest "+D.url+" rate limited");return}a.scheduleRefresh(a.uri||D.url,G)},onTimeout:function(I,D,U){a.log("Timeout loading steering manifest ("+D.url+")"),a.scheduleRefresh(a.uri||D.url)}};this.log("Requesting steering manifest: "+h),this.loader.load(m,A,L)},s.scheduleRefresh=function(e,a){var u=this;a===void 0&&(a=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var f,h=(f=u.hls)==null?void 0:f.media;if(h&&!h.ended){u.loadSteeringManifest(e);return}u.scheduleRefresh(e,u.timeToLoad*1e3)},a)},b(c,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}}])}(rt);function al(l,c,s,n){l&&Object.keys(c).forEach(function(e){var a=l.filter(function(u){return u.groupId===e}).map(function(u){var f=x({},u);return f.details=void 0,f.attrs=new xr(f.attrs),f.url=f.attrs.URI=sl(u.url,u.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),f.groupId=f.attrs["GROUP-ID"]=c[e],f.attrs["PATHWAY-ID"]=n,f});l.push.apply(l,a)})}function sl(l,c,s,n){var e=n.HOST,a=n.PARAMS,u=n[s],f;c&&(f=u?.[c],f&&(l=f));var h=new self.URL(l);return e&&!f&&(h.host=e),a&&Object.keys(a).sort().forEach(function(g){g&&h.searchParams.set(g,a[g])}),h.href}var ds=function(){function l(s){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=s,this.registerListeners()}var c=l.prototype;return c.setStreamController=function(n){this.streamController=n},c.registerListeners=function(){this.hls.on(N.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(N.MEDIA_DETACHING,this.onMediaDetaching,this)},c.unregisterListeners=function(){this.hls.off(N.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(N.MEDIA_DETACHING,this.onMediaDetaching,this)},c.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},c.onMediaAttaching=function(n,e){var a=this.hls.config;if(a.capLevelOnFPSDrop){var u=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=u,u&&typeof u.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),a.fpsDroppedMonitoringPeriod)}},c.onMediaDetaching=function(){this.media=null},c.checkFPS=function(n,e,a){var u=performance.now();if(e){if(this.lastTime){var f=u-this.lastTime,h=a-this.lastDroppedFrames,g=e-this.lastDecodedFrames,m=1e3*h/f,E=this.hls;if(E.trigger(N.FPS_DROP,{currentDropped:h,currentDecoded:g,totalDroppedFrames:a}),m>0&&h>E.config.fpsDroppedMonitoringThreshold*g){var T=E.currentLevel;E.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+T),T>0&&(E.autoLevelCapping===-1||E.autoLevelCapping>=T)&&(T=T-1,E.trigger(N.FPS_DROP_LEVEL_CAPPING,{level:T,droppedLevel:E.currentLevel}),E.autoLevelCapping=T,this.streamController.nextLevelSwitch())}}this.lastTime=u,this.lastDroppedFrames=a,this.lastDecodedFrames=e}},c.checkFPSInterval=function(){var n=this.media;if(n)if(this.isVideoPlaybackQualityAvailable){var e=n.getVideoPlaybackQuality();this.checkFPS(n,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(n,n.webkitDecodedFrameCount,n.webkitDroppedFrameCount)},l}(),Qn=function(){function l(){this.chunks=[],this.dataLength=0}var c=l.prototype;return c.push=function(n){this.chunks.push(n),this.dataLength+=n.length},c.flush=function(){var n=this.chunks,e=this.dataLength,a;if(n.length)n.length===1?a=n[0]:a=mr(n,e);else return new Uint8Array(0);return this.reset(),a},c.reset=function(){this.chunks.length=0,this.dataLength=0},l}();function mr(l,c){for(var s=new Uint8Array(c),n=0,e=0;e<l.length;e++){var a=l[e];s.set(a,n),n+=a.length}return s}function Aa(l,c){return c+10<=l.length&&l[c]===51&&l[c+1]===68&&l[c+2]===73&&l[c+3]<255&&l[c+4]<255&&l[c+6]<128&&l[c+7]<128&&l[c+8]<128&&l[c+9]<128}function sn(l,c){return c+10<=l.length&&l[c]===73&&l[c+1]===68&&l[c+2]===51&&l[c+3]<255&&l[c+4]<255&&l[c+6]<128&&l[c+7]<128&&l[c+8]<128&&l[c+9]<128}function hs(l,c){var s=0;return s=(l[c]&127)<<21,s|=(l[c+1]&127)<<14,s|=(l[c+2]&127)<<7,s|=l[c+3]&127,s}function ia(l,c){for(var s=c,n=0;sn(l,c);){n+=10;var e=hs(l,c+6);n+=e,Aa(l,c+10)&&(n+=10),c+=n}if(n>0)return l.subarray(s,s+n)}function ol(l,c,s,n){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=c[s+2],u=a>>2&15;if(u>12){var f=new Error("invalid ADTS sampling index:"+u);l.emit(N.ERROR,N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}var h=(a>>6&3)+1,g=c[s+3]>>6&3|(a&1)<<2,m="mp4a.40."+h,E=e[u],T=u;(h===5||h===29)&&(T-=3);var A=[h<<3|(T&14)>>1,(T&1)<<7|g<<3];return tt.log("manifest codec:"+n+", parsed codec:"+m+", channels:"+g+", rate:"+E+" (ADTS object type:"+h+" sampling index:"+u+")"),{config:A,samplerate:E,channelCount:g,codec:m,parsedCodec:m,manifestCodec:n}}function pi(l,c){return l[c]===255&&(l[c+1]&246)===240}function ps(l,c){return l[c+1]&1?7:9}function vi(l,c){return(l[c+3]&3)<<11|l[c+4]<<3|(l[c+5]&224)>>>5}function gi(l,c){return c+5<l.length}function Ca(l,c){return c+1<l.length&&pi(l,c)}function v(l,c){return gi(l,c)&&pi(l,c)&&vi(l,c)<=l.length-c}function y(l,c){if(Ca(l,c)){var s=ps(l,c);if(c+s>=l.length)return!1;var n=vi(l,c);if(n<=s)return!1;var e=c+n;return e===l.length||Ca(l,e)}return!1}function S(l,c,s,n,e){if(!l.samplerate){var a=ol(c,s,n,e);if(!a)return;x(l,a)}}function C(l){return 1024*9e4/l}function w(l,c){var s=ps(l,c);if(c+s<=l.length){var n=vi(l,c)-s;if(n>0)return{headerLength:s,frameLength:n}}}function M(l,c,s,n,e){var a=C(l.samplerate),u=n+e*a,f=w(c,s),h;if(f){var g=f.frameLength,m=f.headerLength,E=m+g,T=Math.max(0,s+E-c.length);T?(h=new Uint8Array(E-m),h.set(c.subarray(s+m,c.length),0)):h=c.subarray(s+m,s+E);var A={unit:h,pts:u};return T||l.samples.push(A),{sample:A,length:E,missing:T}}var L=c.length-s;h=new Uint8Array(L),h.set(c.subarray(s,c.length),0);var k={unit:h,pts:u};return{sample:k,length:L,missing:-1}}function B(l,c){return sn(l,c)&&hs(l,c+6)+10<=l.length-c}function q(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function $(l,c,s){return c===void 0&&(c=0),s===void 0&&(s=1/0),J(l,c,s,Uint8Array)}function J(l,c,s,n){var e=re(l),a=1;"BYTES_PER_ELEMENT"in n&&(a=n.BYTES_PER_ELEMENT);var u=Y(l)?l.byteOffset:0,f=(u+l.byteLength)/a,h=(u+c)/a,g=Math.floor(Math.max(0,Math.min(h,f))),m=Math.floor(Math.min(g+Math.max(s,0),f));return new n(e,g,m-g)}function re(l){return l instanceof ArrayBuffer?l:l.buffer}function Y(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function oe(l){var c={key:l.type,description:"",data:"",mimeType:null,pictureType:null},s=3;if(!(l.size<2)){if(l.data[0]!==s){console.log("Ignore frame with unrecognized character encoding");return}var n=l.data.subarray(1).indexOf(0);if(n!==-1){var e=tr($(l.data,1,n)),a=l.data[2+n],u=l.data.subarray(3+n).indexOf(0);if(u!==-1){var f=tr($(l.data,3+n,u)),h;return e==="-->"?h=tr($(l.data,4+n+u)):h=q(l.data.subarray(4+n+u)),c.mimeType=e,c.pictureType=a,c.description=f,c.data=h,c}}}}function X(l){if(!(l.size<2)){var c=tr(l.data,!0),s=new Uint8Array(l.data.subarray(c.length+1));return{key:l.type,info:c,data:s.buffer}}}function te(l){if(!(l.size<2)){if(l.type==="TXXX"){var c=1,s=tr(l.data.subarray(c),!0);c+=s.length+1;var n=tr(l.data.subarray(c));return{key:l.type,info:s,data:n}}var e=tr(l.data.subarray(1));return{key:l.type,info:"",data:e}}}function ae(l){if(l.type==="WXXX"){if(l.size<2)return;var c=1,s=tr(l.data.subarray(c),!0);c+=s.length+1;var n=tr(l.data.subarray(c));return{key:l.type,info:s,data:n}}var e=tr(l.data);return{key:l.type,info:"",data:e}}function ee(l){return l.type==="PRIV"?X(l):l.type[0]==="W"?ae(l):l.type==="APIC"?oe(l):te(l)}function fe(l){var c=String.fromCharCode(l[0],l[1],l[2],l[3]),s=hs(l,4),n=10;return{type:c,size:s,data:l.subarray(n,n+s)}}var pe=10,ye=10;function Te(l){for(var c=0,s=[];sn(l,c);){var n=hs(l,c+6);l[c+5]>>6&1&&(c+=pe),c+=pe;for(var e=c+n;c+ye<e;){var a=fe(l.subarray(c)),u=ee(a);u&&s.push(u),c+=a.size+pe}Aa(l,c)&&(c+=pe)}return s}function Me(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function Ge(l){if(l.data.byteLength===8){var c=new Uint8Array(l.data),s=c[3]&1,n=(c[4]<<23)+(c[5]<<15)+(c[6]<<7)+c[7];return n/=45,s&&(n+=4772185884e-2),Math.round(n)}}function Oe(l){for(var c=Te(l),s=0;s<c.length;s++){var n=c[s];if(Me(n))return Ge(n)}}var we=function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l}({});function Fe(l,c){return l===void 0&&(l=""),c===void 0&&(c=9e4),{type:l,id:-1,pid:-1,inputTimeScale:c,sequenceNumber:-1,samples:[],dropped:0}}var Ue=function(){function l(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var c=l.prototype;return c.resetInitSegment=function(n,e,a,u){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},c.resetTimeStamp=function(n){this.initPTS=n,this.resetContiguity()},c.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},c.canParse=function(n,e){return!1},c.appendFrame=function(n,e,a){},c.demux=function(n,e){this.cachedData&&(n=Xr(this.cachedData,n),this.cachedData=null);var a=ia(n,0),u=a?a.length:0,f,h=this._audioTrack,g=this._id3Track,m=a?Oe(a):void 0,E=n.length;for((this.basePTS===null||this.frameIndex===0&&xe(m))&&(this.basePTS=Xe(m,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),a&&a.length>0&&g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:we.audioId3,duration:Number.POSITIVE_INFINITY});u<E;){if(this.canParse(n,u)){var T=this.appendFrame(h,n,u);T?(this.frameIndex++,this.lastPTS=T.sample.pts,u+=T.length,f=u):u=E}else B(n,u)?(a=ia(n,u),g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:we.audioId3,duration:Number.POSITIVE_INFINITY}),u+=a.length,f=u):u++;if(u===E&&f!==E){var A=n.slice(f);this.cachedData?this.cachedData=Xr(this.cachedData,A):this.cachedData=A}}return{audioTrack:h,videoTrack:Fe(),id3Track:g,textTrack:Fe()}},c.demuxSampleAes=function(n,e,a){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},c.flush=function(n){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Fe(),id3Track:this._id3Track,textTrack:Fe()}},c.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},l}(),Xe=function(c,s,n){if(xe(c))return c*90;var e=n?n.baseTime*9e4/n.timescale:0;return s*9e4+e},mt=null,At=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ct=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],gn=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],bt=[0,1,1,4];function wr(l,c,s,n,e){if(!(s+24>c.length)){var a=Ir(c,s);if(a&&s+a.frameLength<=c.length){var u=a.samplesPerFrame*9e4/a.sampleRate,f=n+e*u,h={unit:c.subarray(s,s+a.frameLength),pts:f,dts:f};return l.config=[],l.channelCount=a.channelCount,l.samplerate=a.sampleRate,l.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}}function Ir(l,c){var s=l[c+1]>>3&3,n=l[c+1]>>1&3,e=l[c+2]>>4&15,a=l[c+2]>>2&3;if(s!==1&&e!==0&&e!==15&&a!==3){var u=l[c+2]>>1&1,f=l[c+3]>>6,h=s===3?3-n:n===3?3:4,g=At[h*14+e-1]*1e3,m=s===3?0:s===2?1:2,E=Ct[m*3+a],T=f===3?1:2,A=gn[s][n],L=bt[n],k=A*8*L,I=Math.floor(A*g/E+u)*L;if(mt===null){var D=navigator.userAgent||"",U=D.match(/Chrome\/(\d+)/i);mt=U?parseInt(U[1]):0}var K=!!mt&&mt<=87;return K&&n===2&&g>=224e3&&f===0&&(l[c+3]=l[c+3]|128),{sampleRate:E,channelCount:T,frameLength:I,samplesPerFrame:k}}}function aa(l,c){return l[c]===255&&(l[c+1]&224)===224&&(l[c+1]&6)!==0}function jr(l,c){return c+1<l.length&&aa(l,c)}function Pi(l,c){var s=4;return aa(l,c)&&s<=l.length-c}function vs(l,c){if(c+1<l.length&&aa(l,c)){var s=4,n=Ir(l,c),e=s;n!=null&&n.frameLength&&(e=n.frameLength);var a=c+e;return a===l.length||jr(l,a)}return!1}var Bv=function(l){function c(n,e){var a;return a=l.call(this)||this,a.observer=void 0,a.config=void 0,a.observer=n,a.config=e,a}P(c,l);var s=c.prototype;return s.resetInitSegment=function(e,a,u,f){l.prototype.resetInitSegment.call(this,e,a,u,f),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:a,duration:f,inputTimeScale:9e4,dropped:0}},c.probe=function(e,a){if(!e)return!1;var u=ia(e,0),f=u?.length||0;if(vs(e,f))return!1;for(var h=e.length;f<h;f++)if(y(e,f))return a.log("ADTS sync word found !"),!0;return!1},s.canParse=function(e,a){return v(e,a)},s.appendFrame=function(e,a,u){S(e,this.observer,a,u,e.manifestCodec);var f=M(e,a,u,this.basePTS,this.frameIndex);if(f&&f.missing===0)return f},c}(Ue),Uv=function(c,s){var n=0,e=5;s+=e;for(var a=new Uint32Array(1),u=new Uint32Array(1),f=new Uint8Array(1);e>0;){f[0]=c[s];var h=Math.min(e,8),g=8-h;u[0]=4278190080>>>24+g<<g,a[0]=(f[0]&u[0])>>g,n=n?n<<h|a[0]:a[0],s+=1,e-=h}return n},Gv=function(l){function c(){return l.apply(this,arguments)||this}P(c,l);var s=c.prototype;return s.resetInitSegment=function(e,a,u,f){l.prototype.resetInitSegment.call(this,e,a,u,f),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:a,duration:f,inputTimeScale:9e4,dropped:0}},c.probe=function(e){if(!e)return!1;var a=ia(e,0),u=a?.length||0;if(a&&e[u]===11&&e[u+1]===119&&Oe(a)!==void 0&&Uv(e,u)<=16)return!1;for(var f=e.length;u<f;u++)if(vs(e,u))return tt.log("MPEG Audio sync word found !"),!0;return!1},s.canParse=function(e,a){return Pi(e,a)},s.appendFrame=function(e,a,u){if(this.basePTS!==null)return wr(e,a,u,this.basePTS,this.frameIndex)},c}(Ue),jv=function(){function l(s,n,e){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=s,this.aesIV=n,this.aesMode=e}var c=l.prototype;return c.decrypt=function(n,e){switch(this.aesMode){case wn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,n);case wn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,n);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},l}();function Vv(l){var c=l.byteLength,s=c&&new DataView(l.buffer).getUint8(c-1);return s?l.slice(0,c-s):l}var Kv=function(){function l(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var c=l.prototype;return c.uint8ArrayToUint32Array_=function(n){for(var e=new DataView(n),a=new Uint32Array(4),u=0;u<4;u++)a[u]=e.getUint32(u*4);return a},c.initTable=function(){var n=this.sBox,e=this.invSBox,a=this.subMix,u=a[0],f=a[1],h=a[2],g=a[3],m=this.invSubMix,E=m[0],T=m[1],A=m[2],L=m[3],k=new Uint32Array(256),I=0,D=0,U=0;for(U=0;U<256;U++)U<128?k[U]=U<<1:k[U]=U<<1^283;for(U=0;U<256;U++){var K=D^D<<1^D<<2^D<<3^D<<4;K=K>>>8^K&255^99,n[I]=K,e[K]=I;var G=k[I],j=k[G],ie=k[j],se=k[K]*257^K*16843008;u[I]=se<<24|se>>>8,f[I]=se<<16|se>>>16,h[I]=se<<8|se>>>24,g[I]=se,se=ie*16843009^j*65537^G*257^I*16843008,E[K]=se<<24|se>>>8,T[K]=se<<16|se>>>16,A[K]=se<<8|se>>>24,L[K]=se,I?(I=G^k[k[k[ie^G]]],D^=k[k[D]]):I=D=1}},c.expandKey=function(n){for(var e=this.uint8ArrayToUint32Array_(n),a=!0,u=0;u<e.length&&a;)a=e[u]===this.key[u],u++;if(!a){this.key=e;var f=this.keySize=e.length;if(f!==4&&f!==6&&f!==8)throw new Error("Invalid aes key size="+f);var h=this.ksRows=(f+6+1)*4,g,m,E=this.keySchedule=new Uint32Array(h),T=this.invKeySchedule=new Uint32Array(h),A=this.sBox,L=this.rcon,k=this.invSubMix,I=k[0],D=k[1],U=k[2],K=k[3],G,j;for(g=0;g<h;g++){if(g<f){G=E[g]=e[g];continue}j=G,g%f===0?(j=j<<8|j>>>24,j=A[j>>>24]<<24|A[j>>>16&255]<<16|A[j>>>8&255]<<8|A[j&255],j^=L[g/f|0]<<24):f>6&&g%f===4&&(j=A[j>>>24]<<24|A[j>>>16&255]<<16|A[j>>>8&255]<<8|A[j&255]),E[g]=G=(E[g-f]^j)>>>0}for(m=0;m<h;m++)g=h-m,m&3?j=E[g]:j=E[g-4],m<4||g<=4?T[m]=j:T[m]=I[A[j>>>24]]^D[A[j>>>16&255]]^U[A[j>>>8&255]]^K[A[j&255]],T[m]=T[m]>>>0}},c.networkToHostOrderSwap=function(n){return n<<24|(n&65280)<<8|(n&16711680)>>8|n>>>24},c.decrypt=function(n,e,a){for(var u=this.keySize+6,f=this.invKeySchedule,h=this.invSBox,g=this.invSubMix,m=g[0],E=g[1],T=g[2],A=g[3],L=this.uint8ArrayToUint32Array_(a),k=L[0],I=L[1],D=L[2],U=L[3],K=new Int32Array(n),G=new Int32Array(K.length),j,ie,se,he,ve,ge,de,ue,Ae,je,Re,Ie,$e,Ze,Qe=this.networkToHostOrderSwap;e<K.length;){for(Ae=Qe(K[e]),je=Qe(K[e+1]),Re=Qe(K[e+2]),Ie=Qe(K[e+3]),ve=Ae^f[0],ge=Ie^f[1],de=Re^f[2],ue=je^f[3],$e=4,Ze=1;Ze<u;Ze++)j=m[ve>>>24]^E[ge>>16&255]^T[de>>8&255]^A[ue&255]^f[$e],ie=m[ge>>>24]^E[de>>16&255]^T[ue>>8&255]^A[ve&255]^f[$e+1],se=m[de>>>24]^E[ue>>16&255]^T[ve>>8&255]^A[ge&255]^f[$e+2],he=m[ue>>>24]^E[ve>>16&255]^T[ge>>8&255]^A[de&255]^f[$e+3],ve=j,ge=ie,de=se,ue=he,$e=$e+4;j=h[ve>>>24]<<24^h[ge>>16&255]<<16^h[de>>8&255]<<8^h[ue&255]^f[$e],ie=h[ge>>>24]<<24^h[de>>16&255]<<16^h[ue>>8&255]<<8^h[ve&255]^f[$e+1],se=h[de>>>24]<<24^h[ue>>16&255]<<16^h[ve>>8&255]<<8^h[ge&255]^f[$e+2],he=h[ue>>>24]<<24^h[ve>>16&255]<<16^h[ge>>8&255]<<8^h[de&255]^f[$e+3],G[e]=Qe(j^k),G[e+1]=Qe(he^I),G[e+2]=Qe(se^D),G[e+3]=Qe(ie^U),k=Ae,I=je,D=Re,U=Ie,e=e+4}return G.buffer},l}(),Hv=function(){function l(s,n,e){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=s,this.key=n,this.aesMode=e}var c=l.prototype;return c.expandKey=function(){var n=qv(this.aesMode);return this.subtle.importKey("raw",this.key,{name:n},!1,["encrypt","decrypt"])},l}();function qv(l){switch(l){case wn.cbc:return"AES-CBC";case wn.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+l)}}var Wv=16,mu=function(){function l(s,n){var e=n===void 0?{}:n,a=e.removePKCS7Padding,u=a===void 0?!0:a;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=s.enableSoftwareAES,this.removePKCS7Padding=u,u)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var c=l.prototype;return c.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},c.isSync=function(){return this.useSoftware},c.flush=function(){var n=this.currentResult,e=this.remainderData;if(!n||e)return this.reset(),null;var a=new Uint8Array(n);return this.reset(),this.removePKCS7Padding?Vv(a):a},c.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},c.decrypt=function(n,e,a,u){var f=this;return this.useSoftware?new Promise(function(h,g){var m=ArrayBuffer.isView(n)?n:new Uint8Array(n);f.softwareDecrypt(m,e,a,u);var E=f.flush();E?h(E.buffer):g(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(n),e,a,u)},c.softwareDecrypt=function(n,e,a,u){var f=this.currentIV,h=this.currentResult,g=this.remainderData;if(u!==wn.cbc||e.byteLength!==16)return tt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),g&&(n=Xr(g,n),this.remainderData=null);var m=this.getValidChunk(n);if(!m.length)return null;f&&(a=f);var E=this.softwareDecrypter;E||(E=this.softwareDecrypter=new Kv),E.expandKey(e);var T=h;return this.currentResult=E.decrypt(m.buffer,0,a),this.currentIV=m.slice(-16).buffer,T||null},c.webCryptoDecrypt=function(n,e,a,u){var f=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(n,e,a,u));this.key=e,this.fastAesKey=new Hv(this.subtle,e,u)}return this.fastAesKey.expandKey().then(function(h){if(!f.subtle)return Promise.reject(new Error("web crypto not initialized"));f.logOnce("WebCrypto AES decrypt");var g=new jv(f.subtle,new Uint8Array(a),u);return g.decrypt(n.buffer,h)}).catch(function(h){return tt.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+h.name+": "+h.message),f.onWebCryptoError(n,e,a,u)})},c.onWebCryptoError=function(n,e,a,u){var f=this.enableSoftwareAES;if(f){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(n,e,a,u);var h=this.flush();if(h)return h.buffer}throw new Error("WebCrypto"+(f?" and softwareDecrypt":"")+": failed to decrypt data")},c.getValidChunk=function(n){var e=n,a=n.length-n.length%Wv;return a!==n.length&&(e=n.slice(0,a),this.remainderData=n.slice(a)),e},c.logOnce=function(n){this.logEnabled&&(tt.log("[decrypter]: "+n),this.logEnabled=!1)},l}(),Yv=/\/emsg[-/]ID3/i,zv=function(){function l(s,n){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}var c=l.prototype;return c.resetTimeStamp=function(){},c.resetInitSegment=function(n,e,a,u){var f=this.videoTrack=Fe("video",1),h=this.audioTrack=Fe("audio",1),g=this.txtTrack=Fe("text",1);if(this.id3Track=Fe("id3",1),this.timeOffset=0,!!(n!=null&&n.byteLength)){var m=rr(n);if(m.video){var E=m.video,T=E.id,A=E.timescale,L=E.codec,k=E.supplemental;f.id=T,f.timescale=g.timescale=A,f.codec=L,f.supplemental=k}if(m.audio){var I=m.audio,D=I.id,U=I.timescale,K=I.codec;h.id=D,h.timescale=U,h.codec=K}g.id=Fr.text,f.sampleDuration=0,f.duration=h.duration=u}},c.resetContiguity=function(){this.remainderData=null},l.probe=function(n){return Pe(n)},c.demux=function(n,e){this.timeOffset=e;var a=n,u=this.videoTrack,f=this.txtTrack;if(this.config.progressive){this.remainderData&&(a=Xr(this.remainderData,n));var h=nr(a);this.remainderData=h.remainder,u.samples=h.valid||new Uint8Array}else u.samples=a;var g=this.extractID3Track(u,e);return f.samples=Li(e,u),{videoTrack:u,audioTrack:this.audioTrack,id3Track:g,textTrack:this.txtTrack}},c.flush=function(){var n=this.timeOffset,e=this.videoTrack,a=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var u=this.extractID3Track(e,this.timeOffset);return a.samples=Li(n,e),{videoTrack:e,audioTrack:Fe(),id3Track:u,textTrack:Fe()}},c.extractID3Track=function(n,e){var a=this,u=this.id3Track;if(n.samples.length){var f=De(n.samples,["emsg"]);f&&f.forEach(function(h){var g=ui(h);if(Yv.test(g.schemeIdUri)){var m=vf(g,e),E=g.eventDuration===4294967295?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;E<=.001&&(E=Number.POSITIVE_INFINITY);var T=g.payload;u.samples.push({data:T,len:T.byteLength,dts:m,pts:m,type:we.emsg,duration:E})}else if(a.config.enableEmsgKLVMetadata&&g.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var A=vf(g,e);u.samples.push({data:g.payload,len:g.payload.byteLength,dts:A,pts:A,type:we.misbklv,duration:Number.POSITIVE_INFINITY})}})}return u},c.demuxSampleAes=function(n,e,a){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},c.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},l}();function vf(l,c){return xe(l.presentationTime)?l.presentationTime/l.timeScale:c+l.presentationTimeDelta/l.timeScale}var $v=function(){function l(s,n,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new mu(n,{removePKCS7Padding:!1})}var c=l.prototype;return c.decryptBuffer=function(n){return this.decrypter.decrypt(n,this.keyData.key.buffer,this.keyData.iv.buffer,wn.cbc)},c.decryptAacSample=function(n,e,a){var u=this,f=n[e].unit;if(!(f.length<=16)){var h=f.subarray(16,f.length-f.length%16),g=h.buffer.slice(h.byteOffset,h.byteOffset+h.length);this.decryptBuffer(g).then(function(m){var E=new Uint8Array(m);f.set(E,16),u.decrypter.isSync()||u.decryptAacSamples(n,e+1,a)})}},c.decryptAacSamples=function(n,e,a){for(;;e++){if(e>=n.length){a();return}if(!(n[e].unit.length<32)&&(this.decryptAacSample(n,e,a),!this.decrypter.isSync()))return}},c.getAvcEncryptedData=function(n){for(var e=Math.floor((n.length-48)/160)*16+16,a=new Int8Array(e),u=0,f=32;f<n.length-16;f+=160,u+=16)a.set(n.subarray(f,f+16),u);return a},c.getAvcDecryptedUnit=function(n,e){for(var a=new Uint8Array(e),u=0,f=32;f<n.length-16;f+=160,u+=16)n.set(a.subarray(u,u+16),f);return n},c.decryptAvcSample=function(n,e,a,u,f){var h=this,g=vn(f.data),m=this.getAvcEncryptedData(g);this.decryptBuffer(m.buffer).then(function(E){f.data=h.getAvcDecryptedUnit(g,E),h.decrypter.isSync()||h.decryptAvcSamples(n,e,a+1,u)})},c.decryptAvcSamples=function(n,e,a,u){if(n instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,a=0){if(e>=n.length){u();return}for(var f=n[e].units;!(a>=f.length);a++){var h=f[a];if(!(h.data.length<=48||h.type!==1&&h.type!==5)&&(this.decryptAvcSample(n,e,a,u,h),!this.decrypter.isSync()))return}}},l}(),Xv=function(){function l(){this.VideoSample=null}var c=l.prototype;return c.createVideoSample=function(n,e,a){return{key:n,frame:!1,pts:e,dts:a,units:[],length:0}},c.getLastNalUnit=function(n){var e,a=this.VideoSample,u;if((!a||a.units.length===0)&&(a=n[n.length-1]),(e=a)!=null&&e.units){var f=a.units;u=f[f.length-1]}return u},c.pushAccessUnit=function(n,e){if(n.units.length&&n.frame){if(n.pts===void 0){var a=e.samples,u=a.length;if(u){var f=a[u-1];n.pts=f.pts,n.dts=f.dts}else{e.dropped++;return}}e.samples.push(n)}},c.parseNALu=function(n,e,a){var u=e.byteLength,f=n.naluState||0,h=f,g=[],m=0,E,T,A,L=-1,k=0;for(f===-1&&(L=0,k=this.getNALuType(e,0),f=0,m=1);m<u;){if(E=e[m++],!f){f=E?0:1;continue}if(f===1){f=E?0:2;continue}if(!E)f=3;else if(E===1){if(T=m-f-1,L>=0){var I={data:e.subarray(L,T),type:k};g.push(I)}else{var D=this.getLastNalUnit(n.samples);D&&(h&&m<=4-h&&D.state&&(D.data=D.data.subarray(0,D.data.byteLength-h)),T>0&&(D.data=Xr(D.data,e.subarray(0,T)),D.state=0))}m<u?(A=this.getNALuType(e,m),L=m,k=A,f=0):f=-1}else f=0}if(L>=0&&f>=0){var U={data:e.subarray(L,u),type:k,state:f};g.push(U)}if(g.length===0){var K=this.getLastNalUnit(n.samples);K&&(K.data=Xr(K.data,e))}return n.naluState=f,g},l}(),gf=function(){function l(s){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=s,this.bytesAvailable=s.byteLength,this.word=0,this.bitsAvailable=0}var c=l.prototype;return c.loadWord=function(){var n=this.data,e=this.bytesAvailable,a=n.byteLength-e,u=new Uint8Array(4),f=Math.min(4,e);if(f===0)throw new Error("no bytes available");u.set(n.subarray(a,a+f)),this.word=new DataView(u.buffer).getUint32(0),this.bitsAvailable=f*8,this.bytesAvailable-=f},c.skipBits=function(n){var e;n=Math.min(n,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>n?(this.word<<=n,this.bitsAvailable-=n):(n-=this.bitsAvailable,e=n>>3,n-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=n,this.bitsAvailable-=n)},c.readBits=function(n){var e=Math.min(this.bitsAvailable,n),a=this.word>>>32-e;if(n>32&&tt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=n-e,e>0&&this.bitsAvailable?a<<e|this.readBits(e):a},c.skipLZ=function(){var n;for(n=0;n<this.bitsAvailable;++n)if((this.word&2147483648>>>n)!==0)return this.word<<=n,this.bitsAvailable-=n,n;return this.loadWord(),n+this.skipLZ()},c.skipUEG=function(){this.skipBits(1+this.skipLZ())},c.skipEG=function(){this.skipBits(1+this.skipLZ())},c.readUEG=function(){var n=this.skipLZ();return this.readBits(n+1)-1},c.readEG=function(){var n=this.readUEG();return 1&n?1+n>>>1:-1*(n>>>1)},c.readBoolean=function(){return this.readBits(1)===1},c.readUByte=function(){return this.readBits(8)},c.readUShort=function(){return this.readBits(16)},c.readUInt=function(){return this.readBits(32)},l}(),Qv=function(l){function c(){return l.apply(this,arguments)||this}P(c,l);var s=c.prototype;return s.parsePES=function(e,a,u,f){var h=this,g=this.parseNALu(e,u.data,f),m=this.VideoSample,E,T=!1;u.data=null,m&&g.length&&!e.audFound&&(this.pushAccessUnit(m,e),m=this.VideoSample=this.createVideoSample(!1,u.pts,u.dts)),g.forEach(function(A){var L,k;switch(A.type){case 1:{var I=!1;E=!0;var D=A.data;if(T&&D.length>4){var U=h.readSliceType(D);(U===2||U===4||U===7||U===9)&&(I=!0)}if(I){var K;(K=m)!=null&&K.frame&&!m.key&&(h.pushAccessUnit(m,e),m=h.VideoSample=null)}m||(m=h.VideoSample=h.createVideoSample(!0,u.pts,u.dts)),m.frame=!0,m.key=I;break}case 5:E=!0,(L=m)!=null&&L.frame&&!m.key&&(h.pushAccessUnit(m,e),m=h.VideoSample=null),m||(m=h.VideoSample=h.createVideoSample(!0,u.pts,u.dts)),m.key=!0,m.frame=!0;break;case 6:{E=!0,li(A.data,1,u.pts,a.samples);break}case 7:{var G,j;E=!0,T=!0;var ie=A.data,se=h.readSPS(ie);if(!e.sps||e.width!==se.width||e.height!==se.height||((G=e.pixelRatio)==null?void 0:G[0])!==se.pixelRatio[0]||((j=e.pixelRatio)==null?void 0:j[1])!==se.pixelRatio[1]){e.width=se.width,e.height=se.height,e.pixelRatio=se.pixelRatio,e.sps=[ie];for(var he=ie.subarray(1,4),ve="avc1.",ge=0;ge<3;ge++){var de=he[ge].toString(16);de.length<2&&(de="0"+de),ve+=de}e.codec=ve}break}case 8:E=!0,e.pps=[A.data];break;case 9:E=!0,e.audFound=!0,(k=m)!=null&&k.frame&&(h.pushAccessUnit(m,e),m=null),m||(m=h.VideoSample=h.createVideoSample(!1,u.pts,u.dts));break;case 12:E=!0;break;default:E=!1;break}if(m&&E){var ue=m.units;ue.push(A)}}),f&&m&&(this.pushAccessUnit(m,e),this.VideoSample=null)},s.getNALuType=function(e,a){return e[a]&31},s.readSliceType=function(e){var a=new gf(e);return a.readUByte(),a.readUEG(),a.readUEG()},s.skipScalingList=function(e,a){for(var u=8,f=8,h,g=0;g<e;g++)f!==0&&(h=a.readEG(),f=(u+h+256)%256),u=f===0?u:f},s.readSPS=function(e){var a=new gf(e),u=0,f=0,h=0,g=0,m,E,T,A=a.readUByte.bind(a),L=a.readBits.bind(a),k=a.readUEG.bind(a),I=a.readBoolean.bind(a),D=a.skipBits.bind(a),U=a.skipEG.bind(a),K=a.skipUEG.bind(a),G=this.skipScalingList.bind(this);A();var j=A();if(L(5),D(3),A(),K(),j===100||j===110||j===122||j===244||j===44||j===83||j===86||j===118||j===128){var ie=k();if(ie===3&&D(1),K(),K(),D(1),I())for(E=ie!==3?8:12,T=0;T<E;T++)I()&&(T<6?G(16,a):G(64,a))}K();var se=k();if(se===0)k();else if(se===1)for(D(1),U(),U(),m=k(),T=0;T<m;T++)U();K(),D(1);var he=k(),ve=k(),ge=L(1);ge===0&&D(1),D(1),I()&&(u=k(),f=k(),h=k(),g=k());var de=[1,1];if(I()&&I()){var ue=A();switch(ue){case 1:de=[1,1];break;case 2:de=[12,11];break;case 3:de=[10,11];break;case 4:de=[16,11];break;case 5:de=[40,33];break;case 6:de=[24,11];break;case 7:de=[20,11];break;case 8:de=[32,11];break;case 9:de=[80,33];break;case 10:de=[18,11];break;case 11:de=[15,11];break;case 12:de=[64,33];break;case 13:de=[160,99];break;case 14:de=[4,3];break;case 15:de=[3,2];break;case 16:de=[2,1];break;case 255:{de=[A()<<8|A(),A()<<8|A()];break}}}return{width:Math.ceil((he+1)*16-u*2-f*2),height:(2-ge)*(ve+1)*16-(ge?2:4)*(h+g),pixelRatio:de}},c}(Xv),Vr=188,Jv=function(){function l(s,n,e,a){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=s,this.config=n,this.typeSupported=e,this.logger=a,this.videoParser=null}l.probe=function(n,e){var a=l.syncOffset(n);return a>0&&e.warn("MPEG2-TS detected but first sync word found @ offset "+a),a!==-1},l.syncOffset=function(n){for(var e=n.length,a=Math.min(Vr*5,e-Vr)+1,u=0;u<a;){for(var f=!1,h=-1,g=0,m=u;m<e;m+=Vr)if(n[m]===71&&(e-m===Vr||n[m+Vr]===71)){if(g++,h===-1&&(h=m,h!==0&&(a=Math.min(h+Vr*99,n.length-Vr)+1)),f||(f=yu(n,m)===0),f&&g>1&&(h===0&&g>2||m+Vr>a))return h}else{if(g)return-1;break}u++}return-1},l.createTrack=function(n,e){return{container:n==="video"||n==="audio"?"video/mp2t":void 0,type:n,id:Fr[n],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:n==="audio"?e:void 0}};var c=l.prototype;return c.resetInitSegment=function(n,e,a,u){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=l.createTrack("video"),this._videoTrack.duration=u,this._audioTrack=l.createTrack("audio",u),this._id3Track=l.createTrack("id3"),this._txtTrack=l.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=a},c.resetTimeStamp=function(){},c.resetContiguity=function(){var n=this._audioTrack,e=this._videoTrack,a=this._id3Track;n&&(n.pesData=null),e&&(e.pesData=null),a&&(a.pesData=null),this.aacOverFlow=null,this.remainderData=null},c.demux=function(n,e,a,u){a===void 0&&(a=!1),u===void 0&&(u=!1),a||(this.sampleAes=null);var f,h=this._videoTrack,g=this._audioTrack,m=this._id3Track,E=this._txtTrack,T=h.pid,A=h.pesData,L=g.pid,k=m.pid,I=g.pesData,D=m.pesData,U=null,K=this.pmtParsed,G=this._pmtId,j=n.length;if(this.remainderData&&(n=Xr(this.remainderData,n),j=n.length,this.remainderData=null),j<Vr&&!u)return this.remainderData=n,{audioTrack:g,videoTrack:h,id3Track:m,textTrack:E};var ie=Math.max(0,l.syncOffset(n));j-=(j-ie)%Vr,j<n.byteLength&&!u&&(this.remainderData=new Uint8Array(n.buffer,j,n.buffer.byteLength-j));for(var se=0,he=ie;he<j;he+=Vr)if(n[he]===71){var ve=!!(n[he+1]&64),ge=yu(n,he),de=(n[he+3]&48)>>4,ue=void 0;if(de>1){if(ue=he+5+n[he+4],ue===he+Vr)continue}else ue=he+4;switch(ge){case T:ve&&(A&&(f=gs(A,this.logger))&&(this.readyVideoParser(h.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(h,E,f,!1)),A={data:[],size:0}),A&&(A.data.push(n.subarray(ue,he+Vr)),A.size+=he+Vr-ue);break;case L:if(ve){if(I&&(f=gs(I,this.logger)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,f);break;case"mp3":this.parseMPEGPES(g,f);break}I={data:[],size:0}}I&&(I.data.push(n.subarray(ue,he+Vr)),I.size+=he+Vr-ue);break;case k:ve&&(D&&(f=gs(D,this.logger))&&this.parseID3PES(m,f),D={data:[],size:0}),D&&(D.data.push(n.subarray(ue,he+Vr)),D.size+=he+Vr-ue);break;case 0:ve&&(ue+=n[ue]+1),G=this._pmtId=Zv(n,ue);break;case G:{ve&&(ue+=n[ue]+1);var Ae=eg(n,ue,this.typeSupported,a,this.observer,this.logger);T=Ae.videoPid,T>0&&(h.pid=T,h.segmentCodec=Ae.segmentVideoCodec),L=Ae.audioPid,L>0&&(g.pid=L,g.segmentCodec=Ae.segmentAudioCodec),k=Ae.id3Pid,k>0&&(m.pid=k),U!==null&&!K&&(this.logger.warn("MPEG-TS PMT found at "+he+" after unknown PID '"+U+"'. Backtracking to sync byte @"+ie+" to parse all TS packets."),U=null,he=ie-188),K=this.pmtParsed=!0;break}case 17:case 8191:break;default:U=ge;break}}else se++;se>0&&ll(this.observer,new Error("Found "+se+" TS packet/s that do not start with 0x47"),void 0,this.logger),h.pesData=A,g.pesData=I,m.pesData=D;var je={audioTrack:g,videoTrack:h,id3Track:m,textTrack:E};return u&&this.extractRemainingSamples(je),je},c.flush=function(){var n=this.remainderData;this.remainderData=null;var e;return n?e=this.demux(n,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},c.extractRemainingSamples=function(n){var e=n.audioTrack,a=n.videoTrack,u=n.id3Track,f=n.textTrack,h=a.pesData,g=e.pesData,m=u.pesData,E;if(h&&(E=gs(h,this.logger))?(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(a,f,E,!0),a.pesData=null)):a.pesData=h,g&&(E=gs(g,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,E);break;case"mp3":this.parseMPEGPES(e,E);break}e.pesData=null}else g!=null&&g.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=g;m&&(E=gs(m,this.logger))?(this.parseID3PES(u,E),u.pesData=null):u.pesData=m},c.demuxSampleAes=function(n,e,a){var u=this.demux(n,a,!0,!this.config.progressive),f=this.sampleAes=new $v(this.observer,this.config,e);return this.decrypt(u,f)},c.readyVideoParser=function(n){this.videoParser===null&&n==="avc"&&(this.videoParser=new Qv)},c.decrypt=function(n,e){return new Promise(function(a){var u=n.audioTrack,f=n.videoTrack;u.samples&&u.segmentCodec==="aac"?e.decryptAacSamples(u.samples,0,function(){f.samples?e.decryptAvcSamples(f.samples,0,0,function(){a(n)}):a(n)}):f.samples&&e.decryptAvcSamples(f.samples,0,0,function(){a(n)})})},c.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},c.parseAACPES=function(n,e){var a=0,u=this.aacOverFlow,f=e.data;if(u){this.aacOverFlow=null;var h=u.missing,g=u.sample.unit.byteLength;if(h===-1)f=Xr(u.sample.unit,f);else{var m=g-h;u.sample.unit.set(f.subarray(0,h),m),n.samples.push(u.sample),a=u.missing}}var E,T;for(E=a,T=f.length;E<T-1&&!Ca(f,E);E++);if(E!==a){var A,L=E<T-1;if(L?A="AAC PES did not start with ADTS header,offset:"+E:A="No ADTS header found in AAC PES",ll(this.observer,new Error(A),L,this.logger),!L)return}S(n,this.observer,f,E,this.audioCodec);var k;if(e.pts!==void 0)k=e.pts;else if(u){var I=C(n.samplerate);k=u.sample.pts+I}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var D=0,U;E<T;)if(U=M(n,f,E,k,D),E+=U.length,U.missing){this.aacOverFlow=U;break}else for(D++;E<T-1&&!Ca(f,E);E++);},c.parseMPEGPES=function(n,e){var a=e.data,u=a.length,f=0,h=0,g=e.pts;if(g===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<u;)if(jr(a,h)){var m=wr(n,a,h,g,f);if(m)h+=m.length,f++;else break}else h++},c.parseAC3PES=function(n,e){},c.parseID3PES=function(n,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var a=x({},e,{type:this._videoTrack?we.emsg:we.audioId3,duration:Number.POSITIVE_INFINITY});n.samples.push(a)},l}();function yu(l,c){return((l[c+1]&31)<<8)+l[c+2]}function Zv(l,c){return(l[c+10]&31)<<8|l[c+11]}function eg(l,c,s,n,e,a){var u={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},f=(l[c+1]&15)<<8|l[c+2],h=c+3+f-4,g=(l[c+10]&15)<<8|l[c+11];for(c+=12+g;c<h;){var m=yu(l,c),E=(l[c+3]&15)<<8|l[c+4];switch(l[c]){case 207:if(!n){bu("ADTS AAC",a);break}case 15:u.audioPid===-1&&(u.audioPid=m);break;case 21:u.id3Pid===-1&&(u.id3Pid=m);break;case 219:if(!n){bu("H.264",a);break}case 27:u.videoPid===-1&&(u.videoPid=m);break;case 3:case 4:!s.mpeg&&!s.mp3?a.log("MPEG audio found, not supported in this browser"):u.audioPid===-1&&(u.audioPid=m,u.segmentAudioCodec="mp3");break;case 193:if(!n){bu("AC-3",a);break}case 129:a.warn("AC-3 in M2TS support not included in build");break;case 6:if(u.audioPid===-1&&E>0)for(var T=c+5,A=E;A>2;){var L=l[T];switch(L){case 106:a.warn("AC-3 in M2TS support not included in build");break}var k=l[T+1]+2;T+=k,A-=k}break;case 194:case 135:return ll(e,new Error("Unsupported EC-3 in M2TS found"),void 0,a),u;case 36:return ll(e,new Error("Unsupported HEVC in M2TS found"),void 0,a),u}c+=E+5}return u}function ll(l,c,s,n){n.warn("parsing error: "+c.message),l.emit(N.ERROR,N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:c,reason:c.message})}function bu(l,c){c.log(l+" with AES-128-CBC encryption found in unencrypted stream")}function gs(l,c){var s=0,n,e,a,u,f,h=l.data;if(!l||l.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Xr(h[0],h[1]),h.splice(1,1);n=h[0];var g=(n[0]<<16)+(n[1]<<8)+n[2];if(g===1){if(e=(n[4]<<8)+n[5],e&&e>l.size-6)return null;var m=n[7];m&192&&(u=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,m&64?(f=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,u-f>60*9e4&&(c.warn(Math.round((u-f)/9e4)+"s delta between PTS and DTS, align them"),u=f)):f=u),a=n[8];var E=a+9;if(l.size<=E)return null;l.size-=E;for(var T=new Uint8Array(l.size),A=0,L=h.length;A<L;A++){n=h[A];var k=n.byteLength;if(E)if(E>k){E-=k;continue}else n=n.subarray(E),k-=E,E=0;T.set(n,s),s+=k}return e&&(e-=a+3),{data:T,pts:u,dts:f,len:e}}return null}var tg=function(){function l(){}return l.getSilentFrame=function(s,n){switch(s){case"mp4a.40.2":if(n===1)return new Uint8Array([0,200,0,128,35,128]);if(n===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(n===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(n===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(n===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(n===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(n===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},l}(),sa=Math.pow(2,32)-1,Zr=function(){function l(){}return l.init=function(){l.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var s;for(s in l.types)l.types.hasOwnProperty(s)&&(l.types[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);l.HDLR_TYPES={video:n,audio:e};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),u=new Uint8Array([0,0,0,0,0,0,0,0]);l.STTS=l.STSC=l.STCO=u,l.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),l.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),l.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),l.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var f=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),g=new Uint8Array([0,0,0,1]);l.FTYP=l.box(l.types.ftyp,f,g,f,h),l.DINF=l.box(l.types.dinf,l.box(l.types.dref,a))},l.box=function(s){for(var n=8,e=arguments.length,a=new Array(e>1?e-1:0),u=1;u<e;u++)a[u-1]=arguments[u];for(var f=a.length,h=f;f--;)n+=a[f].byteLength;var g=new Uint8Array(n);for(g[0]=n>>24&255,g[1]=n>>16&255,g[2]=n>>8&255,g[3]=n&255,g.set(s,4),f=0,n=8;f<h;f++)g.set(a[f],n),n+=a[f].byteLength;return g},l.hdlr=function(s){return l.box(l.types.hdlr,l.HDLR_TYPES[s])},l.mdat=function(s){return l.box(l.types.mdat,s)},l.mdhd=function(s,n){n*=s;var e=Math.floor(n/(sa+1)),a=Math.floor(n%(sa+1));return l.box(l.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,e>>24,e>>16&255,e>>8&255,e&255,a>>24,a>>16&255,a>>8&255,a&255,85,196,0,0]))},l.mdia=function(s){return l.box(l.types.mdia,l.mdhd(s.timescale||0,s.duration||0),l.hdlr(s.type),l.minf(s))},l.mfhd=function(s){return l.box(l.types.mfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255]))},l.minf=function(s){return s.type==="audio"?l.box(l.types.minf,l.box(l.types.smhd,l.SMHD),l.DINF,l.stbl(s)):l.box(l.types.minf,l.box(l.types.vmhd,l.VMHD),l.DINF,l.stbl(s))},l.moof=function(s,n,e){return l.box(l.types.moof,l.mfhd(s),l.traf(e,n))},l.moov=function(s){for(var n=s.length,e=[];n--;)e[n]=l.trak(s[n]);return l.box.apply(null,[l.types.moov,l.mvhd(s[0].timescale||0,s[0].duration||0)].concat(e).concat(l.mvex(s)))},l.mvex=function(s){for(var n=s.length,e=[];n--;)e[n]=l.trex(s[n]);return l.box.apply(null,[l.types.mvex].concat(e))},l.mvhd=function(s,n){n*=s;var e=Math.floor(n/(sa+1)),a=Math.floor(n%(sa+1)),u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,e>>24,e>>16&255,e>>8&255,e&255,a>>24,a>>16&255,a>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return l.box(l.types.mvhd,u)},l.sdtp=function(s){var n=s.samples||[],e=new Uint8Array(4+n.length),a,u;for(a=0;a<n.length;a++)u=n[a].flags,e[a+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return l.box(l.types.sdtp,e)},l.stbl=function(s){return l.box(l.types.stbl,l.stsd(s),l.box(l.types.stts,l.STTS),l.box(l.types.stsc,l.STSC),l.box(l.types.stsz,l.STSZ),l.box(l.types.stco,l.STCO))},l.avc1=function(s){var n=[],e=[],a,u,f;for(a=0;a<s.sps.length;a++)u=s.sps[a],f=u.byteLength,n.push(f>>>8&255),n.push(f&255),n=n.concat(Array.prototype.slice.call(u));for(a=0;a<s.pps.length;a++)u=s.pps[a],f=u.byteLength,e.push(f>>>8&255),e.push(f&255),e=e.concat(Array.prototype.slice.call(u));var h=l.box(l.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|s.sps.length].concat(n).concat([s.pps.length]).concat(e))),g=s.width,m=s.height,E=s.pixelRatio[0],T=s.pixelRatio[1];return l.box(l.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,l.box(l.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),l.box(l.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,T>>24,T>>16&255,T>>8&255,T&255])))},l.esds=function(s){var n=s.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(n,[6,1,2]))},l.audioStsd=function(s){var n=s.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s.channelCount||0,0,16,0,0,0,0,n>>8&255,n&255,0,0])},l.mp4a=function(s){return l.box(l.types.mp4a,l.audioStsd(s),l.box(l.types.esds,l.esds(s)))},l.mp3=function(s){return l.box(l.types[".mp3"],l.audioStsd(s))},l.ac3=function(s){return l.box(l.types["ac-3"],l.audioStsd(s),l.box(l.types.dac3,s.config))},l.stsd=function(s){var n=s.segmentCodec;if(s.type==="audio"){if(n==="aac")return l.box(l.types.stsd,l.STSD,l.mp4a(s));if(n==="mp3"&&s.codec==="mp3")return l.box(l.types.stsd,l.STSD,l.mp3(s))}else if(s.pps&&s.sps){if(n==="avc")return l.box(l.types.stsd,l.STSD,l.avc1(s))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+s.type+" segment codec ("+n+"/"+s.codec+")")},l.tkhd=function(s){var n=s.id,e=(s.duration||0)*(s.timescale||0),a=s.width||0,u=s.height||0,f=Math.floor(e/(sa+1)),h=Math.floor(e%(sa+1));return l.box(l.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,a&255,0,0,u>>8&255,u&255,0,0]))},l.traf=function(s,n){var e=l.sdtp(s),a=s.id,u=Math.floor(n/(sa+1)),f=Math.floor(n%(sa+1));return l.box(l.types.traf,l.box(l.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255])),l.box(l.types.tfdt,new Uint8Array([1,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,f>>24,f>>16&255,f>>8&255,f&255])),l.trun(s,e.length+16+20+8+16+8+8),e)},l.trak=function(s){return s.duration=s.duration||4294967295,l.box(l.types.trak,l.tkhd(s),l.mdia(s))},l.trex=function(s){var n=s.id;return l.box(l.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},l.trun=function(s,n){var e=s.samples||[],a=e.length,u=12+16*a,f=new Uint8Array(u),h,g,m,E,T,A;for(n+=8+u,f.set([s.type==="video"?1:0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255],0),h=0;h<a;h++)g=e[h],m=g.duration,E=g.size,T=g.flags,A=g.cts,f.set([m>>>24&255,m>>>16&255,m>>>8&255,m&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,T.isLeading<<2|T.dependsOn,T.isDependedOn<<6|T.hasRedundancy<<4|T.paddingValue<<1|T.isNonSync,T.degradPrio&61440,T.degradPrio&15,A>>>24&255,A>>>16&255,A>>>8&255,A&255],12+16*h);return l.box(l.types.trun,f)},l.initSegment=function(s){l.types||l.init();var n=l.moov(s),e=Xr(l.FTYP,n);return e},l.hvc1=function(s){return new Uint8Array},l}();Zr.types=void 0,Zr.HDLR_TYPES=void 0,Zr.STTS=void 0,Zr.STSC=void 0,Zr.STCO=void 0,Zr.STSZ=void 0,Zr.VMHD=void 0,Zr.SMHD=void 0,Zr.STSD=void 0,Zr.FTYP=void 0,Zr.DINF=void 0;var rg=9e4;function ng(l,c,s,n){var e=l*c*s;return Math.round(e)}function ao(l,c){return ng(l,1e3,1/rg)}var ig=10*1e3,ag=1024,sg=1152,og=1536,ms=null,Eu=null;function mf(l,c,s,n){return{duration:c,size:s,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}var _u=function(l){function c(n,e,a,u){var f;if(f=l.call(this,"mp4-remuxer",u)||this,f.observer=void 0,f.config=void 0,f.typeSupported=void 0,f.ISGenerated=!1,f._initPTS=null,f._initDTS=null,f.nextVideoTs=null,f.nextAudioTs=null,f.videoSampleDuration=null,f.isAudioContiguous=!1,f.isVideoContiguous=!1,f.videoTrackConfig=void 0,f.observer=n,f.config=e,f.typeSupported=a,f.ISGenerated=!1,ms===null){var h=navigator.userAgent||"",g=h.match(/Chrome\/(\d+)/i);ms=g?parseInt(g[1]):0}if(Eu===null){var m=navigator.userAgent.match(/Safari\/(\d+)/i);Eu=m?parseInt(m[1]):0}return f}P(c,l);var s=c.prototype;return s.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},s.resetTimeStamp=function(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e},s.resetNextTimestamp=function(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},s.resetInitSegment=function(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},s.getVideoStartPts=function(e){var a=!1,u=e[0].pts,f=e.reduce(function(h,g){var m=g.pts,E=m-h;return E<-4294967296&&(a=!0,m=Jn(m,u),E=m-h),E>0?h:m},u);return a&&this.debug("PTS rollover detected"),f},s.remux=function(e,a,u,f,h,g,m,E){var T,A,L,k,I,D,U=h,K=h,G=e.pid>-1,j=a.pid>-1,ie=a.samples.length,se=e.samples.length>0,he=m&&ie>0||ie>1,ve=(!G||se)&&(!j||he)||this.ISGenerated||m;if(ve){if(this.ISGenerated){var ge,de,ue,Ae,je=this.videoTrackConfig;(je&&(a.width!==je.width||a.height!==je.height||((ge=a.pixelRatio)==null?void 0:ge[0])!==((de=je.pixelRatio)==null?void 0:de[0])||((ue=a.pixelRatio)==null?void 0:ue[1])!==((Ae=je.pixelRatio)==null?void 0:Ae[1]))||!je&&he||this.nextAudioTs===null&&se)&&this.resetInitSegment()}this.ISGenerated||(L=this.generateIS(e,a,h,g));var Re=this.isVideoContiguous,Ie=-1,$e;if(he&&(Ie=lg(a.samples),!Re&&this.config.forceKeyFrameOnDiscontinuity))if(D=!0,Ie>0){this.warn("Dropped "+Ie+" out of "+ie+" video samples due to a missing keyframe");var Ze=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(Ie),a.dropped+=Ie,K+=(a.samples[0].pts-Ze)/a.inputTimeScale,$e=K}else Ie===-1&&(this.warn("No keyframe found out of "+ie+" video samples"),D=!1);if(this.ISGenerated){if(se&&he){var Qe=this.getVideoStartPts(a.samples),it=Jn(e.samples[0].pts,Qe)-Qe,xt=it/a.inputTimeScale;U+=Math.max(0,xt),K+=Math.max(0,-xt)}if(se){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),L=this.generateIS(e,a,h,g)),A=this.remuxAudio(e,U,this.isAudioContiguous,g,j||he||E===st.AUDIO?K:void 0),he){var at=A?A.endPTS-A.startPTS:0;a.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),L=this.generateIS(e,a,h,g)),T=this.remuxVideo(a,K,Re,at)}}else he&&(T=this.remuxVideo(a,K,Re,0));T&&(T.firstKeyFrame=Ie,T.independent=Ie!==-1,T.firstKeyFramePTS=$e)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(u.samples.length&&(I=yf(u,h,this._initPTS,this._initDTS)),f.samples.length&&(k=bf(f,h,this._initPTS))),{audio:A,video:T,initSegment:L,independent:D,text:k,id3:I}},s.generateIS=function(e,a,u,f){var h=e.samples,g=a.samples,m=this.typeSupported,E={},T=this._initPTS,A=!T||f,L="audio/mp4",k,I,D,U=-1;if(A&&(k=I=1/0),e.config&&h.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":m.mpeg?(L="audio/mpeg",e.codec=""):m.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}E.audio={id:"audio",container:L,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&m.mpeg?new Uint8Array(0):Zr.initSegment([e]),metadata:{channelCount:e.channelCount}},A&&(U=e.id,D=e.inputTimeScale,!T||D!==T.timescale?k=I=h[0].pts-Math.round(D*u):A=!1)}if(a.sps&&a.pps&&g.length){if(a.timescale=a.inputTimeScale,E.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:Zr.initSegment([a]),metadata:{width:a.width,height:a.height}},A)if(U=a.id,D=a.inputTimeScale,!T||D!==T.timescale){var K=this.getVideoStartPts(g),G=Math.round(D*u);I=Math.min(I,Jn(g[0].dts,K)-G),k=Math.min(k,K-G)}else A=!1;this.videoTrackConfig={width:a.width,height:a.height,pixelRatio:a.pixelRatio}}if(Object.keys(E).length)return this.ISGenerated=!0,A?(T&&this.warn("Timestamps at playlist time: "+(f?"":"~")+u+" "+k/D+" != initPTS: "+T.baseTime/T.timescale+" ("+T.baseTime+"/"+T.timescale+") trackId: "+T.trackId),this.log("Found initPTS at playlist time: "+u+" offset: "+k/D+" ("+k+"/"+D+") trackId: "+U),this._initPTS={baseTime:k,timescale:D,trackId:U},this._initDTS={baseTime:I,timescale:D,trackId:U}):k=D=void 0,{tracks:E,initPTS:k,timescale:D,trackId:U}},s.remuxVideo=function(e,a,u,f){var h=e.inputTimeScale,g=e.samples,m=[],E=g.length,T=this._initPTS,A=T.baseTime*h/T.timescale,L=this.nextVideoTs,k=8,I=this.videoSampleDuration,D,U,K=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,j=!1;if(!u||L===null){var ie=A+a*h,se=g[0].pts-Jn(g[0].dts,g[0].pts);ms&&L!==null&&Math.abs(ie-se-(L+A))<15e3?u=!0:L=ie-se-A}for(var he=L+A,ve=0;ve<E;ve++){var ge=g[ve];ge.pts=Jn(ge.pts,he),ge.dts=Jn(ge.dts,he),ge.dts<g[ve>0?ve-1:ve].dts&&(j=!0)}j&&g.sort(function(ml,Jf){var Cm=ml.dts-Jf.dts,Lm=ml.pts-Jf.pts;return Cm||Lm}),D=g[0].dts,U=g[g.length-1].dts;var de=U-D,ue=de?Math.round(de/(E-1)):I||e.inputTimeScale/30;if(u){var Ae=D-he,je=Ae>ue,Re=Ae<-1;if((je||Re)&&(je?this.warn((e.segmentCodec||"").toUpperCase()+": "+ao(Ae)+" ms ("+Ae+"dts) hole between fragments detected at "+a.toFixed(3)):this.warn((e.segmentCodec||"").toUpperCase()+": "+ao(-Ae)+" ms ("+Ae+"dts) overlapping between fragments detected at "+a.toFixed(3)),!Re||he>=g[0].pts||ms)){D=he;var Ie=g[0].pts-Ae;if(je)g[0].dts=D,g[0].pts=Ie;else for(var $e=!0,Ze=0;Ze<g.length&&!(g[Ze].dts>Ie&&$e);Ze++){var Qe=g[Ze].pts;if(g[Ze].dts-=Ae,g[Ze].pts-=Ae,Ze<g.length-1){var it=g[Ze+1].pts,xt=g[Ze].pts,at=it<=xt,ct=it<=Qe;$e=at==ct}}this.log("Video: Initial PTS/DTS adjusted: "+ao(Ie)+"/"+ao(D)+", delta: "+ao(Ae)+" ms")}}D=Math.max(0,D);for(var lt=0,Nt=0,ir=D,yr=0;yr<E;yr++){for(var Pr=g[yr],Kr=Pr.units,Er=Kr.length,en=0,Dr=0;Dr<Er;Dr++)en+=Kr[Dr].data.length;Nt+=en,lt+=Er,Pr.length=en,Pr.dts<ir?(Pr.dts=ir,ir+=ue/4|0||1):ir=Pr.dts,K=Math.min(Pr.pts,K),G=Math.max(Pr.pts,G)}U=g[E-1].dts;var or=Nt+4*lt+8,tn;try{tn=new Uint8Array(or)}catch(ml){this.observer.emit(N.ERROR,N.ERROR,{type:ft.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:ml,bytes:or,reason:"fail allocating video mdat "+or});return}var on=new DataView(tn.buffer);on.setUint32(0,or),tn.set(Zr.types.mdat,4);for(var Un=!1,_r=Number.POSITIVE_INFINITY,Zn=Number.POSITIVE_INFINITY,In=Number.NEGATIVE_INFINITY,Oi=Number.NEGATIVE_INFINITY,ln=0;ln<E;ln++){for(var ei=g[ln],qf=ei.units,Wf=0,wu=0,gm=qf.length;wu<gm;wu++){var Yf=qf[wu],mm=Yf.data,Iu=Yf.data.byteLength;on.setUint32(k,Iu),k+=4,tn.set(mm,k),k+=Iu,Wf+=4+Iu}var vl=void 0;if(ln<E-1)I=g[ln+1].dts-ei.dts,vl=g[ln+1].pts-ei.pts;else{var zf=this.config,gl=ln>0?ei.dts-g[ln-1].dts:ue;if(vl=ln>0?ei.pts-g[ln-1].pts:ue,zf.stretchShortVideoTrack&&this.nextAudioTs!==null){var ym=Math.floor(zf.maxBufferHole*h),Pu=(f?K+f*h:this.nextAudioTs+A)-ei.pts;Pu>ym?(I=Pu-gl,I<0?I=gl:Un=!0,this.log("It is approximately "+Pu/90+" ms to the next segment; using duration "+I/90+" ms for the last video frame.")):I=gl}else I=gl}var bm=Math.round(ei.pts-ei.dts);_r=Math.min(_r,I),In=Math.max(In,I),Zn=Math.min(Zn,vl),Oi=Math.max(Oi,vl),m.push(mf(ei.key,I,Wf,bm))}if(m.length){if(ms){if(ms<70){var $f=m[0].flags;$f.dependsOn=2,$f.isNonSync=0}}else if(Eu&&Oi-Zn<In-_r&&ue/In<.025&&m[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Du=D,ti=0,Xf=m.length;ti<Xf;ti++){var Qf=Du+m[ti].duration,Em=Du+m[ti].cts;if(ti<Xf-1){var _m=Qf+m[ti+1].cts;m[ti].duration=_m-Em}else m[ti].duration=ti?m[ti-1].duration:ue;m[ti].cts=0,Du=Qf}}}I=Un||!I?ue:I;var Tm=U+I;this.nextVideoTs=L=Tm-A,this.videoSampleDuration=I,this.isVideoContiguous=!0;var Sm=Zr.moof(e.sequenceNumber++,D,x(e,{samples:m})),xm="video",Am={data1:Sm,data2:tn,startPTS:(K-A)/h,endPTS:(G+I-A)/h,startDTS:(D-A)/h,endDTS:L/h,type:xm,hasAudio:!1,hasVideo:!0,nb:m.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Am},s.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return sg;case"ac3":return og;default:return ag}},s.remuxAudio=function(e,a,u,f,h){var g=e.inputTimeScale,m=e.samplerate?e.samplerate:g,E=g/m,T=this.getSamplesPerFrame(e),A=T*E,L=this._initPTS,k=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,I=[],D=h!==void 0,U=e.samples,K=k?0:8,G=this.nextAudioTs||-1,j=L.baseTime*g/L.timescale,ie=j+a*g;if(this.isAudioContiguous=u=u||U.length&&G>0&&(f&&Math.abs(ie-(G+j))<9e3||Math.abs(Jn(U[0].pts,ie)-(G+j))<20*A),U.forEach(function(_r){_r.pts=Jn(_r.pts,ie)}),!u||G<0){if(U=U.filter(function(_r){return _r.pts>=0}),!U.length)return;h===0?G=0:f&&!D?G=Math.max(0,ie-j):G=U[0].pts-j}if(e.segmentCodec==="aac")for(var se=this.config.maxAudioFramesDrift,he=0,ve=G+j;he<U.length;he++){var ge=U[he],de=ge.pts,ue=de-ve,Ae=Math.abs(1e3*ue/g);if(ue<=-se*A&&D)he===0&&(this.warn("Audio frame @ "+(de/g).toFixed(3)+"s overlaps marker by "+Math.round(1e3*ue/g)+" ms."),this.nextAudioTs=G=de-j,ve=de);else if(ue>=se*A&&Ae<ig&&D){var je=Math.round(ue/A);for(ve=de-je*A;ve<0&&je&&A;)je--,ve+=A;he===0&&(this.nextAudioTs=G=ve-j),this.warn("Injecting "+je+" audio frames @ "+((ve-j)/g).toFixed(3)+"s due to "+Math.round(1e3*ue/g)+" ms gap.");for(var Re=0;Re<je;Re++){var Ie=tg.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Ie||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Ie=ge.unit.subarray()),U.splice(he,0,{unit:Ie,pts:ve}),ve+=A,he++}}ge.pts=ve,ve+=A}for(var $e=null,Ze=null,Qe,it=0,xt=U.length;xt--;)it+=U[xt].unit.byteLength;for(var at=0,ct=U.length;at<ct;at++){var lt=U[at],Nt=lt.unit,ir=lt.pts;if(Ze!==null){var yr=I[at-1];yr.duration=Math.round((ir-Ze)/E)}else if(u&&e.segmentCodec==="aac"&&(ir=G+j),$e=ir,it>0){it+=K;try{Qe=new Uint8Array(it)}catch(_r){this.observer.emit(N.ERROR,N.ERROR,{type:ft.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:_r,bytes:it,reason:"fail allocating audio mdat "+it});return}if(!k){var Pr=new DataView(Qe.buffer);Pr.setUint32(0,it),Qe.set(Zr.types.mdat,4)}}else return;Qe.set(Nt,K);var Kr=Nt.byteLength;K+=Kr,I.push(mf(!0,T,Kr,0)),Ze=ir}var Er=I.length;if(Er){var en=I[I.length-1];G=Ze-j,this.nextAudioTs=G+E*en.duration;var Dr=k?new Uint8Array(0):Zr.moof(e.sequenceNumber++,$e/E,x({},e,{samples:I}));e.samples=[];var or=($e-j)/g,tn=G/g,on="audio",Un={data1:Dr,data2:Qe,startPTS:or,endPTS:tn,startDTS:or,endDTS:tn,type:on,hasAudio:!0,hasVideo:!1,nb:Er};return this.isAudioContiguous=!0,Un}},c}(rt);function Jn(l,c){var s;if(c===null)return l;for(c<l?s=-8589934592:s=8589934592;Math.abs(l-c)>4294967296;)l+=s;return l}function lg(l){for(var c=0;c<l.length;c++)if(l[c].key)return c;return-1}function yf(l,c,s,n){var e=l.samples.length;if(e){for(var a=l.inputTimeScale,u=0;u<e;u++){var f=l.samples[u];f.pts=Jn(f.pts-s.baseTime*a/s.timescale,c*a)/a,f.dts=Jn(f.dts-n.baseTime*a/n.timescale,c*a)/a}var h=l.samples;return l.samples=[],{samples:h}}}function bf(l,c,s){var n=l.samples.length;if(n){for(var e=l.inputTimeScale,a=0;a<n;a++){var u=l.samples[a];u.pts=Jn(u.pts-s.baseTime*e/s.timescale,c*e)/e}l.samples.sort(function(h,g){return h.pts-g.pts});var f=l.samples;return l.samples=[],{samples:f}}}var ug=function(l){function c(n,e,a,u){var f;return f=l.call(this,"passthrough-remuxer",u)||this,f.emitInitSegment=!1,f.audioCodec=void 0,f.videoCodec=void 0,f.initData=void 0,f.initPTS=null,f.initTracks=void 0,f.lastEndTime=null,f.isVideoContiguous=!1,f}P(c,l);var s=c.prototype;return s.destroy=function(){},s.resetTimeStamp=function(e){this.lastEndTime=null;var a=this.initPTS;a&&e&&a.baseTime===e.baseTime&&a.timescale===e.timescale||(this.initPTS=e)},s.resetNextTimestamp=function(){this.isVideoContiguous=!1,this.lastEndTime=null},s.resetInitSegment=function(e,a,u,f){this.audioCodec=a,this.videoCodec=u,this.generateInitSegment(e,f),this.emitInitSegment=!0},s.generateInitSegment=function(e,a){var u=this.audioCodec,f=this.videoCodec;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var h=this.initData=rr(e),g=h.audio,m=h.video;if(a)Wn(e,a);else{var E=g||m;E!=null&&E.encrypted&&this.warn('Init segment with encrypted track with has no key ("'+E.codec+'")!')}g&&(u=Ef(g,ot.AUDIO,this)),m&&(f=Ef(m,ot.VIDEO,this));var T={};g&&m?T.audiovideo={container:"video/mp4",codec:u+","+f,supplemental:m.supplemental,encrypted:m.encrypted,initSegment:e,id:"main"}:g?T.audio={container:"audio/mp4",codec:u,encrypted:g.encrypted,initSegment:e,id:"audio"}:m?T.video={container:"video/mp4",codec:f,supplemental:m.supplemental,encrypted:m.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=T},s.remux=function(e,a,u,f,h,g){var m,E,T=this.initPTS,A=this.lastEndTime,L={audio:void 0,video:void 0,text:f,id3:u,initSegment:void 0};xe(A)||(A=this.lastEndTime=h||0);var k=a.samples;if(!k.length)return L;var I={initPTS:void 0,timescale:void 0,trackId:void 0},D=this.initData;if((m=D)!=null&&m.length||(this.generateInitSegment(k),D=this.initData),!((E=D)!=null&&E.length))return this.warn("Failed to generate initSegment."),L;this.emitInitSegment&&(I.tracks=this.initTracks,this.emitInitSegment=!1);var U=jt(k,D,this),K=D.audio?U[D.audio.id]:null,G=D.video?U[D.video.id]:null,j=ul(G,1/0),ie=ul(K,1/0),se=ul(G,0,!0),he=ul(K,0,!0),ve=h,ge=0,de=K&&(!G||!T&&ie<j||T&&T.trackId===D.audio.id),ue=de?K:G;if(ue){var Ae=ue.timescale,je=ue.start-h*Ae,Re=de?D.audio.id:D.video.id;ve=ue.start/Ae,ge=de?he-ie:se-j,(g||!T)&&(cg(T,ve,h,ge)||Ae!==T.timescale)&&(T&&this.warn("Timestamps at playlist time: "+(g?"":"~")+h+" "+je/Ae+" != initPTS: "+T.baseTime/T.timescale+" ("+T.baseTime+"/"+T.timescale+") trackId: "+T.trackId),this.log("Found initPTS at playlist time: "+h+" offset: "+(ve-h)+" ("+je+"/"+Ae+") trackId: "+Re),T=null,I.initPTS=je,I.timescale=Ae,I.trackId=Re)}else this.warn("No audio or video samples found for initPTS at playlist time: "+h);T?(I.initPTS=T.baseTime,I.timescale=T.timescale,I.trackId=T.trackId):((!I.timescale||I.trackId===void 0||I.initPTS===void 0)&&(this.warn("Could not set initPTS"),I.initPTS=ve,I.timescale=1,I.trackId=-1),this.initPTS=T={baseTime:I.initPTS,timescale:I.timescale,trackId:I.trackId});var Ie=ve-T.baseTime/T.timescale,$e=Ie+ge;ge>0?this.lastEndTime=$e:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var Ze=!!D.audio,Qe=!!D.video,it="";Ze&&(it+="audio"),Qe&&(it+="video");var xt=(D.audio?D.audio.encrypted:!1)||(D.video?D.video.encrypted:!1),at={data1:k,startPTS:Ie,startDTS:Ie,endPTS:$e,endDTS:$e,type:it,hasAudio:Ze,hasVideo:Qe,nb:1,dropped:0,encrypted:xt};L.audio=Ze&&!Qe?at:void 0,L.video=Qe?at:void 0;var ct=G?.sampleCount;if(ct){var lt=G.keyFrameIndex,Nt=lt!==-1;at.nb=ct,at.dropped=lt===0||this.isVideoContiguous?0:Nt?lt:ct,at.independent=Nt,at.firstKeyFrame=lt,Nt&&G.keyFrameStart&&(at.firstKeyFramePTS=(G.keyFrameStart-T.baseTime)/T.timescale),this.isVideoContiguous||(L.independent=Nt),this.isVideoContiguous||(this.isVideoContiguous=Nt),at.dropped&&this.warn("fmp4 does not start with IDR: firstIDR "+lt+"/"+ct+" dropped: "+at.dropped+" start: "+(at.firstKeyFramePTS||"NA"))}return L.initSegment=I,L.id3=yf(u,h,T,T),f.samples.length&&(L.text=bf(f,h,T)),L},c}(rt);function ul(l,c,s){return s===void 0&&(s=!1),l?.start!==void 0?(l.start+(s?l.duration:0))/l.timescale:c}function cg(l,c,s,n){if(l===null)return!0;var e=Math.max(n,1),a=c-l.baseTime/l.timescale;return Math.abs(a-s)>e}function Ef(l,c,s){var n=l.codec;if(n&&n.length>4)return n;if(c===ot.AUDIO){if(n==="ec-3"||n==="ac-3"||n==="alac")return n;if(n==="fLaC"||n==="Opus"){var e=!1;return ma(n,e)}return s.warn('Unhandled audio codec "'+n+'" in mp4 MAP'),n||"mp4a"}return s.warn('Unhandled video codec "'+n+'" in mp4 MAP'),n||"avc1"}var Di;try{Di=self.performance.now.bind(self.performance)}catch{Di=Date.now}var Tu=[{demux:zv,remux:ug},{demux:Jv,remux:_u},{demux:Bv,remux:_u},{demux:Gv,remux:_u}],Su=function(){function l(s,n,e,a,u,f){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=s,this.typeSupported=n,this.config=e,this.id=u,this.logger=f}var c=l.prototype;return c.configure=function(n){this.transmuxConfig=n,this.decrypter&&this.decrypter.reset()},c.push=function(n,e,a,u){var f=this,h=a.transmuxing;h.executeStart=Di();var g=new Uint8Array(n),m=this.currentTransmuxState,E=this.transmuxConfig;u&&(this.currentTransmuxState=u);var T=u||m,A=T.contiguous,L=T.discontinuity,k=T.trackSwitch,I=T.accurateTimeOffset,D=T.timeOffset,U=T.initSegmentChange,K=E.audioCodec,G=E.videoCodec,j=E.defaultInitPts,ie=E.duration,se=E.initSegmentData,he=fg(g,e);if(he&&hi(he.method)){var ve=this.getDecrypter(),ge=Ys(he.method);if(ve.isSync()){var de=ve.softwareDecrypt(g,he.key.buffer,he.iv.buffer,ge),ue=a.part>-1;if(ue){var Ae=ve.flush();de=Ae&&Ae.buffer}if(!de)return h.executeEnd=Di(),xu(a);g=new Uint8Array(de)}else return this.asyncResult=!0,this.decryptionPromise=ve.webCryptoDecrypt(g,he.key.buffer,he.iv.buffer,ge).then(function(Ze){var Qe=f.push(Ze,null,a);return f.decryptionPromise=null,Qe}),this.decryptionPromise}var je=this.needsProbing(L,k);if(je){var Re=this.configureTransmuxer(g);if(Re)return this.logger.warn("[transmuxer] "+Re.message),this.observer.emit(N.ERROR,N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:Re,reason:Re.message}),h.executeEnd=Di(),xu(a)}(L||k||U||je)&&this.resetInitSegment(se,K,G,ie,e),(L||U||je)&&this.resetInitialTimestamp(j),A||this.resetContiguity();var Ie=this.transmux(g,he,D,I,a);this.asyncResult=La(Ie);var $e=this.currentTransmuxState;return $e.contiguous=!0,$e.discontinuity=!1,$e.trackSwitch=!1,h.executeEnd=Di(),Ie},c.flush=function(n){var e=this,a=n.transmuxing;a.executeStart=Di();var u=this.decrypter,f=this.currentTransmuxState,h=this.decryptionPromise;if(h)return this.asyncResult=!0,h.then(function(){return e.flush(n)});var g=[],m=f.timeOffset;if(u){var E=u.flush();E&&g.push(this.push(E.buffer,null,n))}var T=this.demuxer,A=this.remuxer;if(!T||!A){a.executeEnd=Di();var L=[xu(n)];return this.asyncResult?Promise.resolve(L):L}var k=T.flush(m);return La(k)?(this.asyncResult=!0,k.then(function(I){return e.flushRemux(g,I,n),g})):(this.flushRemux(g,k,n),this.asyncResult?Promise.resolve(g):g)},c.flushRemux=function(n,e,a){var u=e.audioTrack,f=e.videoTrack,h=e.id3Track,g=e.textTrack,m=this.currentTransmuxState,E=m.accurateTimeOffset,T=m.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+a.sn+(a.part>-1?" part: "+a.part:"")+" of "+(this.id===st.MAIN?"level":"track")+" "+a.level);var A=this.remuxer.remux(u,f,h,g,T,E,!0,this.id);n.push({remuxResult:A,chunkMeta:a}),a.transmuxing.executeEnd=Di()},c.resetInitialTimestamp=function(n){var e=this.demuxer,a=this.remuxer;!e||!a||(e.resetTimeStamp(n),a.resetTimeStamp(n))},c.resetContiguity=function(){var n=this.demuxer,e=this.remuxer;!n||!e||(n.resetContiguity(),e.resetNextTimestamp())},c.resetInitSegment=function(n,e,a,u,f){var h=this.demuxer,g=this.remuxer;!h||!g||(h.resetInitSegment(n,e,a,u),g.resetInitSegment(n,e,a,f))},c.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},c.transmux=function(n,e,a,u,f){var h;return e&&e.method==="SAMPLE-AES"?h=this.transmuxSampleAes(n,e,a,u,f):h=this.transmuxUnencrypted(n,a,u,f),h},c.transmuxUnencrypted=function(n,e,a,u){var f=this.demuxer.demux(n,e,!1,!this.config.progressive),h=f.audioTrack,g=f.videoTrack,m=f.id3Track,E=f.textTrack,T=this.remuxer.remux(h,g,m,E,e,a,!1,this.id);return{remuxResult:T,chunkMeta:u}},c.transmuxSampleAes=function(n,e,a,u,f){var h=this;return this.demuxer.demuxSampleAes(n,e,a).then(function(g){var m=h.remuxer.remux(g.audioTrack,g.videoTrack,g.id3Track,g.textTrack,a,u,!1,h.id);return{remuxResult:m,chunkMeta:f}})},c.configureTransmuxer=function(n){for(var e=this.config,a=this.observer,u=this.typeSupported,f,h=0,g=Tu.length;h<g;h++){var m;if((m=Tu[h].demux)!=null&&m.probe(n,this.logger)){f=Tu[h];break}}if(!f)return new Error("Failed to find demuxer by probing fragment data");var E=this.demuxer,T=this.remuxer,A=f.remux,L=f.demux;(!T||!(T instanceof A))&&(this.remuxer=new A(a,e,u,this.logger)),(!E||!(E instanceof L))&&(this.demuxer=new L(a,e,u,this.logger),this.probe=L.probe)},c.needsProbing=function(n,e){return!this.demuxer||!this.remuxer||n||e},c.getDecrypter=function(){var n=this.decrypter;return n||(n=this.decrypter=new mu(this.config)),n},l}();function fg(l,c){var s=null;return l.byteLength>0&&c?.key!=null&&c.iv!==null&&c.method!=null&&(s=c),s}var xu=function(c){return{remuxResult:{},chunkMeta:c}};function La(l){return"then"in l&&l.then instanceof Function}var dg=function(c,s,n,e,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=c,this.videoCodec=s,this.initSegmentData=n,this.duration=e,this.defaultInitPts=a||null},hg=function(c,s,n,e,a,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=c,this.contiguous=s,this.accurateTimeOffset=n,this.trackSwitch=e,this.timeOffset=a,this.initSegmentChange=u};function pg(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var vg=/(\d+)-(\d+)\/(\d+)/,_f=function(){function l(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||bg,this.controller=new self.AbortController,this.stats=new kt}var c=l.prototype;return c.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},c.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},c.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!=null&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},c.load=function(n,e,a){var u=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var h=gg(n,this.controller.signal),g=n.responseType==="arraybuffer",m=g?"byteLength":"length",E=e.loadPolicy,T=E.maxTimeToFirstByteMs,A=E.maxLoadTimeMs;this.context=n,this.config=e,this.callbacks=a,this.request=this.fetchSetup(n,h),self.clearTimeout(this.requestTimeout),e.timeout=T&&xe(T)?T:A,this.requestTimeout=self.setTimeout(function(){u.callbacks&&(u.abortInternal(),u.callbacks.onTimeout(f,n,u.response))},e.timeout);var L=La(this.request)?this.request.then(self.fetch):self.fetch(this.request);L.then(function(k){var I;u.response=u.loader=k;var D=Math.max(self.performance.now(),f.loading.start);if(self.clearTimeout(u.requestTimeout),e.timeout=A,u.requestTimeout=self.setTimeout(function(){u.callbacks&&(u.abortInternal(),u.callbacks.onTimeout(f,n,u.response))},A-(D-f.loading.start)),!k.ok){var U=k.status,K=k.statusText;throw new Eg(K||"fetch, bad network response",U,k)}f.loading.first=D,f.total=yg(k.headers)||f.total;var G=(I=u.callbacks)==null?void 0:I.onProgress;return G&&xe(e.highWaterMark)?u.loadProgressively(k,f,n,e.highWaterMark,G):g?k.arrayBuffer():n.responseType==="json"?k.json():k.text()}).then(function(k){var I,D,U=u.response;if(!U)throw new Error("loader destroyed");self.clearTimeout(u.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first);var K=k[m];K&&(f.loaded=f.total=K);var G={url:U.url,data:k,code:U.status},j=(I=u.callbacks)==null?void 0:I.onProgress;j&&!xe(e.highWaterMark)&&j(f,n,k,U),(D=u.callbacks)==null||D.onSuccess(G,f,n,U)}).catch(function(k){var I;if(self.clearTimeout(u.requestTimeout),!f.aborted){var D=k&&k.code||0,U=k?k.message:null;(I=u.callbacks)==null||I.onError({code:D,text:U},n,k?k.details:null,f)}})},c.getCacheAge=function(){var n=null;if(this.response){var e=this.response.headers.get("age");n=e?parseFloat(e):null}return n},c.getResponseHeader=function(n){return this.response?this.response.headers.get(n):null},c.loadProgressively=function(n,e,a,u,f){u===void 0&&(u=0);var h=new Qn,g=n.body.getReader(),m=function(){return g.read().then(function(T){if(T.done)return h.dataLength&&f(e,a,h.flush().buffer,n),Promise.resolve(new ArrayBuffer(0));var A=T.value,L=A.length;return e.loaded+=L,L<u||h.dataLength?(h.push(A),h.dataLength>=u&&f(e,a,h.flush().buffer,n)):f(e,a,A.buffer,n),m()}).catch(function(){return Promise.reject()})};return m()},l}();function gg(l,c){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:c,headers:new self.Headers(x({},l.headers))};return l.rangeEnd&&s.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),s}function mg(l){var c=vg.exec(l);if(c)return parseInt(c[2])-parseInt(c[1])+1}function yg(l){var c=l.get("Content-Range");if(c){var s=mg(c);if(xe(s))return s}var n=l.get("Content-Length");if(n)return parseInt(n)}function bg(l,c){return new self.Request(l.url,c)}var Eg=function(l){function c(s,n,e){var a;return a=l.call(this,s)||this,a.code=void 0,a.details=void 0,a.code=n,a.details=e,a}return P(c,l),c}(le(Error)),_g=/^age:\s*[\d.]+\s*$/im,Tf=function(){function l(s){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=s&&s.xhrSetup||null,this.stats=new kt,this.retryDelay=0}var c=l.prototype;return c.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},c.abortInternal=function(){var n=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),n&&(n.onreadystatechange=null,n.onprogress=null,n.readyState!==4&&(this.stats.aborted=!0,n.abort()))},c.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!=null&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},c.load=function(n,e,a){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=n,this.config=e,this.callbacks=a,this.loadInternal()},c.loadInternal=function(){var n=this,e=this.config,a=this.context;if(!(!e||!a)){var u=this.loader=new self.XMLHttpRequest,f=this.stats;f.loading.first=0,f.loaded=0,f.aborted=!1;var h=this.xhrSetup;h?Promise.resolve().then(function(){if(!(n.loader!==u||n.stats.aborted))return h(u,a.url)}).catch(function(g){if(!(n.loader!==u||n.stats.aborted))return u.open("GET",a.url,!0),h(u,a.url)}).then(function(){n.loader!==u||n.stats.aborted||n.openAndSendXhr(u,a,e)}).catch(function(g){var m;(m=n.callbacks)==null||m.onError({code:u.status,text:g.message},a,u,f)}):this.openAndSendXhr(u,a,e)}},c.openAndSendXhr=function(n,e,a){n.readyState||n.open("GET",e.url,!0);var u=e.headers,f=a.loadPolicy,h=f.maxTimeToFirstByteMs,g=f.maxLoadTimeMs;if(u)for(var m in u)n.setRequestHeader(m,u[m]);e.rangeEnd&&n.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=e.responseType,self.clearTimeout(this.requestTimeout),a.timeout=h&&xe(h)?h:g,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout),n.send()},c.readystatechange=function(){var n=this.context,e=this.loader,a=this.stats;if(!(!n||!e)){var u=e.readyState,f=this.config;if(!a.aborted&&u>=2&&(a.loading.first===0&&(a.loading.first=Math.max(self.performance.now(),a.loading.start),f.timeout!==f.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),f.timeout=f.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.loadPolicy.maxLoadTimeMs-(a.loading.first-a.loading.start)))),u===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var h=e.status,g=e.responseType==="text"?e.responseText:null;if(h>=200&&h<300){var m=g??e.response;if(m!=null){var E,T;a.loading.end=Math.max(self.performance.now(),a.loading.first);var A=e.responseType==="arraybuffer"?m.byteLength:m.length;a.loaded=a.total=A,a.bwEstimate=a.total*8e3/(a.loading.end-a.loading.first);var L=(E=this.callbacks)==null?void 0:E.onProgress;L&&L(a,n,m,e);var k={url:e.responseURL,data:m,code:h};(T=this.callbacks)==null||T.onSuccess(k,a,n,e);return}}var I=f.loadPolicy.errorRetry,D=a.retry,U={url:n.url,data:void 0,code:h};if(di(I,D,!1,U))this.retry(I);else{var K;tt.error(h+" while loading "+n.url),(K=this.callbacks)==null||K.onError({code:h,text:e.statusText},n,e,a)}}}},c.loadtimeout=function(){if(this.config){var n=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(di(n,e,!0))this.retry(n);else{var a;tt.warn("timeout while loading "+((a=this.context)==null?void 0:a.url));var u=this.callbacks;u&&(this.abortInternal(),u.onTimeout(this.stats,this.context,this.loader))}}},c.retry=function(n){var e=this.context,a=this.stats;this.retryDelay=_n(n,a.retry),a.retry++,tt.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+e?.url+", retrying "+a.retry+"/"+n.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},c.loadprogress=function(n){var e=this.stats;e.loaded=n.loaded,n.lengthComputable&&(e.total=n.total)},c.getCacheAge=function(){var n=null;if(this.loader&&_g.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");n=e?parseFloat(e):null}return n},c.getResponseHeader=function(n){return this.loader&&new RegExp("^"+n+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(n):null},l}(),Sf={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Tg=H(H({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Tf,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ft,bufferController:cu,capLevelController:Ja,errorController:Bn,fpsController:ds,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!1,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!1,preserveManualLevelOnError:!1,certLoadPolicy:{default:Sf},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:Sf},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Sg()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:gu,interstitialsController:void 0});function Sg(){return{cueHandler:va,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function xg(l,c,s){if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(c.liveMaxLatencyDurationCount!==void 0&&(c.liveSyncDurationCount===void 0||c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(c.liveMaxLatencyDuration!==void 0&&(c.liveSyncDuration===void 0||c.liveMaxLatencyDuration<=c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var n=Au(l),e=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(u){var f=(u==="level"?"playlist":u)+"LoadPolicy",h=c[f]===void 0,g=[];a.forEach(function(m){var E=u+"Loading"+m,T=c[E];if(T!==void 0&&h){g.push(E);var A=n[f].default;switch(c[f]={default:A},m){case"TimeOut":A.maxLoadTimeMs=T,A.maxTimeToFirstByteMs=T;break;case"MaxRetry":A.errorRetry.maxNumRetry=T,A.timeoutRetry.maxNumRetry=T;break;case"RetryDelay":A.errorRetry.retryDelayMs=T,A.timeoutRetry.retryDelayMs=T;break;case"MaxRetryTimeout":A.errorRetry.maxRetryDelayMs=T,A.timeoutRetry.maxRetryDelayMs=T;break}}}),g.length&&s.warn('hls.js config: "'+g.join('", "')+'" setting(s) are deprecated, use "'+f+'": '+Ur(c[f]))}),H(H({},n),c)}function Au(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(Au):Object.keys(l).reduce(function(c,s){return c[s]=Au(l[s]),c},{}):l}function Ag(l,c){var s=l.loader;if(s!==_f&&s!==Tf)c.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1;else{var n=pg();n&&(l.loader=_f,l.progressive=!0,l.enableSoftwareAES=!0,c.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var Sn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Cg=function(){function l(s){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=s,this._registerListeners()}var c=l.prototype;return c._registerListeners=function(){var n=this.hls;n&&(n.on(N.MANIFEST_LOADING,this.onManifestLoading,this),n.on(N.BUFFER_APPENDED,this.onBufferAppended,this),n.on(N.FRAG_BUFFERED,this.onFragBuffered,this),n.on(N.FRAG_LOADED,this.onFragLoaded,this))},c._unregisterListeners=function(){var n=this.hls;n&&(n.off(N.MANIFEST_LOADING,this.onManifestLoading,this),n.off(N.BUFFER_APPENDED,this.onBufferAppended,this),n.off(N.FRAG_BUFFERED,this.onFragBuffered,this),n.off(N.FRAG_LOADED,this.onFragLoaded,this))},c.destroy=function(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},c.getAppendedFrag=function(n,e){var a=this.activePartLists[e];if(a)for(var u=a.length;u--;){var f=a[u];if(!f)break;if(f.start<=n&&n<=f.end&&f.loaded)return f}return this.getBufferedFrag(n,e)},c.getBufferedFrag=function(n,e){return this.getFragAtPos(n,e,!0)},c.getFragAtPos=function(n,e,a){for(var u=this.fragments,f=Object.keys(u),h=f.length;h--;){var g=u[f[h]];if(g?.body.type===e&&(!a||g.buffered)){var m=g.body;if(m.start<=n&&n<=m.end)return m}}return null},c.detectEvictedFragments=function(n,e,a,u,f){var h=this;this.timeRanges&&(this.timeRanges[n]=e);var g=u?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(m){var E=h.fragments[m];if(E&&!(g>=E.body.sn)){if(!E.buffered&&(!E.loaded||f)){E.body.type===a&&h.removeFragment(E.body);return}var T=E.range[n];if(T){if(T.time.length===0){h.removeFragment(E.body);return}T.time.some(function(A){var L=!h.isTimeBuffered(A.startPTS,A.endPTS,e);return L&&h.removeFragment(E.body),L})}}})},c.detectPartialFragments=function(n){var e=this,a=this.timeRanges;if(!(!a||n.frag.sn==="initSegment")){var u=n.frag,f=ys(u),h=this.fragments[f];if(!(!h||h.buffered&&u.gap)){var g=!u.relurl;if(Object.keys(a).forEach(function(E){var T=u.elementaryStreams[E];if(T){var A=a[E],L=g||T.partial===!0;h.range[E]=e.getBufferedTimes(u,n.part,L,A)}}),h.loaded=null,Object.keys(h.range).length){h.buffered=!0;var m=h.body.endList=u.endList||h.body.endList;m&&(this.endListFragments[h.body.type]=h),cl(h)||this.removeParts(u.sn-1,u.type)}else this.removeFragment(h.body)}}},c.removeParts=function(n,e){var a=this.activePartLists[e];a&&(this.activePartLists[e]=xf(a,function(u){return u.fragment.sn>=n}))},c.fragBuffered=function(n,e){var a=ys(n),u=this.fragments[a];!u&&e&&(u=this.fragments[a]={body:n,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},n.gap&&(this.hasGaps=!0)),u&&(u.loaded=null,u.buffered=!0)},c.getBufferedTimes=function(n,e,a,u){for(var f={time:[],partial:a},h=n.start,g=n.end,m=n.minEndPTS||g,E=n.maxStartPTS||h,T=0;T<u.length;T++){var A=u.start(T)-this.bufferPadding,L=u.end(T)+this.bufferPadding;if(E>=A&&m<=L){f.time.push({startPTS:Math.max(h,u.start(T)),endPTS:Math.min(g,u.end(T))});break}else if(h<L&&g>A){var k=Math.max(h,u.start(T)),I=Math.min(g,u.end(T));I>k&&(f.partial=!0,f.time.push({startPTS:k,endPTS:I}))}else if(g<=A)break}return f},c.getPartialFragment=function(n){var e=null,a,u,f,h=0,g=this.bufferPadding,m=this.fragments;return Object.keys(m).forEach(function(E){var T=m[E];T&&cl(T)&&(u=T.body.start-g,f=T.body.end+g,n>=u&&n<=f&&(a=Math.min(n-u,f-n),h<=a&&(e=T.body,h=a)))}),e},c.isEndListAppended=function(n){var e=this.endListFragments[n];return e!==void 0&&(e.buffered||cl(e))},c.getState=function(n){var e=ys(n),a=this.fragments[e];return a?a.buffered?cl(a)?Sn.PARTIAL:Sn.OK:Sn.APPENDING:Sn.NOT_LOADED},c.isTimeBuffered=function(n,e,a){for(var u,f,h=0;h<a.length;h++){if(u=a.start(h)-this.bufferPadding,f=a.end(h)+this.bufferPadding,n>=u&&e<=f)return!0;if(e<=u)return!1}return!1},c.onManifestLoading=function(){this.removeAllFragments()},c.onFragLoaded=function(n,e){if(!(e.frag.sn==="initSegment"||e.frag.bitrateTest)){var a=e.frag,u=e.part?null:e,f=ys(a);this.fragments[f]={body:a,appendedPTS:null,loaded:u,buffered:!1,range:Object.create(null)}}},c.onBufferAppended=function(n,e){var a=e.frag,u=e.part,f=e.timeRanges,h=e.type;if(a.sn!=="initSegment"){var g=a.type;if(u){var m=this.activePartLists[g];m||(this.activePartLists[g]=m=[]),m.push(u)}this.timeRanges=f;var E=f[h];this.detectEvictedFragments(h,E,g,u)}},c.onFragBuffered=function(n,e){this.detectPartialFragments(e)},c.hasFragment=function(n){var e=ys(n);return!!this.fragments[e]},c.hasFragments=function(n){var e=this.fragments,a=Object.keys(e);if(!n)return a.length>0;for(var u=a.length;u--;){var f=e[a[u]];if(f?.body.type===n)return!0}return!1},c.hasParts=function(n){var e;return!!((e=this.activePartLists[n])!=null&&e.length)},c.removeFragmentsInRange=function(n,e,a,u,f){var h=this;u&&!this.hasGaps||Object.keys(this.fragments).forEach(function(g){var m=h.fragments[g];if(m){var E=m.body;E.type!==a||u&&!E.gap||E.start<e&&E.end>n&&(m.buffered||f)&&h.removeFragment(E)}})},c.removeFragment=function(n){var e=ys(n);n.clearElementaryStreamInfo();var a=this.activePartLists[n.type];if(a){var u=n.sn;this.activePartLists[n.type]=xf(a,function(f){return f.fragment.sn!==u})}delete this.fragments[e],n.endList&&delete this.endListFragments[n.type]},c.removeAllFragments=function(){var n;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var e=(n=this.hls)==null||(n=n.latestLevelDetails)==null?void 0:n.partList;e&&e.forEach(function(a){return a.clearElementaryStreamInfo()})},l}();function cl(l){var c,s,n;return l.buffered&&!!(l.body.gap||(c=l.range.video)!=null&&c.partial||(s=l.range.audio)!=null&&s.partial||(n=l.range.audiovideo)!=null&&n.partial)}function ys(l){return l.type+"_"+l.level+"_"+l.sn}function xf(l,c){return l.filter(function(s){var n=c(s);return n||s.clearElementaryStreamInfo(),n})}var Af=Math.pow(2,17),Lg=function(){function l(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var c=l.prototype;return c.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},c.abort=function(){this.loader&&this.loader.abort()},c.load=function(n,e){var a=this,u=n.url;if(!u)return Promise.reject(new Mi({type:ft.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:n,error:new Error("Fragment does not have a "+(u?"part list":"url")),networkDetails:null}));this.abort();var f=this.config,h=f.fLoader,g=f.loader;return new Promise(function(m,E){if(a.loader&&a.loader.destroy(),n.gap)if(n.tagList.some(function(D){return D[0]==="GAP"})){E(Lf(n));return}else n.gap=!1;var T=a.loader=h?new h(f):new g(f),A=Cf(n);n.loader=T;var L=Zi(f.fragLoadPolicy.default),k={loadPolicy:L,timeout:L.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:n.sn==="initSegment"?1/0:Af};n.stats=T.stats;var I={onSuccess:function(U,K,G,j){a.resetLoader(n,T);var ie=U.data;G.resetIV&&n.decryptdata&&(n.decryptdata.iv=new Uint8Array(ie.slice(0,16)),ie=ie.slice(16)),m({frag:n,part:null,payload:ie,networkDetails:j})},onError:function(U,K,G,j){a.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:n,response:H({url:u,data:void 0},U),error:new Error("HTTP Error "+U.code+" "+U.text),networkDetails:G,stats:j}))},onAbort:function(U,K,G){a.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:n,error:new Error("Aborted"),networkDetails:G,stats:U}))},onTimeout:function(U,K,G){a.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,error:new Error("Timeout after "+k.timeout+"ms"),networkDetails:G,stats:U}))}};e&&(I.onProgress=function(D,U,K,G){return e({frag:n,part:null,payload:K,networkDetails:G})}),T.load(A,k,I)})},c.loadPart=function(n,e,a){var u=this;this.abort();var f=this.config,h=f.fLoader,g=f.loader;return new Promise(function(m,E){if(u.loader&&u.loader.destroy(),n.gap||e.gap){E(Lf(n,e));return}var T=u.loader=h?new h(f):new g(f),A=Cf(n,e);n.loader=T;var L=Zi(f.fragLoadPolicy.default),k={loadPolicy:L,timeout:L.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Af};e.stats=T.stats,T.load(A,k,{onSuccess:function(D,U,K,G){u.resetLoader(n,T),u.updateStatsFromPart(n,e);var j={frag:n,part:e,payload:D.data,networkDetails:G};a(j),m(j)},onError:function(D,U,K,G){u.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:n,part:e,response:H({url:A.url,data:void 0},D),error:new Error("HTTP Error "+D.code+" "+D.text),networkDetails:K,stats:G}))},onAbort:function(D,U,K){n.stats.aborted=e.stats.aborted,u.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:n,part:e,error:new Error("Aborted"),networkDetails:K,stats:D}))},onTimeout:function(D,U,K){u.resetLoader(n,T),E(new Mi({type:ft.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,part:e,error:new Error("Timeout after "+k.timeout+"ms"),networkDetails:K,stats:D}))}})})},c.updateStatsFromPart=function(n,e){var a=n.stats,u=e.stats,f=u.total;if(a.loaded+=u.loaded,f){var h=Math.round(n.duration/e.duration),g=Math.min(Math.round(a.loaded/f),h),m=h-g,E=m*Math.round(a.loaded/g);a.total=a.loaded+E}else a.total=Math.max(a.loaded,a.total);var T=a.loading,A=u.loading;T.start?T.first+=A.first-A.start:(T.start=A.start,T.first=A.first),T.end=A.end},c.resetLoader=function(n,e){n.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},l}();function Cf(l,c){c===void 0&&(c=null);var s=c||l,n={frag:l,part:c,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},e=s.byteRangeStartOffset,a=s.byteRangeEndOffset;if(xe(e)&&xe(a)){var u,f=e,h=a;if(l.sn==="initSegment"&&Rg((u=l.decryptdata)==null?void 0:u.method)){var g=a-e;g%16&&(h=a+(16-g%16)),e!==0&&(n.resetIV=!0,f=e-16)}n.rangeStart=f,n.rangeEnd=h}return n}function Lf(l,c){var s=new Error("GAP "+(l.gap?"tag":"attribute")+" found"),n={type:ft.MEDIA_ERROR,details:be.FRAG_GAP,fatal:!1,frag:l,error:s,networkDetails:null};return c&&(n.part=c),(c||l).stats.aborted=!0,new Mi(n)}function Rg(l){return l==="AES-128"||l==="AES-256"}var Mi=function(l){function c(s){var n;return n=l.call(this,s.error.message)||this,n.data=void 0,n.data=s,n}return P(c,l),c}(le(Error)),Rf=function(l){function c(n,e){var a;return a=l.call(this,n,e)||this,a._boundTick=void 0,a._tickTimer=null,a._tickInterval=null,a._tickCallCount=0,a._boundTick=a.tick.bind(a),a}P(c,l);var s=c.prototype;return s.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},s.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},s.onHandlerDestroyed=function(){},s.hasInterval=function(){return!!this._tickInterval},s.hasNextTick=function(){return!!this._tickTimer},s.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},s.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},s.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},s.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},s.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},s.doTick=function(){},c}(rt),kf=function(c,s,n,e,a,u){e===void 0&&(e=0),a===void 0&&(a=-1),u===void 0&&(u=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=fl(),this.buffering={audio:fl(),video:fl(),audiovideo:fl()},this.level=c,this.sn=s,this.id=n,this.size=e,this.part=a,this.partial=u};function fl(){return{start:0,executeStart:0,executeEnd:0,end:0}}function so(l,c){for(var s=0,n=l.length;s<n;s++){var e;if(((e=l[s])==null?void 0:e.cc)===c)return l[s]}return null}function kg(l,c){return!!(l&&c.startCC<l.endCC&&c.endCC>l.startCC)}function wf(l,c){var s=l.start+c;l.startPTS=s,l.setStart(s),l.endPTS=s+l.duration}function If(l,c){for(var s=c.fragments,n=0,e=s.length;n<e;n++)wf(s[n],l);c.fragmentHint&&wf(c.fragmentHint,l),c.alignedSliding=!0}function wg(l,c){l&&(Ig(c,l),c.alignedSliding||Pg(c,l),!c.alignedSliding&&!c.skippedSegments&&el(l,c,!1))}function Ig(l,c){if(kg(c,l)){var s=Math.min(c.endCC,l.endCC),n=so(c.fragments,s),e=so(l.fragments,s);if(!(!n||!e)){tt.log("Aligning playlist at start of dicontinuity sequence "+s);var a=n.start-e.start;If(a,l)}}}function Pg(l,c){if(!(!l.hasProgramDateTime||!c.hasProgramDateTime)){var s=l.fragments,n=c.fragments;if(!(!s.length||!n.length)){var e,a,u=Math.min(c.endCC,l.endCC);c.startCC<u&&l.startCC<u&&(e=so(n,u),a=so(s,u)),(!e||!a)&&(e=n[Math.floor(n.length/2)],a=so(s,e.cc)||s[Math.floor(s.length/2)]);var f=e.programDateTime,h=a.programDateTime;if(!(!f||!h)){var g=(h-f)/1e3-(a.start-e.start);If(g,l)}}}}var Dg={toString:function(c){for(var s="",n=c.length,e=0;e<n;e++)s+="["+c.start(e).toFixed(3)+"-"+c.end(e).toFixed(3)+"]";return s}},Ve={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_LEVEL:"WAITING_LEVEL"},Mg=function(l){function c(n,e,a,u,f){var h;return h=l.call(this,u,n.logger)||this,h.hls=void 0,h.fragPrevious=null,h.fragCurrent=null,h.fragmentTracker=void 0,h.transmuxer=null,h._state=Ve.STOPPED,h.playlistType=void 0,h.media=null,h.mediaBuffer=null,h.config=void 0,h.bitrateTest=!1,h.lastCurrentTime=0,h.nextLoadPosition=0,h.startPosition=0,h.startTimeOffset=null,h.retryDate=0,h.levels=null,h.fragmentLoader=void 0,h.keyLoader=void 0,h.levelLastLoaded=null,h.startFragRequested=!1,h.decrypter=void 0,h.initPTS=[],h.buffering=!0,h.loadingParts=!1,h.loopSn=void 0,h.onMediaSeeking=function(){var g=h,m=g.config,E=g.fragCurrent,T=g.media,A=g.mediaBuffer,L=g.state,k=T?T.currentTime:0,I=Mt.bufferInfo(A||T,k,m.maxBufferHole),D=!I.len;if(h.log("Media seeking to "+(xe(k)?k.toFixed(3):k)+", state: "+L+", "+(D?"out of":"in")+" buffer"),h.state===Ve.ENDED)h.resetLoadingState();else if(E){var U=m.maxFragLookUpTolerance,K=E.start-U,G=E.start+E.duration+U;if(D||G<I.start||K>I.end){var j=k>G;(k<K||j)&&(j&&E.loader&&(h.log("Cancelling fragment load for seek (sn: "+E.sn+")"),E.abortRequests(),h.resetLoadingState()),h.fragPrevious=null)}}if(T){h.fragmentTracker.removeFragmentsInRange(k,1/0,h.playlistType,!0);var ie=h.lastCurrentTime;if(k>ie&&(h.lastCurrentTime=k),!h.loadingParts){var se=Math.max(I.end,k),he=h.shouldLoadParts(h.getLevelDetails(),se);he&&(h.log("LL-Part loading ON after seeking to "+k.toFixed(2)+" with buffer @"+se.toFixed(2)),h.loadingParts=he)}}h.hls.hasEnoughToStart||(h.log("Setting "+(D?"startPosition":"nextLoadPosition")+" to "+k+" for seek without enough to start"),h.nextLoadPosition=k,D&&(h.startPosition=k)),h.tickImmediate()},h.onMediaEnded=function(){h.log("setting startPosition to 0 because media ended"),h.startPosition=h.lastCurrentTime=0},h.playlistType=f,h.hls=n,h.fragmentLoader=new Lg(n.config),h.keyLoader=a,h.fragmentTracker=e,h.config=n.config,h.decrypter=new mu(n.config),h}P(c,l);var s=c.prototype;return s.registerListeners=function(){var e=this.hls;e.on(N.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(N.ERROR,this.onError,this)},s.unregisterListeners=function(){var e=this.hls;e.off(N.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(N.ERROR,this.onError,this)},s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(e){},s.stopLoad=function(){if(this.state!==Ve.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ve.STOPPED}},s.pauseBuffering=function(){this.buffering=!1},s.resumeBuffering=function(){this.buffering=!0},s._streamEnded=function(e,a){if(a.live||!this.media)return!1;var u=e.end||0,f=this.config.timelineOffset||0;if(u<=f)return!1;var h=e.buffered;this.config.maxBufferHole&&h&&h.length>1&&(e=Mt.bufferedInfo(h,e.start,0));var g=e.nextStart,m=g&&g>f&&g<a.edge;if(m||this.media.currentTime<e.start)return!1;var E=a.partList;if(E!=null&&E.length){var T=E[E.length-1],A=Mt.isBuffered(this.media,T.start+T.duration/2);return A}var L=a.fragments[a.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(L)},s.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details},s.onMediaAttached=function(e,a){var u=this.media=this.mediaBuffer=a.media;u.removeEventListener("seeking",this.onMediaSeeking),u.removeEventListener("ended",this.onMediaEnded),u.addEventListener("seeking",this.onMediaSeeking),u.addEventListener("ended",this.onMediaEnded);var f=this.config;this.levels&&f.autoStartLoad&&this.state===Ve.STOPPED&&this.startLoad(f.startPosition)},s.onMediaDetaching=function(e,a){var u=!!a.transferMedia,f=this.media;if(f!==null){if(f.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),f.removeEventListener("seeking",this.onMediaSeeking),f.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!u&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,u){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},s.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},s.onError=function(e,a){},s.onManifestLoaded=function(e,a){this.startTimeOffset=a.startTimeOffset},s.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),l.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},s.onHandlerDestroyed=function(){this.state=Ve.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,l.prototype.onHandlerDestroyed.call(this)},s.loadFragment=function(e,a,u){this.startFragRequested=!0,this._loadFragForPlayback(e,a,u)},s._loadFragForPlayback=function(e,a,u){var f=this,h=function(m){var E=m.frag;if(f.fragContextChanged(E)){f.warn(E.type+" sn: "+E.sn+(m.part?" part: "+m.part.index:"")+" of "+f.fragInfo(E,!1,m.part)+") was dropped during download."),f.fragmentTracker.removeFragment(E);return}E.stats.chunkCount++,f._handleFragmentLoadProgress(m)};this._doFragLoad(e,a,u,h).then(function(g){if(g){var m=f.state,E=g.frag;if(f.fragContextChanged(E)){(m===Ve.FRAG_LOADING||!f.fragCurrent&&m===Ve.PARSING)&&(f.fragmentTracker.removeFragment(E),f.state=Ve.IDLE);return}"payload"in g&&(f.log("Loaded "+E.type+" sn: "+E.sn+" of "+f.playlistLabel()+" "+E.level),f.hls.trigger(N.FRAG_LOADED,g)),f._handleFragmentLoadComplete(g)}}).catch(function(g){f.state===Ve.STOPPED||f.state===Ve.ERROR||(f.warn("Frag error: "+(g?.message||g)),f.resetFragmentLoading(e))})},s.clearTrackerIfNeeded=function(e){var a,u=this.fragmentTracker,f=u.getState(e);if(f===Sn.APPENDING){var h=e.type,g=this.getFwdBufferInfo(this.mediaBuffer,h),m=Math.max(e.duration,g?g.len:this.config.maxBufferLength),E=this.backtrackFragment,T=E?e.sn-E.sn:0;(T===1||this.reduceMaxBufferLength(m,e.duration))&&u.removeFragment(e)}else((a=this.mediaBuffer)==null?void 0:a.buffered.length)===0?u.removeAllFragments():u.hasParts(e.type)&&(u.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),u.getState(e)===Sn.PARTIAL&&u.removeFragment(e))},s.checkLiveUpdate=function(e){if(e.updated&&!e.live){var a=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:a,part:null,stats:a.stats,id:a.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},s.waitForLive=function(e){var a=e.details;return a?.live&&a.type!=="EVENT"&&(this.levelLastLoaded!==e||a.expired)},s.flushMainBuffer=function(e,a,u){if(u===void 0&&(u=null),!!(e-a)){var f={startOffset:e,endOffset:a,type:u};this.hls.trigger(N.BUFFER_FLUSHING,f)}},s._loadInitSegment=function(e,a){var u=this;this._doFragLoad(e,a).then(function(f){var h=f?.frag;if(!h||u.fragContextChanged(h)||!u.levels)throw new Error("init load aborted");return f}).then(function(f){var h=u.hls,g=f.frag,m=f.payload,E=g.decryptdata;if(m&&m.byteLength>0&&E!=null&&E.key&&E.iv&&hi(E.method)){var T=self.performance.now();return u.decrypter.decrypt(new Uint8Array(m),E.key.buffer,E.iv.buffer,Ys(E.method)).catch(function(A){throw h.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_DECRYPT_ERROR,fatal:!1,error:A,reason:A.message,frag:g}),A}).then(function(A){var L=self.performance.now();return h.trigger(N.FRAG_DECRYPTED,{frag:g,payload:A,stats:{tstart:T,tdecrypt:L}}),f.payload=A,u.completeInitSegmentLoad(f)})}return u.completeInitSegmentLoad(f)}).catch(function(f){u.state===Ve.STOPPED||u.state===Ve.ERROR||(u.warn(f),u.resetFragmentLoading(e))})},s.completeInitSegmentLoad=function(e){var a=this.levels;if(!a)throw new Error("init load aborted, missing levels");var u=e.frag.stats;this.state!==Ve.STOPPED&&(this.state=Ve.IDLE),e.frag.data=new Uint8Array(e.payload),u.parsing.start=u.buffering.start=self.performance.now(),u.parsing.end=u.buffering.end=self.performance.now(),this.tick()},s.unhandledEncryptionError=function(e,a){var u,f,h=e.tracks;if(h&&!a.encrypted&&((u=h.audio)!=null&&u.encrypted||(f=h.video)!=null&&f.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){var g=this.media,m=new Error("Encrypted track with no key in "+this.fragInfo(a)+" (media "+(g?"attached mediaKeys: "+g.mediaKeys:"detached")+")");return this.warn(m.message),!g||g.mediaKeys?!1:(this.hls.trigger(N.ERROR,{type:ft.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_KEYS,fatal:!1,error:m,frag:a}),this.resetTransmuxer(),!0)}return!1},s.fragContextChanged=function(e){var a=this.fragCurrent;return!e||!a||e.sn!==a.sn||e.level!==a.level},s.fragBufferedComplete=function(e,a){var u=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(a?" part: "+a.index:"")+" of "+this.fragInfo(e,!1,a)+" > buffer:"+(u?Dg.toString(Mt.getBuffered(u)):"(detached)")+")"),ht(e)){var f;if(e.type!==st.SUBTITLE){var h=e.elementaryStreams;if(!Object.keys(h).some(function(m){return!!h[m]})){this.state=Ve.IDLE;return}}var g=(f=this.levels)==null?void 0:f[e.level];g!=null&&g.fragmentError&&(this.log("Resetting level fragment error count of "+g.fragmentError+" on frag buffered"),g.fragmentError=0)}this.state=Ve.IDLE},s._handleFragmentLoadComplete=function(e){var a=this.transmuxer;if(a){var u=e.frag,f=e.part,h=e.partsLoaded,g=!h||h.length===0||h.some(function(E){return!E}),m=new kf(u.level,u.sn,u.stats.chunkCount+1,0,f?f.index:-1,!g);a.flush(m)}},s._handleFragmentLoadProgress=function(e){},s._doFragLoad=function(e,a,u,f){var h,g=this;u===void 0&&(u=null),this.fragCurrent=e;var m=a.details;if(!this.levels||!m)throw new Error("frag load aborted, missing level"+(m?"":" detail")+"s");var E=null;e.encrypted&&!((h=e.decryptdata)!=null&&h.key)?(this.log("Loading key for "+e.sn+" of ["+m.startSN+"-"+m.endSN+"], "+this.playlistLabel()+" "+e.level),this.state=Ve.KEY_LOADING,this.fragCurrent=e,E=this.keyLoader.load(e).then(function(j){if(!g.fragContextChanged(j.frag))return g.hls.trigger(N.KEY_LOADED,j),g.state===Ve.KEY_LOADING&&(g.state=Ve.IDLE),j}),this.hls.trigger(N.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(E=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(E=this.keyLoader.loadClear(e,m.encryptedFragments,this.startFragRequested),E&&this.log("[eme] blocking frag load until media-keys acquired"));var T=this.fragPrevious;if(ht(e)&&(!T||e.sn!==T.sn)){var A=this.shouldLoadParts(a.details,e.end);A!==this.loadingParts&&(this.log("LL-Part loading "+(A?"ON":"OFF")+" loading sn "+T?.sn+"->"+e.sn),this.loadingParts=A)}if(u=Math.max(e.start,u||0),this.loadingParts&&ht(e)){var L=m.partList;if(L&&f){u>m.fragmentEnd&&m.fragmentHint&&(e=m.fragmentHint);var k=this.getNextPart(L,e,u);if(k>-1){var I=L[k];e=this.fragCurrent=I.fragment,this.log("Loading "+e.type+" sn: "+e.sn+" part: "+I.index+" ("+k+"/"+(L.length-1)+") of "+this.fragInfo(e,!1,I)+") cc: "+e.cc+" ["+m.startSN+"-"+m.endSN+"], target: "+parseFloat(u.toFixed(3))),this.nextLoadPosition=I.start+I.duration,this.state=Ve.FRAG_LOADING;var D;return E?D=E.then(function(j){return!j||g.fragContextChanged(j.frag)?null:g.doFragPartsLoad(e,I,a,f)}).catch(function(j){return g.handleFragLoadError(j)}):D=this.doFragPartsLoad(e,I,a,f).catch(function(j){return g.handleFragLoadError(j)}),this.hls.trigger(N.FRAG_LOADING,{frag:e,part:I,targetBufferTime:u}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):D}else if(!e.url||this.loadedEndOfParts(L,u))return Promise.resolve(null)}}if(ht(e)&&this.loadingParts){var U;this.log("LL-Part loading OFF after next part miss @"+u.toFixed(2)+" Check buffer at sn: "+e.sn+" loaded parts: "+((U=m.partList)==null?void 0:U.filter(function(j){return j.loaded}).map(function(j){return"["+j.start+"-"+j.end+"]"}))),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log("Loading "+e.type+" sn: "+e.sn+" of "+this.fragInfo(e,!1)+") cc: "+e.cc+" "+("["+m.startSN+"-"+m.endSN+"]")+", target: "+parseFloat(u.toFixed(3))),xe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Ve.FRAG_LOADING;var K=this.config.progressive,G;return K&&E?G=E.then(function(j){return!j||g.fragContextChanged(j.frag)?null:g.fragmentLoader.load(e,f)}).catch(function(j){return g.handleFragLoadError(j)}):G=Promise.all([this.fragmentLoader.load(e,K?f:void 0),E]).then(function(j){var ie=j[0];return!K&&f&&f(ie),ie}).catch(function(j){return g.handleFragLoadError(j)}),this.hls.trigger(N.FRAG_LOADING,{frag:e,targetBufferTime:u}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):G},s.doFragPartsLoad=function(e,a,u,f){var h=this;return new Promise(function(g,m){var E,T=[],A=(E=u.details)==null?void 0:E.partList,L=function(I){h.fragmentLoader.loadPart(e,I,f).then(function(D){T[I.index]=D;var U=D.part;h.hls.trigger(N.FRAG_LOADED,D);var K=to(u.details,e.sn,I.index+1)||nl(A,e.sn,I.index+1);if(K)L(K);else return g({frag:e,part:U,partsLoaded:T})}).catch(m)};L(a)})},s.handleFragLoadError=function(e){if("data"in e){var a=e.data;a&&a.details===be.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(N.ERROR,a)}else this.hls.trigger(N.ERROR,{type:ft.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},s._handleTransmuxerFlush=function(e){var a=this.getCurrentContext(e);if(!a||this.state!==Ve.PARSING){!this.fragCurrent&&this.state!==Ve.STOPPED&&this.state!==Ve.ERROR&&(this.state=Ve.IDLE);return}var u=a.frag,f=a.part,h=a.level,g=self.performance.now();u.stats.parsing.end=g,f&&(f.stats.parsing.end=g);var m=this.getLevelDetails(),E=m&&u.sn>m.endSN,T=E||this.shouldLoadParts(m,u.end);T!==this.loadingParts&&(this.log("LL-Part loading "+(T?"ON":"OFF")+" after parsing segment ending @"+u.end.toFixed(2)),this.loadingParts=T),this.updateLevelTiming(u,f,h,e.partial)},s.shouldLoadParts=function(e,a){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var u,f=e.partList[0];if(f.fragment.type===st.SUBTITLE)return!1;var h=f.end+(((u=e.fragmentHint)==null?void 0:u.duration)||0);if(a>=h){var g,m=this.hls.hasEnoughToStart?((g=this.media)==null?void 0:g.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(m>f.start-f.fragment.duration)return!0}}}return!1},s.getCurrentContext=function(e){var a=this.levels,u=this.fragCurrent,f=e.level,h=e.sn,g=e.part;if(!(a!=null&&a[f]))return this.warn("Levels object was unset while buffering fragment "+h+" of "+this.playlistLabel()+" "+f+". The current chunk will not be buffered."),null;var m=a[f],E=m.details,T=g>-1?to(E,h,g):null,A=T?T.fragment:eo(E,h,u);return A?(u&&u!==A&&(A.stats=u.stats),{frag:A,part:T,level:m}):null},s.bufferFragmentData=function(e,a,u,f,h){if(this.state===Ve.PARSING){var g=e.data1,m=e.data2,E=g;if(m&&(E=Xr(g,m)),!!E.length){var T=this.initPTS[a.cc],A=T?-T.baseTime/T.timescale:void 0,L={type:e.type,frag:a,part:u,chunkMeta:f,offset:A,parent:a.type,data:E};if(this.hls.trigger(N.BUFFER_APPENDING,L),e.dropped&&e.independent&&!u){if(h)return;this.flushBufferGap(a)}}}},s.flushBufferGap=function(e){var a=this.media;if(a){if(!Mt.isBuffered(a,a.currentTime)){this.flushMainBuffer(0,e.start);return}var u=a.currentTime,f=Mt.bufferInfo(a,u,0),h=e.duration,g=Math.min(this.config.maxFragLookUpTolerance*2,h*.25),m=Math.max(Math.min(e.start-g,f.end-g),u+g);e.start-m>g&&this.flushMainBuffer(m,e.start)}},s.getFwdBufferInfo=function(e,a){var u,f=this.getLoadPosition();if(!xe(f))return null;var h=this.lastCurrentTime>f,g=h||(u=this.media)!=null&&u.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,f,a,g)},s.getFwdBufferInfoAtPos=function(e,a,u,f){var h=Mt.bufferInfo(e,a,f);if(h.len===0&&h.nextStart!==void 0){var g=this.fragmentTracker.getBufferedFrag(a,u);if(g&&(h.nextStart<=g.end||g.gap)){var m=Math.max(Math.min(h.nextStart,g.end)-a,f);return Mt.bufferInfo(e,a,m)}}return h},s.getMaxBufferLength=function(e){var a=this.config,u;return e?u=Math.max(8*a.maxBufferSize/e,a.maxBufferLength):u=a.maxBufferLength,Math.min(u,a.maxMaxBufferLength)},s.reduceMaxBufferLength=function(e,a){var u=this.config,f=Math.max(Math.min(e-a,u.maxBufferLength),a),h=Math.max(e-a*3,u.maxMaxBufferLength/2,f);return h>=f?(u.maxMaxBufferLength=h,this.warn("Reduce max buffer length to "+h+"s"),!0):!1},s.getAppendedFrag=function(e,a){a===void 0&&(a=st.MAIN);var u=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,a):null;return u&&"fragment"in u?u.fragment:u},s.getNextFragment=function(e,a){var u=a.fragments,f=u.length;if(!f)return null;var h=this.config,g=u[0].start,m=h.lowLatencyMode&&!!a.partList,E=null;if(a.live){var T=h.initialLiveManifestSize;if(f<T)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+T+")"),null;if(!a.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<g){var A;m&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),E=this.getInitialLiveFragment(a);var L=this.hls.startPosition,k=this.hls.liveSyncPosition,I=E?(L!==-1&&L>=g?L:k)||E.start:e;this.log("Setting startPosition to "+I+" to match start frag at live edge. mainStart: "+L+" liveSyncPosition: "+k+" frag.start: "+((A=E)==null?void 0:A.start)),this.startPosition=this.nextLoadPosition=I}}else e<=g&&(E=u[0]);if(!E){var D=this.loadingParts?a.partEnd:a.fragmentEnd;E=this.getFragmentAtPosition(e,D,a)}var U=this.filterReplacedPrimary(E,a);if(!U&&E){var K=E.sn-a.startSN;U=this.filterReplacedPrimary(u[K+1]||null,a)}return this.mapToInitFragWhenRequired(U)},s.isLoopLoading=function(e,a){var u=this.fragmentTracker.getState(e);return(u===Sn.OK||u===Sn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>a},s.getNextFragmentLoopLoading=function(e,a,u,f,h){var g=null;if(e.gap&&(g=this.getNextFragment(this.nextLoadPosition,a),g&&!g.gap&&u.nextStart)){var m=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,u.nextStart,f,0);if(m!==null&&u.len+m.len>=h){var E=g.sn;return this.loopSn!==E&&(this.log('buffer full after gaps in "'+f+'" playlist starting at sn: '+E),this.loopSn=E),null}}return this.loopSn=void 0,g},s.filterReplacedPrimary=function(e,a){return e&&(Pf(this.config),e)},s.mapToInitFragWhenRequired=function(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e},s.getNextPart=function(e,a,u){for(var f=-1,h=!1,g=!0,m=0,E=e.length;m<E;m++){var T=e[m];if(g=g&&!T.independent,f>-1&&u<T.start)break;var A=T.loaded;A?f=-1:(h||(T.independent||g)&&T.fragment===a)&&(T.fragment!==a&&this.warn("Need buffer at "+u+" but next unloaded part starts at "+T.start),f=m),h=A}return f},s.loadedEndOfParts=function(e,a){for(var u,f=e.length;f--;){if(u=e[f],!u.loaded)return!1;if(a>u.start)return!0}return!1},s.getInitialLiveFragment=function(e){var a=e.fragments,u=this.fragPrevious,f=null;if(u){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+u.programDateTime),f=uu(a,u.endProgramDateTime,this.config.maxFragLookUpTolerance)),!f){var h=u.sn+1;if(h>=e.startSN&&h<=e.endSN){var g=a[h-e.startSN];u.cc===g.cc&&(f=g,this.log("Live playlist, switching playlist, load frag with next SN: "+f.sn))}f||(f=$o(e,u.cc,u.end),f&&this.log("Live playlist, switching playlist, load frag with same CC: "+f.sn))}}else{var m=this.hls.liveSyncPosition;m!==null&&(f=this.getFragmentAtPosition(m,this.bitrateTest?e.fragmentEnd:e.edge,e))}return f},s.getFragmentAtPosition=function(e,a,u){var f=this.config,h=this.fragPrevious,g=u.fragments,m=u.endSN,E=u.fragmentHint,T=f.maxFragLookUpTolerance,A=u.partList,L=!!(this.loadingParts&&A!=null&&A.length&&E);L&&!this.bitrateTest&&A[A.length-1].fragment.sn===E.sn&&(g=g.concat(E),m=E.sn);var k;if(e<a){var I,D=e<this.lastCurrentTime,U=D||e>a-T||(I=this.media)!=null&&I.paused||!this.startFragRequested?0:T;k=Jr(h,g,e,U)}else k=g[g.length-1];if(k){var K=k.sn-u.startSN,G=this.fragmentTracker.getState(k);if((G===Sn.OK||G===Sn.PARTIAL&&k.gap)&&(h=k),h&&k.sn===h.sn&&(!L||A[0].fragment.sn>k.sn||!u.live)){var j=k.level===h.level;if(j){var ie=g[K+1];k.sn<m&&this.fragmentTracker.getState(ie)!==Sn.OK?k=ie:k=null}}}return k},s.alignPlaylists=function(e,a,u){var f=e.fragments.length;if(!f)return this.warn("No fragments in live playlist"),0;var h=e.fragmentStart,g=!a,m=e.alignedSliding&&xe(h);if(g||!m&&!h){wg(u,e);var E=e.fragmentStart;return this.log("Live playlist sliding: "+E.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+e.startSN+" fragments: "+f),E}return h},s.waitForCdnTuneIn=function(e){var a=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*a)},s.setStartPosition=function(e,a){var u=this.startPosition;u<a&&(u=-1);var f=this.timelineOffset;if(u===-1){var h=this.startTimeOffset!==null,g=h?this.startTimeOffset:e.startTimeOffset;g!==null&&xe(g)?(u=a+g,g<0&&(u+=e.edge),u=Math.min(Math.max(a,u),a+e.totalduration),this.log("Setting startPosition to "+u+" for start time offset "+g+" found in "+(h?"multivariant":"media")+" playlist"),this.startPosition=u):e.live?(u=this.hls.liveSyncPosition||a,this.log("Setting startPosition to -1 to start at live edge "+u),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=u=0),this.lastCurrentTime=u+f}this.nextLoadPosition=u+f},s.getLoadPosition=function(){var e,a=this.media,u=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&a?u=a.currentTime:this.nextLoadPosition>=0&&(u=this.nextLoadPosition),u},s.handleFragLoadAborted=function(e,a){this.transmuxer&&e.type===this.playlistType&&ht(e)&&e.stats.aborted&&(this.log("Fragment "+e.sn+(a?" part "+a.index:"")+" of "+this.playlistLabel()+" "+e.level+" was aborted"),this.resetFragmentLoading(e))},s.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Ve.FRAG_LOADING_WAITING_RETRY)&&(this.state=Ve.IDLE)},s.onFragmentOrKeyLoadError=function(e,a){var u;if(a.chunkMeta&&!a.frag){var f=this.getCurrentContext(a.chunkMeta);f&&(a.frag=f.frag)}var h=a.frag;if(!(!h||h.type!==e||!this.levels)){if(this.fragContextChanged(h)){var g;this.warn("Frag load error must match current frag to retry "+h.url+" > "+((g=this.fragCurrent)==null?void 0:g.url));return}var m=a.details===be.FRAG_GAP;m&&this.fragmentTracker.fragBuffered(h,!0);var E=a.errorAction,T=E||{},A=T.action,L=T.flags,k=T.retryCount,I=k===void 0?0:k,D=T.retryConfig,U=!!E&&!!D,K=U&&A===sr.RetryRequest,G=U&&!E.resolved&&L===kn.MoveAllAlternatesMatchingHost,j=((u=a.response)==null?void 0:u.code)||0;if(!K&&G&&ht(h)&&!h.endList&&j!==0)this.resetFragmentErrors(e),this.treatAsGap(h),E.resolved=!0;else if((K||G)&&I<D.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var ie=_n(D,I);this.warn("Fragment "+h.sn+" of "+e+" "+h.level+" errored with "+a.details+", retrying loading "+(I+1)+"/"+D.maxNumRetry+" in "+ie+"ms"),E.resolved=!0,this.retryDate=self.performance.now()+ie,this.state=Ve.FRAG_LOADING_WAITING_RETRY}else if(D&&E)if(this.resetFragmentErrors(e),I<D.maxNumRetry)!m&&A!==sr.RemoveAlternatePermanently&&(E.resolved=!0);else{this.warn(a.details+" reached or exceeded max retry ("+I+")");return}else A===sr.SendAlternateToPenaltyBox?this.state=Ve.WAITING_LEVEL:this.state=Ve.ERROR;this.tickImmediate()}},s.reduceLengthAndFlushBuffer=function(e){if(this.state===Ve.PARSING||this.state===Ve.PARSED){var a=e.frag,u=e.parent,f=this.getFwdBufferInfo(this.mediaBuffer,u),h=f&&f.len>.5;h&&this.reduceMaxBufferLength(f.len,a?.duration||10);var g=!h;return g&&this.warn("Buffer full error while media.currentTime ("+this.getLoadPosition()+") is not buffered, flush "+u+" buffer"),a&&(this.fragmentTracker.removeFragment(a),this.nextLoadPosition=a.start),this.resetLoadingState(),g}return!1},s.resetFragmentErrors=function(e){e===st.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Ve.STOPPED&&(this.state=Ve.IDLE)},s.afterBufferFlushed=function(e,a,u){if(e){var f=Mt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(a,f,u),this.state===Ve.ENDED&&this.resetLoadingState()}},s.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Ve.STOPPED&&(this.state=Ve.IDLE)},s.resetStartWhenNotLoaded=function(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var a=e?e.details:null;a!=null&&a.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(a,a.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},s.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},s.updateLevelTiming=function(e,a,u,f){var h=this,g=u.details;if(!g){this.warn("level.details undefined");return}var m=Object.keys(e.elementaryStreams).reduce(function(A,L){var k=e.elementaryStreams[L];if(k){var I=k.endPTS-k.startPTS;if(I<=0)return h.warn("Could not parse fragment "+e.sn+" "+L+" duration reliably ("+I+")"),A||!1;var D=f?0:Zo(g,e,k.startPTS,k.endPTS,k.startDTS,k.endDTS,h);return h.hls.trigger(N.LEVEL_PTS_UPDATED,{details:g,level:u,drift:D,type:L,frag:e,start:k.startPTS,end:k.endPTS}),!0}return A},!1);if(!m){var E;if(u.fragmentError===0&&this.treatAsGap(e,u),((E=this.transmuxer)==null?void 0:E.error)===null){var T=new Error("Found no media in fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(T.message),this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:T,frag:e,reason:"Found no media in msn "+e.sn+" of "+this.playlistLabel()+' "'+u.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=Ve.PARSED,this.log("Parsed "+e.type+" sn: "+e.sn+(a?" part: "+a.index:"")+" of "+this.fragInfo(e,!1,a)+")"),this.hls.trigger(N.FRAG_PARSED,{frag:e,part:a})},s.playlistLabel=function(){return this.playlistType===st.MAIN?"level":"track"},s.fragInfo=function(e,a,u){var f,h;return a===void 0&&(a=!0),this.playlistLabel()+" "+e.level+" ("+(u?"part":"frag")+":["+((f=a&&!u?e.startPTS:(u||e).start)!=null?f:NaN).toFixed(3)+"-"+((h=a&&!u?e.endPTS:(u||e).end)!=null?h:NaN).toFixed(3)+"]"+(u&&e.type==="main"?"INDEPENDENT="+(u.independent?"YES":"NO"):"")},s.treatAsGap=function(e,a){a&&a.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)},s.resetTransmuxer=function(){var e;(e=this.transmuxer)==null||e.reset()},s.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},b(c,[{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,a=this.startPosition;return a===-1&&e?e:a}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var e=this.config.timelineOffset;if(e){var a;return((a=this.getLevelDetails())==null?void 0:a.appliedTimelineOffset)||e}return 0}},{key:"primaryPrefetch",get:function(){return Pf(this.config),!1}},{key:"state",get:function(){return this._state},set:function(e){var a=this._state;a!==e&&(this._state=e,this.log(a+"->"+e))}}])}(Rf);function Pf(l){return!1}function oo(l,c,s){bs(l,c,s),l.addEventListener(c,s)}function bs(l,c,s){l.removeEventListener(c,s)}var dl=2,Og=.1,Ng=.05,Fg=100,Bg=function(l){function c(n,e){var a;return a=l.call(this,"gap-controller",n.logger)||this,a.hls=void 0,a.fragmentTracker=void 0,a.media=null,a.mediaSource=void 0,a.nudgeRetry=0,a.stallReported=!1,a.stalled=null,a.moved=!1,a.seeking=!1,a.buffered={},a.lastCurrentTime=0,a.ended=0,a.waiting=0,a.onMediaPlaying=function(){a.ended=0,a.waiting=0},a.onMediaWaiting=function(){var u;(u=a.media)!=null&&u.seeking||(a.waiting=self.performance.now(),a.tick())},a.onMediaEnded=function(){if(a.hls){var u;a.ended=((u=a.media)==null?void 0:u.currentTime)||1,a.hls.trigger(N.MEDIA_ENDED,{stalled:!1})}},a.hls=n,a.fragmentTracker=e,a.registerListeners(),a}P(c,l);var s=c.prototype;return s.registerListeners=function(){var e=this.hls;e&&(e.on(N.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(N.BUFFER_APPENDED,this.onBufferAppended,this))},s.unregisterListeners=function(){var e=this.hls;e&&(e.off(N.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(N.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(N.BUFFER_APPENDED,this.onBufferAppended,this))},s.destroy=function(){l.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},s.onMediaAttached=function(e,a){this.setInterval(Fg),this.mediaSource=a.mediaSource;var u=this.media=a.media;oo(u,"playing",this.onMediaPlaying),oo(u,"waiting",this.onMediaWaiting),oo(u,"ended",this.onMediaEnded)},s.onMediaDetaching=function(e,a){this.clearInterval();var u=this.media;u&&(bs(u,"playing",this.onMediaPlaying),bs(u,"waiting",this.onMediaWaiting),bs(u,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},s.onBufferAppended=function(e,a){this.buffered=a.timeRanges},s.tick=function(){var e;if(!(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)){var a=this.media.currentTime;this.poll(a,this.lastCurrentTime),this.lastCurrentTime=a}},s.poll=function(e,a){var u,f,h=(u=this.hls)==null?void 0:u.config;if(h){var g=this.media;if(g){var m=g.seeking,E=this.seeking&&!m,T=!this.seeking&&m,A=g.paused&&!m||g.ended||g.playbackRate===0;if(this.seeking=m,e!==a){a&&(this.ended=0),this.moved=!0,m||(this.nudgeRetry=0,h.nudgeOnVideoHole&&!A&&e>a&&this.nudgeOnVideoHole(e,a)),this.waiting===0&&this.stallResolved(e);return}if(T||E){E&&this.stallResolved(e);return}if(A){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&g.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(N.MEDIA_ENDED,{stalled:!1}));return}if(!Mt.getBuffered(g).length){this.nudgeRetry=0;return}var L=Mt.bufferInfo(g,e,0),k=L.nextStart||0,I=this.fragmentTracker;if(m&&I&&this.hls){var D=Df(this.hls.inFlightFragments,e),U=L.len>dl,K=!k||D||k-e>dl&&!I.getPartialFragment(e);if(U||K)return;this.moved=!1}var G=(f=this.hls)==null?void 0:f.latestLevelDetails;if(!this.moved&&this.stalled!==null&&I){var j=L.len>0;if(!j&&!k)return;var ie=Math.max(k,L.start||0)-e,se=!!(G!=null&&G.live),he=se?G.targetduration*2:dl,ve=hl(e,I);if(ie>0&&(ie<=he||ve)){g.paused||this._trySkipBufferHole(ve);return}}var ge=h.detectStallWithCurrentTimeMs,de=self.performance.now(),ue=this.waiting,Ae=this.stalled;if(Ae===null)if(ue>0&&de-ue<ge)Ae=this.stalled=ue;else{this.stalled=de;return}var je=de-Ae;if(!m&&(je>=ge||ue)&&this.hls){var Re;if(((Re=this.mediaSource)==null?void 0:Re.readyState)==="ended"&&!(G!=null&&G.live)&&Math.abs(e-(G?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(N.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(L),!this.media||!this.hls)return}var Ie=Mt.bufferInfo(g,e,h.maxBufferHole);this._tryFixBufferStall(Ie,je,e)}}},s.stallResolved=function(e){var a=this.stalled;if(a&&this.hls&&(this.stalled=null,this.stallReported)){var u=self.performance.now()-a;this.log("playback not stuck anymore @"+e+", after "+Math.round(u)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(N.STALL_RESOLVED,{})}},s.nudgeOnVideoHole=function(e,a){var u,f=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(u=this.buffered.audio)!=null&&u.length&&f&&f.length>1&&e>f.end(0)){var h=Mt.bufferedInfo(Mt.timeRangesToArray(this.buffered.audio),e,0);if(h.len>1&&a>=h.start){var g=Mt.timeRangesToArray(f),m=Mt.bufferedInfo(g,a,0).bufferedIndex;if(m>-1&&m<g.length-1){var E=Mt.bufferedInfo(g,e,0).bufferedIndex,T=g[m].end,A=g[m+1].start;if((E===-1||E>m)&&A-T<1&&e-T<2){var L=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+e+" hole: "+T+" -> "+A+" buffered index: "+E);this.warn(L.message),this.media.currentTime+=1e-6;var k=hl(e,this.fragmentTracker);k&&"fragment"in k?k=k.fragment:k||(k=void 0);var I=Mt.bufferInfo(this.media,e,0);this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:L,reason:L.message,frag:k,buffer:I.len,bufferInfo:I})}}}}},s._tryFixBufferStall=function(e,a,u){var f,h,g=this.fragmentTracker,m=this.media,E=(f=this.hls)==null?void 0:f.config;if(!(!m||!g||!E)){var T=(h=this.hls)==null?void 0:h.latestLevelDetails,A=hl(u,g);if(A||T!=null&&T.live&&u<T.fragmentStart){var L=this._trySkipBufferHole(A);if(L||!this.media)return}var k=e.buffered,I=this.adjacentTraversal(e,u);(k&&k.length>1&&e.len>E.maxBufferHole||e.nextStart&&(e.nextStart-u<E.maxBufferHole||I))&&(a>E.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}},s.adjacentTraversal=function(e,a){var u=this.fragmentTracker,f=e.nextStart;if(u&&f){var h=u.getFragAtPos(a,st.MAIN),g=u.getFragAtPos(f,st.MAIN);if(h&&g)return g.sn-h.sn<2}return!1},s._reportStall=function(e){var a=this.hls,u=this.media,f=this.stallReported,h=this.stalled;if(!f&&h!==null&&u&&a){this.stallReported=!0;var g=new Error("Playback stalling at @"+u.currentTime+" due to low buffer ("+Ur(e)+")");this.warn(g.message),a.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,fatal:!1,error:g,buffer:e.len,bufferInfo:e,stalled:{start:h}})}},s._trySkipBufferHole=function(e){var a,u=this.fragmentTracker,f=this.media,h=(a=this.hls)==null?void 0:a.config;if(!f||!u||!h)return 0;var g=f.currentTime,m=Mt.bufferInfo(f,g,0),E=g<m.start?m.start:m.nextStart;if(E&&this.hls){var T=m.len<=h.maxBufferHole,A=m.len>0&&m.len<1&&f.readyState<3,L=E-g;if(L>0&&(T||A)){if(L>h.maxBufferHole){var k=!1;if(g===0){var I=u.getAppendedFrag(0,st.MAIN);I&&E<I.end&&(k=!0)}if(!k&&e){var D;if(!((D=this.hls.loadLevelObj)!=null&&D.details))return 0;var U=Df(this.hls.inFlightFragments,E);if(U)return 0;for(var K=!1,G=e.end;G<E;){var j=hl(G,u);if(j)G+=j.duration;else{K=!0;break}}if(K)return 0}}var ie=Math.max(E+Ng,g+Og);if(this.warn("skipping hole, adjusting currentTime from "+g+" to "+ie),this.moved=!0,f.currentTime=ie,!(e!=null&&e.gap)){var se=new Error("fragment loaded with buffer holes, seeking from "+g+" to "+ie),he={type:ft.MEDIA_ERROR,details:be.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:se,reason:se.message,buffer:m.len,bufferInfo:m};e&&("fragment"in e?he.part=e:he.frag=e),this.hls.trigger(N.ERROR,he)}return ie}}return 0},s._tryNudgeBuffer=function(e){var a=this.hls,u=this.media,f=this.nudgeRetry,h=a?.config;if(!u||!h)return 0;var g=u.currentTime;if(this.nudgeRetry++,f<h.nudgeMaxRetry){var m=g+(f+1)*h.nudgeOffset,E=new Error("Nudging 'currentTime' from "+g+" to "+m);this.warn(E.message),u.currentTime=m,a.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_NUDGE_ON_STALL,error:E,fatal:!1,buffer:e.len,bufferInfo:e})}else{var T=new Error("Playhead still not moving while enough data buffered @"+g+" after "+h.nudgeMaxRetry+" nudges");this.error(T.message),a.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,error:T,fatal:!0,buffer:e.len,bufferInfo:e})}},b(c,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(Rf);function Df(l,c){var s=Mf(l.main);if(s&&s.start<=c)return s;var n=Mf(l.audio);return n&&n.start<=c?n:null}function Mf(l){if(!l)return null;switch(l.state){case Ve.IDLE:case Ve.STOPPED:case Ve.ENDED:case Ve.ERROR:return null}return l.frag}function hl(l,c){return c.getAppendedFrag(l,st.MAIN)||c.getPartialFragment(l)}function Ug(l,c){var s;try{s=new Event("addtrack")}catch{s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=l,c.dispatchEvent(s)}function Gg(l,c){var s=l.mode;if(s==="disabled"&&(l.mode="hidden"),l.cues)for(var n=l.cues.length;n--;)c&&l.cues[n].removeEventListener("enter",c),l.removeCue(l.cues[n]);s==="disabled"&&(l.mode=s)}function jg(l,c,s,n){var e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0)for(var a=Kg(l.cues,c,s),u=0;u<a.length;u++)(!n||n(a[u]))&&l.removeCue(a[u]);e==="disabled"&&(l.mode=e)}function Vg(l,c){if(c<=l[0].startTime)return 0;var s=l.length-1;if(c>l[s].endTime)return-1;for(var n=0,e=s,a;n<=e;)if(a=Math.floor((e+n)/2),c<l[a].startTime)e=a-1;else if(c>l[a].startTime&&n<s)n=a+1;else return a;return l[n].startTime-c<c-l[e].startTime?n:e}function Kg(l,c,s){var n=[],e=Vg(l,c);if(e>-1)for(var a=e,u=l.length;a<u;a++){var f=l[a];if(f.startTime>=c&&f.endTime<=s)n.push(f);else if(f.startTime>s)return n}return n}var Hg=.25;function Cu(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Of(l,c,s,n,e){var a=new l(c,s,"");try{a.value=n,e&&(a.type=e)}catch{a=new l(c,s,Ur(e?H({type:e},n):n))}return a}var pl=function(){var l=Cu();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}(),qg=function(){function l(s){var n=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=function(){n.hls&&n.hls.trigger(N.EVENT_CUE_ENTER,{})},this.hls=s,this._registerListeners()}var c=l.prototype;return c.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},c._registerListeners=function(){var n=this.hls;n&&(n.on(N.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(N.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(N.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(N.MANIFEST_LOADING,this.onManifestLoading,this),n.on(N.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.on(N.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(N.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(N.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},c._unregisterListeners=function(){var n=this.hls;n&&(n.off(N.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(N.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(N.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(N.MANIFEST_LOADING,this.onManifestLoading,this),n.off(N.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.off(N.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(N.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(N.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},c.onMediaAttaching=function(n,e){var a;this.media=e.media,((a=e.overrides)==null?void 0:a.cueRemoval)===!1&&(this.removeCues=!1)},c.onMediaAttached=function(){var n,e=(n=this.hls)==null?void 0:n.latestLevelDetails;e&&this.updateDateRangeCues(e)},c.onMediaDetaching=function(n,e){this.media=null;var a=!!e.transferMedia;a||(this.id3Track&&(this.removeCues&&Gg(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},c.onManifestLoading=function(){this.dateRangeCuesAppended={}},c.createTrack=function(n){var e=this.getID3Track(n.textTracks);return e.mode="hidden",e},c.getID3Track=function(n){if(this.media){for(var e=0;e<n.length;e++){var a=n[e];if(a.kind==="metadata"&&a.label==="id3")return Ug(a,this.media),a}return this.media.addTextTrack("metadata","id3")}},c.onFragParsingMetadata=function(n,e){if(!(!this.media||!this.hls)){var a=this.hls.config,u=a.enableEmsgMetadataCues,f=a.enableID3MetadataCues;if(!(!u&&!f)){var h=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var g=Cu();if(g)for(var m=0;m<h.length;m++){var E=h[m].type;if(!(E===we.emsg&&!u||!f)){var T=Te(h[m].data),A=h[m].pts,L=A+h[m].duration;L>pl&&(L=pl);var k=L-A;k<=0&&(L=A+Hg);for(var I=0;I<T.length;I++){var D=T[I];if(!Me(D)){this.updateId3CueEnds(A,E);var U=Of(g,A,L,D,E);U&&this.id3Track.addCue(U)}}}}}}},c.updateId3CueEnds=function(n,e){var a,u=(a=this.id3Track)==null?void 0:a.cues;if(u)for(var f=u.length;f--;){var h=u[f];h.type===e&&h.startTime<n&&h.endTime===pl&&(h.endTime=n)}},c.onBufferFlushing=function(n,e){var a=e.startOffset,u=e.endOffset,f=e.type,h=this.id3Track,g=this.hls;if(g){var m=g.config,E=m.enableEmsgMetadataCues,T=m.enableID3MetadataCues;if(h&&(E||T)){var A;f==="audio"?A=function(k){return k.type===we.audioId3&&T}:f==="video"?A=function(k){return k.type===we.emsg&&E}:A=function(k){return k.type===we.audioId3&&T||k.type===we.emsg&&E},jg(h,a,u,A)}}},c.onLevelUpdated=function(n,e){var a=e.details;this.updateDateRangeCues(a,!0)},c.onLevelPtsUpdated=function(n,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)},c.updateDateRangeCues=function(n,e){var a=this;if(!(!this.hls||!this.media)){var u=this.hls.config;u.assetPlayerId,u.timelineOffset;var f=u.enableDateRangeMetadataCues;if(u.interstitialsController,!!f){var h=Cu();if(n.hasProgramDateTime){var g=this.id3Track,m=n.dateRanges,E=Object.keys(m),T=this.dateRangeCuesAppended;if(g&&e){var A;if((A=g.cues)!=null&&A.length)for(var L=Object.keys(T).filter(function(G){return!E.includes(G)}),k=function(){var j,ie=L[I],se=(j=T[ie])==null?void 0:j.cues;delete T[ie],se&&Object.keys(se).forEach(function(he){var ve=se[he];if(ve){ve.removeEventListener("enter",a.onEventCueEnter);try{g.removeCue(ve)}catch{}}})},I=L.length;I--;)k();else T=this.dateRangeCuesAppended={}}var D=n.fragments[n.fragments.length-1];if(!(E.length===0||!xe(D?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var U=function(){var j=E[K],ie=m[j],se=ie.startTime,he=T[j],ve=he?.cues||{},ge=he?.durationKnown||!1,de=pl,ue=ie.duration,Ae=ie.endDate;if(Ae&&ue!==null)de=se+ue,ge=!0;else if(ie.endOnNext&&!ge){var je=E.reduce(function(at,ct){if(ct!==ie.id){var lt=m[ct];if(lt.class===ie.class&&lt.startDate>ie.startDate&&(!at||ie.startDate<at.startDate))return lt}return at},null);je&&(de=je.startTime,ge=!0)}for(var Re=Object.keys(ie.attr),Ie=0;Ie<Re.length;Ie++){var $e=Re[Ie];if(hu($e)){var Ze=ve[$e];if(Ze)ge&&!(he!=null&&he.durationKnown)?Ze.endTime=de:Math.abs(Ze.startTime-se)>.01&&(Ze.startTime=se,Ze.endTime=de);else if(h){var Qe=ie.attr[$e];Ws($e)&&(Qe=Tt(Qe));var it={key:$e,data:Qe},xt=Of(h,se,de,it,we.dateRange);xt&&(xt.id=j,a.id3Track.addCue(xt),ve[$e]=xt)}}}T[j]={cues:ve,dateRange:ie,durationKnown:ge}},K=0;K<E.length;K++)U()}}}}},l}(),Wg=function(){function l(s){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=n.media,a=n.levelDetails;if(!(!e||!a)){n.currentTime=e.currentTime;var u=n.computeLatency();if(u!==null){n._latency=u;var f=n.config,h=f.lowLatencyMode,g=f.maxLiveSyncPlaybackRate;if(!(!h||g===1||!a.live)){var m=n.targetLatency;if(m!==null){var E=u-m,T=Math.min(n.maxLatency,m+a.targetduration),A=E<T;if(A&&E>.05&&n.forwardBufferLength>1){var L=Math.min(2,Math.max(1,g)),k=Math.round(2/(1+Math.exp(-.75*E-n.edgeStalled))*20)/20,I=Math.min(L,Math.max(1,k));n.changeMediaPlaybackRate(e,I)}else e.playbackRate!==1&&e.playbackRate!==0&&n.changeMediaPlaybackRate(e,1)}}}}},this.hls=s,this.config=s.config,this.registerListeners()}var c=l.prototype;return c.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},c.registerListeners=function(){var n=this.hls;n&&(n.on(N.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(N.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(N.MANIFEST_LOADING,this.onManifestLoading,this),n.on(N.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(N.ERROR,this.onError,this))},c.unregisterListeners=function(){var n=this.hls;n&&(n.off(N.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(N.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(N.MANIFEST_LOADING,this.onManifestLoading,this),n.off(N.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(N.ERROR,this.onError,this))},c.onMediaAttached=function(n,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},c.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},c.onManifestLoading=function(){this._latency=null,this.stallCount=0},c.onLevelUpdated=function(n,e){var a=e.details;a.advanced&&this.onTimeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},c.onError=function(n,e){var a;e.details===be.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(a=this.levelDetails)!=null&&a.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},c.changeMediaPlaybackRate=function(n,e){var a,u;n.playbackRate!==e&&((a=this.hls)==null||a.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((u=this.targetLatency)==null?void 0:u.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+n.playbackRate+" to "+e),n.playbackRate=e)},c.estimateLiveEdge=function(){var n=this.levelDetails;return n===null?null:n.edge+n.age},c.computeLatency=function(){var n=this.estimateLiveEdge();return n===null?null:n-this.currentTime},b(l,[{key:"levelDetails",get:function(){var n;return((n=this.hls)==null?void 0:n.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var n=this.config;if(n.liveMaxLatencyDuration!==void 0)return n.liveMaxLatencyDuration;var e=this.levelDetails;return e?n.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var n=this.levelDetails;if(n===null||this.hls===null)return null;var e=n.holdBack,a=n.partHoldBack,u=n.targetduration,f=this.config,h=f.liveSyncDuration,g=f.liveSyncDurationCount,m=f.lowLatencyMode,E=this.hls.userConfig,T=m&&a||e;(this._targetLatencyUpdated||E.liveSyncDuration||E.liveSyncDurationCount||T===0)&&(T=h!==void 0?h:g*u);var A=u;return T+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,A)},set:function(n){this.stallCount=0,this.config.liveSyncDuration=n,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var n=this.estimateLiveEdge(),e=this.targetLatency;if(n===null||e===null)return null;var a=this.levelDetails;if(a===null)return null;var u=a.edge,f=n-e-this.edgeStalled,h=u-a.totalduration,g=u-(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.min(Math.max(h,f),g)}},{key:"drift",get:function(){var n=this.levelDetails;return n===null?1:n.drift}},{key:"edgeStalled",get:function(){var n=this.levelDetails;if(n===null)return 0;var e=(this.config.lowLatencyMode&&n.partTarget||n.targetduration)*3;return Math.max(n.age-e,0)}},{key:"forwardBufferLength",get:function(){var n=this.media,e=this.levelDetails;if(!n||!e)return 0;var a=n.buffered.length;return(a?n.buffered.end(a-1):e.edge)-this.currentTime}}])}(),Yg=function(l){function c(n,e){var a;return a=l.call(this,e,n.logger)||this,a.hls=void 0,a.canLoad=!1,a.timer=-1,a.hls=n,a}P(c,l);var s=c.prototype;return s.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},s.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},s.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},s.stopLoad=function(){this.canLoad=!1,this.clearTimer()},s.switchParams=function(e,a,u){var f=a?.renditionReports;if(f){for(var h=-1,g=0;g<f.length;g++){var m=f[g],E=void 0;try{E=new self.URL(m.URI,a.url).href}catch(D){this.warn("Could not construct new URL for Rendition Report: "+D),E=m.URI||""}if(E===e){h=g;break}else E===e.substring(0,E.length)&&(h=g)}if(h!==-1){var T=f[h],A=parseInt(T["LAST-MSN"])||a.lastPartSn,L=parseInt(T["LAST-PART"])||a.lastPartIndex;if(this.hls.config.lowLatencyMode){var k=Math.min(a.age-a.partTarget,a.targetduration);L>=0&&k>a.partTarget&&(L+=1)}var I=u&&$t(u);return new $i(A,L>=0?L:void 0,I)}}},s.loadPlaylist=function(e){this.clearTimer()},s.loadingPlaylist=function(e,a){this.clearTimer()},s.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},s.getUrlWithDirectives=function(e,a){if(a)try{return a.addDirectives(e)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}return e},s.playlistLoaded=function(e,a,u){var f=a.details,h=a.stats,g=self.performance.now(),m=h.loading.first?Math.max(0,g-h.loading.first):0;f.advancedDateTime=Date.now()-m;var E=this.hls.config.timelineOffset;if(E!==f.appliedTimelineOffset){var T=Math.max(E||0,0);f.appliedTimelineOffset=T,f.fragments.forEach(function(it){it.setStart(it.playlistOffset+T)})}if(f.live||u!=null&&u.live){var A="levelInfo"in a?a.levelInfo:a.track;if(f.reloaded(u),u&&f.fragments.length>0){Js(u,f,this);var L=f.playlistParsingError;if(L){this.warn(L);var k=this.hls;if(!k.config.ignorePlaylistParsingErrors){var I,D=a.networkDetails;k.trigger(N.ERROR,{type:ft.NETWORK_ERROR,details:be.LEVEL_PARSING_ERROR,fatal:!1,url:f.url,error:L,reason:L.message,level:a.level||void 0,parent:(I=f.fragments[0])==null?void 0:I.type,networkDetails:D,stats:h});return}f.playlistParsingError=null}}f.requestScheduled===-1&&(f.requestScheduled=h.loading.start);var U=this.hls.mainForwardBufferInfo,K=U?U.end-U.len:0,G=(f.edge-K)*1e3,j=rl(f,G);if(f.requestScheduled+j<g?f.requestScheduled=g:f.requestScheduled+=j,this.log("live playlist "+e+" "+(f.advanced?"REFRESHED "+f.lastPartSn+"-"+f.lastPartIndex:f.updated?"UPDATED":"MISSED")),!this.canLoad||!f.live)return;var ie,se=void 0,he=void 0;if(f.canBlockReload&&f.endSN&&f.advanced){var ve=this.hls.config.lowLatencyMode,ge=f.lastPartSn,de=f.endSN,ue=f.lastPartIndex,Ae=ue!==-1,je=ge===de;Ae?je?(se=de+1,he=ve?0:ue):(se=ge,he=ve?ue+1:f.maxPartIndex):se=de+1;var Re=f.age,Ie=Re+f.ageHeader,$e=Math.min(Ie-f.partTarget,f.targetduration*1.5);if($e>0){if(Ie>f.targetduration*3)this.log("Playlist last advanced "+Re.toFixed(2)+"s ago. Omitting segment and part directives."),se=void 0,he=void 0;else if(u!=null&&u.tuneInGoal&&Ie-f.partTarget>u.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+u.tuneInGoal+" to: "+$e+" with playlist age: "+f.age),$e=0;else{var Ze=Math.floor($e/f.targetduration);if(se+=Ze,he!==void 0){var Qe=Math.round($e%f.targetduration/f.partTarget);he+=Qe}this.log("CDN Tune-in age: "+f.ageHeader+"s last advanced "+Re.toFixed(2)+"s goal: "+$e+" skip sn "+Ze+" to part "+he)}f.tuneInGoal=$e}if(ie=this.getDeliveryDirectives(f,a.deliveryDirectives,se,he),ve||!je){f.requestScheduled=g,this.loadingPlaylist(A,ie);return}}else(f.canBlockReload||f.canSkipUntil)&&(ie=this.getDeliveryDirectives(f,a.deliveryDirectives,se,he));ie&&se!==void 0&&f.canBlockReload&&(f.requestScheduled=h.loading.first+Math.max(j-m*2,j/2)),this.scheduleLoading(A,ie,f)}else this.clearTimer()},s.scheduleLoading=function(e,a,u){var f=this,h=u||e.details;if(!h){this.loadingPlaylist(e,a);return}var g=self.performance.now(),m=h.requestScheduled;if(g>=m){this.loadingPlaylist(e,a);return}var E=m-g;this.log("reload live playlist "+(e.name||e.bitrate+"bps")+" in "+Math.round(E)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return f.loadingPlaylist(e,a)},E)},s.getDeliveryDirectives=function(e,a,u,f){var h=$t(e);return a!=null&&a.skip&&e.deltaUpdateFailed&&(u=a.msn,f=a.part,h=ba.No),new $i(u,f,h)},s.checkRetry=function(e){var a=this,u=e.details,f=_a(e),h=e.errorAction,g=h||{},m=g.action,E=g.retryCount,T=E===void 0?0:E,A=g.retryConfig,L=!!h&&!!A&&(m===sr.RetryRequest||!h.resolved&&m===sr.SendAlternateToPenaltyBox);if(L){var k;if(T>=A.maxNumRetry)return!1;if(f&&(k=e.context)!=null&&k.deliveryDirectives)this.warn("Retrying playlist loading "+(T+1)+"/"+A.maxNumRetry+' after "'+u+'" without delivery-directives'),this.loadPlaylist();else{var I=_n(A,T);this.clearTimer(),this.timer=self.setTimeout(function(){return a.loadPlaylist()},I),this.warn("Retrying playlist loading "+(T+1)+"/"+A.maxNumRetry+' after "'+u+'" in '+I+"ms")}e.levelRetry=!0,h.resolved=!0}return L},c}(rt),zg=function(l){function c(n,e){var a;return a=l.call(this,n,"level-controller")||this,a._levels=[],a._firstLevel=-1,a._maxAutoLevel=-1,a._startLevel=void 0,a.currentLevel=null,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.steering=void 0,a.onParsedComplete=void 0,a.steering=e,a._registerListeners(),a}P(c,l);var s=c.prototype;return s._registerListeners=function(){var e=this.hls;e.on(N.MANIFEST_LOADING,this.onManifestLoading,this),e.on(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(N.LEVEL_LOADED,this.onLevelLoaded,this),e.on(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(N.FRAG_BUFFERED,this.onFragBuffered,this),e.on(N.ERROR,this.onError,this)},s._unregisterListeners=function(){var e=this.hls;e.off(N.MANIFEST_LOADING,this.onManifestLoading,this),e.off(N.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(N.LEVEL_LOADED,this.onLevelLoaded,this),e.off(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(N.FRAG_BUFFERED,this.onFragBuffered,this),e.off(N.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),l.prototype.destroy.call(this)},s.stopLoad=function(){var e=this._levels;e.forEach(function(a){a.loadError=0,a.fragmentError=0}),l.prototype.stopLoad.call(this)},s.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},s.onManifestLoading=function(e,a){this.resetLevels()},s.onManifestLoaded=function(e,a){var u=this,f=this.hls.config.preferManagedMediaSource,h=[],g={},m={},E=!1,T=!1,A=!1;a.levels.forEach(function(L){var k=L.attrs,I=L.audioCodec,D=L.videoCodec;I&&(L.audioCodec=I=ma(I,f)||void 0),D&&(D=L.videoCodec=Bs(D));var U=L.width,K=L.height,G=L.unknownCodecs,j=G?G.length:0;if(G)for(var ie=j;ie--;){var se=G[ie];u.isAudioSupported(se)?(L.audioCodec=I=I?I+","+se:se,j--,Br.audio[I.substring(0,4)]=2):u.isVideoSupported(se)&&(L.videoCodec=D=D?D+","+se:se,j--,Br.video[D.substring(0,4)]=2)}if(E||(E=!!(U&&K)),T||(T=!!D),A||(A=!!I),j||I&&!u.isAudioSupported(I)||D&&!u.isVideoSupported(D)){u.log('Some or all CODECS not supported "'+k.CODECS+'"');return}var he=k.CODECS,ve=k["FRAME-RATE"],ge=k["HDCP-LEVEL"],de=k["PATHWAY-ID"],ue=k.RESOLUTION,Ae=k["VIDEO-RANGE"],je=(de||".")+"-",Re=""+je+L.bitrate+"-"+ue+"-"+ve+"-"+he+"-"+Ae+"-"+ge;if(g[Re])if(g[Re].uri!==L.url&&!L.attrs["PATHWAY-ID"]){var $e=m[Re]+=1;L.attrs["PATHWAY-ID"]=new Array($e+1).join(".");var Ze=u.createLevel(L);g[Re]=Ze,h.push(Ze)}else g[Re].addGroupId("audio",k.AUDIO),g[Re].addGroupId("text",k.SUBTITLES);else{var Ie=u.createLevel(L);g[Re]=Ie,m[Re]=1,h.push(Ie)}}),this.filterAndSortMediaOptions(h,a,E,T,A)},s.createLevel=function(e){var a=new Xi(e),u=e.supplemental;if(u!=null&&u.videoCodec&&!this.isVideoSupported(u.videoCodec)){var f=new Error('SUPPLEMENTAL-CODECS not supported "'+u.videoCodec+'"');this.log(f.message),a.supportedResult=qn.getUnsupportedResult(f,[])}return a},s.isAudioSupported=function(e){return an(e,"audio",this.hls.config.preferManagedMediaSource)},s.isVideoSupported=function(e){return an(e,"video",this.hls.config.preferManagedMediaSource)},s.filterAndSortMediaOptions=function(e,a,u,f,h){var g=this,m=[],E=[],T=e;if((u||f)&&h&&(T=T.filter(function(ve){var ge=ve.videoCodec,de=ve.videoRange,ue=ve.width,Ae=ve.height;return(!!ge||!!(ue&&Ae))&&qo(de)})),T.length===0){Promise.resolve().then(function(){if(g.hls){var ve="no level with compatible codecs found in manifest",ge=ve;a.levels.length&&(ge="one or more CODECS in variant not supported: "+Ur(a.levels.map(function(ue){return ue.attrs.CODECS}).filter(function(ue,Ae,je){return je.indexOf(ue)===Ae})),g.warn(ge),ve+=" ("+ge+")");var de=new Error(ve);g.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,error:de,reason:ge})}});return}a.audioTracks&&(m=a.audioTracks.filter(function(ve){return!ve.audioCodec||g.isAudioSupported(ve.audioCodec)}),Nf(m)),a.subtitles&&(E=a.subtitles,Nf(E));var A=T.slice(0);T.sort(function(ve,ge){if(ve.attrs["HDCP-LEVEL"]!==ge.attrs["HDCP-LEVEL"])return(ve.attrs["HDCP-LEVEL"]||"")>(ge.attrs["HDCP-LEVEL"]||"")?1:-1;if(u&&ve.height!==ge.height)return ve.height-ge.height;if(ve.frameRate!==ge.frameRate)return ve.frameRate-ge.frameRate;if(ve.videoRange!==ge.videoRange)return ya.indexOf(ve.videoRange)-ya.indexOf(ge.videoRange);if(ve.videoCodec!==ge.videoCodec){var de=Wi(ve.videoCodec),ue=Wi(ge.videoCodec);if(de!==ue)return ue-de}if(ve.uri===ge.uri&&ve.codecSet!==ge.codecSet){var Ae=ci(ve.codecSet),je=ci(ge.codecSet);if(Ae!==je)return je-Ae}return ve.averageBitrate!==ge.averageBitrate?ve.averageBitrate-ge.averageBitrate:0});var L=A[0];if(this.steering&&(T=this.steering.filterParsedLevels(T),T.length!==A.length)){for(var k=0;k<A.length;k++)if(A[k].pathwayId===T[0].pathwayId){L=A[k];break}}this._levels=T;for(var I=0;I<T.length;I++)if(T[I]===L){var D;this._firstLevel=I;var U=L.bitrate,K=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+T.length+" level(s) found, first bitrate: "+U),((D=this.hls.userConfig)==null?void 0:D.abrEwmaDefaultEstimate)===void 0){var G=Math.min(U,this.hls.config.abrEwmaDefaultEstimateMax);G>K&&K===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=G)}break}var j=h&&!f,ie=this.hls.config,se=!!(ie.audioStreamController&&ie.audioTrackController),he={levels:T,audioTracks:m,subtitleTracks:E,sessionData:a.sessionData,sessionKeys:a.sessionKeys,firstLevel:this._firstLevel,stats:a.stats,audio:h,video:f,altAudio:se&&!j&&m.some(function(ve){return!!ve.url})};this.hls.trigger(N.MANIFEST_PARSED,he)},s.onError=function(e,a){a.fatal||!a.context||a.context.type===ut.LEVEL&&a.context.level===this.level&&this.checkRetry(a)},s.onFragBuffered=function(e,a){var u=a.frag;if(u!==void 0&&u.type===st.MAIN){var f=u.elementaryStreams;if(!Object.keys(f).some(function(g){return!!f[g]}))return;var h=this._levels[u.level];h!=null&&h.loadError&&(this.log("Resetting level error count of "+h.loadError+" on frag buffered"),h.loadError=0)}},s.onLevelLoaded=function(e,a){var u,f=a.level,h=a.details,g=a.levelInfo;if(!g){var m;this.warn("Invalid level index "+f),(m=a.deliveryDirectives)!=null&&m.skip&&(h.deltaUpdateFailed=!0);return}if(g===this.currentLevel||a.withoutMultiVariant){g.fragmentError===0&&(g.loadError=0);var E=g.details;E===a.details&&E.advanced&&(E=void 0),this.playlistLoaded(f,a,E)}else(u=a.deliveryDirectives)!=null&&u.skip&&(h.deltaUpdateFailed=!0)},s.loadPlaylist=function(e){l.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)},s.loadingPlaylist=function(e,a){l.prototype.loadingPlaylist.call(this,e,a);var u=this.getUrlWithDirectives(e.uri,a),f=this.currentLevelIndex,h=e.attrs["PATHWAY-ID"],g=e.details,m=g?.age;this.log("Loading level index "+f+(a?.msn!==void 0?" at sn "+a.msn+" part "+a.part:"")+(h?" Pathway "+h:"")+(m&&g.live?" age "+m.toFixed(1)+(g.type&&" "+g.type||""):"")+" "+u),this.hls.trigger(N.LEVEL_LOADING,{url:u,level:f,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:a||null})},s.removeLevel=function(e){var a=this,u;if(this._levels.length!==1){var f=this._levels.filter(function(g,m){return m!==e?!0:(a.steering&&a.steering.removeLevel(g),g===a.currentLevel&&(a.currentLevel=null,a.currentLevelIndex=-1,g.details&&g.details.fragments.forEach(function(E){return E.level=-1})),!1)});ro(f),this._levels=f,this.currentLevelIndex>-1&&(u=this.currentLevel)!=null&&u.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var h=f.length-1;this._firstLevel=Math.min(this._firstLevel,h),this._startLevel&&(this._startLevel=Math.min(this._startLevel,h)),this.hls.trigger(N.LEVELS_UPDATED,{levels:f})}},s.onLevelsUpdated=function(e,a){var u=a.levels;this._levels=u},s.checkMaxAutoUpdated=function(){var e=this.hls,a=e.autoLevelCapping,u=e.maxAutoLevel,f=e.maxHdcpLevel;this._maxAutoLevel!==u&&(this._maxAutoLevel=u,this.hls.trigger(N.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:a,levels:this.levels,maxAutoLevel:u,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:f}))},b(c,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var a=this._levels;if(a.length!==0){if(e<0||e>=a.length){var u=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(N.ERROR,{type:ft.OTHER_ERROR,details:be.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:u,reason:u.message}),f)return;e=Math.min(e,a.length-1)}var h=this.currentLevelIndex,g=this.currentLevel,m=g?g.attrs["PATHWAY-ID"]:void 0,E=a[e],T=E.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=E,!(h===e&&g&&m===T)){this.log("Switching to level "+e+" ("+(E.height?E.height+"p ":"")+(E.videoRange?E.videoRange+" ":"")+(E.codecSet?E.codecSet+" ":"")+"@"+E.bitrate+")"+(T?" with Pathway "+T:"")+" from level "+h+(m?" with Pathway "+m:""));var A={level:e,attrs:E.attrs,details:E.details,bitrate:E.bitrate,averageBitrate:E.averageBitrate,maxBitrate:E.maxBitrate,realBitrate:E.realBitrate,width:E.width,height:E.height,codecSet:E.codecSet,audioCodec:E.audioCodec,videoCodec:E.videoCodec,audioGroups:E.audioGroups,subtitleGroups:E.subtitleGroups,loaded:E.loaded,loadError:E.loadError,fragmentError:E.fragmentError,name:E.name,id:E.id,uri:E.uri,url:E.url,urlId:0,audioGroupIds:E.audioGroupIds,textGroupIds:E.textGroupIds};this.hls.trigger(N.LEVEL_SWITCHING,A);var L=E.details;if(!L||L.live){var k=this.switchParams(E.uri,g?.details,L);this.loadPlaylist(k)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var a=this.steering.pathways(),u=e.filter(function(f){return a.indexOf(f)!==-1});if(e.length<1){this.warn("pathwayPriority "+e+" should contain at least one pathway from list: "+a);return}this.steering.pathwayPriority=u}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}])}(Yg);function Nf(l){var c={};l.forEach(function(s){var n=s.groupId||"";s.id=c[n]=c[n]||0,c[n]++})}var Lu=[];typeof o<"u"&&o&&$g();function $g(){self.addEventListener("message",function(l){var c=l.data,s=c.instanceNo;if(s!==void 0){var n=Lu[s];if(c.cmd==="reset"&&(delete Lu[c.resetNo],n&&n.destroy(),c.cmd="init"),c.cmd==="init"){var e=JSON.parse(c.config),a=new Ce;a.on(N.FRAG_DECRYPTED,Es),a.on(N.ERROR,Es);var u=On(e.debug,c.id);Xg(u,s),Lu[s]=new Su(a,c.typeSupported,e,"",c.id,u),Es("init",null,s);return}if(n)switch(c.cmd){case"configure":{n.configure(c.config);break}case"demux":{var f=n.push(c.data,c.decryptdata,c.chunkMeta,c.state);La(f)?f.then(function(m){Ru(self,m,s)}).catch(function(m){Es(N.ERROR,{instanceNo:s,type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,chunkMeta:c.chunkMeta,fatal:!1,error:m,err:m,reason:"transmuxer-worker push error"},s)}):Ru(self,f,s);break}case"flush":{var h=c.chunkMeta,g=n.flush(h);La(g)?g.then(function(m){Bf(self,m,h,s)}).catch(function(m){Es(N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,chunkMeta:c.chunkMeta,fatal:!1,error:m,err:m,reason:"transmuxer-worker flush error"},s)}):Bf(self,g,h,s);break}}}})}function Ru(l,c,s){if(Qg(c.remuxResult))return!1;var n=[],e=c.remuxResult,a=e.audio,u=e.video;return a&&Ff(n,a),u&&Ff(n,u),l.postMessage({event:"transmuxComplete",data:c,instanceNo:s},n),!0}function Ff(l,c){c.data1&&l.push(c.data1.buffer),c.data2&&l.push(c.data2.buffer)}function Bf(l,c,s,n){var e=c.reduce(function(a,u){return Ru(l,u,n)||a},!1);e||l.postMessage({event:"transmuxComplete",data:c[0],instanceNo:n}),l.postMessage({event:"flush",data:s,instanceNo:n})}function Es(l,c,s){self.postMessage({event:l,data:c,instanceNo:s})}function Xg(l,c){var s=function(a){l[a]=function(){var u=Array.prototype.join.call(arguments," ");Es("workerLog",{logType:a,message:u},c)}};for(var n in l)s(n)}function Qg(l){return!l.audio&&!l.video&&!l.text&&!l.id3&&!l.initSegment}var lo="1.6.10",_s={};function Jg(){return typeof i=="function"}function Zg(){var l=_s[lo];if(l)return l.clientCount++,l;var c=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+i.toString()+")(true);"],{type:"text/javascript"}),s=self.URL.createObjectURL(c),n=new self.Worker(s),e={worker:n,objectURL:s,clientCount:1};return _s[lo]=e,e}function em(l){var c=_s[l];if(c)return c.clientCount++,c;var s=new self.URL(l,self.location.href).href,n=new self.Worker(s),e={worker:n,scriptURL:s,clientCount:1};return _s[l]=e,e}function tm(l){var c=_s[l||lo];if(c){var s=c.clientCount--;if(s===1){var n=c.worker,e=c.objectURL;delete _s[l||lo],e&&self.URL.revokeObjectURL(e),n.terminate()}}}var Uf=0,rm=function(){function l(s,n,e,a){var u=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Uf++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(A){var L=A.data,k=u.hls;if(!(!k||!(L!=null&&L.event)||L.instanceNo!==u.instanceNo))switch(L.event){case"init":{var I,D=(I=u.workerContext)==null?void 0:I.objectURL;D&&self.URL.revokeObjectURL(D);break}case"transmuxComplete":{u.handleTransmuxComplete(L.data);break}case"flush":{u.onFlush(L.data);break}case"workerLog":{k.logger[L.data.logType]&&k.logger[L.data.logType](L.data.message);break}default:{L.data=L.data||{},L.data.frag=u.frag,L.data.part=u.part,L.data.id=u.id,k.trigger(L.event,L.data);break}}},this.onWorkerError=function(A){if(u.hls){var L=new Error(A.message+"  ("+A.filename+":"+A.lineno+")");u.hls.config.enableWorker=!1,u.hls.logger.warn('Error in "'+u.id+'" Web Worker, fallback to inline'),u.hls.trigger(N.ERROR,{type:ft.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:L})}};var f=s.config;this.hls=s,this.id=n,this.useWorker=!!f.enableWorker,this.onTransmuxComplete=e,this.onFlush=a;var h=function(L,k){k=k||{},k.frag=u.frag||void 0,L===N.ERROR&&(k=k,k.parent=u.id,k.part=u.part,u.error=k.error),u.hls.trigger(L,k)};this.observer=new Ce,this.observer.on(N.FRAG_DECRYPTED,h),this.observer.on(N.ERROR,h);var g=Us(f.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var m=this.hls.logger,E=f.workerPath||Jg();if(E){try{f.workerPath?(m.log("loading Web Worker "+f.workerPath+' for "'+n+'"'),this.workerContext=em(f.workerPath)):(m.log('injecting Web Worker for "'+n+'"'),this.workerContext=Zg());var T=this.workerContext.worker;T.addEventListener("message",this.onWorkerMessage),T.addEventListener("error",this.onWorkerError),T.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:g,id:n,config:Ur(f)})}catch(A){m.warn('Error setting up "'+n+'" Web Worker, fallback to inline',A),this.terminateWorker(),this.error=null,this.transmuxer=new Su(this.observer,g,f,"",n,s.logger)}return}}this.transmuxer=new Su(this.observer,g,f,"",n,s.logger)}var c=l.prototype;return c.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var n=this.instanceNo;this.instanceNo=Uf++;var e=this.hls.config,a=Us(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:n,typeSupported:a,id:this.id,config:Ur(e)})}},c.terminateWorker=function(){if(this.workerContext){var n=this.workerContext.worker;this.workerContext=null,n.removeEventListener("message",this.onWorkerMessage),n.removeEventListener("error",this.onWorkerError),tm(this.hls.config.workerPath)}},c.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},c.push=function(n,e,a,u,f,h,g,m,E,T){var A,L,k=this;E.transmuxing.start=self.performance.now();var I=this.instanceNo,D=this.transmuxer,U=h?h.start:f.start,K=f.decryptdata,G=this.frag,j=!(G&&f.cc===G.cc),ie=!(G&&E.level===G.level),se=G?E.sn-G.sn:-1,he=this.part?E.part-this.part.index:-1,ve=se===0&&E.id>1&&E.id===G?.stats.chunkCount,ge=!ie&&(se===1||se===0&&(he===1||ve&&he<=0)),de=self.performance.now();(ie||se||f.stats.parsing.start===0)&&(f.stats.parsing.start=de),h&&(he||!ge)&&(h.stats.parsing.start=de);var ue=!(G&&((A=f.initSegment)==null?void 0:A.url)===((L=G.initSegment)==null?void 0:L.url)),Ae=new hg(j,ge,m,ie,U,ue);if(!ge||j||ue){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+f.type+" sn: "+E.sn+(E.part>-1?" part: "+E.part:"")+" "+(this.id===st.MAIN?"level":"track")+": "+E.level+" id: "+E.id+`
        discontinuity: `+j+`
        trackSwitch: `+ie+`
        contiguous: `+ge+`
        accurateTimeOffset: `+m+`
        timeOffset: `+U+`
        initSegmentChange: `+ue);var je=new dg(a,u,e,g,T);this.configureTransmuxer(je)}if(this.frag=f,this.part=h,this.workerContext)this.workerContext.worker.postMessage({instanceNo:I,cmd:"demux",data:n,decryptdata:K,chunkMeta:E,state:Ae},n instanceof ArrayBuffer?[n]:[]);else if(D){var Re=D.push(n,K,E,Ae);La(Re)?Re.then(function(Ie){k.handleTransmuxComplete(Ie)}).catch(function(Ie){k.transmuxerError(Ie,E,"transmuxer-interface push error")}):this.handleTransmuxComplete(Re)}},c.flush=function(n){var e=this;n.transmuxing.start=self.performance.now();var a=this.instanceNo,u=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:a,cmd:"flush",chunkMeta:n});else if(u){var f=u.flush(n);La(f)?f.then(function(h){e.handleFlushResult(h,n)}).catch(function(h){e.transmuxerError(h,n,"transmuxer-interface flush error")}):this.handleFlushResult(f,n)}},c.transmuxerError=function(n,e,a){this.hls&&(this.error=n,this.hls.trigger(N.ERROR,{type:ft.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:n,err:n,reason:a}))},c.handleFlushResult=function(n,e){var a=this;n.forEach(function(u){a.handleTransmuxComplete(u)}),this.onFlush(e)},c.configureTransmuxer=function(n){var e=this.instanceNo,a=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:n}):a&&a.configure(n)},c.handleTransmuxComplete=function(n){n.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(n)},l}();function Gf(){return self.SourceBuffer||self.WebKitSourceBuffer}function jf(){var l=En();if(!l)return!1;var c=Gf();return!c||c.prototype&&typeof c.prototype.appendBuffer=="function"&&typeof c.prototype.remove=="function"}function nm(){if(!jf())return!1;var l=En();return typeof l?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(c){return l.isTypeSupported(Qr(c,"video"))})||["mp4a.40.2","fLaC"].some(function(c){return l.isTypeSupported(Qr(c,"audio"))}))}function im(){var l,c=Gf();return typeof(c==null||(l=c.prototype)==null?void 0:l.changeType)=="function"}var am=100,sm=function(l){function c(n,e,a){var u;return u=l.call(this,n,e,a,"stream-controller",st.MAIN)||this,u.audioCodecSwap=!1,u.level=-1,u._forceStartLoad=!1,u._hasEnoughToStart=!1,u.altAudio=0,u.audioOnly=!1,u.fragPlaying=null,u.fragLastKbps=0,u.couldBacktrack=!1,u.backtrackFragment=null,u.audioCodecSwitch=!1,u.videoBuffer=null,u.onMediaPlaying=function(){u.tick()},u.onMediaSeeked=function(){var f=u.media,h=f?f.currentTime:null;if(!(h===null||!xe(h))&&(u.log("Media seeked to "+h.toFixed(3)),!!u.getBufferedFrag(h))){var g=u.getFwdBufferInfoAtPos(f,h,st.MAIN,0);if(g===null||g.len===0){u.warn("Main forward buffer length at "+h+' on "seeked" event '+(g?g.len:"empty")+")");return}u.tick()}},u.registerListeners(),u}P(c,l);var s=c.prototype;return s.registerListeners=function(){l.prototype.registerListeners.call(this);var e=this.hls;e.on(N.MANIFEST_PARSED,this.onManifestParsed,this),e.on(N.LEVEL_LOADING,this.onLevelLoading,this),e.on(N.LEVEL_LOADED,this.onLevelLoaded,this),e.on(N.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(N.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(N.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(N.BUFFER_CREATED,this.onBufferCreated,this),e.on(N.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(N.FRAG_BUFFERED,this.onFragBuffered,this)},s.unregisterListeners=function(){l.prototype.unregisterListeners.call(this);var e=this.hls;e.off(N.MANIFEST_PARSED,this.onManifestParsed,this),e.off(N.LEVEL_LOADED,this.onLevelLoaded,this),e.off(N.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(N.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(N.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(N.BUFFER_CREATED,this.onBufferCreated,this),e.off(N.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(N.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(N.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),l.prototype.onHandlerDestroying.call(this)},s.startLoad=function(e,a){if(this.levels){var u=this.lastCurrentTime,f=this.hls;if(this.stopLoad(),this.setInterval(am),this.level=-1,!this.startFragRequested){var h=f.startLevel;h===-1&&(f.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=f.firstAutoLevel),f.nextLoadLevel=h,this.level=f.loadLevel,this._hasEnoughToStart=!!a}u>0&&e===-1&&!a&&(this.log("Override startPosition with lastCurrentTime @"+u.toFixed(3)),e=u),this.state=Ve.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=a?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Ve.STOPPED},s.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case Ve.WAITING_LEVEL:{var e=this.levels,a=this.level,u=e?.[a],f=u?.details;if(f&&(!f.live||this.levelLastLoaded===u&&!this.waitForLive(u))){if(this.waitForCdnTuneIn(f))break;this.state=Ve.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Ve.IDLE;break}break}case Ve.FRAG_LOADING_WAITING_RETRY:{var h,g=self.performance.now(),m=this.retryDate;if(!m||g>=m||(h=this.media)!=null&&h.seeking){var E=this.levels,T=this.level,A=E?.[T];this.resetStartWhenNotLoaded(A||null),this.state=Ve.IDLE}}break}this.state===Ve.IDLE&&this.doTickIdle(),this.onTickEnd()},s.onTickEnd=function(){var e;l.prototype.onTickEnd.call(this),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},s.doTickIdle=function(){var e=this.hls,a=this.levelLastLoaded,u=this.levels,f=this.media;if(!(a===null||!f&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var h=this.buffering?e.nextLoadLevel:e.loadLevel;if(u!=null&&u[h]){var g=u[h],m=this.getMainFwdBufferInfo();if(m!==null){var E=this.getLevelDetails();if(E&&this._streamEnded(m,E)){var T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(N.BUFFER_EOS,T),this.state=Ve.ENDED;return}if(this.buffering){e.loadLevel!==h&&e.manualLevel===-1&&this.log("Adapting to level "+h+" from level "+this.level),this.level=e.nextLoadLevel=h;var A=g.details;if(!A||this.state===Ve.WAITING_LEVEL||this.waitForLive(g)){this.level=h,this.state=Ve.WAITING_LEVEL,this.startFragRequested=!1;return}var L=m.len,k=this.getMaxBufferLength(g.maxBitrate);if(!(L>=k)){this.backtrackFragment&&this.backtrackFragment.start>m.end&&(this.backtrackFragment=null);var I=this.backtrackFragment?this.backtrackFragment.start:m.end,D=this.getNextFragment(I,A);if(this.couldBacktrack&&!this.fragPrevious&&D&&ht(D)&&this.fragmentTracker.getState(D)!==Sn.OK){var U,K=((U=this.backtrackFragment)!=null?U:D).sn,G=K-A.startSN,j=A.fragments[G-1];j&&D.cc===j.cc&&(D=j,this.fragmentTracker.removeFragment(j))}else this.backtrackFragment&&m.len&&(this.backtrackFragment=null);if(D&&this.isLoopLoading(D,I)){var ie=D.gap;if(!ie){var se=this.audioOnly&&!this.altAudio?ot.AUDIO:ot.VIDEO,he=(se===ot.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;he&&this.afterBufferFlushed(he,se,st.MAIN)}D=this.getNextFragmentLoopLoading(D,A,m,st.MAIN,k)}D&&(D.initSegment&&!D.initSegment.data&&!this.bitrateTest&&(D=D.initSegment),this.loadFragment(D,g,I))}}}}}},s.loadFragment=function(e,a,u){var f=this.fragmentTracker.getState(e);f===Sn.NOT_LOADED||f===Sn.PARTIAL?ht(e)?this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,a)):l.prototype.loadFragment.call(this,e,a,u):this._loadInitSegment(e,a):this.clearTrackerIfNeeded(e)},s.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,st.MAIN)},s.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var e=this.levels,a=this.media;if(a!=null&&a.readyState){var u,f=this.getAppendedFrag(a.currentTime);f&&f.start>1&&this.flushMainBuffer(0,f.start-1);var h=this.getLevelDetails();if(h!=null&&h.live){var g=this.getMainFwdBufferInfo();if(!g||g.len<h.targetduration*2)return}if(!a.paused&&e){var m=this.hls.nextLoadLevel,E=e[m],T=this.fragLastKbps;T&&this.fragCurrent?u=this.fragCurrent.duration*E.maxBitrate/(1e3*T)+1:u=0}else u=0;var A=this.getBufferedFrag(a.currentTime+u);if(A){var L=this.followingBufferedFrag(A);if(L){this.abortCurrentFrag();var k=L.maxStartPTS?L.maxStartPTS:L.start,I=L.duration,D=Math.max(A.end,k+Math.min(Math.max(I-this.config.maxFragLookUpTolerance,I*(this.couldBacktrack?.5:.125)),I*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(D,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ve.KEY_LOADING:case Ve.FRAG_LOADING:case Ve.FRAG_LOADING_WAITING_RETRY:case Ve.PARSING:case Ve.PARSED:this.state=Ve.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(e,a){l.prototype.flushMainBuffer.call(this,e,a,this.altAudio===2?"video":null)},s.onMediaAttached=function(e,a){l.prototype.onMediaAttached.call(this,e,a);var u=a.media;oo(u,"playing",this.onMediaPlaying),oo(u,"seeked",this.onMediaSeeked)},s.onMediaDetaching=function(e,a){var u=this.media;u&&(bs(u,"playing",this.onMediaPlaying),bs(u,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,l.prototype.onMediaDetaching.call(this,e,a);var f=!!a.transferMedia;f||(this._hasEnoughToStart=!1)},s.onManifestLoading=function(){l.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(N.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},s.onManifestParsed=function(e,a){for(var u=!1,f=!1,h=0;h<a.levels.length;h++){var g=a.levels[h].audioCodec;g&&(u=u||g.indexOf("mp4a.40.2")!==-1,f=f||g.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=u&&f&&!im(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(e,a){var u=this.levels;if(!(!u||this.state!==Ve.IDLE)){var f=a.levelInfo;(!f.details||f.details.live&&(this.levelLastLoaded!==f||f.details.expired)||this.waitForCdnTuneIn(f.details))&&(this.state=Ve.WAITING_LEVEL)}},s.onLevelLoaded=function(e,a){var u,f=this.levels,h=this.startFragRequested,g=a.level,m=a.details,E=m.totalduration;if(!f){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+m.startSN+","+m.endSN+"]"+(m.lastPartSn?"[part-"+m.lastPartSn+"-"+m.lastPartIndex+"]":"")+", cc ["+m.startCC+", "+m.endCC+"] duration:"+E);var T=a.levelInfo,A=this.fragCurrent;A&&(this.state===Ve.FRAG_LOADING||this.state===Ve.FRAG_LOADING_WAITING_RETRY)&&A.level!==a.level&&A.loader&&this.abortCurrentFrag();var L=0;if(m.live||(u=T.details)!=null&&u.live){var k;if(this.checkLiveUpdate(m),m.deltaUpdateFailed)return;L=this.alignPlaylists(m,T.details,(k=this.levelLastLoaded)==null?void 0:k.details)}if(T.details=m,this.levelLastLoaded=T,h||this.setStartPosition(m,L),this.hls.trigger(N.LEVEL_UPDATED,{details:m,level:g}),this.state===Ve.WAITING_LEVEL){if(this.waitForCdnTuneIn(m))return;this.state=Ve.IDLE}h&&m.live&&this.synchronizeToLiveEdge(m),this.tick()},s.synchronizeToLiveEdge=function(e){var a=this.config,u=this.media;if(u){var f=this.hls.liveSyncPosition,h=this.getLoadPosition(),g=e.fragmentStart,m=e.edge,E=h>=g-a.maxFragLookUpTolerance&&h<=m;if(f!==null&&u.duration>f&&(h<f||!E)){var T=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*e.targetduration;if((!E&&u.readyState<4||h<m-T)&&(this._hasEnoughToStart||(this.nextLoadPosition=f),u.readyState))if(this.warn("Playback: "+h.toFixed(3)+" is located too far from the end of live sliding playlist: "+m+", reset currentTime to : "+f.toFixed(3)),this.config.liveSyncMode==="buffered"){var A,L=Mt.bufferInfo(u,f,0);if(!((A=L.buffered)!=null&&A.length)){u.currentTime=f;return}var k=L.start<=h;if(k){u.currentTime=f;return}var I=Mt.bufferedInfo(L.buffered,h,0),D=I.nextStart;D&&(u.currentTime=D)}else u.currentTime=f}}},s._handleFragmentLoadProgress=function(e){var a,u=e.frag,f=e.part,h=e.payload,g=this.levels;if(!g){this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered");return}var m=g[u.level];if(!m){this.warn("Level "+u.level+" not found on progress");return}var E=m.details;if(!E){this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset"),this.fragmentTracker.removeFragment(u);return}var T=m.videoCodec,A=E.PTSKnown||!E.live,L=(a=u.initSegment)==null?void 0:a.data,k=this._getAudioCodec(m),I=this.transmuxer=this.transmuxer||new rm(this.hls,st.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),D=f?f.index:-1,U=D!==-1,K=new kf(u.level,u.sn,u.stats.chunkCount,h.byteLength,D,U),G=this.initPTS[u.cc];I.push(h,L,k,T,u,f,E.totalduration,A,K,G)},s.onAudioTrackSwitching=function(e,a){var u=this,f=this.hls,h=this.altAudio===2,g=Yo(a.url,f);if(g)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var m=this.fragCurrent;m&&(this.log("Switching to main audio track, cancel main fragment load"),m.abortRequests(),this.fragmentTracker.removeFragment(m)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(h){this.fragmentTracker.removeAllFragments(),f.once(N.BUFFER_FLUSHED,function(){u.hls&&u.hls.trigger(N.AUDIO_TRACK_SWITCHED,a)}),f.trigger(N.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}f.trigger(N.AUDIO_TRACK_SWITCHED,a)}},s.onAudioTrackSwitched=function(e,a){var u=Yo(a.url,this.hls);if(u){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=u?2:0,this.tick()},s.onBufferCreated=function(e,a){var u=a.tracks,f,h,g=!1;for(var m in u){var E=u[m];if(E.id==="main"){if(h=m,f=E,m==="video"){var T=u[m];T&&(this.videoBuffer=T.buffer)}}else g=!0}g&&f?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=f.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(e,a){var u=a.frag,f=a.part,h=u.type===st.MAIN;if(h){if(this.fragContextChanged(u)){this.warn("Fragment "+u.sn+(f?" p: "+f.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state),this.state===Ve.PARSED&&(this.state=Ve.IDLE);return}var g=f?f.stats:u.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),ht(u)&&(this.fragPrevious=u),this.fragBufferedComplete(u,f)}var m=this.media;m&&(!this._hasEnoughToStart&&Mt.getBuffered(m).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),h&&this.tick())},s.onError=function(e,a){var u;if(a.fatal){this.state=Ve.ERROR;return}switch(a.details){case be.FRAG_GAP:case be.FRAG_PARSING_ERROR:case be.FRAG_DECRYPT_ERROR:case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(st.MAIN,a);break;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:case be.LEVEL_PARSING_ERROR:!a.levelRetry&&this.state===Ve.WAITING_LEVEL&&((u=a.context)==null?void 0:u.type)===ut.LEVEL&&(this.state=Ve.IDLE);break;case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:if(a.parent!=="main")return;this.reduceLengthAndFlushBuffer(a)&&this.resetLoadingState();break;case be.BUFFER_FULL_ERROR:if(a.parent!=="main")return;if(this.reduceLengthAndFlushBuffer(a)){var f=!this.config.interstitialsController&&this.config.assetPlayerId;f?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case be.INTERNAL_EXCEPTION:this.recoverWorkerError(a);break}},s.onFragLoadEmergencyAborted=function(){this.state=Ve.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},s.onBufferFlushed=function(e,a){var u=a.type;if(u!==ot.AUDIO||!this.altAudio){var f=(u===ot.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;f&&(this.afterBufferFlushed(f,u,st.MAIN),this.tick())}},s.onLevelsUpdated=function(e,a){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var e=this.media;if(e){var a=e.currentTime,u=this.startPosition;if(u>=0&&a<u){if(e.seeking){this.log("could not seek to "+u+", already seeking at "+a);return}var f=this.timelineOffset;f&&u&&(u+=f);var h=this.getLevelDetails(),g=Mt.getBuffered(e),m=g.length?g.start(0):0,E=m-u,T=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||E>0&&(E<T||this.loadingParts&&E<2*(h?.partTarget||0)))&&(this.log("adjusting start position by "+E+" to match buffer start"),u+=E,this.startPosition=u),a<u&&(this.log("seek to target start position "+u+" from current time "+a+" buffer start "+m),e.currentTime=u)}}},s._getAudioCodec=function(e){var a=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a},s._loadBitrateTestFrag=function(e,a){var u=this;e.bitrateTest=!0,this._doFragLoad(e,a).then(function(f){var h=u.hls,g=f?.frag;if(!(!g||u.fragContextChanged(g))){a.fragmentError=0,u.state=Ve.IDLE,u.startFragRequested=!1,u.bitrateTest=!1;var m=g.stats;m.parsing.start=m.parsing.end=m.buffering.start=m.buffering.end=self.performance.now(),h.trigger(N.FRAG_LOADED,f),g.bitrateTest=!1}})},s._handleTransmuxComplete=function(e){var a=this.playlistType,u=this.hls,f=e.remuxResult,h=e.chunkMeta,g=this.getCurrentContext(h);if(!g){this.resetWhenMissingContext(h);return}var m=g.frag,E=g.part,T=g.level,A=f.video,L=f.text,k=f.id3,I=f.initSegment,D=T.details,U=this.altAudio?void 0:f.audio;if(this.fragContextChanged(m)){this.fragmentTracker.removeFragment(m);return}if(this.state=Ve.PARSING,I){var K=I.tracks;if(K){var G=m.initSegment||m;if(this.unhandledEncryptionError(I,m))return;this._bufferInitSegment(T,K,G,h),u.trigger(N.FRAG_PARSING_INIT_SEGMENT,{frag:G,id:a,tracks:K})}var j=I.initPTS,ie=I.timescale,se=this.initPTS[m.cc];if(xe(j)&&(!se||se.baseTime!==j||se.timescale!==ie)){var he=I.trackId;this.initPTS[m.cc]={baseTime:j,timescale:ie,trackId:he},u.trigger(N.INIT_PTS_FOUND,{frag:m,id:a,initPTS:j,timescale:ie,trackId:he})}}if(A&&D){U&&A.type==="audiovideo"&&this.logMuxedErr(m);var ve=D.fragments[m.sn-1-D.startSN],ge=m.sn===D.startSN,de=!ve||m.cc>ve.cc;if(f.independent!==!1){var ue=A.startPTS,Ae=A.endPTS,je=A.startDTS,Re=A.endDTS;if(E)E.elementaryStreams[A.type]={startPTS:ue,endPTS:Ae,startDTS:je,endDTS:Re};else if(A.firstKeyFrame&&A.independent&&h.id===1&&!de&&(this.couldBacktrack=!0),A.dropped&&A.independent){var Ie=this.getMainFwdBufferInfo(),$e=(Ie?Ie.end:this.getLoadPosition())+this.config.maxBufferHole,Ze=A.firstKeyFramePTS?A.firstKeyFramePTS:ue;if(!ge&&$e<Ze-this.config.maxBufferHole&&!de){this.backtrack(m);return}else de&&(m.gap=!0);m.setElementaryStreamInfo(A.type,m.start,Ae,m.start,Re,!0)}else ge&&ue-(D.appliedTimelineOffset||0)>dl&&(m.gap=!0);m.setElementaryStreamInfo(A.type,ue,Ae,je,Re),this.backtrackFragment&&(this.backtrackFragment=m),this.bufferFragmentData(A,m,E,h,ge||de)}else if(ge||de)m.gap=!0;else{this.backtrack(m);return}}if(U){var Qe=U.startPTS,it=U.endPTS,xt=U.startDTS,at=U.endDTS;E&&(E.elementaryStreams[ot.AUDIO]={startPTS:Qe,endPTS:it,startDTS:xt,endDTS:at}),m.setElementaryStreamInfo(ot.AUDIO,Qe,it,xt,at),this.bufferFragmentData(U,m,E,h)}if(D&&k!=null&&k.samples.length){var ct={id:a,frag:m,details:D,samples:k.samples};u.trigger(N.FRAG_PARSING_METADATA,ct)}if(D&&L){var lt={id:a,frag:m,details:D,samples:L.samples};u.trigger(N.FRAG_PARSING_USERDATA,lt)}},s.logMuxedErr=function(e){this.warn((ht(e)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+e.url)},s._bufferInitSegment=function(e,a,u,f){var h=this;if(this.state===Ve.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&(delete a.audio,a.audiovideo&&this.logMuxedErr(u));var g=a.audio,m=a.video,E=a.audiovideo;if(g){var T=e.audioCodec,A=ki(g.codec,T);A==="mp4a"&&(A="mp4a.40.5");var L=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){A&&(A.indexOf("mp4a.40.5")!==-1?A="mp4a.40.2":A="mp4a.40.5");var k=g.metadata;k&&"channelCount"in k&&(k.channelCount||1)!==1&&L.indexOf("firefox")===-1&&(A="mp4a.40.5")}A&&A.indexOf("mp4a.40.5")!==-1&&L.indexOf("android")!==-1&&g.container!=="audio/mpeg"&&(A="mp4a.40.2",this.log("Android: force audio codec to "+A)),T&&T!==A&&this.log('Swapping manifest audio codec "'+T+'" for "'+A+'"'),g.levelCodec=A,g.id=st.MAIN,this.log("Init audio buffer, container:"+g.container+", codecs[selected/level/parsed]=["+(A||"")+"/"+(T||"")+"/"+g.codec+"]"),delete a.audiovideo}if(m){m.levelCodec=e.videoCodec,m.id=st.MAIN;var I=m.codec;if(I?.length===4)switch(I){case"hvc1":case"hev1":m.codec="hvc1.1.6.L120.90";break;case"av01":m.codec="av01.0.04M.08";break;case"avc1":m.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+m.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+I+"]"+(m.codec!==I?" parsed-corrected="+m.codec:"")+(m.supplemental?" supplemental="+m.supplemental:"")),delete a.audiovideo}E&&(this.log("Init audiovideo buffer, container:"+E.container+", codecs[level/parsed]=["+e.codecs+"/"+E.codec+"]"),delete a.video,delete a.audio);var D=Object.keys(a);if(D.length){if(this.hls.trigger(N.BUFFER_CODECS,a),!this.hls)return;D.forEach(function(U){var K=a[U],G=K.initSegment;G!=null&&G.byteLength&&h.hls.trigger(N.BUFFER_APPENDING,{type:U,data:G,frag:u,part:null,chunkMeta:f,parent:u.type})})}this.tickImmediate()}},s.getMainFwdBufferInfo=function(){var e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,st.MAIN)},s.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ve.IDLE},s.checkFragmentChanged=function(){var e=this.media,a=null;if(e&&e.readyState>1&&e.seeking===!1){var u=e.currentTime;if(Mt.isBuffered(e,u)?a=this.getAppendedFrag(u):Mt.isBuffered(e,u+.1)&&(a=this.getAppendedFrag(u+.1)),a){this.backtrackFragment=null;var f=this.fragPlaying,h=a.level;(!f||a.sn!==f.sn||f.level!==h)&&(this.fragPlaying=a,this.hls.trigger(N.FRAG_CHANGED,{frag:a}),(!f||f.level!==h)&&this.hls.trigger(N.LEVEL_SWITCHED,{level:h}))}}},b(c,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var e=this.levels,a=this.level,u=e?.[a];return u?this.getMaxBufferLength(u.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e;if(this.fragPlaying)return this.fragPlaying;var a=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return xe(a)?this.getAppendedFrag(a):null}},{key:"currentProgramDateTime",get:function(){var e,a=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(xe(a)){var u=this.getLevelDetails(),f=this.currentFrag||(u?Jr(null,u.fragments,a):null);if(f){var h=f.programDateTime;if(h!==null){var g=h+(a-f.start)*1e3;return new Date(g)}}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(Mg),om=function(){function l(s){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=s}var c=l.prototype;return c.abort=function(n){for(var e in this.keyUriToKeyInfo){var a=this.keyUriToKeyInfo[e].loader;if(a){var u;if(n&&n!==((u=a.context)==null?void 0:u.frag.type))return;a.abort()}}},c.detach=function(){for(var n in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[n];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[n]}},c.destroy=function(){this.detach();for(var n in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[n].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},c.createKeyLoadError=function(n,e,a,u,f){return e===void 0&&(e=be.KEY_LOAD_ERROR),new Mi({type:ft.NETWORK_ERROR,details:e,fatal:!1,frag:n,response:f,error:a,networkDetails:u})},c.loadClear=function(n,e,a){var u=this;if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length){for(var f=function(){var A=e[g];if(n.cc<=A.cc&&(!ht(n)||!ht(A)||n.sn<A.sn)||!a&&g==m-1)return{v:u.emeController.selectKeySystemFormat(A).then(function(L){if(u.emeController){A.setKeyFormat(L);var k=qn.keySystemFormatToKeySystemDomain(L);if(k)return u.emeController.getKeySystemAccess([k])}})}},h,g=0,m=e.length;g<m;g++)if(h=f(),h)return h.v}if(this.config.requireKeySystemAccessOnStart){var E=qn.getKeySystemsForConfig(this.config);if(E.length)return this.emeController.getKeySystemAccess(E)}}return null},c.load=function(n){var e=this;return!n.decryptdata&&n.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(n).then(function(a){return e.loadInternal(n,a)}):this.loadInternal(n)},c.loadInternal=function(n,e){var a,u;e&&n.setKeyFormat(e);var f=n.decryptdata;if(!f){var h=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(n,be.KEY_LOAD_ERROR,h))}var g=f.uri;if(!g)return Promise.reject(this.createKeyLoadError(n,be.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+g+'"')));var m=this.keyUriToKeyInfo[g];if((a=m)!=null&&a.decryptdata.key)return f.key=m.decryptdata.key,Promise.resolve({frag:n,keyInfo:m});if((u=m)!=null&&u.keyLoadPromise){var E;switch((E=m.mediaKeySessionContext)==null?void 0:E.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return m.keyLoadPromise.then(function(T){return f.key=T.keyInfo.decryptdata.key,{frag:n,keyInfo:m}})}}switch(m=this.keyUriToKeyInfo[g]={decryptdata:f,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},f.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return f.keyFormat==="identity"?this.loadKeyHTTP(m,n):this.loadKeyEME(m,n);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(m,n);default:return Promise.reject(this.createKeyLoadError(n,be.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+f.method+'"')))}},c.loadKeyEME=function(n,e){var a={frag:e,keyInfo:n};if(this.emeController&&this.config.emeEnabled){var u=this.emeController.loadKey(a);if(u)return(n.keyLoadPromise=u.then(function(f){return n.mediaKeySessionContext=f,a})).catch(function(f){throw n.keyLoadPromise=null,f})}return Promise.resolve(a)},c.loadKeyHTTP=function(n,e){var a=this,u=this.config,f=u.loader,h=new f(u);return e.keyLoader=n.loader=h,n.keyLoadPromise=new Promise(function(g,m){var E={keyInfo:n,frag:e,responseType:"arraybuffer",url:n.decryptdata.uri},T=u.keyLoadPolicy.default,A={loadPolicy:T,timeout:T.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},L={onSuccess:function(I,D,U,K){var G=U.frag,j=U.keyInfo,ie=U.url;if(!G.decryptdata||j!==a.keyUriToKeyInfo[ie])return m(a.createKeyLoadError(G,be.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),K));j.decryptdata.key=G.decryptdata.key=new Uint8Array(I.data),G.keyLoader=null,j.loader=null,g({frag:G,keyInfo:j})},onError:function(I,D,U,K){a.resetLoader(D),m(a.createKeyLoadError(e,be.KEY_LOAD_ERROR,new Error("HTTP Error "+I.code+" loading key "+I.text),U,H({url:E.url,data:void 0},I)))},onTimeout:function(I,D,U){a.resetLoader(D),m(a.createKeyLoadError(e,be.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),U))},onAbort:function(I,D,U){a.resetLoader(D),m(a.createKeyLoadError(e,be.INTERNAL_ABORTED,new Error("key loading aborted"),U))}};h.load(E,A,L)})},c.resetLoader=function(n){var e=n.frag,a=n.keyInfo,u=n.url,f=a.loader;e.keyLoader===f&&(e.keyLoader=null,a.loader=null),delete this.keyUriToKeyInfo[u],f&&f.destroy()},l}();function Vf(l){var c=l.type;switch(c){case ut.AUDIO_TRACK:return st.AUDIO;case ut.SUBTITLE_TRACK:return st.SUBTITLE;default:return st.MAIN}}function ku(l,c){var s=l.url;return(s===void 0||s.indexOf("data:")===0)&&(s=c.url),s}var lm=function(){function l(s){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=s,this.registerListeners()}var c=l.prototype;return c.startLoad=function(n){},c.stopLoad=function(){this.destroyInternalLoaders()},c.registerListeners=function(){var n=this.hls;n.on(N.MANIFEST_LOADING,this.onManifestLoading,this),n.on(N.LEVEL_LOADING,this.onLevelLoading,this),n.on(N.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),n.on(N.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),n.on(N.LEVELS_UPDATED,this.onLevelsUpdated,this)},c.unregisterListeners=function(){var n=this.hls;n.off(N.MANIFEST_LOADING,this.onManifestLoading,this),n.off(N.LEVEL_LOADING,this.onLevelLoading,this),n.off(N.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),n.off(N.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),n.off(N.LEVELS_UPDATED,this.onLevelsUpdated,this)},c.createInternalLoader=function(n){var e=this.hls.config,a=e.pLoader,u=e.loader,f=a||u,h=new f(e);return this.loaders[n.type]=h,h},c.getInternalLoader=function(n){return this.loaders[n.type]},c.resetInternalLoader=function(n){this.loaders[n]&&delete this.loaders[n]},c.destroyInternalLoaders=function(){for(var n in this.loaders){var e=this.loaders[n];e&&e.destroy(),this.resetInternalLoader(n)}},c.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},c.onManifestLoading=function(n,e){var a=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ut.MANIFEST,url:a,deliveryDirectives:null,levelOrTrack:null})},c.onLevelLoading=function(n,e){var a=e.id,u=e.level,f=e.pathwayId,h=e.url,g=e.deliveryDirectives,m=e.levelInfo;this.load({id:a,level:u,pathwayId:f,responseType:"text",type:ut.LEVEL,url:h,deliveryDirectives:g,levelOrTrack:m})},c.onAudioTrackLoading=function(n,e){var a=e.id,u=e.groupId,f=e.url,h=e.deliveryDirectives,g=e.track;this.load({id:a,groupId:u,level:null,responseType:"text",type:ut.AUDIO_TRACK,url:f,deliveryDirectives:h,levelOrTrack:g})},c.onSubtitleTrackLoading=function(n,e){var a=e.id,u=e.groupId,f=e.url,h=e.deliveryDirectives,g=e.track;this.load({id:a,groupId:u,level:null,responseType:"text",type:ut.SUBTITLE_TRACK,url:f,deliveryDirectives:h,levelOrTrack:g})},c.onLevelsUpdated=function(n,e){var a=this.loaders[ut.LEVEL];if(a){var u=a.context;u&&!e.levels.some(function(f){return f===u.levelOrTrack})&&(a.abort(),delete this.loaders[ut.LEVEL])}},c.load=function(n){var e,a=this,u=this.hls.config,f=this.getInternalLoader(n);if(f){var h=this.hls.logger,g=f.context;if(g&&g.levelOrTrack===n.levelOrTrack&&(g.url===n.url||g.deliveryDirectives&&!n.deliveryDirectives)){g.url===n.url?h.log("[playlist-loader]: ignore "+n.url+" ongoing request"):h.log("[playlist-loader]: ignore "+n.url+" in favor of "+g.url);return}h.log("[playlist-loader]: aborting previous loader for type: "+n.type),f.abort()}var m;if(n.type===ut.MANIFEST?m=u.manifestLoadPolicy.default:m=x({},u.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),f=this.createInternalLoader(n),xe((e=n.deliveryDirectives)==null?void 0:e.part)){var E;if(n.type===ut.LEVEL&&n.level!==null?E=this.hls.levels[n.level].details:n.type===ut.AUDIO_TRACK&&n.id!==null?E=this.hls.audioTracks[n.id].details:n.type===ut.SUBTITLE_TRACK&&n.id!==null&&(E=this.hls.subtitleTracks[n.id].details),E){var T=E.partTarget,A=E.targetduration;if(T&&A){var L=Math.max(T*3,A*.8)*1e3;m=x({},m,{maxTimeToFirstByteMs:Math.min(L,m.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(L,m.maxTimeToFirstByteMs)})}}}var k=m.errorRetry||m.timeoutRetry||{},I={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:k.maxNumRetry||0,retryDelay:k.retryDelayMs||0,maxRetryDelay:k.maxRetryDelayMs||0},D={onSuccess:function(K,G,j,ie){var se=a.getInternalLoader(j);a.resetInternalLoader(j.type);var he=K.data;if(he.indexOf("#EXTM3U")!==0){a.handleManifestParsingError(K,j,new Error("no EXTM3U delimiter"),ie||null,G);return}G.parsing.start=performance.now(),$n.isMediaPlaylist(he)||j.type!==ut.MANIFEST?a.handleTrackOrLevelPlaylist(K,G,j,ie||null,se):a.handleMasterPlaylist(K,G,j,ie)},onError:function(K,G,j,ie){a.handleNetworkError(G,j,!1,K,ie)},onTimeout:function(K,G,j){a.handleNetworkError(G,j,!0,void 0,K)}};f.load(n,I,D)},c.checkAutostartLoad=function(){if(this.hls){var n=this.hls,e=n.config,a=e.autoStartLoad,u=e.startPosition,f=n.forceStartLoad;(a||f)&&(this.hls.logger.log((a?"auto":"force")+" startLoad with configured startPosition "+u),this.hls.startLoad(u))}},c.handleMasterPlaylist=function(n,e,a,u){var f=this.hls,h=n.data,g=ku(n,a),m=$n.parseMasterPlaylist(h,g);if(m.playlistParsingError){this.handleManifestParsingError(n,a,m.playlistParsingError,u,e);return}var E=m.contentSteering,T=m.levels,A=m.sessionData,L=m.sessionKeys,k=m.startTimeOffset,I=m.variableList;this.variableList=I;var D=$n.parseMasterPlaylistMedia(h,g,m),U=D.AUDIO,K=U===void 0?[]:U,G=D.SUBTITLES,j=D["CLOSED-CAPTIONS"];if(K.length){var ie=K.some(function(se){return!se.url});!ie&&T[0].audioCodec&&!T[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),K.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new xr({}),bitrate:0,url:""}))}f.trigger(N.MANIFEST_LOADED,{levels:T,audioTracks:K,subtitles:G,captions:j,contentSteering:E,url:g,stats:e,networkDetails:u,sessionData:A,sessionKeys:L,startTimeOffset:k,variableList:I})},c.handleTrackOrLevelPlaylist=function(n,e,a,u,f){var h=this.hls,g=a.id,m=a.level,E=a.type,T=ku(n,a),A=xe(m)?m:xe(g)?g:0,L=Vf(a),k=$n.parseLevelPlaylist(n.data,T,A,L,0,this.variableList);if(E===ut.MANIFEST){var I={attrs:new xr({}),bitrate:0,details:k,name:"",url:T};k.requestScheduled=e.loading.start+rl(k,0),h.trigger(N.MANIFEST_LOADED,{levels:[I],audioTracks:[],url:T,stats:e,networkDetails:u,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),a.levelDetails=k,this.handlePlaylistLoaded(k,n,e,a,u,f)},c.handleManifestParsingError=function(n,e,a,u,f){this.hls.trigger(N.ERROR,{type:ft.NETWORK_ERROR,details:be.MANIFEST_PARSING_ERROR,fatal:e.type===ut.MANIFEST,url:n.url,err:a,error:a,reason:a.message,response:n,context:e,networkDetails:u,stats:f})},c.handleNetworkError=function(n,e,a,u,f){a===void 0&&(a=!1);var h="A network "+(a?"timeout":"error"+(u?" (status "+u.code+")":""))+" occurred while loading "+n.type;n.type===ut.LEVEL?h+=": "+n.level+" id: "+n.id:(n.type===ut.AUDIO_TRACK||n.type===ut.SUBTITLE_TRACK)&&(h+=" id: "+n.id+' group-id: "'+n.groupId+'"');var g=new Error(h);this.hls.logger.warn("[playlist-loader]: "+h);var m=be.UNKNOWN,E=!1,T=this.getInternalLoader(n);switch(n.type){case ut.MANIFEST:m=a?be.MANIFEST_LOAD_TIMEOUT:be.MANIFEST_LOAD_ERROR,E=!0;break;case ut.LEVEL:m=a?be.LEVEL_LOAD_TIMEOUT:be.LEVEL_LOAD_ERROR,E=!1;break;case ut.AUDIO_TRACK:m=a?be.AUDIO_TRACK_LOAD_TIMEOUT:be.AUDIO_TRACK_LOAD_ERROR,E=!1;break;case ut.SUBTITLE_TRACK:m=a?be.SUBTITLE_TRACK_LOAD_TIMEOUT:be.SUBTITLE_LOAD_ERROR,E=!1;break}T&&this.resetInternalLoader(n.type);var A={type:ft.NETWORK_ERROR,details:m,fatal:E,url:n.url,loader:T,context:n,error:g,networkDetails:e,stats:f};if(u){var L=e?.url||n.url;A.response=H({url:L,data:void 0},u)}this.hls.trigger(N.ERROR,A)},c.handlePlaylistLoaded=function(n,e,a,u,f,h){var g=this.hls,m=u.type,E=u.level,T=u.id,A=u.groupId,L=u.deliveryDirectives,k=ku(e,u),I=Vf(u),D=typeof u.level=="number"&&I===st.MAIN?E:void 0;if(!n.fragments.length){var U=n.playlistParsingError=new Error("No Segments found in Playlist");g.trigger(N.ERROR,{type:ft.NETWORK_ERROR,details:be.LEVEL_EMPTY_ERROR,fatal:!1,url:k,error:U,reason:U.message,response:e,context:u,level:D,parent:I,networkDetails:f,stats:a});return}n.targetduration||(n.playlistParsingError=new Error("Missing Target Duration"));var K=n.playlistParsingError;if(K){if(this.hls.logger.warn(K+" "+n.url),!g.config.ignorePlaylistParsingErrors){g.trigger(N.ERROR,{type:ft.NETWORK_ERROR,details:be.LEVEL_PARSING_ERROR,fatal:!1,url:k,error:K,reason:K.message,response:e,context:u,level:D,parent:I,networkDetails:f,stats:a});return}n.playlistParsingError=null}switch(n.live&&h&&(h.getCacheAge&&(n.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(n.ageHeader))&&(n.ageHeader=0)),m){case ut.MANIFEST:case ut.LEVEL:g.trigger(N.LEVEL_LOADED,{details:n,levelInfo:u.levelOrTrack||g.levels[0],level:D||0,id:T||0,stats:a,networkDetails:f,deliveryDirectives:L,withoutMultiVariant:m===ut.MANIFEST});break;case ut.AUDIO_TRACK:g.trigger(N.AUDIO_TRACK_LOADED,{details:n,track:u.levelOrTrack,id:T||0,groupId:A||"",stats:a,networkDetails:f,deliveryDirectives:L});break;case ut.SUBTITLE_TRACK:g.trigger(N.SUBTITLE_TRACK_LOADED,{details:n,track:u.levelOrTrack,id:T||0,groupId:A||"",stats:a,networkDetails:f,deliveryDirectives:L});break}},l}(),um={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function cm(l,c){return{supported:!1,configurations:c,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:l}}function fm(l,c,s,n){n===void 0&&(n={});var e=l.videoCodec;if(!e&&!l.audioCodec||!s)return Promise.resolve(um);for(var a=[],u=dm(l),f=u.length,h=hm(l,c,f>0),g=h.length,m=f||1*g||1;m--;){var E={type:"media-source"};if(f&&(E.video=u[m%f]),g){E.audio=h[m%g];var T=E.audio.bitrate;E.video&&T&&(E.video.bitrate-=T)}a.push(E)}if(e){var A=navigator.userAgent;if(e.split(",").some(function(L){return oi(L)})&&Ln())return Promise.resolve(cm(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: ("+A+")"),a))}return Promise.all(a.map(function(L){var k=vm(L);return n[k]||(n[k]=s.decodingInfo(L))})).then(function(L){return{supported:!L.some(function(k){return!k.supported}),configurations:a,decodingInfoResults:L}}).catch(function(L){return{supported:!1,configurations:a,decodingInfoResults:[],error:L}})}function dm(l){var c,s=(c=l.videoCodec)==null?void 0:c.split(","),n=Kf(l),e=l.width||640,a=l.height||480,u=l.frameRate||30,f=l.videoRange.toLowerCase();return s?s.map(function(h){var g={contentType:Qr(wi(h),"video"),width:e,height:a,bitrate:n,framerate:u};return f!=="sdr"&&(g.transferFunction=f),g}):[]}function hm(l,c,s){var n,e=(n=l.audioCodec)==null?void 0:n.split(","),a=Kf(l);return e&&l.audioGroups?l.audioGroups.reduce(function(u,f){var h,g=f?(h=c.groups[f])==null?void 0:h.tracks:null;return g?g.reduce(function(m,E){if(E.groupId===f){var T=parseFloat(E.channels||"");e.forEach(function(A){var L={contentType:Qr(A,"audio"),bitrate:s?pm(A,a):a};T&&(L.channels=""+T),m.push(L)})}return m},u):u},[]):[]}function pm(l,c){if(c<=1)return 1;var s=128e3;return l==="ec-3"?s=768e3:l==="ac-3"&&(s=64e4),Math.min(c/2,s)}function Kf(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function vm(l){var c="",s=l.audio,n=l.video;if(n){var e=zi(n.contentType);c+=e+"_r"+n.height+"x"+n.width+"f"+Math.ceil(n.framerate)+(n.transferFunction||"sd")+"_"+Math.ceil(n.bitrate/1e5)}if(s){var a=zi(s.contentType);c+=(n?"_":"")+a+"_c"+s.channels}return c}var Hf=function(){function l(s){s===void 0&&(s={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ce,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var n=this.logger=On(s.debug||!1,"Hls instance",s.assetPlayerId),e=this.config=xg(l.DefaultConfig,s,n);this.userConfig=s,e.progressive&&Ag(e,n);var a=e.abrController,u=e.bufferController,f=e.capLevelController,h=e.errorController,g=e.fpsController,m=new h(this),E=this.abrController=new a(this),T=new Cg(this),A=e.interstitialsController,L=A?this.interstitialsController=new A(this,l):null,k=this.bufferController=new u(this,T),I=this.capLevelController=new f(this),D=new g(this),U=new lm(this),K=e.contentSteeringController,G=K?new K(this):null,j=this.levelController=new zg(this,G),ie=new qg(this),se=new om(this.config),he=this.streamController=new sm(this,T,se),ve=this.gapController=new Bg(this,T);I.setStreamController(he),D.setStreamController(he);var ge=[U,j,he];L&&ge.splice(1,0,L),G&&ge.splice(1,0,G),this.networkControllers=ge;var de=[E,k,ve,I,D,ie,T];this.audioTrackController=this.createController(e.audioTrackController,ge);var ue=e.audioStreamController;ue&&ge.push(this.audioStreamController=new ue(this,T,se)),this.subtitleTrackController=this.createController(e.subtitleTrackController,ge);var Ae=e.subtitleStreamController;Ae&&ge.push(this.subtititleStreamController=new Ae(this,T,se)),this.createController(e.timelineController,de),se.emeController=this.emeController=this.createController(e.emeController,de),this.cmcdController=this.createController(e.cmcdController,de),this.latencyController=this.createController(Wg,de),this.coreComponents=de,ge.push(m);var je=m.onErrorOut;typeof je=="function"&&this.on(N.ERROR,je,m),this.on(N.MANIFEST_LOADED,U.onManifestLoaded,U)}l.isMSESupported=function(){return jf()},l.isSupported=function(){return nm()},l.getMediaSource=function(){return En()};var c=l.prototype;return c.createController=function(n,e){if(n){var a=new n(this);return e&&e.push(a),a}return null},c.on=function(n,e,a){a===void 0&&(a=this),this._emitter.on(n,e,a)},c.once=function(n,e,a){a===void 0&&(a=this),this._emitter.once(n,e,a)},c.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},c.off=function(n,e,a,u){a===void 0&&(a=this),this._emitter.off(n,e,a,u)},c.listeners=function(n){return this._emitter.listeners(n)},c.emit=function(n,e,a){return this._emitter.emit(n,e,a)},c.trigger=function(n,e){if(this.config.debug)return this.emit(n,n,e);try{return this.emit(n,n,e)}catch(u){if(this.logger.error("An internal error happened while handling event "+n+'. Error message: "'+u.message+'". Here is a stacktrace:',u),!this.triggeringException){this.triggeringException=!0;var a=n===N.ERROR;this.trigger(N.ERROR,{type:ft.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:a,event:n,error:u}),this.triggeringException=!1}}return!1},c.listenerCount=function(n){return this._emitter.listenerCount(n)},c.destroy=function(){this.logger.log("destroy"),this.trigger(N.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var n=this.config;n.xhrSetup=n.fetchSetup=void 0,this.userConfig=null},c.attachMedia=function(n){if(!n||"media"in n&&!n.media){var e=new Error("attachMedia failed: invalid argument ("+n+")");this.trigger(N.ERROR,{type:ft.OTHER_ERROR,details:be.ATTACH_MEDIA_ERROR,fatal:!0,error:e});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var a="media"in n,u=a?n.media:n,f=a?n:{media:u};this._media=u,this.trigger(N.MEDIA_ATTACHING,f)},c.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(N.MEDIA_DETACHING,{}),this._media=null},c.transferMedia=function(){this._media=null;var n=this.bufferController.transferMedia();return this.trigger(N.MEDIA_DETACHING,{transferMedia:n}),n},c.loadSource=function(n){this.stopLoad();var e=this.media,a=this._url,u=this._url=He.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+u),e&&a&&(a!==u||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(N.MANIFEST_LOADING,{url:n})},c.startLoad=function(n,e){n===void 0&&(n=-1),this.logger.log("startLoad("+(n+(e?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var a=0;a<this.networkControllers.length&&(this.networkControllers[a].startLoad(n,e),!(!this.started||!this.networkControllers));a++);},c.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var n=0;n<this.networkControllers.length&&(this.networkControllers[n].stopLoad(),!(this.started||!this.networkControllers));n++);},c.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(n){n.resumeBuffering&&n.resumeBuffering()}))},c.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(n){n.pauseBuffering&&n.pauseBuffering()}))},c.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},c.recoverMediaError=function(){this.logger.log("recoverMediaError");var n=this._media,e=n?.currentTime;this.detachMedia(),n&&(this.attachMedia(n),e&&this.startLoad(e))},c.removeLevel=function(n){this.levelController.removeLevel(n)},c.setAudioOption=function(n){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(n))||null},c.setSubtitleOption=function(n){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(n))||null},c.getMediaDecodingInfo=function(n,e){e===void 0&&(e=this.allAudioTracks);var a=Qi(e);return fm(n,a,navigator.mediaCapabilities)},b(l,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var n,e=(n={},n[st.MAIN]=this.streamController.inFlightFrag,n);return this.audioStreamController&&(e[st.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[st.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}},{key:"sessionId",get:function(){var n=this._sessionId;return n||(n=this._sessionId=ce()),n}},{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){this.logger.log("set currentLevel:"+n),this.levelController.manualLevel=n,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){this.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){this.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){this.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){var n=this.levelController.startLevel;return n===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:n},set:function(n){this.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var e=!!n;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(this.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN},set:function(n){this.abrController.resetEstimator(n)}},{key:"abrEwmaDefaultEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(n){It(n)&&this._maxHdcpLevel!==n&&(this._maxHdcpLevel=n,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,e=this.config.minAutoBitrate;if(!n)return 0;for(var a=n.length,u=0;u<a;u++)if(n[u].maxBitrate>=e)return u;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,e=this.autoLevelCapping,a=this.maxHdcpLevel,u;if(e===-1&&n!=null&&n.length?u=n.length-1:u=e,a)for(var f=u;f--;){var h=n[f].attrs["HDCP-LEVEL"];if(h&&h<=a)return f}return u}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(n){this.abrController.nextAutoLevel=n}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var n=this.audioTrackController;return n?n.allAudioTracks:[]}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var e=this.audioTrackController;e&&(e.audioTrack=n)}},{key:"allSubtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var e=this.subtitleTrackController;e&&(e.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return n?n.subtitleDisplay:!1},set:function(n){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(n){this.latencyController.targetLatency=n}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(n){this.levelController.pathwayPriority=n}},{key:"bufferedToEnd",get:function(){var n;return!!((n=this.bufferController)!=null&&n.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var n;return((n=this.interstitialsController)==null?void 0:n.interstitialsManager)||null}}],[{key:"version",get:function(){return lo}},{key:"Events",get:function(){return N}},{key:"MetadataSchema",get:function(){return we}},{key:"ErrorTypes",get:function(){return ft}},{key:"ErrorDetails",get:function(){return be}},{key:"DefaultConfig",get:function(){return l.defaultConfig?l.defaultConfig:Tg},set:function(n){l.defaultConfig=n}}])}();return Hf.defaultConfig=void 0,Hf})})(!1)}(fc)),fc.exports}var Sb=Tb();const ch=nu(Sb);function We(t,r,i){return(r=Ab(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function xb(t,r){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var o=i.call(t,r);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Ab(t){var r=xb(t,"string");return typeof r=="symbol"?r:String(r)}function Cb(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function fh(t,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Lb(t,r,i){return r&&fh(t.prototype,r),i&&fh(t,i),t}function Rb(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function dh(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(t,d).enumerable})),i.push.apply(i,o)}return i}function hh(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?dh(Object(i),!0).forEach(function(o){Rb(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dh(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}var ph={addCSS:!0,thumbWidth:15,watch:!0};function kb(t,r){return(function(){return Array.from(document.querySelectorAll(r)).includes(this)}).call(t,r)}function wb(t,r){if(t&&r){var i=new Event(r,{bubbles:!0});t.dispatchEvent(i)}}var Vo=function(t){return t!=null?t.constructor:null},cf=function(t,r){return!!(t&&r&&t instanceof r)},fv=function(t){return t==null},dv=function(t){return Vo(t)===Object},Ib=function(t){return Vo(t)===Number&&!Number.isNaN(t)},hv=function(t){return Vo(t)===String},Pb=function(t){return Vo(t)===Boolean},Db=function(t){return Vo(t)===Function},pv=function(t){return Array.isArray(t)},vv=function(t){return cf(t,NodeList)},Mb=function(t){return cf(t,Element)},Ob=function(t){return cf(t,Event)},Nb=function(t){return fv(t)||(hv(t)||pv(t)||vv(t))&&!t.length||dv(t)&&!Object.keys(t).length},un={nullOrUndefined:fv,object:dv,number:Ib,string:hv,boolean:Pb,function:Db,array:pv,nodeList:vv,element:Mb,event:Ob,empty:Nb};function Fb(t){var r="".concat(t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return r?Math.max(0,(r[1]?r[1].length:0)-(r[2]?+r[2]:0)):0}function Bb(t,r){if(1>r){var i=Fb(r);return parseFloat(t.toFixed(i))}return Math.round(t/r)*r}var Ub=function(){function t(r,i){Cb(this,t),un.element(r)?this.element=r:un.string(r)&&(this.element=document.querySelector(r)),un.element(this.element)&&un.empty(this.element.rangeTouch)&&(this.config=hh({},ph,{},i),this.init())}return Lb(t,[{key:"init",value:function(){t.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){t.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(r){var i=this,o=r?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(d){i.element[o](d,function(p){return i.set(p)},!1)})}},{key:"get",value:function(r){if(!t.enabled||!un.event(r))return null;var i,o=r.target,d=r.changedTouches[0],p=parseFloat(o.getAttribute("min"))||0,b=parseFloat(o.getAttribute("max"))||100,_=parseFloat(o.getAttribute("step"))||1,x=o.getBoundingClientRect(),R=100/x.width*(this.config.thumbWidth/2)/100;return 0>(i=100/x.width*(d.clientX-x.left))?i=0:100<i&&(i=100),50>i?i-=(100-2*i)*R:50<i&&(i+=2*(i-50)*R),p+Bb(i/100*(b-p),_)}},{key:"set",value:function(r){t.enabled&&un.event(r)&&!r.target.disabled&&(r.preventDefault(),r.target.value=this.get(r),wb(r.target,r.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(r){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},o=null;if(un.empty(r)||un.string(r)?o=Array.from(document.querySelectorAll(un.string(r)?r:'input[type="range"]')):un.element(r)?o=[r]:un.nodeList(r)?o=Array.from(r):un.array(r)&&(o=r.filter(un.element)),un.empty(o))return null;var d=hh({},ph,{},i);if(un.string(r)&&d.watch){var p=new MutationObserver(function(b){Array.from(b).forEach(function(_){Array.from(_.addedNodes).forEach(function(x){un.element(x)&&kb(x,r)&&new t(x,d)})})});p.observe(document.body,{childList:!0,subtree:!0})}return o.map(function(b){return new t(b,i)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),t}();const Ko=t=>t!=null?t.constructor:null,Vi=(t,r)=>!!(t&&r&&t instanceof r),ff=t=>t==null,gv=t=>Ko(t)===Object,Gb=t=>Ko(t)===Number&&!Number.isNaN(t),su=t=>Ko(t)===String,jb=t=>Ko(t)===Boolean,mv=t=>typeof t=="function",yv=t=>Array.isArray(t),Vb=t=>Vi(t,WeakMap),bv=t=>Vi(t,NodeList),Kb=t=>Ko(t)===Text,Hb=t=>Vi(t,Event),qb=t=>Vi(t,KeyboardEvent),Wb=t=>Vi(t,window.TextTrackCue)||Vi(t,window.VTTCue),Yb=t=>Vi(t,TextTrack)||!ff(t)&&su(t.kind),zb=t=>Vi(t,Promise)&&mv(t.then),$b=t=>t!==null&&typeof t=="object"&&t.nodeType===1&&typeof t.style=="object"&&typeof t.ownerDocument=="object",Ev=t=>ff(t)||(su(t)||yv(t)||bv(t))&&!t.length||gv(t)&&!Object.keys(t).length,Xb=t=>{if(Vi(t,window.URL))return!0;if(!su(t))return!1;let r=t;t.startsWith("http://")&&t.startsWith("https://")||(r=`http://${t}`);try{return!Ev(new URL(r).hostname)}catch{return!1}};var V={nullOrUndefined:ff,object:gv,number:Gb,string:su,boolean:jb,function:mv,array:yv,weakMap:Vb,nodeList:bv,element:$b,textNode:Kb,event:Hb,keyboardEvent:qb,cue:Wb,track:Yb,promise:zb,url:Xb,empty:Ev};const Dc=(()=>{const t=document.createElement("span"),r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},i=Object.keys(r).find(o=>t.style[o]!==void 0);return!!V.string(i)&&r[i]})();function _v(t,r){setTimeout(()=>{try{t.hidden=!0,t.offsetHeight,t.hidden=!1}catch{}},r)}const Qb=!!window.document.documentMode,Jb=/Edge/g.test(navigator.userAgent),Zb="WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),eE=/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,tE=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,rE=/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;var Wr={isIE:Qb,isEdge:Jb,isWebKit:Zb,isIPhone:eE,isIPadOS:tE,isIos:rE};function nE(t){return JSON.parse(JSON.stringify(t))}function Tv(t,r){return r.split(".").reduce((i,o)=>i&&i[o],t)}function Ar(t={},...r){if(!r.length)return t;const i=r.shift();return V.object(i)?(Object.keys(i).forEach(o=>{V.object(i[o])?(Object.keys(t).includes(o)||Object.assign(t,{[o]:{}}),Ar(t[o],i[o])):Object.assign(t,{[o]:i[o]})}),Ar(t,...r)):t}function Sv(t,r){const i=t.length?t:[t];Array.from(i).reverse().forEach((o,d)=>{const p=d>0?r.cloneNode(!0):r,b=o.parentNode,_=o.nextSibling;p.appendChild(o),_?b.insertBefore(p,_):b.appendChild(p)})}function Mc(t,r){V.element(t)&&!V.empty(r)&&Object.entries(r).filter(([,i])=>!V.nullOrUndefined(i)).forEach(([i,o])=>t.setAttribute(i,o))}function vt(t,r,i){const o=document.createElement(t);return V.object(r)&&Mc(o,r),V.string(i)&&(o.innerText=i),o}function iE(t,r){V.element(t)&&V.element(r)&&r.parentNode.insertBefore(t,r.nextSibling)}function vh(t,r,i,o){V.element(r)&&r.appendChild(vt(t,i,o))}function Ui(t){V.nodeList(t)||V.array(t)?Array.from(t).forEach(Ui):V.element(t)&&V.element(t.parentNode)&&t.parentNode.removeChild(t)}function Dl(t){if(!V.element(t))return;let{length:r}=t.childNodes;for(;r>0;)t.removeChild(t.lastChild),r-=1}function ql(t,r){return V.element(r)&&V.element(r.parentNode)&&V.element(t)?(r.parentNode.replaceChild(t,r),t):null}function _i(t,r){if(!V.string(t)||V.empty(t))return{};const i={},o=Ar({},r);return t.split(",").forEach(d=>{const p=d.trim(),b=p.replace(".",""),_=p.replace(/[[\]]/g,"").split("="),[x]=_,R=_.length>1?_[1].replace(/["']/g,""):"";switch(p.charAt(0)){case".":V.string(o.class)?i.class=`${o.class} ${b}`:i.class=b;break;case"#":i.id=p.replace("#","");break;case"[":i[x]=R}}),Ar(o,i)}function Ra(t,r){if(!V.element(t))return;let i=r;V.boolean(i)||(i=!t.hidden),t.hidden=i}function Ht(t,r,i){if(V.nodeList(t))return Array.from(t).map(o=>Ht(o,r,i));if(V.element(t)){let o="toggle";return i!==void 0&&(o=i?"add":"remove"),t.classList[o](r),t.classList.contains(r)}return!1}function Wl(t,r){return V.element(t)&&t.classList.contains(r)}function wa(t,r){const{prototype:i}=Element;return(i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(){return Array.from(document.querySelectorAll(r)).includes(this)}).call(t,r)}function aE(t,r){const{prototype:i}=Element;return(i.closest||function(){let o=this;do{if(wa.matches(o,r))return o;o=o.parentElement||o.parentNode}while(o!==null&&o.nodeType===1);return null}).call(t,r)}function ko(t){return this.elements.container.querySelectorAll(t)}function Mr(t){return this.elements.container.querySelector(t)}function dc(t=null,r=!1){V.element(t)&&t.focus({preventScroll:!0,focusVisible:r})}const gh={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},Cr={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(t,r){const i=Cr[t]||r!=="html5";return{api:i,ui:i&&Cr.rangeInput}},pip:!(Wr.isIPhone||!V.function(vt("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||vt("video").disablePictureInPicture)),airplay:V.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(t){if(V.empty(t))return!1;const[r]=t.split("/");let i=t;if(!this.isHTML5||r!==this.type)return!1;Object.keys(gh).includes(i)&&(i+=`; codecs="${gh[t]}"`);try{return!!(i&&this.media.canPlayType(i).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const t=document.createElement("input");return t.type="range",t.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:Dc!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},sE=(()=>{let t=!1;try{const r=Object.defineProperty({},"passive",{get:()=>(t=!0,null)});window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}return t})();function wo(t,r,i,o=!1,d=!0,p=!1){if(!t||!("addEventListener"in t)||V.empty(r)||!V.function(i))return;const b=r.split(" ");let _=p;sE&&(_={passive:d,capture:p}),b.forEach(x=>{this&&this.eventListeners&&o&&this.eventListeners.push({element:t,type:x,callback:i,options:_}),t[o?"addEventListener":"removeEventListener"](x,i,_)})}function Vt(t,r="",i,o=!0,d=!1){wo.call(this,t,r,i,!0,o,d)}function ou(t,r="",i,o=!0,d=!1){wo.call(this,t,r,i,!1,o,d)}function df(t,r="",i,o=!0,d=!1){const p=(...b)=>{ou(t,r,p,o,d),i.apply(this,b)};wo.call(this,t,r,p,!0,o,d)}function gt(t,r="",i=!1,o={}){if(!V.element(t)||V.empty(r))return;const d=new CustomEvent(r,{bubbles:i,detail:{...o,plyr:this}});t.dispatchEvent(d)}function oE(){this&&this.eventListeners&&(this.eventListeners.forEach(t=>{const{element:r,type:i,callback:o,options:d}=t;r.removeEventListener(i,o,d)}),this.eventListeners=[])}function lE(){return new Promise(t=>this.ready?setTimeout(t,0):Vt.call(this,this.elements.container,"ready",t)).then(()=>{})}function Ti(t){V.promise(t)&&t.then(null,()=>{})}function Oc(t){return V.array(t)?t.filter((r,i)=>t.indexOf(r)===i):t}function xv(t,r){return V.array(t)&&t.length?t.reduce((i,o)=>Math.abs(o-r)<Math.abs(i-r)?o:i):null}function Av(t){return!(!window||!window.CSS)&&window.CSS.supports(t)}const mh=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((t,[r,i])=>({...t,[r/i]:[r,i]}),{});function Cv(t){return V.array(t)||V.string(t)&&t.includes(":")?(V.array(t)?t:t.split(":")).map(Number).every(V.number):!1}function Yl(t){if(!V.array(t)||!t.every(V.number))return null;const[r,i]=t,o=(p,b)=>b===0?p:o(b,p%b),d=o(r,i);return[r/d,i/d]}function hf(t){const r=o=>Cv(o)?o.split(":").map(Number):null;let i=r(t);if(i===null&&(i=r(this.config.ratio)),i===null&&!V.empty(this.embed)&&V.array(this.embed.ratio)&&({ratio:i}=this.embed),i===null&&this.isHTML5){const{videoWidth:o,videoHeight:d}=this.media;i=[o,d]}return Yl(i)}function Ds(t){if(!this.isVideo)return{};const{wrapper:r}=this.elements,i=hf.call(this,t);if(!V.array(i))return{};const[o,d]=Yl(i),p=100/o*d;if(Av(`aspect-ratio: ${o}/${d}`)?r.style.aspectRatio=`${o}/${d}`:r.style.paddingBottom=`${p}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const b=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),_=(b-p)/(b/50);this.fullscreen.active?r.style.paddingBottom=null:this.media.style.transform=`translateY(-${_}%)`}else this.isHTML5&&r.classList.add(this.config.classNames.videoFixedRatio);return{padding:p,ratio:i}}function Lv(t,r,i=.05){const o=t/r,d=xv(Object.keys(mh),o);return Math.abs(d-o)<=i?mh[d]:[t,r]}function uE(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}const fa={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(t=>{const r=t.getAttribute("type");return!!V.empty(r)||Cr.mime.call(this,r)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:fa.getSources.call(this).map(t=>Number(t.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const t=this;t.options.speed=t.config.speed.options,V.empty(this.config.ratio)||Ds.call(t),Object.defineProperty(t.media,"quality",{get(){const r=fa.getSources.call(t).find(i=>i.getAttribute("src")===t.source);return r&&Number(r.getAttribute("size"))},set(r){if(t.quality!==r){if(t.config.quality.forced&&V.function(t.config.quality.onChange))t.config.quality.onChange(r);else{const i=fa.getSources.call(t).find(x=>Number(x.getAttribute("size"))===r);if(!i)return;const{currentTime:o,paused:d,preload:p,readyState:b,playbackRate:_}=t.media;t.media.src=i.getAttribute("src"),(p!=="none"||b)&&(t.once("loadedmetadata",()=>{t.speed=_,t.currentTime=o,d||Ti(t.play())}),t.media.load())}gt.call(t,t.media,"qualitychange",!1,{quality:r})}}})},cancelRequests(){this.isHTML5&&(Ui(fa.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function cE(t){return`${t}-${Math.floor(1e4*Math.random())}`}function Nc(t,...r){return V.empty(t)?t:t.toString().replace(/{(\d+)}/g,(i,o)=>r[o].toString())}function fE(t,r){return t===0||r===0||Number.isNaN(t)||Number.isNaN(r)?0:(t/r*100).toFixed(2)}const Eo=(t="",r="",i="")=>t.replace(new RegExp(r.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),i.toString()),Rv=(t="")=>t.toString().replace(/\w\S*/g,r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase());function dE(t=""){let r=t.toString();return r=Eo(r,"-"," "),r=Eo(r,"_"," "),r=Rv(r),Eo(r," ","")}function hE(t=""){let r=t.toString();return r=dE(r),r.charAt(0).toLowerCase()+r.slice(1)}function pE(t){const r=document.createDocumentFragment(),i=document.createElement("div");return r.appendChild(i),i.innerHTML=t,r.firstChild.innerText}function vE(t){const r=document.createElement("div");return r.appendChild(t),r.innerHTML}const yh={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},qr={get(t="",r={}){if(V.empty(t)||V.empty(r))return"";let i=Tv(r.i18n,t);if(V.empty(i))return Object.keys(yh).includes(t)?yh[t]:"";const o={"{seektime}":r.seekTime,"{title}":r.title};return Object.entries(o).forEach(([d,p])=>{i=Eo(i,d,p)}),i}};class Io{constructor(r){We(this,"get",i=>{if(!Io.supported||!this.enabled)return null;const o=window.localStorage.getItem(this.key);if(V.empty(o))return null;const d=JSON.parse(o);return V.string(i)&&i.length?d[i]:d}),We(this,"set",i=>{if(!Io.supported||!this.enabled||!V.object(i))return;let o=this.get();V.empty(o)&&(o={}),Ar(o,i);try{window.localStorage.setItem(this.key,JSON.stringify(o))}catch{}}),this.enabled=r.config.storage.enabled,this.key=r.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const r="___test";return window.localStorage.setItem(r,r),window.localStorage.removeItem(r),!0}catch{return!1}}}function Ho(t,r="text"){return new Promise((i,o)=>{try{const d=new XMLHttpRequest;if(!("withCredentials"in d))return;d.addEventListener("load",()=>{if(r==="text")try{i(JSON.parse(d.responseText))}catch{i(d.responseText)}else i(d.response)}),d.addEventListener("error",()=>{throw new Error(d.status)}),d.open("GET",t,!0),d.responseType=r,d.send()}catch(d){o(d)}})}function kv(t,r){if(!V.string(t))return;const i="cache",o=V.string(r);let d=!1;const p=()=>document.getElementById(r)!==null,b=(_,x)=>{_.innerHTML=x,o&&p()||document.body.insertAdjacentElement("afterbegin",_)};if(!o||!p()){const _=Io.supported,x=document.createElement("div");if(x.setAttribute("hidden",""),o&&x.setAttribute("id",r),_){const R=window.localStorage.getItem(`${i}-${r}`);if(d=R!==null,d){const P=JSON.parse(R);b(x,P.content)}}Ho(t).then(R=>{if(!V.empty(R)){if(_)try{window.localStorage.setItem(`${i}-${r}`,JSON.stringify({content:R}))}catch{}b(x,R)}}).catch(()=>{})}}const wv=t=>Math.trunc(t/60/60%60,10),gE=t=>Math.trunc(t/60%60,10),mE=t=>Math.trunc(t%60,10);function lu(t=0,r=!1,i=!1){if(!V.number(t))return lu(void 0,r,i);const o=_=>`0${_}`.slice(-2);let d=wv(t);const p=gE(t),b=mE(t);return d=r||d>0?`${d}:`:"",`${i&&t>0?"-":""}${d}${o(p)}:${o(b)}`}const Ke={getIconUrl(){const t=new URL(this.config.iconUrl,window.location),r=window.location.host?window.location.host:window.top.location.host,i=t.host!==r||Wr.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:i}},findElements(){try{return this.elements.controls=Mr.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:ko.call(this,this.config.selectors.buttons.play),pause:Mr.call(this,this.config.selectors.buttons.pause),restart:Mr.call(this,this.config.selectors.buttons.restart),rewind:Mr.call(this,this.config.selectors.buttons.rewind),fastForward:Mr.call(this,this.config.selectors.buttons.fastForward),mute:Mr.call(this,this.config.selectors.buttons.mute),pip:Mr.call(this,this.config.selectors.buttons.pip),airplay:Mr.call(this,this.config.selectors.buttons.airplay),settings:Mr.call(this,this.config.selectors.buttons.settings),captions:Mr.call(this,this.config.selectors.buttons.captions),fullscreen:Mr.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Mr.call(this,this.config.selectors.progress),this.elements.inputs={seek:Mr.call(this,this.config.selectors.inputs.seek),volume:Mr.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Mr.call(this,this.config.selectors.display.buffer),currentTime:Mr.call(this,this.config.selectors.display.currentTime),duration:Mr.call(this,this.config.selectors.display.duration)},V.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(t){return this.debug.warn("It looks like there is a problem with your custom controls HTML",t),this.toggleNativeControls(!0),!1}},createIcon(t,r){const i="http://www.w3.org/2000/svg",o=Ke.getIconUrl.call(this),d=`${o.cors?"":o.url}#${this.config.iconPrefix}`,p=document.createElementNS(i,"svg");Mc(p,Ar(r,{"aria-hidden":"true",focusable:"false"}));const b=document.createElementNS(i,"use"),_=`${d}-${t}`;return"href"in b&&b.setAttributeNS("http://www.w3.org/1999/xlink","href",_),b.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",_),p.appendChild(b),p},createLabel(t,r={}){const i=qr.get(t,this.config);return vt("span",{...r,class:[r.class,this.config.classNames.hidden].filter(Boolean).join(" ")},i)},createBadge(t){if(V.empty(t))return null;const r=vt("span",{class:this.config.classNames.menu.value});return r.appendChild(vt("span",{class:this.config.classNames.menu.badge},t)),r},createButton(t,r){const i=Ar({},r);let o=hE(t);const d={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(b=>{Object.keys(i).includes(b)&&(d[b]=i[b],delete i[b])}),d.element!=="button"||Object.keys(i).includes("type")||(i.type="button"),Object.keys(i).includes("class")?i.class.split(" ").some(b=>b===this.config.classNames.control)||Ar(i,{class:`${i.class} ${this.config.classNames.control}`}):i.class=this.config.classNames.control,t){case"play":d.toggle=!0,d.label="play",d.labelPressed="pause",d.icon="play",d.iconPressed="pause";break;case"mute":d.toggle=!0,d.label="mute",d.labelPressed="unmute",d.icon="volume",d.iconPressed="muted";break;case"captions":d.toggle=!0,d.label="enableCaptions",d.labelPressed="disableCaptions",d.icon="captions-off",d.iconPressed="captions-on";break;case"fullscreen":d.toggle=!0,d.label="enterFullscreen",d.labelPressed="exitFullscreen",d.icon="enter-fullscreen",d.iconPressed="exit-fullscreen";break;case"play-large":i.class+=` ${this.config.classNames.control}--overlaid`,o="play",d.label="play",d.icon="play";break;default:V.empty(d.label)&&(d.label=o),V.empty(d.icon)&&(d.icon=t)}const p=vt(d.element);return d.toggle?(p.appendChild(Ke.createIcon.call(this,d.iconPressed,{class:"icon--pressed"})),p.appendChild(Ke.createIcon.call(this,d.icon,{class:"icon--not-pressed"})),p.appendChild(Ke.createLabel.call(this,d.labelPressed,{class:"label--pressed"})),p.appendChild(Ke.createLabel.call(this,d.label,{class:"label--not-pressed"}))):(p.appendChild(Ke.createIcon.call(this,d.icon)),p.appendChild(Ke.createLabel.call(this,d.label))),Ar(i,_i(this.config.selectors.buttons[o],i)),Mc(p,i),o==="play"?(V.array(this.elements.buttons[o])||(this.elements.buttons[o]=[]),this.elements.buttons[o].push(p)):this.elements.buttons[o]=p,p},createRange(t,r){const i=vt("input",Ar(_i(this.config.selectors.inputs[t]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":qr.get(t,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},r));return this.elements.inputs[t]=i,Ke.updateRangeFill.call(this,i),Ub.setup(i),i},createProgress(t,r){const i=vt("progress",Ar(_i(this.config.selectors.display[t]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},r));if(t!=="volume"){i.appendChild(vt("span",null,"0"));const o={played:"played",buffer:"buffered"}[t],d=o?qr.get(o,this.config):"";i.innerText=`% ${d.toLowerCase()}`}return this.elements.display[t]=i,i},createTime(t,r){const i=_i(this.config.selectors.display[t],r),o=vt("div",Ar(i,{class:`${i.class?i.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":qr.get(t,this.config),role:"timer"}),"00:00");return this.elements.display[t]=o,o},bindMenuItemShortcuts(t,r){Vt.call(this,t,"keydown keyup",i=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(i.key)||(i.preventDefault(),i.stopPropagation(),i.type==="keydown"))return;const o=wa(t,'[role="menuitemradio"]');if(!o&&[" ","ArrowRight"].includes(i.key))Ke.showMenuPanel.call(this,r,!0);else{let d;i.key!==" "&&(i.key==="ArrowDown"||o&&i.key==="ArrowRight"?(d=t.nextElementSibling,V.element(d)||(d=t.parentNode.firstElementChild)):(d=t.previousElementSibling,V.element(d)||(d=t.parentNode.lastElementChild)),dc.call(this,d,!0))}},!1),Vt.call(this,t,"keyup",i=>{i.key==="Return"&&Ke.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:t,list:r,type:i,title:o,badge:d=null,checked:p=!1}){const b=_i(this.config.selectors.inputs[i]),_=vt("button",Ar(b,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${b.class?b.class:""}`.trim(),"aria-checked":p,value:t})),x=vt("span");x.innerHTML=o,V.element(d)&&x.appendChild(d),_.appendChild(x),Object.defineProperty(_,"checked",{enumerable:!0,get:()=>_.getAttribute("aria-checked")==="true",set(R){R&&Array.from(_.parentNode.children).filter(P=>wa(P,'[role="menuitemradio"]')).forEach(P=>P.setAttribute("aria-checked","false")),_.setAttribute("aria-checked",R?"true":"false")}}),this.listeners.bind(_,"click keyup",R=>{if(!V.keyboardEvent(R)||R.key===" "){switch(R.preventDefault(),R.stopPropagation(),_.checked=!0,i){case"language":this.currentTrack=Number(t);break;case"quality":this.quality=t;break;case"speed":this.speed=parseFloat(t)}Ke.showMenuPanel.call(this,"home",V.keyboardEvent(R))}},i,!1),Ke.bindMenuItemShortcuts.call(this,_,i),r.appendChild(_)},formatTime(t=0,r=!1){return V.number(t)?lu(t,wv(this.duration)>0,r):t},updateTimeDisplay(t=null,r=0,i=!1){V.element(t)&&V.number(r)&&(t.innerText=Ke.formatTime(r,i))},updateVolume(){this.supported.ui&&(V.element(this.elements.inputs.volume)&&Ke.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),V.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(t,r=0){V.element(t)&&(t.value=r,Ke.updateRangeFill.call(this,t))},updateProgress(t){if(!this.supported.ui||!V.event(t))return;let r=0;const i=(o,d)=>{const p=V.number(d)?d:0,b=V.element(o)?o:this.elements.display.buffer;if(V.element(b)){b.value=p;const _=b.getElementsByTagName("span")[0];V.element(_)&&(_.childNodes[0].nodeValue=p)}};if(t)switch(t.type){case"timeupdate":case"seeking":case"seeked":r=fE(this.currentTime,this.duration),t.type==="timeupdate"&&Ke.setRange.call(this,this.elements.inputs.seek,r);break;case"playing":case"progress":i(this.elements.display.buffer,100*this.buffered)}},updateRangeFill(t){const r=V.event(t)?t.target:t;if(V.element(r)&&r.getAttribute("type")==="range"){if(wa(r,this.config.selectors.inputs.seek)){r.setAttribute("aria-valuenow",this.currentTime);const i=Ke.formatTime(this.currentTime),o=Ke.formatTime(this.duration),d=qr.get("seekLabel",this.config);r.setAttribute("aria-valuetext",d.replace("{currentTime}",i).replace("{duration}",o))}else if(wa(r,this.config.selectors.inputs.volume)){const i=100*r.value;r.setAttribute("aria-valuenow",i),r.setAttribute("aria-valuetext",`${i.toFixed(1)}%`)}else r.setAttribute("aria-valuenow",r.value);(Wr.isWebKit||Wr.isIPadOS)&&r.style.setProperty("--value",r.value/r.max*100+"%")}},updateSeekTooltip(t){var r,i;if(!this.config.tooltips.seek||!V.element(this.elements.inputs.seek)||!V.element(this.elements.display.seekTooltip)||this.duration===0)return;const o=this.elements.display.seekTooltip,d=`${this.config.classNames.tooltip}--visible`,p=P=>Ht(o,d,P);if(this.touch)return void p(!1);let b=0;const _=this.elements.progress.getBoundingClientRect();if(V.event(t))b=100/_.width*(t.pageX-_.left);else{if(!Wl(o,d))return;b=parseFloat(o.style.left,10)}b<0?b=0:b>100&&(b=100);const x=this.duration/100*b;o.innerText=Ke.formatTime(x);const R=(r=this.config.markers)===null||r===void 0||(i=r.points)===null||i===void 0?void 0:i.find(({time:P})=>P===Math.round(x));R&&o.insertAdjacentHTML("afterbegin",`${R.label}<br>`),o.style.left=`${b}%`,V.event(t)&&["mouseenter","mouseleave"].includes(t.type)&&p(t.type==="mouseenter")},timeUpdate(t){const r=!V.element(this.elements.display.duration)&&this.config.invertTime;Ke.updateTimeDisplay.call(this,this.elements.display.currentTime,r?this.duration-this.currentTime:this.currentTime,r),t&&t.type==="timeupdate"&&this.media.seeking||Ke.updateProgress.call(this,t)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return Ra(this.elements.display.currentTime,!0),void Ra(this.elements.progress,!0);V.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const t=V.element(this.elements.display.duration);!t&&this.config.displayDuration&&this.paused&&Ke.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),t&&Ke.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&Ke.setMarkers.call(this),Ke.updateSeekTooltip.call(this)},toggleMenuButton(t,r){Ra(this.elements.settings.buttons[t],!r)},updateSetting(t,r,i){const o=this.elements.settings.panels[t];let d=null,p=r;if(t==="captions")d=this.currentTrack;else{if(d=V.empty(i)?this[t]:i,V.empty(d)&&(d=this.config[t].default),!V.empty(this.options[t])&&!this.options[t].includes(d))return void this.debug.warn(`Unsupported value of '${d}' for ${t}`);if(!this.config[t].options.includes(d))return void this.debug.warn(`Disabled value of '${d}' for ${t}`)}if(V.element(p)||(p=o&&o.querySelector('[role="menu"]')),!V.element(p))return;this.elements.settings.buttons[t].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=Ke.getLabel.call(this,t,d);const b=p&&p.querySelector(`[value="${d}"]`);V.element(b)&&(b.checked=!0)},getLabel(t,r){switch(t){case"speed":return r===1?qr.get("normal",this.config):`${r}&times;`;case"quality":if(V.number(r)){const i=qr.get(`qualityLabel.${r}`,this.config);return i.length?i:`${r}p`}return Rv(r);case"captions":return Kt.getLabel.call(this);default:return null}},setQualityMenu(t){if(!V.element(this.elements.settings.panels.quality))return;const r="quality",i=this.elements.settings.panels.quality.querySelector('[role="menu"]');V.array(t)&&(this.options.quality=Oc(t).filter(p=>this.config.quality.options.includes(p)));const o=!V.empty(this.options.quality)&&this.options.quality.length>1;if(Ke.toggleMenuButton.call(this,r,o),Dl(i),Ke.checkMenu.call(this),!o)return;const d=p=>{const b=qr.get(`qualityBadge.${p}`,this.config);return b.length?Ke.createBadge.call(this,b):null};this.options.quality.sort((p,b)=>{const _=this.config.quality.options;return _.indexOf(p)>_.indexOf(b)?1:-1}).forEach(p=>{Ke.createMenuItem.call(this,{value:p,list:i,type:r,title:Ke.getLabel.call(this,"quality",p),badge:d(p)})}),Ke.updateSetting.call(this,r,i)},setCaptionsMenu(){if(!V.element(this.elements.settings.panels.captions))return;const t="captions",r=this.elements.settings.panels.captions.querySelector('[role="menu"]'),i=Kt.getTracks.call(this),o=!!i.length;if(Ke.toggleMenuButton.call(this,t,o),Dl(r),Ke.checkMenu.call(this),!o)return;const d=i.map((p,b)=>({value:b,checked:this.captions.toggled&&this.currentTrack===b,title:Kt.getLabel.call(this,p),badge:p.language&&Ke.createBadge.call(this,p.language.toUpperCase()),list:r,type:"language"}));d.unshift({value:-1,checked:!this.captions.toggled,title:qr.get("disabled",this.config),list:r,type:"language"}),d.forEach(Ke.createMenuItem.bind(this)),Ke.updateSetting.call(this,t,r)},setSpeedMenu(){if(!V.element(this.elements.settings.panels.speed))return;const t="speed",r=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(o=>o>=this.minimumSpeed&&o<=this.maximumSpeed);const i=!V.empty(this.options.speed)&&this.options.speed.length>1;Ke.toggleMenuButton.call(this,t,i),Dl(r),Ke.checkMenu.call(this),i&&(this.options.speed.forEach(o=>{Ke.createMenuItem.call(this,{value:o,list:r,type:t,title:Ke.getLabel.call(this,"speed",o)})}),Ke.updateSetting.call(this,t,r))},checkMenu(){const{buttons:t}=this.elements.settings,r=!V.empty(t)&&Object.values(t).some(i=>!i.hidden);Ra(this.elements.settings.menu,!r)},focusFirstMenuItem(t,r=!1){if(this.elements.settings.popup.hidden)return;let i=t;V.element(i)||(i=Object.values(this.elements.settings.panels).find(d=>!d.hidden));const o=i.querySelector('[role^="menuitem"]');dc.call(this,o,r)},toggleMenu(t){const{popup:r}=this.elements.settings,i=this.elements.buttons.settings;if(!V.element(r)||!V.element(i))return;const{hidden:o}=r;let d=o;if(V.boolean(t))d=t;else if(V.keyboardEvent(t)&&t.key==="Escape")d=!1;else if(V.event(t)){const p=V.function(t.composedPath)?t.composedPath()[0]:t.target,b=r.contains(p);if(b||!b&&t.target!==i&&d)return}i.setAttribute("aria-expanded",d),Ra(r,!d),Ht(this.elements.container,this.config.classNames.menu.open,d),d&&V.keyboardEvent(t)?Ke.focusFirstMenuItem.call(this,null,!0):d||o||dc.call(this,i,V.keyboardEvent(t))},getMenuSize(t){const r=t.cloneNode(!0);r.style.position="absolute",r.style.opacity=0,r.removeAttribute("hidden"),t.parentNode.appendChild(r);const i=r.scrollWidth,o=r.scrollHeight;return Ui(r),{width:i,height:o}},showMenuPanel(t="",r=!1){const i=this.elements.container.querySelector(`#plyr-settings-${this.id}-${t}`);if(!V.element(i))return;const o=i.parentNode,d=Array.from(o.children).find(p=>!p.hidden);if(Cr.transitions&&!Cr.reducedMotion){o.style.width=`${d.scrollWidth}px`,o.style.height=`${d.scrollHeight}px`;const p=Ke.getMenuSize.call(this,i),b=_=>{_.target===o&&["width","height"].includes(_.propertyName)&&(o.style.width="",o.style.height="",ou.call(this,o,Dc,b))};Vt.call(this,o,Dc,b),o.style.width=`${p.width}px`,o.style.height=`${p.height}px`}Ra(d,!0),Ra(i,!1),Ke.focusFirstMenuItem.call(this,i,r)},setDownloadUrl(){const t=this.elements.buttons.download;V.element(t)&&t.setAttribute("href",this.download)},create(t){const{bindMenuItemShortcuts:r,createButton:i,createProgress:o,createRange:d,createTime:p,setQualityMenu:b,setSpeedMenu:_,showMenuPanel:x}=Ke;this.elements.controls=null,V.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(i.call(this,"play-large"));const R=vt("div",_i(this.config.selectors.controls.wrapper));this.elements.controls=R;const P={class:"plyr__controls__item"};return Oc(V.array(this.config.controls)?this.config.controls:[]).forEach(O=>{if(O==="restart"&&R.appendChild(i.call(this,"restart",P)),O==="rewind"&&R.appendChild(i.call(this,"rewind",P)),O==="play"&&R.appendChild(i.call(this,"play",P)),O==="fast-forward"&&R.appendChild(i.call(this,"fast-forward",P)),O==="progress"){const F=vt("div",{class:`${P.class} plyr__progress__container`}),W=vt("div",_i(this.config.selectors.progress));if(W.appendChild(d.call(this,"seek",{id:`plyr-seek-${t.id}`})),W.appendChild(o.call(this,"buffer")),this.config.tooltips.seek){const H=vt("span",{class:this.config.classNames.tooltip},"00:00");W.appendChild(H),this.elements.display.seekTooltip=H}this.elements.progress=W,F.appendChild(this.elements.progress),R.appendChild(F)}if(O==="current-time"&&R.appendChild(p.call(this,"currentTime",P)),O==="duration"&&R.appendChild(p.call(this,"duration",P)),O==="mute"||O==="volume"){let{volume:F}=this.elements;if(V.element(F)&&R.contains(F)||(F=vt("div",Ar({},P,{class:`${P.class} plyr__volume`.trim()})),this.elements.volume=F,R.appendChild(F)),O==="mute"&&F.appendChild(i.call(this,"mute")),O==="volume"&&!Wr.isIos&&!Wr.isIPadOS){const W={max:1,step:.05,value:this.config.volume};F.appendChild(d.call(this,"volume",Ar(W,{id:`plyr-volume-${t.id}`})))}}if(O==="captions"&&R.appendChild(i.call(this,"captions",P)),O==="settings"&&!V.empty(this.config.settings)){const F=vt("div",Ar({},P,{class:`${P.class} plyr__menu`.trim(),hidden:""}));F.appendChild(i.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${t.id}`,"aria-expanded":!1}));const W=vt("div",{class:"plyr__menu__container",id:`plyr-settings-${t.id}`,hidden:""}),H=vt("div"),Z=vt("div",{id:`plyr-settings-${t.id}-home`}),_e=vt("div",{role:"menu"});Z.appendChild(_e),H.appendChild(Z),this.elements.settings.panels.home=Z,this.config.settings.forEach(me=>{const le=vt("button",Ar(_i(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));r.call(this,le,me),Vt.call(this,le,"click",()=>{x.call(this,me,!1)});const ce=vt("span",null,qr.get(me,this.config)),Ee=vt("span",{class:this.config.classNames.menu.value});Ee.innerHTML=t[me],ce.appendChild(Ee),le.appendChild(ce),_e.appendChild(le);const Se=vt("div",{id:`plyr-settings-${t.id}-${me}`,hidden:""}),z=vt("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});z.appendChild(vt("span",{"aria-hidden":!0},qr.get(me,this.config))),z.appendChild(vt("span",{class:this.config.classNames.hidden},qr.get("menuBack",this.config))),Vt.call(this,Se,"keydown",ne=>{ne.key==="ArrowLeft"&&(ne.preventDefault(),ne.stopPropagation(),x.call(this,"home",!0))},!1),Vt.call(this,z,"click",()=>{x.call(this,"home",!1)}),Se.appendChild(z),Se.appendChild(vt("div",{role:"menu"})),H.appendChild(Se),this.elements.settings.buttons[me]=le,this.elements.settings.panels[me]=Se}),W.appendChild(H),F.appendChild(W),R.appendChild(F),this.elements.settings.popup=W,this.elements.settings.menu=F}if(O==="pip"&&Cr.pip&&R.appendChild(i.call(this,"pip",P)),O==="airplay"&&Cr.airplay&&R.appendChild(i.call(this,"airplay",P)),O==="download"){const F=Ar({},P,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(F.download="");const{download:W}=this.config.urls;!V.url(W)&&this.isEmbed&&Ar(F,{icon:`logo-${this.provider}`,label:this.provider}),R.appendChild(i.call(this,"download",F))}O==="fullscreen"&&R.appendChild(i.call(this,"fullscreen",P))}),this.isHTML5&&b.call(this,fa.getQualityOptions.call(this)),_.call(this),R},inject(){if(this.config.loadSprite){const d=Ke.getIconUrl.call(this);d.cors&&kv(d.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let t=null;this.elements.controls=null;const r={id:this.id,seektime:this.config.seekTime,title:this.config.title};let i=!0;V.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,r)),this.config.controls||(this.config.controls=[]),V.element(this.config.controls)||V.string(this.config.controls)?t=this.config.controls:(t=Ke.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:Kt.getLabel.call(this)}),i=!1);let o;if(i&&V.string(this.config.controls)&&(t=(d=>{let p=d;return Object.entries(r).forEach(([b,_])=>{p=Eo(p,`{${b}}`,_)}),p})(t)),V.string(this.config.selectors.controls.container)&&(o=document.querySelector(this.config.selectors.controls.container)),V.element(o)||(o=this.elements.container),o[V.element(t)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",t),V.element(this.elements.controls)||Ke.findElements.call(this),!V.empty(this.elements.buttons)){const d=p=>{const b=this.config.classNames.controlPressed;p.setAttribute("aria-pressed","false"),Object.defineProperty(p,"pressed",{configurable:!0,enumerable:!0,get:()=>Wl(p,b),set(_=!1){Ht(p,b,_),p.setAttribute("aria-pressed",_?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(p=>{V.array(p)||V.nodeList(p)?Array.from(p).filter(Boolean).forEach(d):d(p)})}if(Wr.isEdge&&_v(o),this.config.tooltips.controls){const{classNames:d,selectors:p}=this.config,b=`${p.controls.wrapper} ${p.labels} .${d.hidden}`,_=ko.call(this,b);Array.from(_).forEach(x=>{Ht(x,this.config.classNames.hidden,!1),Ht(x,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var t,r;if(!this.duration||this.elements.markers)return;const i=(t=this.config.markers)===null||t===void 0||(r=t.points)===null||r===void 0?void 0:r.filter(({time:x})=>x>0&&x<this.duration);if(i==null||!i.length)return;const o=document.createDocumentFragment(),d=document.createDocumentFragment();let p=null;const b=`${this.config.classNames.tooltip}--visible`,_=x=>Ht(p,b,x);i.forEach(x=>{const R=vt("span",{class:this.config.classNames.marker},""),P=x.time/this.duration*100+"%";p&&(R.addEventListener("mouseenter",()=>{x.label||(p.style.left=P,p.innerHTML=x.label,_(!0))}),R.addEventListener("mouseleave",()=>{_(!1)})),R.addEventListener("click",()=>{this.currentTime=x.time}),R.style.left=P,d.appendChild(R)}),o.appendChild(d),this.config.tooltips.seek||(p=vt("span",{class:this.config.classNames.tooltip},""),o.appendChild(p)),this.elements.markers={points:d,tip:p},this.elements.progress.appendChild(o)}};function Iv(t,r=!0){let i=t;if(r){const o=document.createElement("a");o.href=i,i=o.href}try{return new URL(i)}catch{return null}}function Pv(t){const r=new URLSearchParams;return V.object(t)&&Object.entries(t).forEach(([i,o])=>{r.set(i,o)}),r}const Kt={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!Cr.textTracks)return void(V.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ke.setCaptionsMenu.call(this));if(V.element(this.elements.captions)||(this.elements.captions=vt("div",_i(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),iE(this.elements.captions,this.elements.wrapper)),Wr.isIE&&window.URL){const o=this.media.querySelectorAll("track");Array.from(o).forEach(d=>{const p=d.getAttribute("src"),b=Iv(p);b!==null&&b.hostname!==window.location.href.hostname&&["http:","https:"].includes(b.protocol)&&Ho(p,"blob").then(_=>{d.setAttribute("src",window.URL.createObjectURL(_))}).catch(()=>{Ui(d)})})}const t=Oc((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(o=>o.split("-")[0]));let r=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();r==="auto"&&([r]=t);let i=this.storage.get("captions");if(V.boolean(i)||({active:i}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:i,language:r,languages:t}),this.isHTML5){const o=this.config.captions.update?"addtrack removetrack":"removetrack";Vt.call(this,this.media.textTracks,o,Kt.update.bind(this))}setTimeout(Kt.update.bind(this),0)},update(){const t=Kt.getTracks.call(this,!0),{active:r,language:i,meta:o,currentTrackNode:d}=this.captions,p=!!t.find(b=>b.language===i);this.isHTML5&&this.isVideo&&t.filter(b=>!o.get(b)).forEach(b=>{this.debug.log("Track added",b),o.set(b,{default:b.mode==="showing"}),b.mode==="showing"&&(b.mode="hidden"),Vt.call(this,b,"cuechange",()=>Kt.updateCues.call(this))}),(p&&this.language!==i||!t.includes(d))&&(Kt.setLanguage.call(this,i),Kt.toggle.call(this,r&&p)),this.elements&&Ht(this.elements.container,this.config.classNames.captions.enabled,!V.empty(t)),V.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ke.setCaptionsMenu.call(this)},toggle(t,r=!0){if(!this.supported.ui)return;const{toggled:i}=this.captions,o=this.config.classNames.captions.active,d=V.nullOrUndefined(t)?!i:t;if(d!==i){if(r||(this.captions.active=d,this.storage.set({captions:d})),!this.language&&d&&!r){const p=Kt.getTracks.call(this),b=Kt.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=b.language,void Kt.set.call(this,p.indexOf(b))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=d),Ht(this.elements.container,o,d),this.captions.toggled=d,Ke.updateSetting.call(this,"captions"),gt.call(this,this.media,d?"captionsenabled":"captionsdisabled")}setTimeout(()=>{d&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(t,r=!0){const i=Kt.getTracks.call(this);if(t!==-1)if(V.number(t))if(t in i){if(this.captions.currentTrack!==t){this.captions.currentTrack=t;const o=i[t],{language:d}=o||{};this.captions.currentTrackNode=o,Ke.updateSetting.call(this,"captions"),r||(this.captions.language=d,this.storage.set({language:d})),this.isVimeo&&this.embed.enableTextTrack(d),gt.call(this,this.media,"languagechange")}Kt.toggle.call(this,!0,r),this.isHTML5&&this.isVideo&&Kt.updateCues.call(this)}else this.debug.warn("Track not found",t);else this.debug.warn("Invalid caption argument",t);else Kt.toggle.call(this,!1,r)},setLanguage(t,r=!0){if(!V.string(t))return void this.debug.warn("Invalid language argument",t);const i=t.toLowerCase();this.captions.language=i;const o=Kt.getTracks.call(this),d=Kt.findTrack.call(this,[i]);Kt.set.call(this,o.indexOf(d),r)},getTracks(t=!1){return Array.from((this.media||{}).textTracks||[]).filter(r=>!this.isHTML5||t||this.captions.meta.has(r)).filter(r=>["captions","subtitles"].includes(r.kind))},findTrack(t,r=!1){const i=Kt.getTracks.call(this),o=b=>Number((this.captions.meta.get(b)||{}).default),d=Array.from(i).sort((b,_)=>o(_)-o(b));let p;return t.every(b=>(p=d.find(_=>_.language===b),!p)),p||(r?d[0]:void 0)},getCurrentTrack(){return Kt.getTracks.call(this)[this.currentTrack]},getLabel(t){let r=t;return!V.track(r)&&Cr.textTracks&&this.captions.toggled&&(r=Kt.getCurrentTrack.call(this)),V.track(r)?V.empty(r.label)?V.empty(r.language)?qr.get("enabled",this.config):t.language.toUpperCase():r.label:qr.get("disabled",this.config)},updateCues(t){if(!this.supported.ui)return;if(!V.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!V.nullOrUndefined(t)&&!Array.isArray(t))return void this.debug.warn("updateCues: Invalid input",t);let r=t;if(!r){const o=Kt.getCurrentTrack.call(this);r=Array.from((o||{}).activeCues||[]).map(d=>d.getCueAsHTML()).map(vE)}const i=r.map(o=>o.trim()).join(`
`);if(i!==this.elements.captions.innerHTML){Dl(this.elements.captions);const o=vt("span",_i(this.config.selectors.caption));o.innerHTML=i,this.elements.captions.appendChild(o),gt.call(this,this.media,"cuechange")}}},Dv={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},hc={active:"picture-in-picture",inactive:"inline"},la={html5:"html5",youtube:"youtube",vimeo:"vimeo"},pc={audio:"audio",video:"video"};function yE(t){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(t)?la.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(t)?la.vimeo:null}const vc=()=>{};class bE{constructor(r=!1){this.enabled=window.console&&r,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):vc}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):vc}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):vc}}class ri{constructor(r){We(this,"onChange",()=>{if(!this.supported)return;const i=this.player.elements.buttons.fullscreen;V.element(i)&&(i.pressed=this.active);const o=this.target===this.player.media?this.target:this.player.elements.container;gt.call(this.player,o,this.active?"enterfullscreen":"exitfullscreen",!0)}),We(this,"toggleFallback",(i=!1)=>{if(i?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=i?"hidden":"",Ht(this.target,this.player.config.classNames.fullscreen.fallback,i),Wr.isIos){let o=document.head.querySelector('meta[name="viewport"]');const d="viewport-fit=cover";o||(o=document.createElement("meta"),o.setAttribute("name","viewport"));const p=V.string(o.content)&&o.content.includes(d);i?(this.cleanupViewport=!p,p||(o.content+=`,${d}`)):this.cleanupViewport&&(o.content=o.content.split(",").filter(b=>b.trim()!==d).join(","))}this.onChange()}),We(this,"trapFocus",i=>{if(Wr.isIos||Wr.isIPadOS||!this.active||i.key!=="Tab")return;const o=document.activeElement,d=ko.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[p]=d,b=d[d.length-1];o!==b||i.shiftKey?o===p&&i.shiftKey&&(b.focus(),i.preventDefault()):(p.focus(),i.preventDefault())}),We(this,"update",()=>{if(this.supported){let i;i=this.forceFallback?"Fallback (forced)":ri.nativeSupported?"Native":"Fallback",this.player.debug.log(`${i} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");Ht(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)}),We(this,"enter",()=>{this.supported&&(Wr.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!ri.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?V.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),We(this,"exit",()=>{if(this.supported)if(Wr.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),Ti(this.player.play());else if(!ri.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!V.empty(this.prefix)){const i=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${i}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),We(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=r,this.prefix=ri.prefix,this.property=ri.property,this.scrollPosition={x:0,y:0},this.forceFallback=r.config.fullscreen.fallback==="force",this.player.elements.fullscreen=r.config.fullscreen.container&&aE(this.player.elements.container,r.config.fullscreen.container),Vt.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),Vt.call(this.player,this.player.elements.container,"dblclick",i=>{V.element(this.player.elements.controls)&&this.player.elements.controls.contains(i.target)||this.player.listeners.proxy(i,this.toggle,"fullscreen")}),Vt.call(this,this.player.elements.container,"keydown",i=>this.trapFocus(i)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return ri.nativeSupported&&!this.forceFallback}static get prefix(){if(V.function(document.exitFullscreen))return"";let r="";return["webkit","moz","ms"].some(i=>!(!V.function(document[`${i}ExitFullscreen`])&&!V.function(document[`${i}CancelFullScreen`]))&&(r=i,!0)),r}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,ri.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||ri.nativeSupported||!Wr.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!ri.nativeSupported||this.forceFallback)return Wl(this.target,this.player.config.classNames.fullscreen.fallback);const r=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return r&&r.shadowRoot?r===this.target.getRootNode().host:r===this.target}get target(){return Wr.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function Ml(t,r=1){return new Promise((i,o)=>{const d=new Image,p=()=>{delete d.onload,delete d.onerror,(d.naturalWidth>=r?i:o)(d)};Object.assign(d,{onload:p,onerror:p,src:t})})}const Jt={addStyleHook(){Ht(this.elements.container,this.config.selectors.container.replace(".",""),!0),Ht(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(t=!1){t&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void Jt.toggleNativeControls.call(this,!0);V.element(this.elements.controls)||(Ke.inject.call(this),this.listeners.controls()),Jt.toggleNativeControls.call(this),this.isHTML5&&Kt.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,Ke.updateVolume.call(this),Ke.timeUpdate.call(this),Ke.durationUpdate.call(this),Jt.checkPlaying.call(this),Ht(this.elements.container,this.config.classNames.pip.supported,Cr.pip&&this.isHTML5&&this.isVideo),Ht(this.elements.container,this.config.classNames.airplay.supported,Cr.airplay&&this.isHTML5),Ht(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{gt.call(this,this.media,"ready")},0),Jt.setTitle.call(this),this.poster&&Jt.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&Ke.durationUpdate.call(this),this.config.mediaMetadata&&Ke.setMediaMetadata.call(this)},setTitle(){let t=qr.get("play",this.config);if(V.string(this.config.title)&&!V.empty(this.config.title)&&(t+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(r=>{r.setAttribute("aria-label",t)}),this.isEmbed){const r=Mr.call(this,"iframe");if(!V.element(r))return;const i=V.empty(this.config.title)?"video":this.config.title,o=qr.get("frameTitle",this.config);r.setAttribute("title",o.replace("{title}",i))}},togglePoster(t){Ht(this.elements.container,this.config.classNames.posterEnabled,t)},setPoster(t,r=!0){return r&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",t),this.elements.poster.removeAttribute("hidden"),lE.call(this).then(()=>Ml(t)).catch(i=>{throw t===this.poster&&Jt.togglePoster.call(this,!1),i}).then(()=>{if(t!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${t}')`,backgroundSize:""}),Jt.togglePoster.call(this,!0),t)))},checkPlaying(t){Ht(this.elements.container,this.config.classNames.playing,this.playing),Ht(this.elements.container,this.config.classNames.paused,this.paused),Ht(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(r=>{Object.assign(r,{pressed:this.playing}),r.setAttribute("aria-label",qr.get(this.playing?"pause":"play",this.config))}),V.event(t)&&t.type==="timeupdate"||Jt.toggleControls.call(this)},checkLoading(t){this.loading=["stalled","waiting"].includes(t.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{Ht(this.elements.container,this.config.classNames.loading,this.loading),Jt.toggleControls.call(this)},this.loading?250:0)},toggleControls(t){const{controls:r}=this.elements;if(r&&this.config.hideControls){const i=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(t||this.loading||this.paused||r.pressed||r.hover||i))}},migrateStyles(){Object.values({...this.media.style}).filter(t=>!V.empty(t)&&V.string(t)&&t.startsWith("--plyr")).forEach(t=>{this.elements.container.style.setProperty(t,this.media.style.getPropertyValue(t)),this.media.style.removeProperty(t)}),V.empty(this.media.style)&&this.media.removeAttribute("style")}};class EE{constructor(r){We(this,"firstTouch",()=>{const{player:i}=this,{elements:o}=i;i.touch=!0,Ht(o.container,i.config.classNames.isTouch,!0)}),We(this,"global",(i=!0)=>{const{player:o}=this;o.config.keyboard.global&&wo.call(o,window,"keydown keyup",this.handleKey,i,!1),wo.call(o,document.body,"click",this.toggleMenu,i),df.call(o,document.body,"touchstart",this.firstTouch)}),We(this,"container",()=>{const{player:i}=this,{config:o,elements:d,timers:p}=i;!o.keyboard.global&&o.keyboard.focused&&Vt.call(i,d.container,"keydown keyup",this.handleKey,!1),Vt.call(i,d.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",x=>{const{controls:R}=d;R&&x.type==="enterfullscreen"&&(R.pressed=!1,R.hover=!1);let P=0;["touchstart","touchmove","mousemove"].includes(x.type)&&(Jt.toggleControls.call(i,!0),P=i.touch?3e3:2e3),clearTimeout(p.controls),p.controls=setTimeout(()=>Jt.toggleControls.call(i,!1),P)});const b=()=>{if(!i.isVimeo||i.config.vimeo.premium)return;const x=d.wrapper,{active:R}=i.fullscreen,[P,O]=hf.call(i),F=Av(`aspect-ratio: ${P} / ${O}`);if(!R)return void(F?(x.style.width=null,x.style.height=null):(x.style.maxWidth=null,x.style.margin=null));const[W,H]=uE(),Z=W/H>P/O;F?(x.style.width=Z?"auto":"100%",x.style.height=Z?"100%":"auto"):(x.style.maxWidth=Z?H/O*P+"px":null,x.style.margin=Z?"0 auto":null)},_=()=>{clearTimeout(p.resized),p.resized=setTimeout(b,50)};Vt.call(i,d.container,"enterfullscreen exitfullscreen",x=>{const{target:R}=i.fullscreen;R===d.container&&(!i.isEmbed&&V.empty(i.config.ratio)||(b(),(x.type==="enterfullscreen"?Vt:ou).call(i,window,"resize",_)))})}),We(this,"media",()=>{const{player:i}=this,{elements:o}=i;if(Vt.call(i,i.media,"timeupdate seeking seeked",p=>Ke.timeUpdate.call(i,p)),Vt.call(i,i.media,"durationchange loadeddata loadedmetadata",p=>Ke.durationUpdate.call(i,p)),Vt.call(i,i.media,"ended",()=>{i.isHTML5&&i.isVideo&&i.config.resetOnEnd&&(i.restart(),i.pause())}),Vt.call(i,i.media,"progress playing seeking seeked",p=>Ke.updateProgress.call(i,p)),Vt.call(i,i.media,"volumechange",p=>Ke.updateVolume.call(i,p)),Vt.call(i,i.media,"playing play pause ended emptied timeupdate",p=>Jt.checkPlaying.call(i,p)),Vt.call(i,i.media,"waiting canplay seeked playing",p=>Jt.checkLoading.call(i,p)),i.supported.ui&&i.config.clickToPlay&&!i.isAudio){const p=Mr.call(i,`.${i.config.classNames.video}`);if(!V.element(p))return;Vt.call(i,o.container,"click",b=>{([o.container,p].includes(b.target)||p.contains(b.target))&&(i.touch&&i.config.hideControls||(i.ended?(this.proxy(b,i.restart,"restart"),this.proxy(b,()=>{Ti(i.play())},"play")):this.proxy(b,()=>{Ti(i.togglePlay())},"play")))})}i.supported.ui&&i.config.disableContextMenu&&Vt.call(i,o.wrapper,"contextmenu",p=>{p.preventDefault()},!1),Vt.call(i,i.media,"volumechange",()=>{i.storage.set({volume:i.volume,muted:i.muted})}),Vt.call(i,i.media,"ratechange",()=>{Ke.updateSetting.call(i,"speed"),i.storage.set({speed:i.speed})}),Vt.call(i,i.media,"qualitychange",p=>{Ke.updateSetting.call(i,"quality",null,p.detail.quality)}),Vt.call(i,i.media,"ready qualitychange",()=>{Ke.setDownloadUrl.call(i)});const d=i.config.events.concat(["keyup","keydown"]).join(" ");Vt.call(i,i.media,d,p=>{let{detail:b={}}=p;p.type==="error"&&(b=i.media.error),gt.call(i,o.container,p.type,!0,b)})}),We(this,"proxy",(i,o,d)=>{const{player:p}=this,b=p.config.listeners[d];let _=!0;V.function(b)&&(_=b.call(p,i)),_!==!1&&V.function(o)&&o.call(p,i)}),We(this,"bind",(i,o,d,p,b=!0)=>{const{player:_}=this,x=_.config.listeners[p],R=V.function(x);Vt.call(_,i,o,P=>this.proxy(P,d,p),b&&!R)}),We(this,"controls",()=>{const{player:i}=this,{elements:o}=i,d=Wr.isIE?"change":"input";if(o.buttons.play&&Array.from(o.buttons.play).forEach(p=>{this.bind(p,"click",()=>{Ti(i.togglePlay())},"play")}),this.bind(o.buttons.restart,"click",i.restart,"restart"),this.bind(o.buttons.rewind,"click",()=>{i.lastSeekTime=Date.now(),i.rewind()},"rewind"),this.bind(o.buttons.fastForward,"click",()=>{i.lastSeekTime=Date.now(),i.forward()},"fastForward"),this.bind(o.buttons.mute,"click",()=>{i.muted=!i.muted},"mute"),this.bind(o.buttons.captions,"click",()=>i.toggleCaptions()),this.bind(o.buttons.download,"click",()=>{gt.call(i,i.media,"download")},"download"),this.bind(o.buttons.fullscreen,"click",()=>{i.fullscreen.toggle()},"fullscreen"),this.bind(o.buttons.pip,"click",()=>{i.pip="toggle"},"pip"),this.bind(o.buttons.airplay,"click",i.airplay,"airplay"),this.bind(o.buttons.settings,"click",p=>{p.stopPropagation(),p.preventDefault(),Ke.toggleMenu.call(i,p)},null,!1),this.bind(o.buttons.settings,"keyup",p=>{[" ","Enter"].includes(p.key)&&(p.key!=="Enter"?(p.preventDefault(),p.stopPropagation(),Ke.toggleMenu.call(i,p)):Ke.focusFirstMenuItem.call(i,null,!0))},null,!1),this.bind(o.settings.menu,"keydown",p=>{p.key==="Escape"&&Ke.toggleMenu.call(i,p)}),this.bind(o.inputs.seek,"mousedown mousemove",p=>{const b=o.progress.getBoundingClientRect(),_=100/b.width*(p.pageX-b.left);p.currentTarget.setAttribute("seek-value",_)}),this.bind(o.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",p=>{const b=p.currentTarget,_="play-on-seeked";if(V.keyboardEvent(p)&&!["ArrowLeft","ArrowRight"].includes(p.key))return;i.lastSeekTime=Date.now();const x=b.hasAttribute(_),R=["mouseup","touchend","keyup"].includes(p.type);x&&R?(b.removeAttribute(_),Ti(i.play())):!R&&i.playing&&(b.setAttribute(_,""),i.pause())}),Wr.isIos){const p=ko.call(i,'input[type="range"]');Array.from(p).forEach(b=>this.bind(b,d,_=>_v(_.target)))}this.bind(o.inputs.seek,d,p=>{const b=p.currentTarget;let _=b.getAttribute("seek-value");V.empty(_)&&(_=b.value),b.removeAttribute("seek-value"),i.currentTime=_/b.max*i.duration},"seek"),this.bind(o.progress,"mouseenter mouseleave mousemove",p=>Ke.updateSeekTooltip.call(i,p)),this.bind(o.progress,"mousemove touchmove",p=>{const{previewThumbnails:b}=i;b&&b.loaded&&b.startMove(p)}),this.bind(o.progress,"mouseleave touchend click",()=>{const{previewThumbnails:p}=i;p&&p.loaded&&p.endMove(!1,!0)}),this.bind(o.progress,"mousedown touchstart",p=>{const{previewThumbnails:b}=i;b&&b.loaded&&b.startScrubbing(p)}),this.bind(o.progress,"mouseup touchend",p=>{const{previewThumbnails:b}=i;b&&b.loaded&&b.endScrubbing(p)}),Wr.isWebKit&&Array.from(ko.call(i,'input[type="range"]')).forEach(p=>{this.bind(p,"input",b=>Ke.updateRangeFill.call(i,b.target))}),i.config.toggleInvert&&!V.element(o.display.duration)&&this.bind(o.display.currentTime,"click",()=>{i.currentTime!==0&&(i.config.invertTime=!i.config.invertTime,Ke.timeUpdate.call(i))}),this.bind(o.inputs.volume,d,p=>{i.volume=p.target.value},"volume"),this.bind(o.controls,"mouseenter mouseleave",p=>{o.controls.hover=!i.touch&&p.type==="mouseenter"}),o.fullscreen&&Array.from(o.fullscreen.children).filter(p=>!p.contains(o.container)).forEach(p=>{this.bind(p,"mouseenter mouseleave",b=>{o.controls&&(o.controls.hover=!i.touch&&b.type==="mouseenter")})}),this.bind(o.controls,"mousedown mouseup touchstart touchend touchcancel",p=>{o.controls.pressed=["mousedown","touchstart"].includes(p.type)}),this.bind(o.controls,"focusin",()=>{const{config:p,timers:b}=i;Ht(o.controls,p.classNames.noTransition,!0),Jt.toggleControls.call(i,!0),setTimeout(()=>{Ht(o.controls,p.classNames.noTransition,!1)},0);const _=this.touch?3e3:4e3;clearTimeout(b.controls),b.controls=setTimeout(()=>Jt.toggleControls.call(i,!1),_)}),this.bind(o.inputs.volume,"wheel",p=>{const b=p.webkitDirectionInvertedFromDevice,[_,x]=[p.deltaX,-p.deltaY].map(O=>b?-O:O),R=Math.sign(Math.abs(_)>Math.abs(x)?_:x);i.increaseVolume(R/50);const{volume:P}=i.media;(R===1&&P<1||R===-1&&P>0)&&p.preventDefault()},"volume",!1)}),this.player=r,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(r){const{player:i}=this,{elements:o}=i,{key:d,type:p,altKey:b,ctrlKey:_,metaKey:x,shiftKey:R}=r,P=p==="keydown",O=P&&d===this.lastKey;if(!(b||_||x||R)&&d){if(P){const W=document.activeElement;if(V.element(W)){const{editable:H}=i.config.selectors,{seek:Z}=o.inputs;if(W!==Z&&wa(W,H)||r.key===" "&&wa(W,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(d)&&(r.preventDefault(),r.stopPropagation()),d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":O||(F=parseInt(d,10),i.currentTime=i.duration/10*F);break;case" ":case"k":O||Ti(i.togglePlay());break;case"ArrowUp":i.increaseVolume(.1);break;case"ArrowDown":i.decreaseVolume(.1);break;case"m":O||(i.muted=!i.muted);break;case"ArrowRight":i.forward();break;case"ArrowLeft":i.rewind();break;case"f":i.fullscreen.toggle();break;case"c":O||i.toggleCaptions();break;case"l":i.loop=!i.loop}d==="Escape"&&!i.fullscreen.usingNative&&i.fullscreen.active&&i.fullscreen.toggle(),this.lastKey=d}else this.lastKey=null;var F}}toggleMenu(r){Ke.toggleMenu.call(this.player,r)}}function _E(t,r){return t(r={exports:{}},r.exports),r.exports}var TE=_E(function(t,r){t.exports=function(){var i=function(){},o={},d={},p={};function b(F,W){F=F.push?F:[F];var H,Z,_e,me=[],le=F.length,ce=le;for(H=function(Ee,Se){Se.length&&me.push(Ee),--ce||W(me)};le--;)Z=F[le],(_e=d[Z])?H(Z,_e):(p[Z]=p[Z]||[]).push(H)}function _(F,W){if(F){var H=p[F];if(d[F]=W,H)for(;H.length;)H[0](F,W),H.splice(0,1)}}function x(F,W){F.call&&(F={success:F}),W.length?(F.error||i)(W):(F.success||i)(F)}function R(F,W,H,Z){var _e,me,le=document,ce=H.async,Ee=(H.numRetries||0)+1,Se=H.before||i,z=F.replace(/[\?|#].*$/,""),ne=F.replace(/^(css|img)!/,"");Z=Z||0,/(^css!|\.css$)/.test(z)?((me=le.createElement("link")).rel="stylesheet",me.href=ne,(_e="hideFocus"in me)&&me.relList&&(_e=0,me.rel="preload",me.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(z)?(me=le.createElement("img")).src=ne:((me=le.createElement("script")).src=F,me.async=ce===void 0||ce),me.onload=me.onerror=me.onbeforeload=function(ke){var Ce=ke.type[0];if(_e)try{me.sheet.cssText.length||(Ce="e")}catch(Be){Be.code!=18&&(Ce="e")}if(Ce=="e"){if((Z+=1)<Ee)return R(F,W,H,Z)}else if(me.rel=="preload"&&me.as=="style")return me.rel="stylesheet";W(F,Ce,ke.defaultPrevented)},Se(F,me)!==!1&&le.head.appendChild(me)}function P(F,W,H){var Z,_e,me=(F=F.push?F:[F]).length,le=me,ce=[];for(Z=function(Ee,Se,z){if(Se=="e"&&ce.push(Ee),Se=="b"){if(!z)return;ce.push(Ee)}--me||W(ce)},_e=0;_e<le;_e++)R(F[_e],Z,H)}function O(F,W,H){var Z,_e;if(W&&W.trim&&(Z=W),_e=(Z?H:W)||{},Z){if(Z in o)throw"LoadJS";o[Z]=!0}function me(le,ce){P(F,function(Ee){x(_e,Ee),le&&x({success:le,error:ce},Ee),_(Z,Ee)},_e)}if(_e.returnPromise)return new Promise(me);me()}return O.ready=function(F,W){return b(F,function(H){x(W,H)}),O},O.done=function(F){_(F,[])},O.reset=function(){o={},d={},p={}},O.isDefined=function(F){return F in o},O}()});function pf(t){return new Promise((r,i)=>{TE(t,{success:r,error:i})})}function SE(t){return V.empty(t)?null:V.number(Number(t))?t:t.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:t}function xE(t){const r=t.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return r&&r.length===5?r[4]:null}function po(t){t&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===t&&(this.media.paused=!t,gt.call(this,this.media,t?"play":"pause"))}const Fc={setup(){const t=this;Ht(t.elements.wrapper,t.config.classNames.embed,!0),t.options.speed=t.config.speed.options,Ds.call(t),V.object(window.Vimeo)?Fc.ready.call(t):pf(t.config.urls.vimeo.sdk).then(()=>{Fc.ready.call(t)}).catch(r=>{t.debug.warn("Vimeo SDK (player.js) failed to load",r)})},ready(){const t=this,r=t.config.vimeo,{premium:i,referrerPolicy:o,...d}=r;let p=t.media.getAttribute("src"),b="";V.empty(p)?(p=t.media.getAttribute(t.config.attributes.embed.id),b=t.media.getAttribute(t.config.attributes.embed.hash)):b=xE(p);const _=b?{h:b}:{};i&&Object.assign(d,{controls:!1,sidedock:!1});const x=Pv({loop:t.config.loop.active,autoplay:t.autoplay,muted:t.muted,gesture:"media",playsinline:t.config.playsinline,..._,...d}),R=SE(p),P=vt("iframe"),O=Nc(t.config.urls.vimeo.iframe,R,x);if(P.setAttribute("src",O),P.setAttribute("allowfullscreen",""),P.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),V.empty(o)||P.setAttribute("referrerPolicy",o),i||!r.customControls)P.setAttribute("data-poster",t.poster),t.media=ql(P,t.media);else{const le=vt("div",{class:t.config.classNames.embedContainer,"data-poster":t.poster});le.appendChild(P),t.media=ql(le,t.media)}r.customControls||Ho(Nc(t.config.urls.vimeo.api,O)).then(le=>{!V.empty(le)&&le.thumbnail_url&&Jt.setPoster.call(t,le.thumbnail_url).catch(()=>{})}),t.embed=new window.Vimeo.Player(P,{autopause:t.config.autopause,muted:t.muted}),t.media.paused=!0,t.media.currentTime=0,t.supported.ui&&t.embed.disableTextTrack(),t.media.play=()=>(po.call(t,!0),t.embed.play()),t.media.pause=()=>(po.call(t,!1),t.embed.pause()),t.media.stop=()=>{t.pause(),t.currentTime=0};let{currentTime:F}=t.media;Object.defineProperty(t.media,"currentTime",{get:()=>F,set(le){const{embed:ce,media:Ee,paused:Se,volume:z}=t,ne=Se&&!ce.hasPlayed;Ee.seeking=!0,gt.call(t,Ee,"seeking"),Promise.resolve(ne&&ce.setVolume(0)).then(()=>ce.setCurrentTime(le)).then(()=>ne&&ce.pause()).then(()=>ne&&ce.setVolume(z)).catch(()=>{})}});let W=t.config.speed.selected;Object.defineProperty(t.media,"playbackRate",{get:()=>W,set(le){t.embed.setPlaybackRate(le).then(()=>{W=le,gt.call(t,t.media,"ratechange")}).catch(()=>{t.options.speed=[1]})}});let{volume:H}=t.config;Object.defineProperty(t.media,"volume",{get:()=>H,set(le){t.embed.setVolume(le).then(()=>{H=le,gt.call(t,t.media,"volumechange")})}});let{muted:Z}=t.config;Object.defineProperty(t.media,"muted",{get:()=>Z,set(le){const ce=!!V.boolean(le)&&le;t.embed.setMuted(!!ce||t.config.muted).then(()=>{Z=ce,gt.call(t,t.media,"volumechange")})}});let _e,{loop:me}=t.config;Object.defineProperty(t.media,"loop",{get:()=>me,set(le){const ce=V.boolean(le)?le:t.config.loop.active;t.embed.setLoop(ce).then(()=>{me=ce})}}),t.embed.getVideoUrl().then(le=>{_e=le,Ke.setDownloadUrl.call(t)}).catch(le=>{this.debug.warn(le)}),Object.defineProperty(t.media,"currentSrc",{get:()=>_e}),Object.defineProperty(t.media,"ended",{get:()=>t.currentTime===t.duration}),Promise.all([t.embed.getVideoWidth(),t.embed.getVideoHeight()]).then(le=>{const[ce,Ee]=le;t.embed.ratio=Lv(ce,Ee),Ds.call(this)}),t.embed.setAutopause(t.config.autopause).then(le=>{t.config.autopause=le}),t.embed.getVideoTitle().then(le=>{t.config.title=le,Jt.setTitle.call(this)}),t.embed.getCurrentTime().then(le=>{F=le,gt.call(t,t.media,"timeupdate")}),t.embed.getDuration().then(le=>{t.media.duration=le,gt.call(t,t.media,"durationchange")}),t.embed.getTextTracks().then(le=>{t.media.textTracks=le,Kt.setup.call(t)}),t.embed.on("cuechange",({cues:le=[]})=>{const ce=le.map(Ee=>pE(Ee.text));Kt.updateCues.call(t,ce)}),t.embed.on("loaded",()=>{t.embed.getPaused().then(le=>{po.call(t,!le),le||gt.call(t,t.media,"playing")}),V.element(t.embed.element)&&t.supported.ui&&t.embed.element.setAttribute("tabindex",-1)}),t.embed.on("bufferstart",()=>{gt.call(t,t.media,"waiting")}),t.embed.on("bufferend",()=>{gt.call(t,t.media,"playing")}),t.embed.on("play",()=>{po.call(t,!0),gt.call(t,t.media,"playing")}),t.embed.on("pause",()=>{po.call(t,!1)}),t.embed.on("timeupdate",le=>{t.media.seeking=!1,F=le.seconds,gt.call(t,t.media,"timeupdate")}),t.embed.on("progress",le=>{t.media.buffered=le.percent,gt.call(t,t.media,"progress"),parseInt(le.percent,10)===1&&gt.call(t,t.media,"canplaythrough"),t.embed.getDuration().then(ce=>{ce!==t.media.duration&&(t.media.duration=ce,gt.call(t,t.media,"durationchange"))})}),t.embed.on("seeked",()=>{t.media.seeking=!1,gt.call(t,t.media,"seeked")}),t.embed.on("ended",()=>{t.media.paused=!0,gt.call(t,t.media,"ended")}),t.embed.on("error",le=>{t.media.error=le,gt.call(t,t.media,"error")}),r.customControls&&setTimeout(()=>Jt.build.call(t),0)}};function AE(t){return V.empty(t)?null:t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:t}function vo(t){t&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===t&&(this.media.paused=!t,gt.call(this,this.media,t?"play":"pause"))}function CE(t){return t.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const Ol={setup(){if(Ht(this.elements.wrapper,this.config.classNames.embed,!0),V.object(window.YT)&&V.function(window.YT.Player))Ol.ready.call(this);else{const t=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{V.function(t)&&t(),Ol.ready.call(this)},pf(this.config.urls.youtube.sdk).catch(r=>{this.debug.warn("YouTube API failed to load",r)})}},getTitle(t){Ho(Nc(this.config.urls.youtube.api,t)).then(r=>{if(V.object(r)){const{title:i,height:o,width:d}=r;this.config.title=i,Jt.setTitle.call(this),this.embed.ratio=Lv(d,o)}Ds.call(this)}).catch(()=>{Ds.call(this)})},ready(){const t=this,r=t.config.youtube,i=t.media&&t.media.getAttribute("id");if(!V.empty(i)&&i.startsWith("youtube-"))return;let o=t.media.getAttribute("src");V.empty(o)&&(o=t.media.getAttribute(this.config.attributes.embed.id));const d=AE(o),p=vt("div",{id:cE(t.provider),"data-poster":r.customControls?t.poster:void 0});if(t.media=ql(p,t.media),r.customControls){const b=_=>`https://i.ytimg.com/vi/${d}/${_}default.jpg`;Ml(b("maxres"),121).catch(()=>Ml(b("sd"),121)).catch(()=>Ml(b("hq"))).then(_=>Jt.setPoster.call(t,_.src)).then(_=>{_.includes("maxres")||(t.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}t.embed=new window.YT.Player(t.media,{videoId:d,host:CE(r),playerVars:Ar({},{autoplay:t.config.autoplay?1:0,hl:t.config.hl,controls:t.supported.ui&&r.customControls?0:1,disablekb:1,playsinline:t.config.playsinline&&!t.config.fullscreen.iosNative?1:0,cc_load_policy:t.captions.active?1:0,cc_lang_pref:t.config.captions.language,widget_referrer:window?window.location.href:null},r),events:{onError(b){if(!t.media.error){const _=b.data,x={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[_]||"An unknown error occurred";t.media.error={code:_,message:x},gt.call(t,t.media,"error")}},onPlaybackRateChange(b){const _=b.target;t.media.playbackRate=_.getPlaybackRate(),gt.call(t,t.media,"ratechange")},onReady(b){if(V.function(t.media.play))return;const _=b.target;Ol.getTitle.call(t,d),t.media.play=()=>{vo.call(t,!0),_.playVideo()},t.media.pause=()=>{vo.call(t,!1),_.pauseVideo()},t.media.stop=()=>{_.stopVideo()},t.media.duration=_.getDuration(),t.media.paused=!0,t.media.currentTime=0,Object.defineProperty(t.media,"currentTime",{get:()=>Number(_.getCurrentTime()),set(O){t.paused&&!t.embed.hasPlayed&&t.embed.mute(),t.media.seeking=!0,gt.call(t,t.media,"seeking"),_.seekTo(O)}}),Object.defineProperty(t.media,"playbackRate",{get:()=>_.getPlaybackRate(),set(O){_.setPlaybackRate(O)}});let{volume:x}=t.config;Object.defineProperty(t.media,"volume",{get:()=>x,set(O){x=O,_.setVolume(100*x),gt.call(t,t.media,"volumechange")}});let{muted:R}=t.config;Object.defineProperty(t.media,"muted",{get:()=>R,set(O){const F=V.boolean(O)?O:R;R=F,_[F?"mute":"unMute"](),_.setVolume(100*x),gt.call(t,t.media,"volumechange")}}),Object.defineProperty(t.media,"currentSrc",{get:()=>_.getVideoUrl()}),Object.defineProperty(t.media,"ended",{get:()=>t.currentTime===t.duration});const P=_.getAvailablePlaybackRates();t.options.speed=P.filter(O=>t.config.speed.options.includes(O)),t.supported.ui&&r.customControls&&t.media.setAttribute("tabindex",-1),gt.call(t,t.media,"timeupdate"),gt.call(t,t.media,"durationchange"),clearInterval(t.timers.buffering),t.timers.buffering=setInterval(()=>{t.media.buffered=_.getVideoLoadedFraction(),(t.media.lastBuffered===null||t.media.lastBuffered<t.media.buffered)&&gt.call(t,t.media,"progress"),t.media.lastBuffered=t.media.buffered,t.media.buffered===1&&(clearInterval(t.timers.buffering),gt.call(t,t.media,"canplaythrough"))},200),r.customControls&&setTimeout(()=>Jt.build.call(t),50)},onStateChange(b){const _=b.target;switch(clearInterval(t.timers.playing),t.media.seeking&&[1,2].includes(b.data)&&(t.media.seeking=!1,gt.call(t,t.media,"seeked")),b.data){case-1:gt.call(t,t.media,"timeupdate"),t.media.buffered=_.getVideoLoadedFraction(),gt.call(t,t.media,"progress");break;case 0:vo.call(t,!1),t.media.loop?(_.stopVideo(),_.playVideo()):gt.call(t,t.media,"ended");break;case 1:r.customControls&&!t.config.autoplay&&t.media.paused&&!t.embed.hasPlayed?t.media.pause():(vo.call(t,!0),gt.call(t,t.media,"playing"),t.timers.playing=setInterval(()=>{gt.call(t,t.media,"timeupdate")},50),t.media.duration!==_.getDuration()&&(t.media.duration=_.getDuration(),gt.call(t,t.media,"durationchange")));break;case 2:t.muted||t.embed.unMute(),vo.call(t,!1);break;case 3:gt.call(t,t.media,"waiting")}gt.call(t,t.elements.container,"statechange",!1,{code:b.data})}}})}},Mv={setup(){this.media?(Ht(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),Ht(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&Ht(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=vt("div",{class:this.config.classNames.video}),Sv(this.media,this.elements.wrapper),this.elements.poster=vt("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?fa.setup.call(this):this.isYouTube?Ol.setup.call(this):this.isVimeo&&Fc.setup.call(this)):this.debug.warn("No media element found!")}};class LE{constructor(r){We(this,"load",()=>{this.enabled&&(V.object(window.google)&&V.object(window.google.ima)?this.ready():pf(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),We(this,"ready",()=>{var i;this.enabled||((i=this).manager&&i.manager.destroy(),i.elements.displayContainer&&i.elements.displayContainer.destroy(),i.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),We(this,"setupIMA",()=>{this.elements.container=vt("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,i=>this.onAdsManagerLoaded(i),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,i=>this.onAdError(i),!1),this.requestAds()}),We(this,"requestAds",()=>{const{container:i}=this.player.elements;try{const o=new google.ima.AdsRequest;o.adTagUrl=this.tagUrl,o.linearAdSlotWidth=i.offsetWidth,o.linearAdSlotHeight=i.offsetHeight,o.nonLinearAdSlotWidth=i.offsetWidth,o.nonLinearAdSlotHeight=i.offsetHeight,o.forceNonLinearFullSlot=!1,o.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(o)}catch(o){this.onAdError(o)}}),We(this,"pollCountdown",(i=!1)=>{if(!i)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const o=lu(Math.max(this.manager.getRemainingTime(),0)),d=`${qr.get("advertisement",this.player.config)} - ${o}`;this.elements.container.setAttribute("data-badge-text",d)},100)}),We(this,"onAdsManagerLoaded",i=>{if(!this.enabled)return;const o=new google.ima.AdsRenderingSettings;o.restoreCustomPlaybackStateOnAdBreakComplete=!0,o.enablePreloading=!0,this.manager=i.getAdsManager(this.player,o),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,d=>this.onAdError(d)),Object.keys(google.ima.AdEvent.Type).forEach(d=>{this.manager.addEventListener(google.ima.AdEvent.Type[d],p=>this.onAdEvent(p))}),this.trigger("loaded")}),We(this,"addCuePoints",()=>{V.empty(this.cuePoints)||this.cuePoints.forEach(i=>{if(i!==0&&i!==-1&&i<this.player.duration){const o=this.player.elements.progress;if(V.element(o)){const d=100/this.player.duration*i,p=vt("span",{class:this.player.config.classNames.cues});p.style.left=`${d.toString()}%`,o.appendChild(p)}}})}),We(this,"onAdEvent",i=>{const{container:o}=this.player.elements,d=i.getAd(),p=i.getAdData();switch((b=>{gt.call(this.player,this.player.media,`ads${b.replace(/_/g,"").toLowerCase()}`)})(i.type),i.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),d.isLinear()||(d.width=o.offsetWidth,d.height=o.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:p.adError&&this.player.debug.warn(`Non-fatal ad error: ${p.adError.getMessage()}`)}}),We(this,"onAdError",i=>{this.cancel(),this.player.debug.warn("Ads error",i)}),We(this,"listeners",()=>{const{container:i}=this.player.elements;let o;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{o=this.player.currentTime}),this.player.on("seeked",()=>{const d=this.player.currentTime;V.empty(this.cuePoints)||this.cuePoints.forEach((p,b)=>{o<p&&p<d&&(this.manager.discardAdBreak(),this.cuePoints.splice(b,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(i.offsetWidth,i.offsetHeight,google.ima.ViewMode.NORMAL)})}),We(this,"play",()=>{const{container:i}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(i.offsetWidth,i.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(o){this.onAdError(o)}}).catch(()=>{})}),We(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,Ti(this.player.media.play())}),We(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),We(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),We(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(i=>{this.on("loaded",i),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),We(this,"trigger",(i,...o)=>{const d=this.events[i];V.array(d)&&d.forEach(p=>{V.function(p)&&p.apply(this,o)})}),We(this,"on",(i,o)=>(V.array(this.events[i])||(this.events[i]=[]),this.events[i].push(o),this)),We(this,"startSafetyTimer",(i,o)=>{this.player.debug.log(`Safety timer invoked from: ${o}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},i)}),We(this,"clearSafetyTimer",i=>{V.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${i}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=r,this.config=r.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((i,o)=>{this.on("loaded",i),this.on("error",o)}),this.load()}get enabled(){const{config:r}=this;return this.player.isHTML5&&this.player.isVideo&&r.enabled&&(!V.empty(r.publisherId)||V.url(r.tagUrl))}get tagUrl(){const{config:r}=this;return V.url(r.tagUrl)?r.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${Pv({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:r.publisherId})}`}}function Ov(t=0,r=0,i=255){return Math.min(Math.max(t,r),i)}const RE=t=>{const r=[];return t.split(/\r\n\r\n|\n\n|\r\r/).forEach(i=>{const o={};i.split(/\r\n|\n|\r/).forEach(d=>{if(V.number(o.startTime)){if(!V.empty(d.trim())&&V.empty(o.text)){const p=d.trim().split("#xywh=");[o.text]=p,p[1]&&([o.x,o.y,o.w,o.h]=p[1].split(","))}}else{const p=d.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);p&&(o.startTime=60*Number(p[1]||0)*60+60*Number(p[2])+Number(p[3])+ +`0.${p[4]}`,o.endTime=60*Number(p[6]||0)*60+60*Number(p[7])+Number(p[8])+ +`0.${p[9]}`)}}),o.text&&r.push(o)}),r},bh=(t,r)=>{const i={};return t>r.width/r.height?(i.width=r.width,i.height=1/t*r.width):(i.height=r.height,i.width=t*r.height),i};class Bc{constructor(r){We(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})}),We(this,"getThumbnails",()=>new Promise(i=>{const{src:o}=this.player.config.previewThumbnails;if(V.empty(o))throw new Error("Missing previewThumbnails.src config attribute");const d=()=>{this.thumbnails.sort((p,b)=>p.height-b.height),this.player.debug.log("Preview thumbnails",this.thumbnails),i()};if(V.function(o))o(p=>{this.thumbnails=p,d()});else{const p=(V.string(o)?[o]:o).map(b=>this.getThumbnail(b));Promise.all(p).then(d)}})),We(this,"getThumbnail",i=>new Promise(o=>{Ho(i).then(d=>{const p={frames:RE(d),height:null,urlPrefix:""};p.frames[0].text.startsWith("/")||p.frames[0].text.startsWith("http://")||p.frames[0].text.startsWith("https://")||(p.urlPrefix=i.substring(0,i.lastIndexOf("/")+1));const b=new Image;b.onload=()=>{p.height=b.naturalHeight,p.width=b.naturalWidth,this.thumbnails.push(p),o()},b.src=p.urlPrefix+p.frames[0].text})})),We(this,"startMove",i=>{if(this.loaded&&V.event(i)&&["touchmove","mousemove"].includes(i.type)&&this.player.media.duration){if(i.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var o,d;const p=this.player.elements.progress.getBoundingClientRect(),b=100/p.width*(i.pageX-p.left);this.seekTime=this.player.media.duration*(b/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=i.pageX,this.elements.thumb.time.innerText=lu(this.seekTime);const _=(o=this.player.config.markers)===null||o===void 0||(d=o.points)===null||d===void 0?void 0:d.find(({time:x})=>x===Math.round(this.seekTime));_&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${_.label}<br>`)}this.showImageAtCurrentTime()}}),We(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),We(this,"startScrubbing",i=>{(V.nullOrUndefined(i.button)||i.button===!1||i.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),We(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):df.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),We(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),We(this,"render",()=>{this.elements.thumb.container=vt("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=vt("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const i=vt("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=vt("span",{},"00:00"),i.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(i),V.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=vt("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),We(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),We(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const i=this.thumbnails[0].frames.findIndex(p=>this.seekTime>=p.startTime&&this.seekTime<=p.endTime),o=i>=0;let d=0;this.mouseDown||this.toggleThumbContainer(o),o&&(this.thumbnails.forEach((p,b)=>{this.loadedImages.includes(p.frames[i].text)&&(d=b)}),i!==this.showingThumb&&(this.showingThumb=i,this.loadImage(d)))}),We(this,"loadImage",(i=0)=>{const o=this.showingThumb,d=this.thumbnails[i],{urlPrefix:p}=d,b=d.frames[o],_=d.frames[o].text,x=p+_;if(this.currentImageElement&&this.currentImageElement.dataset.filename===_)this.showImage(this.currentImageElement,b,i,o,_,!1),this.currentImageElement.dataset.index=o,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const R=new Image;R.src=x,R.dataset.index=o,R.dataset.filename=_,this.showingThumbFilename=_,this.player.debug.log(`Loading image: ${x}`),R.onload=()=>this.showImage(R,b,i,o,_,!0),this.loadingImage=R,this.removeOldImages(R)}}),We(this,"showImage",(i,o,d,p,b,_=!0)=>{this.player.debug.log(`Showing thumb: ${b}. num: ${p}. qual: ${d}. newimg: ${_}`),this.setImageSizeAndOffset(i,o),_&&(this.currentImageContainer.appendChild(i),this.currentImageElement=i,this.loadedImages.includes(b)||this.loadedImages.push(b)),this.preloadNearby(p,!0).then(this.preloadNearby(p,!1)).then(this.getHigherQuality(d,i,o,b))}),We(this,"removeOldImages",i=>{Array.from(this.currentImageContainer.children).forEach(o=>{if(o.tagName.toLowerCase()!=="img")return;const d=this.usingSprites?500:1e3;if(o.dataset.index!==i.dataset.index&&!o.dataset.deleting){o.dataset.deleting=!0;const{currentImageContainer:p}=this;setTimeout(()=>{p.removeChild(o),this.player.debug.log(`Removing thumb: ${o.dataset.filename}`)},d)}})}),We(this,"preloadNearby",(i,o=!0)=>new Promise(d=>{setTimeout(()=>{const p=this.thumbnails[0].frames[i].text;if(this.showingThumbFilename===p){let b;b=o?this.thumbnails[0].frames.slice(i):this.thumbnails[0].frames.slice(0,i).reverse();let _=!1;b.forEach(x=>{const R=x.text;if(R!==p&&!this.loadedImages.includes(R)){_=!0,this.player.debug.log(`Preloading thumb filename: ${R}`);const{urlPrefix:P}=this.thumbnails[0],O=P+R,F=new Image;F.src=O,F.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${R}`),this.loadedImages.includes(R)||this.loadedImages.push(R),d()}}}),_||d()}},300)})),We(this,"getHigherQuality",(i,o,d,p)=>{if(i<this.thumbnails.length-1){let b=o.naturalHeight;this.usingSprites&&(b=d.h),b<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===p&&(this.player.debug.log(`Showing higher quality thumb for: ${p}`),this.loadImage(i+1))},300)}}),We(this,"toggleThumbContainer",(i=!1,o=!1)=>{const d=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(d,i),!i&&o&&(this.showingThumb=null,this.showingThumbFilename=null)}),We(this,"toggleScrubbingContainer",(i=!1)=>{const o=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(o,i),i||(this.showingThumb=null,this.showingThumbFilename=null)}),We(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),We(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:i}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(i.clientHeight>20&&i.clientWidth<20){const o=Math.floor(i.clientHeight*this.thumbAspectRatio);i.style.width=`${o}px`}else if(i.clientHeight<20&&i.clientWidth>20){const o=Math.floor(i.clientWidth/this.thumbAspectRatio);i.style.height=`${o}px`}}else{const o=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);i.style.height=`${this.thumbContainerHeight}px`,i.style.width=`${o}px`}this.setThumbContainerPos()}),We(this,"setThumbContainerPos",()=>{const i=this.player.elements.progress.getBoundingClientRect(),o=this.player.elements.container.getBoundingClientRect(),{container:d}=this.elements.thumb,p=o.left-i.left+10,b=o.right-i.left-d.clientWidth-10,_=this.mousePosX-i.left-d.clientWidth/2,x=Ov(_,p,b);d.style.left=`${x}px`,d.style.setProperty("--preview-arrow-offset",_-x+"px")}),We(this,"setScrubbingContainerSize",()=>{const{width:i,height:o}=bh(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${i}px`,this.elements.scrubbing.container.style.height=`${o}px`}),We(this,"setImageSizeAndOffset",(i,o)=>{if(!this.usingSprites)return;const d=this.thumbContainerHeight/o.h;i.style.height=i.naturalHeight*d+"px",i.style.width=i.naturalWidth*d+"px",i.style.left=`-${o.x*d}px`,i.style.top=`-${o.y*d}px`}),this.player=r,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:r}=bh(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return r}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(r){this.mouseDown?this.currentScrubbingImageElement=r:this.currentThumbnailImageElement=r}}const Uc={insertElements(t,r){V.string(r)?vh(t,this.media,{src:r}):V.array(r)&&r.forEach(i=>{vh(t,this.media,i)})},change(t){Tv(t,"sources.length")?(fa.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],Ui(this.media),this.media=null,V.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:r,type:i}=t,[{provider:o=la.html5,src:d}]=r,p=o==="html5"?i:"div",b=o==="html5"?{}:{src:d};Object.assign(this,{provider:o,type:i,supported:Cr.check(i,o,this.config.playsinline),media:vt(p,b)}),this.elements.container.appendChild(this.media),V.boolean(t.autoplay)&&(this.config.autoplay=t.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),V.empty(t.poster)||(this.poster=t.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),Jt.addStyleHook.call(this),this.isHTML5&&Uc.insertElements.call(this,"source",r),this.config.title=t.title,Mv.setup.call(this),this.isHTML5&&Object.keys(t).includes("tracks")&&Uc.insertElements.call(this,"track",t.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Jt.build.call(this),this.isHTML5&&this.media.load(),V.empty(t.previewThumbnails)||(Object.assign(this.config.previewThumbnails,t.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Bc(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};class Po{constructor(r,i){if(We(this,"play",()=>V.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>Ti(this.media.play())),this.media.play()):null),We(this,"pause",()=>this.playing&&V.function(this.media.pause)?this.media.pause():null),We(this,"togglePlay",_=>(V.boolean(_)?_:!this.playing)?this.play():this.pause()),We(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):V.function(this.media.stop)&&this.media.stop()}),We(this,"restart",()=>{this.currentTime=0}),We(this,"rewind",_=>{this.currentTime-=V.number(_)?_:this.config.seekTime}),We(this,"forward",_=>{this.currentTime+=V.number(_)?_:this.config.seekTime}),We(this,"increaseVolume",_=>{const x=this.media.muted?0:this.volume;this.volume=x+(V.number(_)?_:0)}),We(this,"decreaseVolume",_=>{this.increaseVolume(-_)}),We(this,"airplay",()=>{Cr.airplay&&this.media.webkitShowPlaybackTargetPicker()}),We(this,"toggleControls",_=>{if(this.supported.ui&&!this.isAudio){const x=Wl(this.elements.container,this.config.classNames.hideControls),R=_===void 0?void 0:!_,P=Ht(this.elements.container,this.config.classNames.hideControls,R);if(P&&V.array(this.config.controls)&&this.config.controls.includes("settings")&&!V.empty(this.config.settings)&&Ke.toggleMenu.call(this,!1),P!==x){const O=P?"controlshidden":"controlsshown";gt.call(this,this.media,O)}return!P}return!1}),We(this,"on",(_,x)=>{Vt.call(this,this.elements.container,_,x)}),We(this,"once",(_,x)=>{df.call(this,this.elements.container,_,x)}),We(this,"off",(_,x)=>{ou(this.elements.container,_,x)}),We(this,"destroy",(_,x=!1)=>{if(!this.ready)return;const R=()=>{document.body.style.overflow="",this.embed=null,x?(Object.keys(this.elements).length&&(Ui(this.elements.buttons.play),Ui(this.elements.captions),Ui(this.elements.controls),Ui(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),V.function(_)&&_()):(oE.call(this),fa.cancelRequests.call(this),ql(this.elements.original,this.elements.container),gt.call(this,this.elements.original,"destroyed",!0),V.function(_)&&_.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(Jt.toggleNativeControls.call(this,!0),R()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&V.function(this.embed.destroy)&&this.embed.destroy(),R()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(R),setTimeout(R,200))}),We(this,"supports",_=>Cr.mime.call(this,_)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=Cr.touch,this.media=r,V.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||V.nodeList(this.media)||V.array(this.media))&&(this.media=this.media[0]),this.config=Ar({},Dv,Po.defaults,i||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new bE(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",Cr),V.nullOrUndefined(this.media)||!V.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!Cr.check().api)return void this.debug.error("Setup failed: no support");const o=this.media.cloneNode(!0);o.autoplay=!1,this.elements.original=o;const d=this.media.tagName.toLowerCase();let p=null,b=null;switch(d){case"div":if(p=this.media.querySelector("iframe"),V.element(p)){if(b=Iv(p.getAttribute("src")),this.provider=yE(b.toString()),this.elements.container=this.media,this.media=p,this.elements.container.className="",b.search.length){const _=["1","true"];_.includes(b.searchParams.get("autoplay"))&&(this.config.autoplay=!0),_.includes(b.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=_.includes(b.searchParams.get("playsinline")),this.config.youtube.hl=b.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(V.empty(this.provider)||!Object.values(la).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=pc.video;break;case"video":case"audio":this.type=d,this.provider=la.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=Cr.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new EE(this),this.storage=new Io(this),this.media.plyr=this,V.element(this.elements.container)||(this.elements.container=vt("div"),Sv(this.media,this.elements.container)),Jt.migrateStyles.call(this),Jt.addStyleHook.call(this),Mv.setup.call(this),this.config.debug&&Vt.call(this,this.elements.container,this.config.events.join(" "),_=>{this.debug.log(`event: ${_.type}`)}),this.fullscreen=new ri(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Jt.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new LE(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>Ti(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Bc(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===la.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===la.youtube}get isVimeo(){return this.provider===la.vimeo}get isVideo(){return this.type===pc.video}get isAudio(){return this.type===pc.audio}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(r){if(!this.duration)return;const i=V.number(r)&&r>0;this.media.currentTime=i?Math.min(r,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:r}=this.media;return V.number(r)?r:r&&r.length&&this.duration>0?r.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const r=parseFloat(this.config.duration),i=(this.media||{}).duration,o=V.number(i)&&i!==1/0?i:0;return r||o}set volume(r){let i=r;V.string(i)&&(i=Number(i)),V.number(i)||(i=this.storage.get("volume")),V.number(i)||({volume:i}=this.config),i>1&&(i=1),i<0&&(i=0),this.config.volume=i,this.media.volume=i,!V.empty(r)&&this.muted&&i>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(r){let i=r;V.boolean(i)||(i=this.storage.get("muted")),V.boolean(i)||(i=this.config.muted),this.config.muted=i,this.media.muted=i}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||!!this.isAudio||!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(r){let i=null;V.number(r)&&(i=r),V.number(i)||(i=this.storage.get("speed")),V.number(i)||(i=this.config.speed.selected);const{minimumSpeed:o,maximumSpeed:d}=this;i=Ov(i,o,d),this.config.speed.selected=i,setTimeout(()=>{this.media&&(this.media.playbackRate=i)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(r){const i=this.config.quality,o=this.options.quality;if(!o.length)return;let d=[!V.empty(r)&&Number(r),this.storage.get("quality"),i.selected,i.default].find(V.number),p=!0;if(!o.includes(d)){const b=xv(o,d);this.debug.warn(`Unsupported quality option: ${d}, using ${b} instead`),d=b,p=!1}i.selected=d,this.media.quality=d,p&&this.storage.set({quality:d})}get quality(){return this.media.quality}set loop(r){const i=V.boolean(r)?r:this.config.loop.active;this.config.loop.active=i,this.media.loop=i}get loop(){return!!this.media.loop}set source(r){Uc.change.call(this,r)}get source(){return this.media.currentSrc}get download(){const{download:r}=this.config.urls;return V.url(r)?r:this.source}set download(r){V.url(r)&&(this.config.urls.download=r,Ke.setDownloadUrl.call(this))}set poster(r){this.isVideo?Jt.setPoster.call(this,r,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const r=Yl(hf.call(this));return V.array(r)?r.join(":"):r}set ratio(r){this.isVideo?V.string(r)&&Cv(r)?(this.config.ratio=Yl(r),Ds.call(this)):this.debug.error(`Invalid aspect ratio specified (${r})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(r){this.config.autoplay=V.boolean(r)?r:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(r){Kt.toggle.call(this,r,!1)}set currentTrack(r){Kt.set.call(this,r,!1),Kt.setup.call(this)}get currentTrack(){const{toggled:r,currentTrack:i}=this.captions;return r?i:-1}set language(r){Kt.setLanguage.call(this,r,!1)}get language(){return(Kt.getCurrentTrack.call(this)||{}).language}set pip(r){if(!Cr.pip)return;const i=V.boolean(r)?r:!this.pip;V.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(i?hc.active:hc.inactive),V.function(this.media.requestPictureInPicture)&&(!this.pip&&i?this.media.requestPictureInPicture():this.pip&&!i&&document.exitPictureInPicture())}get pip(){return Cr.pip?V.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===hc.active:null}setPreviewThumbnails(r){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,r),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Bc(this))}static supported(r,i){return Cr.check(r,i)}static loadSprite(r,i){return kv(r,i)}static setup(r,i={}){let o=null;return V.string(r)?o=Array.from(document.querySelectorAll(r)):V.nodeList(r)?o=Array.from(r):V.array(r)&&(o=r.filter(V.element)),V.empty(o)?null:o.map(d=>new Po(d,i))}}Po.defaults=nE(Dv);function kE(t,r){Q(r).fullscreen.toggle()}var wE=(t,r)=>r(),IE=(t,r)=>Q(r).play(),PE=(t,r)=>Q(r).stop(),DE=(t,r)=>r(),ME=Yr('<div class="tooltip fixed bottom-20 left-5 z-50 tooltip-ghost tooltip-right"><div class="tooltip-content"><div class=" text-2xl font-black"><img alt="qr"/></div></div> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan-qr-code-icon lucide-scan-qr-code"><path d="M17 12v4a1 1 0 0 1-1 1h-4"></path><path d="M17 3h2a2 2 0 0 1 2 2v2"></path><path d="M17 8V7"></path><path d="M21 17v2a2 2 0 0 1-2 2h-2"></path><path d="M3 7V5a2 2 0 0 1 2-2h2"></path><path d="M7 17h.01"></path><path d="M7 21H5a2 2 0 0 1-2-2v-2"></path><rect x="7" y="7" width="5" height="5" rx="1"></rect></svg></div> <div class="fixed bottom-20 right-5 z-[2147483647]"><button class="btn btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-expand-icon lucide-expand"><path d="m15 15 6 6"></path><path d="m15 9 6-6"></path><path d="M21 16v5h-5"></path><path d="M21 8V3h-5"></path><path d="M3 16v5h5"></path><path d="m3 21 6-6"></path><path d="M3 8V3h5"></path><path d="M9 9 3 3"></path></svg></button></div>',1),OE=Yr('<div class="navbar fixed top-1 z-10"><div class="flex-1"><div class="text-xl ml-10"> </div></div> <div class="flex-none"></div></div> <div class="video-container"><video controls crossorigin="" playsinline=""></video></div> <div class="fixed bottom-0 left-0 z-50 w-full h-[200px] opacity-0 transition-opacity duration-[2000ms] hover:opacity-100 hover:duration-[150ms]"><div class="controllers flex flex-row w-400px justify-center gap-10"><button class="hover:text-primary transition-opacity duration-[500ms]"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-big-left-dash-icon lucide-arrow-big-left-dash"><path d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h2a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z"></path><path d="M20 9v6"></path></svg></button> <button class="hover:text-primary transition-opacity duration-[500ms]"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-icon lucide-play"><path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"></path></svg></button> <button class="hover:text-primary transition-opacity duration-[500ms]"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop-icon lucide-circle-stop"><circle cx="12" cy="12" r="10"></circle><rect x="9" y="9" width="6" height="6" rx="1"></rect></svg></button> <button class="hover:text-primary transition-opacity duration-[500ms]"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-big-right-dash-icon lucide-arrow-big-right-dash"><path d="M11 9a1 1 0 0 0 1-1V5.061a1 1 0 0 1 1.811-.75l6.836 6.836a1.207 1.207 0 0 1 0 1.707l-6.836 6.835a1 1 0 0 1-1.811-.75V16a1 1 0 0 0-1-1H9a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1z"></path><path d="M4 9v6"></path></svg></button></div> <!></div>',3);function Eh(t,r){Ba(r,!0);let i=Pt(void 0),o=Pt(void 0),d=Pt(0);jo(async()=>{await lh("Dubai One","https://dminnvllta.cdn.mgmlcdn.com/dubaione/smil:dubaione.stream.smil/chunklist.m3u8"),Bi.channels=await Ro(),await p();const Se=new au(localStorage.getItem("server_id")||"",{config:{iceServers:[]}});Se.on("open",async function(z){localStorage.setItem("server_id",z),console.log(window.location.href+"#/"+z),qe(i,await mb.toDataURL(window.location.href+"#/"+z,{errorCorrectionLevel:"L"}),!0)}),Se.on("connection",z=>{z.on("data",async ne=>{if(ne.type==="id"&&z.send({type:"channels",channels:Bi.channels}),ne.type==="delete"){let ke=await _b(ne.id);ke&&z.send({type:"response",response:ke})}if(ne.type==="add"){let ke=await lh(ne.data.name,ne.data.url);ke&&z.send({type:"response",response:ke})}})})});const p=async()=>{const Se=document.querySelector("video");let z=Bi.channels[Q(d)]?.url||"";if(qe(o,new Po(Se,{controls:["play-large"],captions:{active:!0,update:!0,language:"en"}}),!0),!ch.isSupported())Se.src=z;else{const ne=new ch;ne.loadSource(z),ne.attachMedia(Se),window.hls=ne}},b=async()=>{Q(d)>0?id(d,-1):Q(d)===0&&qe(d,Bi.channels.length-1),Q(o)&&Q(o).destroy(),await p(),Q(o).play()},_=async()=>{Q(d)<Bi.channels.length-1?id(d):Q(d)===Bi.channels.length-1&&qe(d,0),Q(o)&&Q(o).destroy(),await p(),Q(o).play()};var x=OE(),R=yt(x),P=Qt(R),O=Qt(P),F=Qt(O),W=Or(R,4),H=Qt(W),Z=Qt(H);Z.__click=[wE,b];var _e=Or(Z,2);_e.__click=[IE,o];var me=Or(_e,2);me.__click=[PE,o];var le=Or(me,2);le.__click=[DE,_];var ce=Or(H,2);{var Ee=Se=>{var z=ME(),ne=yt(z),ke=Qt(ne),Ce=Qt(ke),Be=Qt(Ce),ze=Or(ne,2),Ye=Qt(ze);Ye.__click=[kE,o],cn(()=>Xt(Be,"src",Q(i))),et(Se,z)};Ot(ce,Se=>{Q(i)&&Se(Ee)})}cn(()=>ka(F,Bi.channels[Q(d)]?.name)),et(t,x),Ua()}ru(["click"]);const NE=Array(12).fill(0);var FE=Yr('<div class="sonner-loading-bar"></div>'),BE=Yr('<div><div class="sonner-spinner"></div></div>');function UE(t,r){Ba(r,!0);var i=BE(),o=Qt(i);jl(o,23,()=>NE,(d,p)=>`spinner-bar-${p}`,(d,p)=>{var b=FE();et(d,b)}),cn(d=>{Ei(i,1,d),Xt(i,"data-visible",r.visible)},[()=>bi(["sonner-loading-wrapper",r.class].filter(Boolean).join(" "))]),et(t,i),Ua()}function Ni(...t){return t.filter(Boolean).join(" ")}const GE=typeof document<"u",jE=typeof window<"u"?window:void 0;function VE(t){let r=t.activeElement;for(;r?.shadowRoot;){const i=r.shadowRoot.activeElement;if(i===r)break;r=i}return r}class KE{#e;#t;constructor(r={}){const{window:i=jE,document:o=i?.document}=r;i!==void 0&&(this.#e=o,this.#t=v0(d=>{const p=Gl(i,"focusin",d),b=Gl(i,"focusout",d);return()=>{p(),b()}}))}get current(){return this.#t?.(),this.#e?VE(this.#e):null}}new KE;class HE{#e;#t;constructor(r){this.#e=r,this.#t=Symbol(r)}get key(){return this.#t}exists(){return u0(this.#t)}get(){const r=td(this.#t);if(r===void 0)throw new Error(`Context "${this.#e}" not found`);return r}getOr(r){const i=td(this.#t);return i===void 0?r:i}set(r){return l0(this.#t,r)}}const qE=new HE("<Toaster/>");let _h=0;class WE{#e=Pt(jn([]));get toasts(){return Q(this.#e)}set toasts(r){qe(this.#e,r,!0)}#t=Pt(jn([]));get heights(){return Q(this.#t)}set heights(r){qe(this.#t,r,!0)}#r=r=>{const i=this.toasts.findIndex(o=>o.id===r);return i===-1?null:i};addToast=r=>{GE&&this.toasts.unshift(r)};updateToast=({id:r,data:i,type:o,message:d})=>{const p=this.toasts.findIndex(_=>_.id===r),b=this.toasts[p];this.toasts[p]={...b,...i,id:r,title:d,type:o,updated:!0}};create=r=>{const{message:i,...o}=r,d=typeof r?.id=="number"||r.id&&r.id?.length>0?r.id:_h++,p=r.dismissable===void 0?!0:r.dismissable,b=r.type===void 0?"default":r.type;return dn(()=>{this.toasts.find(x=>x.id===d)?this.updateToast({id:d,data:r,type:b,message:i,dismissable:p}):this.addToast({...o,id:d,title:i,dismissable:p,type:b})}),d};dismiss=r=>(dn(()=>{if(r===void 0){this.toasts=this.toasts.map(o=>({...o,dismiss:!0}));return}const i=this.toasts.findIndex(o=>o.id===r);this.toasts[i]&&(this.toasts[i]={...this.toasts[i],dismiss:!0})}),r);remove=r=>{if(r===void 0){this.toasts=[];return}const i=this.#r(r);if(i!==null)return this.toasts.splice(i,1),r};message=(r,i)=>this.create({...i,type:"default",message:r});error=(r,i)=>this.create({...i,type:"error",message:r});success=(r,i)=>this.create({...i,type:"success",message:r});info=(r,i)=>this.create({...i,type:"info",message:r});warning=(r,i)=>this.create({...i,type:"warning",message:r});loading=(r,i)=>this.create({...i,type:"loading",message:r});promise=(r,i)=>{if(!i)return;let o;i.loading!==void 0&&(o=this.create({...i,promise:r,type:"loading",message:typeof i.loading=="string"?i.loading:i.loading()}));const d=r instanceof Promise?r:r();let p=o!==void 0;return d.then(b=>{if(typeof b=="object"&&b&&"ok"in b&&typeof b.ok=="boolean"&&!b.ok){p=!1;const _=YE(b);this.create({id:o,type:"error",message:_})}else if(i.success!==void 0){p=!1;const _=typeof i.success=="function"?i.success(b):i.success;this.create({id:o,type:"success",message:_})}}).catch(b=>{if(i.error!==void 0){p=!1;const _=typeof i.error=="function"?i.error(b):i.error;this.create({id:o,type:"error",message:_})}}).finally(()=>{p&&(this.dismiss(o),o=void 0),i.finally?.()}),o};custom=(r,i)=>{const o=i?.id||_h++;return this.create({component:r,id:o,...i}),o};removeHeight=r=>{this.heights=this.heights.filter(i=>i.toastId!==r)};setHeight=r=>{const i=this.#r(r.toastId);if(i===null){this.heights.push(r);return}this.heights[i]=r};reset=()=>{this.toasts=[],this.heights=[]}}function YE(t){return t&&typeof t=="object"&&"status"in t?`HTTP error! Status: ${t.status}`:`Error! ${t}`}const Yt=new WE;function zE(t,r){return Yt.create({message:t,...r})}class $E{#e=Rt(()=>Yt.toasts.filter(r=>!r.dismiss));get toasts(){return Q(this.#e)}}const XE=zE,gc=Object.assign(XE,{success:Yt.success,info:Yt.info,warning:Yt.warning,error:Yt.error,custom:Yt.custom,message:Yt.message,promise:Yt.promise,dismiss:Yt.dismiss,loading:Yt.loading,getActiveToasts:()=>Yt.toasts.filter(t=>!t.dismiss)});function zl(t){return t.label!==void 0}function QE(){let t=Pt(jn(typeof document<"u"?document.hidden:!1));return Vn(()=>Gl(document,"visibilitychange",()=>{qe(t,document.hidden,!0)})),{get current(){return Q(t)}}}const Th=4e3,JE=14,ZE=45,e_=200,t_=.05,r_={toast:"",title:"",description:"",loader:"",closeButton:"",cancelButton:"",actionButton:"",action:"",warning:"",error:"",success:"",default:"",info:"",loading:""};function n_(t){const[r,i]=t.split("-"),o=[];return r&&o.push(r),i&&o.push(i),o}function Sh(t){return 1/(1.5+Math.abs(t)/20)}var i_=Yr("<div><!></div>"),a_=(t,r,i,o,d)=>{Q(r)||!Q(i)||(o(),d.toast.onDismiss?.(d.toast))},s_=Yr('<button data-close-button=""><!></button>'),o_=Yr('<div data-icon=""><!> <!></div>'),l_=Yr('<div data-description=""><!></div>'),u_=(t,r,i,o)=>{zl(r.toast.cancel)&&Q(i)&&(r.toast.cancel?.onClick?.(t),o())},c_=Yr('<button data-button="" data-cancel=""> </button>'),f_=(t,r,i)=>{zl(r.toast.action)&&(r.toast.action?.onClick(t),!t.defaultPrevented&&i())},d_=Yr('<button data-button=""> </button>'),h_=Yr('<!> <div data-content=""><div data-title=""><!></div> <!></div> <!> <!>',1),p_=Yr('<li data-sonner-toast=""><!> <!></li>');function v_(t,r){Ba(r,!0);const i=pt=>{var Tt=St(),kt=yt(Tt);{var ot=ht=>{var ur=i_(),pn=Qt(ur);ni(pn,()=>r.loadingIcon),cn(Nn=>{Ei(ur,1,Nn),Xt(ur,"data-visible",Q(z)==="loading")},[()=>bi(Ni(Q(N)?.loader,r.toast?.classes?.loader,"sonner-loader"))]),et(ht,ur)},Gt=ht=>{{let ur=Rt(()=>Ni(Q(N)?.loader,r.toast.classes?.loader)),pn=Rt(()=>Q(z)==="loading");UE(ht,{get class(){return Q(ur)},get visible(){return Q(pn)}})}};Ot(kt,ht=>{r.loadingIcon?ht(ot):ht(Gt,!1)})}et(pt,Tt)};let o=fr(r,"cancelButtonStyle",3,""),d=fr(r,"actionButtonStyle",3,""),p=fr(r,"descriptionClass",3,""),b=fr(r,"unstyled",3,!1),_=fr(r,"defaultRichColors",3,!1);const x={...r_};let R=Pt(!1),P=Pt(!1),O=Pt(!1),F=Pt(!1),W=Pt(!1),H=Pt(0),Z=Pt(0),_e=r.toast.duration||r.duration||Th,me=Pt(void 0),le=Pt(null),ce=Pt(null);const Ee=Rt(()=>r.index===0),Se=Rt(()=>r.index+1<=r.visibleToasts),z=Rt(()=>r.toast.type),ne=Rt(()=>r.toast.dismissable!==!1),ke=Rt(()=>r.toast.class||""),Ce=Rt(()=>r.toast.descriptionClass||""),Be=Rt(()=>Yt.heights.findIndex(pt=>pt.toastId===r.toast.id)||0),ze=Rt(()=>r.toast.closeButton??r.closeButton),Ye=Rt(()=>r.toast.duration??r.duration??Th);let He=null;const xe=Rt(()=>r.position.split("-")),er=Rt(()=>Yt.heights.reduce((pt,Tt,kt)=>kt>=Q(Be)?pt:pt+Tt.height,0)),Tr=QE(),ft=Rt(()=>r.toast.invert||r.invert),be=Rt(()=>Q(z)==="loading"),N=Rt(()=>({...x,...r.classes})),ut=Rt(()=>r.toast.title),st=Rt(()=>r.toast.description);let zr=Pt(0),$r=Pt(0);const rt=Rt(()=>Math.round(Q(Be)*JE+Q(er)));Vn(()=>{Q(ut),Q(st);let pt;r.expanded||r.expandByDefault?pt=1:pt=1-r.index*t_;const Tt=dn(()=>Q(me));if(Tt===void 0)return;Tt.style.setProperty("height","auto");const kt=Tt.offsetHeight,ot=Tt.getBoundingClientRect().height,Gt=Math.round(ot/pt+Number.EPSILON&100)/100;Tt.style.removeProperty("height");let ht;Math.abs(Gt-kt)<1?ht=Gt:ht=kt,qe(Z,ht,!0),dn(()=>{Yt.setHeight({toastId:r.toast.id,height:ht})})});function _t(){qe(P,!0),qe(H,Q(rt),!0),Yt.removeHeight(r.toast.id),setTimeout(()=>{Yt.remove(r.toast.id)},e_)}let lr;const Zt=Rt(()=>r.toast.promise&&Q(z)==="loading"||r.toast.duration===Number.POSITIVE_INFINITY);function br(){qe(zr,new Date().getTime(),!0),lr=setTimeout(()=>{r.toast.onAutoClose?.(r.toast),_t()},_e)}function Je(){if(Q($r)<Q(zr)){const pt=new Date().getTime()-Q(zr);_e=_e-pt}qe($r,new Date().getTime(),!0)}Vn(()=>{r.toast.updated&&(clearTimeout(lr),_e=Q(Ye),br())}),Vn(()=>(Q(Zt)||(r.expanded||r.interacting||Tr.current?Je():br()),()=>clearTimeout(lr))),jo(()=>{qe(R,!0);const pt=Q(me)?.getBoundingClientRect().height;return qe(Z,pt,!0),Yt.setHeight({toastId:r.toast.id,height:pt}),()=>{Yt.removeHeight(r.toast.id)}}),Vn(()=>{r.toast.delete&&dn(()=>{_t(),r.toast.onDismiss?.(r.toast)})});const An=pt=>{if(Q(be))return;qe(H,Q(rt),!0);const Tt=pt.target;Tt.setPointerCapture(pt.pointerId),Tt.tagName!=="BUTTON"&&(qe(O,!0),He={x:pt.clientX,y:pt.clientY})},On=()=>{if(Q(F)||!Q(ne))return;He=null;const pt=Number(Q(me)?.style.getPropertyValue("--swipe-amount-x").replace("px","")||0),Tt=Number(Q(me)?.style.getPropertyValue("--swipe-amount-y").replace("px","")||0),kt=new Date().getTime()-0,ot=Q(le)==="x"?pt:Tt,Gt=Math.abs(ot)/kt;if(Math.abs(ot)>=ZE||Gt>.11){qe(H,Q(rt),!0),r.toast.onDismiss?.(r.toast),Q(le)==="x"?qe(ce,pt>0?"right":"left",!0):qe(ce,Tt>0?"down":"up",!0),_t(),qe(F,!0);return}else Q(me)?.style.setProperty("--swipe-amount-x","0px"),Q(me)?.style.setProperty("--swipe-amount-y","0px");qe(W,!1),qe(O,!1),qe(le,null)},tt=pt=>{if(!He||!Q(ne)||(window.getSelection()?.toString().length??-1)>0)return;const kt=pt.clientY-He.y,ot=pt.clientX-He.x,Gt=r.swipeDirections??n_(r.position);!Q(le)&&(Math.abs(ot)>1||Math.abs(kt)>1)&&qe(le,Math.abs(ot)>Math.abs(kt)?"x":"y",!0);let ht={x:0,y:0};if(Q(le)==="y"){if(Gt.includes("top")||Gt.includes("bottom"))if(Gt.includes("top")&&kt<0||Gt.includes("bottom")&&kt>0)ht.y=kt;else{const ur=kt*Sh(kt);ht.y=Math.abs(ur)<Math.abs(kt)?ur:kt}}else if(Q(le)==="x"&&(Gt.includes("left")||Gt.includes("right")))if(Gt.includes("left")&&ot<0||Gt.includes("right")&&ot>0)ht.x=ot;else{const ur=ot*Sh(ot);ht.x=Math.abs(ur)<Math.abs(ot)?ur:ot}(Math.abs(ht.x)>0||Math.abs(ht.y)>0)&&qe(W,!0),Q(me)?.style.setProperty("--swipe-amount-x",`${ht.x}px`),Q(me)?.style.setProperty("--swipe-amount-y",`${ht.y}px`)},Nr=()=>{qe(O,!1),qe(le,null),He=null},kr=Rt(()=>r.toast.icon?r.toast.icon:Q(z)==="success"?r.successIcon:Q(z)==="error"?r.errorIcon:Q(z)==="warning"?r.warningIcon:Q(z)==="info"?r.infoIcon:Q(z)==="loading"?r.loadingIcon:null);var Et=p_();Xt(Et,"tabindex",0);let qn;Et.__pointermove=tt,Et.__pointerup=On,Et.__pointerdown=An;var va=Qt(Et);{var En=pt=>{var Tt=s_();Tt.__click=[a_,be,ne,_t,r];var kt=Qt(Tt);ni(kt,()=>r.closeIcon??rn),cn(ot=>{Xt(Tt,"aria-label",r.closeButtonAriaLabel),Xt(Tt,"data-disabled",Q(be)),Ei(Tt,1,ot)},[()=>bi(Ni(Q(N)?.closeButton,r.toast?.classes?.closeButton))]),et(pt,Tt)};Ot(va,pt=>{Q(ze)&&!r.toast.component&&Q(z)!=="loading"&&r.closeIcon!==null&&pt(En)})}var ga=Or(va,2);{var Ci=pt=>{const Tt=Rt(()=>r.toast.component);var kt=St(),ot=yt(kt);Fi(ot,()=>Q(Tt),(Gt,ht)=>{ht(Gt,bo(()=>r.toast.componentProps,{closeToast:_t}))}),et(pt,kt)},tr=pt=>{var Tt=h_(),kt=yt(Tt);{var ot=Ne=>{var Le=o_(),dt=Qt(Le);{var wt=Dt=>{var rr=St(),Lr=yt(rr);{var zt=vr=>{var cr=St(),gr=yt(cr);Fi(gr,()=>r.toast.icon,(Wn,Fn)=>{Fn(Wn,{})}),et(vr,cr)},pr=vr=>{i(vr)};Ot(Lr,vr=>{r.toast.icon?vr(zt):vr(pr,!1)})}et(Dt,rr)};Ot(dt,Dt=>{(r.toast.promise||Q(z)==="loading")&&Dt(wt)})}var Pe=Or(dt,2);{var De=Dt=>{var rr=St(),Lr=yt(rr);{var zt=vr=>{var cr=St(),gr=yt(cr);Fi(gr,()=>r.toast.icon,(Wn,Fn)=>{Fn(Wn,{})}),et(vr,cr)},pr=vr=>{var cr=St(),gr=yt(cr);{var Wn=jt=>{var nr=St(),Xr=yt(nr);ni(Xr,()=>r.successIcon??rn),et(jt,nr)},Fn=jt=>{var nr=St(),Xr=yt(nr);{var Li=Cn=>{var li=St(),vn=yt(li);ni(vn,()=>r.errorIcon??rn),et(Cn,li)},oi=Cn=>{var li=St(),vn=yt(li);{var ui=Br=>{var Yn=St(),an=yt(Yn);ni(an,()=>r.warningIcon??rn),et(Br,Yn)},Ln=Br=>{var Yn=St(),an=yt(Yn);{var qi=Qr=>{var Wi=St(),ci=yt(Wi);ni(ci,()=>r.infoIcon??rn),et(Qr,Wi)};Ot(an,Qr=>{Q(z)==="info"&&Qr(qi)},!0)}et(Br,Yn)};Ot(vn,Br=>{Q(z)==="warning"?Br(ui):Br(Ln,!1)},!0)}et(Cn,li)};Ot(Xr,Cn=>{Q(z)==="error"?Cn(Li):Cn(oi,!1)},!0)}et(jt,nr)};Ot(gr,jt=>{Q(z)==="success"?jt(Wn):jt(Fn,!1)},!0)}et(vr,cr)};Ot(Lr,vr=>{r.toast.icon?vr(zt):vr(pr,!1)})}et(Dt,rr)};Ot(Pe,Dt=>{r.toast.type!=="loading"&&Dt(De)})}cn(Dt=>Ei(Le,1,Dt),[()=>bi(Ni(Q(N)?.icon,r.toast?.classes?.icon))]),et(Ne,Le)};Ot(kt,Ne=>{(Q(z)||r.toast.icon||r.toast.promise)&&r.toast.icon!==null&&(Q(kr)!==null||r.toast.icon)&&Ne(ot)})}var Gt=Or(kt,2),ht=Qt(Gt),ur=Qt(ht);{var pn=Ne=>{var Le=St(),dt=yt(Le);{var wt=De=>{const Dt=Rt(()=>r.toast.title);var rr=St(),Lr=yt(rr);Fi(Lr,()=>Q(Dt),(zt,pr)=>{pr(zt,bo(()=>r.toast.componentProps))}),et(De,rr)},Pe=De=>{var Dt=dd();cn(()=>ka(Dt,r.toast.title)),et(De,Dt)};Ot(dt,De=>{typeof r.toast.title!="string"?De(wt):De(Pe,!1)})}et(Ne,Le)};Ot(ur,Ne=>{r.toast.title&&Ne(pn)})}var Nn=Or(ht,2);{var si=Ne=>{var Le=l_(),dt=Qt(Le);{var wt=De=>{const Dt=Rt(()=>r.toast.description);var rr=St(),Lr=yt(rr);Fi(Lr,()=>Q(Dt),(zt,pr)=>{pr(zt,bo(()=>r.toast.componentProps))}),et(De,rr)},Pe=De=>{var Dt=dd();cn(()=>ka(Dt,r.toast.description)),et(De,Dt)};Ot(dt,De=>{typeof r.toast.description!="string"?De(wt):De(Pe,!1)})}cn(De=>Ei(Le,1,De),[()=>bi(Ni(p(),Q(Ce),Q(N)?.description,r.toast.classes?.description))]),et(Ne,Le)};Ot(Nn,Ne=>{r.toast.description&&Ne(si)})}var dr=Or(Gt,2);{var hr=Ne=>{var Le=St(),dt=yt(Le);{var wt=De=>{var Dt=St(),rr=yt(Dt);Fi(rr,()=>r.toast.cancel,(Lr,zt)=>{zt(Lr,{})}),et(De,Dt)},Pe=De=>{var Dt=St(),rr=yt(Dt);{var Lr=zt=>{var pr=c_();pr.__click=[u_,r,ne,_t];var vr=Qt(pr);cn(cr=>{Al(pr,r.toast.cancelButtonStyle??o()),Ei(pr,1,cr),ka(vr,r.toast.cancel.label)},[()=>bi(Ni(Q(N)?.cancelButton,r.toast?.classes?.cancelButton))]),et(zt,pr)};Ot(rr,zt=>{zl(r.toast.cancel)&&zt(Lr)},!0)}et(De,Dt)};Ot(dt,De=>{typeof r.toast.cancel=="function"?De(wt):De(Pe,!1)})}et(Ne,Le)};Ot(dr,Ne=>{r.toast.cancel&&Ne(hr)})}var Fr=Or(dr,2);{var Lt=Ne=>{var Le=St(),dt=yt(Le);{var wt=De=>{var Dt=St(),rr=yt(Dt);Fi(rr,()=>r.toast.action,(Lr,zt)=>{zt(Lr,{})}),et(De,Dt)},Pe=De=>{var Dt=St(),rr=yt(Dt);{var Lr=zt=>{var pr=d_();pr.__click=[f_,r,_t];var vr=Qt(pr);cn(cr=>{Al(pr,r.toast.actionButtonStyle??d()),Ei(pr,1,cr),ka(vr,r.toast.action.label)},[()=>bi(Ni(Q(N)?.actionButton,r.toast?.classes?.actionButton))]),et(zt,pr)};Ot(rr,zt=>{zl(r.toast.action)&&zt(Lr)},!0)}et(De,Dt)};Ot(dt,De=>{typeof r.toast.action=="function"?De(wt):De(Pe,!1)})}et(Ne,Le)};Ot(Fr,Ne=>{r.toast.action&&Ne(Lt)})}cn(Ne=>Ei(ht,1,Ne),[()=>bi(Ni(Q(N)?.title,r.toast?.classes?.title))]),et(pt,Tt)};Ot(ga,pt=>{r.toast.component?pt(Ci):pt(tr,!1)})}vp(Et,pt=>qe(me,pt),()=>Q(me)),cn((pt,Tt,kt,ot)=>{Ei(Et,1,pt),Xt(Et,"data-rich-colors",r.toast.richColors??_()),Xt(Et,"data-styled",!(r.toast.component||r.toast.unstyled||b())),Xt(Et,"data-mounted",Q(R)),Xt(Et,"data-promise",Tt),Xt(Et,"data-swiped",Q(W)),Xt(Et,"data-removed",Q(P)),Xt(Et,"data-visible",Q(Se)),Xt(Et,"data-y-position",Q(xe)[0]),Xt(Et,"data-x-position",Q(xe)[1]),Xt(Et,"data-index",r.index),Xt(Et,"data-front",Q(Ee)),Xt(Et,"data-swiping",Q(O)),Xt(Et,"data-dismissable",Q(ne)),Xt(Et,"data-type",Q(z)),Xt(Et,"data-invert",Q(ft)),Xt(Et,"data-swipe-out",Q(F)),Xt(Et,"data-swipe-direction",Q(ce)),Xt(Et,"data-expanded",kt),qn=Al(Et,`${r.style} ${r.toast.style}`,qn,ot)},[()=>bi(Ni(r.class,Q(ke),Q(N)?.toast,r.toast?.classes?.toast,Q(N)?.[Q(z)],r.toast?.classes?.[Q(z)])),()=>!!r.toast.promise,()=>!!(r.expanded||r.expandByDefault&&Q(R)),()=>({"--index":r.index,"--toasts-before":r.index,"--z-index":Yt.toasts.length-r.index,"--offset":`${Q(P)?Q(H):Q(rt)}px`,"--initial-height":r.expandByDefault?"auto":`${Q(Z)}px`})]),sp("dragend",Et,Nr),et(t,Et),Ua()}ru(["pointermove","pointerup","pointerdown","click"]);var g_=Go('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" height="20" width="20" data-sonner-success-icon=""><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd"></path></svg>');function m_(t){var r=g_();et(t,r)}var y_=Go('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" height="20" width="20" data-sonner-error-icon=""><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path></svg>');function b_(t){var r=y_();et(t,r)}var E_=Go('<svg viewBox="0 0 64 64" fill="currentColor" height="20" width="20" data-sonner-warning-icon="" xmlns="http://www.w3.org/2000/svg"><path d="M32.427,7.987c2.183,0.124 4,1.165 5.096,3.281l17.936,36.208c1.739,3.66 -0.954,8.585 -5.373,8.656l-36.119,0c-4.022,-0.064 -7.322,-4.631 -5.352,-8.696l18.271,-36.207c0.342,-0.65 0.498,-0.838 0.793,-1.179c1.186,-1.375 2.483,-2.111 4.748,-2.063Zm-0.295,3.997c-0.687,0.034 -1.316,0.419 -1.659,1.017c-6.312,11.979 -12.397,24.081 -18.301,36.267c-0.546,1.225 0.391,2.797 1.762,2.863c12.06,0.195 24.125,0.195 36.185,0c1.325,-0.064 2.321,-1.584 1.769,-2.85c-5.793,-12.184 -11.765,-24.286 -17.966,-36.267c-0.366,-0.651 -0.903,-1.042 -1.79,-1.03Z"></path><path d="M33.631,40.581l-3.348,0l-0.368,-16.449l4.1,0l-0.384,16.449Zm-3.828,5.03c0,-0.609 0.197,-1.113 0.592,-1.514c0.396,-0.4 0.935,-0.601 1.618,-0.601c0.684,0 1.223,0.201 1.618,0.601c0.395,0.401 0.593,0.905 0.593,1.514c0,0.587 -0.193,1.078 -0.577,1.473c-0.385,0.395 -0.929,0.593 -1.634,0.593c-0.705,0 -1.249,-0.198 -1.634,-0.593c-0.384,-0.395 -0.576,-0.886 -0.576,-1.473Z"></path></svg>');function __(t){var r=E_();et(t,r)}var T_=Go('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" height="20" width="20" data-sonner-info-icon=""><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"></path></svg>');function S_(t){var r=T_();et(t,r)}var x_=Go('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-sonner-close-icon=""><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>');function A_(t){var r=x_();et(t,r)}const C_=3,Nv="24px",Fv="16px",L_=4e3,R_=356,k_=14,mc="dark",_l="light";function w_(t,r){const i={};return[t,r].forEach((o,d)=>{const p=d===1,b=p?"--mobile-offset":"--offset",_=p?Fv:Nv;function x(R){["top","right","bottom","left"].forEach(P=>{i[`${b}-${P}`]=typeof R=="number"?`${R}px`:R})}typeof o=="number"||typeof o=="string"?x(o):typeof o=="object"?["top","right","bottom","left"].forEach(R=>{const P=o[R];P===void 0?i[`${b}-${R}`]=_:i[`${b}-${R}`]=typeof P=="number"?`${P}px`:P}):x(_)}),i}var I_=Yr("<ol></ol>"),P_=Yr('<section aria-live="polite" aria-relevant="additions text" aria-atomic="false" class="svelte-tppj9g"><!></section>');function D_(t,r){Ba(r,!0);function i(rt){return rt!=="system"?rt:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?mc:_l}let o=fr(r,"invert",3,!1),d=fr(r,"position",3,"bottom-right"),p=fr(r,"hotkey",19,()=>["altKey","KeyT"]),b=fr(r,"expand",3,!1),_=fr(r,"closeButton",3,!1),x=fr(r,"offset",3,Nv),R=fr(r,"mobileOffset",3,Fv),P=fr(r,"theme",3,"light"),O=fr(r,"richColors",3,!1),F=fr(r,"duration",3,L_),W=fr(r,"visibleToasts",3,C_),H=fr(r,"toastOptions",19,()=>({})),Z=fr(r,"dir",7,"auto"),_e=fr(r,"gap",3,k_),me=fr(r,"containerAriaLabel",3,"Notifications"),le=fr(r,"closeButtonAriaLabel",3,"Close toast"),ce=hy(r,["$$slots","$$events","$$legacy","invert","position","hotkey","expand","closeButton","offset","mobileOffset","theme","richColors","duration","visibleToasts","toastOptions","dir","gap","loadingIcon","successIcon","errorIcon","warningIcon","closeIcon","infoIcon","containerAriaLabel","class","closeButtonAriaLabel","onblur","onfocus","onmouseenter","onmousemove","onmouseleave","ondragend","onpointerdown","onpointerup"]);function Ee(){if(Z()!=="auto")return Z();if(typeof window>"u"||typeof document>"u")return"ltr";const rt=document.documentElement.getAttribute("dir");return rt==="auto"||!rt?(dn(()=>Z(window.getComputedStyle(document.documentElement).direction??"ltr")),Z()):(dn(()=>Z(rt)),rt)}const Se=Rt(()=>Array.from(new Set([d(),...Yt.toasts.filter(rt=>rt.position).map(rt=>rt.position)].filter(Boolean))));let z=Pt(!1),ne=Pt(!1),ke=Pt(jn(i(P()))),Ce=Pt(void 0),Be=Pt(null),ze=Pt(!1);const Ye=Rt(()=>p().join("+").replace(/Key/g,"").replace(/Digit/g,""));Vn(()=>{Yt.toasts.length<=1&&qe(z,!1)}),Vn(()=>{const rt=Yt.toasts.filter(_t=>_t.dismiss&&!_t.delete);if(rt.length>0){const _t=Yt.toasts.map(lr=>rt.find(br=>br.id===lr.id)?{...lr,delete:!0}:lr);Yt.toasts=_t}}),Vn(()=>()=>{Q(Ce)&&Q(Be)&&(Q(Be).focus({preventScroll:!0}),qe(Be,null),qe(ze,!1))}),jo(()=>(Yt.reset(),Gl(document,"keydown",_t=>{p().every(Zt=>_t[Zt]||_t.code===Zt)&&(qe(z,!0),Q(Ce)?.focus()),_t.code==="Escape"&&(document.activeElement===Q(Ce)||Q(Ce)?.contains(document.activeElement))&&qe(z,!1)}))),Vn(()=>{if(P()!=="system"&&qe(ke,P()),typeof window<"u"){P()==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?qe(ke,mc):qe(ke,_l));const rt=window.matchMedia("(prefers-color-scheme: dark)"),_t=({matches:lr})=>{qe(ke,lr?mc:_l,!0)};"addEventListener"in rt?rt.addEventListener("change",_t):rt.addListener(_t)}});const He=rt=>{r.onblur?.(rt),Q(ze)&&!rt.currentTarget.contains(rt.relatedTarget)&&(qe(ze,!1),Q(Be)&&(Q(Be).focus({preventScroll:!0}),qe(Be,null)))},xe=rt=>{r.onfocus?.(rt),!(rt.target instanceof HTMLElement&&rt.target.dataset.dismissable==="false")&&(Q(ze)||(qe(ze,!0),qe(Be,rt.relatedTarget,!0)))},er=rt=>{r.onpointerdown?.(rt),!(rt.target instanceof HTMLElement&&rt.target.dataset.dismissable==="false")&&qe(ne,!0)},Tr=rt=>{r.onmouseenter?.(rt),qe(z,!0)},ft=rt=>{r.onmouseleave?.(rt),Q(ne)||qe(z,!1)},be=rt=>{r.onmousemove?.(rt),qe(z,!0)},N=rt=>{r.ondragend?.(rt),qe(z,!1)},ut=rt=>{r.onpointerup?.(rt),qe(ne,!1)};qE.set(new $E);var st=P_();Xt(st,"tabindex",-1);var zr=Qt(st);{var $r=rt=>{var _t=St(),lr=yt(_t);jl(lr,18,()=>Q(Se),Zt=>Zt,(Zt,br,Je,An)=>{const On=Rt(()=>{const[kr,Et]=br.split("-");return{y:kr,x:Et}}),tt=Rt(()=>w_(x(),R()));var Nr=I_();ly(Nr,(kr,Et)=>({tabindex:-1,dir:kr,class:r.class,"data-sonner-toaster":!0,"data-sonner-theme":Q(ke),"data-y-position":Q(On).y,"data-x-position":Q(On).x,style:r.style,onblur:He,onfocus:xe,onmouseenter:Tr,onmousemove:be,onmouseleave:ft,ondragend:N,onpointerdown:er,onpointerup:ut,...ce,[As]:Et}),[Ee,()=>({"--front-toast-height":`${Yt.heights[0]?.height}px`,"--width":`${R_}px`,"--gap":`${_e()}px`,"--offset-top":Q(tt)["--offset-top"],"--offset-right":Q(tt)["--offset-right"],"--offset-bottom":Q(tt)["--offset-bottom"],"--offset-left":Q(tt)["--offset-left"],"--mobile-offset-top":Q(tt)["--mobile-offset-top"],"--mobile-offset-right":Q(tt)["--mobile-offset-right"],"--mobile-offset-bottom":Q(tt)["--mobile-offset-bottom"],"--mobile-offset-left":Q(tt)["--mobile-offset-left"]})],void 0,"svelte-tppj9g"),jl(Nr,23,()=>Yt.toasts.filter(kr=>!kr.position&&Q(Je)===0||kr.position===br),kr=>kr.id,(kr,Et,qn,va)=>{{const En=dr=>{var hr=St(),Fr=yt(hr);{var Lt=Le=>{var dt=St(),wt=yt(dt);ni(wt,()=>r.successIcon??rn),et(Le,dt)},Ne=Le=>{var dt=St(),wt=yt(dt);{var Pe=De=>{m_(De)};Ot(wt,De=>{r.successIcon!==null&&De(Pe)},!0)}et(Le,dt)};Ot(Fr,Le=>{r.successIcon?Le(Lt):Le(Ne,!1)})}et(dr,hr)},ga=dr=>{var hr=St(),Fr=yt(hr);{var Lt=Le=>{var dt=St(),wt=yt(dt);ni(wt,()=>r.errorIcon??rn),et(Le,dt)},Ne=Le=>{var dt=St(),wt=yt(dt);{var Pe=De=>{b_(De)};Ot(wt,De=>{r.errorIcon!==null&&De(Pe)},!0)}et(Le,dt)};Ot(Fr,Le=>{r.errorIcon?Le(Lt):Le(Ne,!1)})}et(dr,hr)},Ci=dr=>{var hr=St(),Fr=yt(hr);{var Lt=Le=>{var dt=St(),wt=yt(dt);ni(wt,()=>r.warningIcon??rn),et(Le,dt)},Ne=Le=>{var dt=St(),wt=yt(dt);{var Pe=De=>{__(De)};Ot(wt,De=>{r.warningIcon!==null&&De(Pe)},!0)}et(Le,dt)};Ot(Fr,Le=>{r.warningIcon?Le(Lt):Le(Ne,!1)})}et(dr,hr)},tr=dr=>{var hr=St(),Fr=yt(hr);{var Lt=Le=>{var dt=St(),wt=yt(dt);ni(wt,()=>r.infoIcon??rn),et(Le,dt)},Ne=Le=>{var dt=St(),wt=yt(dt);{var Pe=De=>{S_(De)};Ot(wt,De=>{r.infoIcon!==null&&De(Pe)},!0)}et(Le,dt)};Ot(Fr,Le=>{r.infoIcon?Le(Lt):Le(Ne,!1)})}et(dr,hr)},pt=dr=>{var hr=St(),Fr=yt(hr);{var Lt=Le=>{var dt=St(),wt=yt(dt);ni(wt,()=>r.closeIcon??rn),et(Le,dt)},Ne=Le=>{var dt=St(),wt=yt(dt);{var Pe=De=>{A_(De)};Ot(wt,De=>{r.closeIcon!==null&&De(Pe)},!0)}et(Le,dt)};Ot(Fr,Le=>{r.closeIcon?Le(Lt):Le(Ne,!1)})}et(dr,hr)};let Tt=Rt(()=>H()?.duration??F()),kt=Rt(()=>H()?.class??""),ot=Rt(()=>H()?.descriptionClass||""),Gt=Rt(()=>H()?.style??""),ht=Rt(()=>H().classes||{}),ur=Rt(()=>H().unstyled??!1),pn=Rt(()=>H()?.cancelButtonStyle??""),Nn=Rt(()=>H()?.actionButtonStyle??""),si=Rt(()=>H()?.closeButtonAriaLabel??le());v_(kr,{get index(){return Q(qn)},get toast(){return Q(Et)},get defaultRichColors(){return O()},get duration(){return Q(Tt)},get class(){return Q(kt)},get descriptionClass(){return Q(ot)},get invert(){return o()},get visibleToasts(){return W()},get closeButton(){return _()},get interacting(){return Q(ne)},get position(){return br},get style(){return Q(Gt)},get classes(){return Q(ht)},get unstyled(){return Q(ur)},get cancelButtonStyle(){return Q(pn)},get actionButtonStyle(){return Q(Nn)},get closeButtonAriaLabel(){return Q(si)},get expandByDefault(){return b()},get expanded(){return Q(z)},get loadingIcon(){return r.loadingIcon},successIcon:En,errorIcon:ga,warningIcon:Ci,infoIcon:tr,closeIcon:pt,$$slots:{successIcon:!0,errorIcon:!0,warningIcon:!0,infoIcon:!0,closeIcon:!0}})}}),vp(Nr,kr=>qe(Ce,kr),()=>Q(Ce)),cn(()=>Nr.dir=Nr.dir),et(Zt,Nr)}),et(rt,_t)};Ot(zr,rt=>{Yt.toasts.length>0&&rt($r)})}cn(()=>Xt(st,"aria-label",`${me()??""} ${Q(Ye)??""}`)),et(t,st),Ua()}var M_=(t,r,i)=>r(Q(i).id),O_=Yr('<tr class="svelte-1xmr6pi"><th class="svelte-1xmr6pi"><button class="btn btn-xs btn-ghost svelte-1xmr6pi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2 svelte-1xmr6pi"><path d="M10 11v6" class="svelte-1xmr6pi"></path><path d="M14 11v6" class="svelte-1xmr6pi"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" class="svelte-1xmr6pi"></path><path d="M3 6h18" class="svelte-1xmr6pi"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" class="svelte-1xmr6pi"></path></svg></button></th><td class="svelte-1xmr6pi"></td><td class="svelte-1xmr6pi"> </td><td class="break-all whitespace-normal svelte-1xmr6pi"> </td></tr>'),N_=Yr('<div class="max-w-11/12 mx-auto mt-5 svelte-1xmr6pi"><form class="join w-full svelte-1xmr6pi"><input class="input join-item w-1/3 svelte-1xmr6pi" placeholder="name" required/> <input class="input join-item w-2/3 svelte-1xmr6pi" placeholder="url" required/> <button class="btn join-item rounded-r-full btn-primary svelte-1xmr6pi" type="submit"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-diamond-plus-icon lucide-diamond-plus svelte-1xmr6pi"><path d="M12 8v8" class="svelte-1xmr6pi"></path><path d="M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41L13.7 2.71a2.41 2.41 0 0 0-3.41 0z" class="svelte-1xmr6pi"></path><path d="M8 12h8" class="svelte-1xmr6pi"></path></svg></button></form> <br class="svelte-1xmr6pi"/> <br class="svelte-1xmr6pi"/> <div class="overflow-x-auto svelte-1xmr6pi"><table class="table table-zebra svelte-1xmr6pi"><thead class="svelte-1xmr6pi"><tr class="text-center svelte-1xmr6pi"><th class="svelte-1xmr6pi"></th><th class="svelte-1xmr6pi">#</th><th class="svelte-1xmr6pi">Name</th><th class="svelte-1xmr6pi">URL</th></tr></thead><tbody class="svelte-1xmr6pi"></tbody></table></div></div>'),F_=Yr('<div class="max-w-1/2 mx-auto mt-5 text-center svelte-1xmr6pi"><div class="loader svelte-1xmr6pi">Connecting...</div></div>'),B_=Yr("<!> <!>",1);function U_(t,r){Ba(r,!0);let i=Pt(!1),o=Pt(void 0),d=Pt(jn([]));jo(()=>{const H=new zy("",{config:{iceServers:[]}});H.on("open",async function(Z){console.log("client peer ID:",Z),qe(i,!1),qe(o,H.connect(r.params.peerId),!0),Q(o).on("open",()=>{qe(i,!0),Q(o).send({type:"id",id:Z})}),Q(o).on("data",function(_e){if(_e.type==="channels"&&qe(d,_e.channels,!0),_e.type==="response"){let{status:me,message:le,remainingChannels:ce}=_e.response;me==="success"?(gc.success(le),qe(b,""),qe(_,""),qe(d,ce,!0)):gc.error(le)}}),Q(o).on("close",()=>{console.log("❌ Disconnected!")})})});const p=async H=>{Q(o).open?Q(o).send({type:"delete",id:H}):gc.error("Not connected.")};let b=Pt(""),_=Pt("");const x=async H=>{H.preventDefault(),Q(o).open?Q(o).send({type:"add",data:{name:Q(b),url:Q(_)}}):console.log("Not connected.")};var R=B_(),P=yt(R);{var O=H=>{var Z=N_(),_e=Qt(Z),me=Qt(_e),le=Or(me,2),ce=Or(_e,6),Ee=Qt(ce),Se=Or(Qt(Ee));jl(Se,21,()=>Q(d),J0,(z,ne,ke)=>{var Ce=O_(),Be=Qt(Ce),ze=Qt(Be);ze.__click=[M_,p,ne];var Ye=Or(Be);Ye.textContent=ke+1;var He=Or(Ye),xe=Qt(He),er=Or(He),Tr=Qt(er);cn(()=>{ka(xe,Q(ne).name),ka(Tr,Q(ne).url)}),et(z,Ce)}),sp("submit",_e,x),md(me,()=>Q(b),z=>qe(b,z)),md(le,()=>Q(_),z=>qe(_,z)),et(H,Z)},F=H=>{var Z=F_();et(H,Z)};Ot(P,H=>{Q(i)?H(O):H(F,!1)})}var W=Or(P,2);D_(W,{position:"bottom-right",expand:!1,richColors:!0}),et(t,R),Ua()}ru(["click"]);function G_(t){const r={"/":Eh,"/:peerId":U_,"*":Eh};Ty(t,{get routes(){return r}})}$0(G_,{target:document.getElementById("app")});
